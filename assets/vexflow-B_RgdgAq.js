class w extends Error{constructor(e,i=""){super("[RuntimeError] "+e+": "+i),this.code=e}}function ge(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:Function("return this")()}function _(t,e="undefined",i=""){if(t===void 0)throw new w(e,i);return t}function j(t,...e){if(!e)return;const i=Array.prototype.slice.call(e).join(" ");ge().console.log(t+": "+i)}function Vi(...t){const e=t.join(" "),i=new Error;ge().console.log("Warning: ",e,i.stack)}function Yi(t,e){return t%e>=e/2?parseInt(`${t/e}`,10)*e+e:parseInt(`${t/e}`,10)*e}function qe(t,e){let i=e+(t-e)/2;return i%2>0&&(i=Yi(i*10,5)/10),i}function je(t){return`vf-${t}`}function oi(t){return t=t%(2*Math.PI),t<0&&(t+=2*Math.PI),t}function he(t){return t.reduce((e,i)=>e+i,0)}class P{static get CATEGORY(){return"Fraction"}static GCD(e,i){if(typeof e!="number"||Number.isNaN(e)||typeof i!="number"||Number.isNaN(i))throw new w("BadArgument",`Invalid numbers: ${e}, ${i}`);let n;for(;i!==0;)n=i,i=e%i,e=n;return e}static LCM(e,i){return e*i/P.GCD(e,i)}static LCMM(e){return e.length===0?0:e.length===1?e[0]:e.length===2?P.LCM(e[0],e[1]):P.LCM(e.shift(),P.LCMM(e))}constructor(e,i){this.numerator=1,this.denominator=1,this.set(e,i)}set(e=1,i=1){return this.numerator=e,this.denominator=i,this}value(){return this.numerator/this.denominator}simplify(){let e=this.numerator,i=this.denominator;const n=P.GCD(e,i);return e/=n,i/=n,i<0&&(i=-i,e=-e),this.set(e,i)}add(e=0,i=1){const[n,a]=Te(e,i),o=P.LCM(this.denominator,a),r=o/this.denominator,s=o/a,c=this.numerator*r+n*s;return this.set(c,o)}subtract(e=0,i=1){const[n,a]=Te(e,i),o=P.LCM(this.denominator,a),r=o/this.denominator,s=o/a,c=this.numerator*r-n*s;return this.set(c,o)}multiply(e=1,i=1){const[n,a]=Te(e,i);return this.set(this.numerator*n,this.denominator*a)}divide(e=1,i=1){const[n,a]=Te(e,i);return this.set(this.numerator*a,this.denominator*n)}equals(e){const i=P.fractionA.copy(e).simplify(),n=P.fractionB.copy(this).simplify();return i.numerator===n.numerator&&i.denominator===n.denominator}greaterThan(e){const i=P.fractionA.copy(this);return i.subtract(e),i.numerator>0}greaterThanEquals(e){const i=P.fractionA.copy(this);return i.subtract(e),i.numerator>=0}lessThan(e){return!this.greaterThanEquals(e)}lessThanEquals(e){return!this.greaterThan(e)}clone(){return new P(this.numerator,this.denominator)}copy(e){return typeof e=="number"?this.set(e):this.set(e.numerator,e.denominator)}quotient(){return Math.floor(this.numerator/this.denominator)}remainder(){return this.numerator%this.denominator}makeAbs(){return this.denominator=Math.abs(this.denominator),this.numerator=Math.abs(this.numerator),this}toString(){return`${this.numerator}/${this.denominator}`}toSimplifiedString(){return P.fractionA.copy(this).simplify().toString()}toMixedString(){let e="";const i=this.quotient(),n=P.fractionA.copy(this);return i<0&&n.makeAbs(),i!==0?(e+=i,n.numerator!==0&&(e+=` ${n.toSimplifiedString()}`)):n.numerator===0?e="0":e=n.toSimplifiedString(),e}parse(e){const i=e.split("/"),n=parseInt(i[0],10),a=i[1]?parseInt(i[1],10):1;return this.set(n,a)}}P.fractionA=new P;P.fractionB=new P;function Te(t,e=1){return typeof t=="number"?[t,e]:[t.numerator,t.denominator]}class F{static clear(e){e?(this.cacheFont.delete(e),this.cacheStyle.delete(e)):(this.cacheFont.clear(),this.cacheStyle.clear())}static getFontInfo(e){let i=this.cacheFont.get(e);return i||(i={family:F.get(`${e}.fontFamily`),size:F.get(`${e}.fontSize`)*F.get(`${e}.fontScale`),weight:F.get(`${e}.fontWeight`),style:F.get(`${e}.fontStyle`)},this.cacheFont.set(e,i)),structuredClone(i)}static getStyle(e){let i=this.cacheStyle.get(e);return i||(i={fillStyle:F.get(`${e}.fillStyle`),strokeStyle:F.get(`${e}.strokeStyle`),lineWidth:F.get(`${e}.lineWidth`),lineDash:F.get(`${e}.lineDash`),shadowBlur:F.get(`${e}.shadowBlur`),shadowColor:F.get(`${e}.shadowColor`)},this.cacheStyle.set(e,i)),structuredClone(i)}static get(e,i){var n;const a=e.split("."),o=a.pop();let r=ue,s=i;for(;r;){s=(n=r[o])!==null&&n!==void 0?n:s;const c=a.shift();if(c)r=r[c];else break}return s}}F.cacheStyle=new Map;F.cacheFont=new Map;const ue={fontFamily:"Bravura,Academico",fontSize:30,fontScale:1,fontWeight:"normal",fontStyle:"normal",Accidental:{cautionary:{fontSize:20},grace:{fontSize:20},noteheadAccidentalPadding:1,leftPadding:2,accidentalSpacing:3},Annotation:{fontSize:10},Bend:{fontSize:10,line:{strokeStyle:"#777777",lineWidth:1}},ChordSymbol:{fontSize:12,spacing:.05,subscriptOffset:.2,superscriptOffset:-.4,superSubRatio:.6},FretHandFinger:{fontSize:9,fontWeight:"bold"},GraceNote:{fontScale:2/3},GraceTabNote:{fontScale:2/3},NoteHead:{minPadding:2},PedalMarking:{text:{fontSize:12,fontStyle:"italic"}},Repetition:{text:{fontSize:12,fontWeight:"bold",offsetX:12,offsetY:25,spacing:5},coda:{offsetY:25},segno:{offsetY:10}},Stave:{strokeStyle:"#999999",fontSize:8,padding:12,endPaddingMax:10,endPaddingMin:5,unalignedNotePadding:10},StaveConnector:{text:{fontSize:16}},StaveLine:{fontSize:10},StaveSection:{fontSize:10,fontWeight:"bold",lineWidth:2,padding:2,strokeStyle:"black"},StaveTempo:{fontSize:14,glyph:{fontSize:25},name:{fontWeight:"bold"}},StaveText:{fontSize:16},StaveTie:{fontSize:10},Stem:{strokeStyle:"black"},StringNumber:{fontSize:10,fontWeight:"bold",verticalPadding:8,stemPadding:2,leftPadding:5,rightPadding:6},Stroke:{text:{fontSize:10,fontStyle:"italic",fontWeight:"bold"}},TabNote:{text:{fontSize:9}},TabSlide:{fontSize:10,fontStyle:"italic",fontWeight:"bold"},TabStave:{strokeStyle:"#999999",fontSize:8},TabTie:{fontSize:10},TextBracket:{fontSize:15,fontStyle:"italic"},TextNote:{text:{fontSize:12}},Tremolo:{spacing:7},Tuplet:{yOffset:0,textYOffset:2},Volta:{fontSize:9,fontWeight:"bold"}};class Nt{static copy(e){return new Nt(e.x,e.y,e.w,e.h)}constructor(e,i,n,a){this.x=e,this.y=i,this.w=n,this.h=a}getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setW(e){return this.w=e,this}setH(e){return this.h=e,this}move(e,i){return this.x+=e,this.y+=i,this}clone(){return Nt.copy(this)}mergeWith(e){const i=e,n=this.x<i.x?this.x:i.x,a=this.y<i.y?this.y:i.y,o=Math.max(this.x+this.w,i.x+i.w)-n,r=Math.max(this.y+this.h,i.y+i.h)-a;return this.x=n,this.y=a,this.w=o,this.h=r,this}}var _i=function(t,e,i,n){function a(o){return o instanceof i?o:new i(function(r){r(o)})}return new(i||(i=Promise))(function(o,r){function s(d){try{u(n.next(d))}catch(h){r(h)}}function c(d){try{u(n.throw(d))}catch(h){r(h)}}function u(d){d.done?o(d.value):a(d.value).then(s,c)}u((n=n.apply(t,e||[])).next())})},qt;(function(t){t.NORMAL="normal",t.BOLD="bold"})(qt||(qt={}));var Ut;(function(t){t.NORMAL="normal",t.ITALIC="italic"})(Ut||(Ut={}));let xe;class W{static convertSizeToPixelValue(e){var i;if(typeof e=="number")return e*W.scaleToPxFrom.pt;{const n=parseFloat(e);if(isNaN(n))return 0;const a=e.replace(/[\d.\s]/g,"").toLowerCase(),o=(i=W.scaleToPxFrom[a])!==null&&i!==void 0?i:1;return n*o}}static convertSizeToPointValue(e){var i;if(typeof e=="number")return e;{const n=parseFloat(e);if(isNaN(n))return 0;const a=e.replace(/[\d.\s]/g,"").toLowerCase(),o=((i=W.scaleToPxFrom[a])!==null&&i!==void 0?i:1)/W.scaleToPxFrom.pt;return n*o}}static validate(e,i,n,a){if(typeof e=="string"&&i===void 0&&n===void 0&&a===void 0)return W.fromCSSString(e);let o;return typeof e=="object"?(o=e.family,i=e.size,n=e.weight,a=e.style):o=e,o=o??F.get("fontFamily"),i=i??F.get("fontSize")+"pt",n=n??qt.NORMAL,a=a??Ut.NORMAL,n===""&&(n=qt.NORMAL),a===""&&(a=Ut.NORMAL),typeof i=="number"&&(i=`${i}pt`),typeof n=="number"&&(n=n.toString()),{family:o,size:i,weight:n,style:a}}static fromCSSString(e){xe||(xe=document.createElement("span")),xe.style.font=e;const{fontFamily:i,fontSize:n,fontWeight:a,fontStyle:o}=xe.style;return{family:i,size:n,weight:a,style:o}}static toCSSString(e){var i;if(!e)return"";let n;const a=e.style;a===Ut.NORMAL||a===""||a===void 0?n="":n=a.trim()+" ";let o;const r=e.weight;r===qt.NORMAL||r===""||r===void 0?o="":typeof r=="number"?o=r+" ":o=r.trim()+" ";let s;const c=e.size;c===void 0?s=F.get("fontSize")+"pt":typeof c=="number"?s=c+"pt ":s=c.trim()+" ";const u=(i=e.family)!==null&&i!==void 0?i:F.get("fontFamily");return`${n}${o}${s}${u}`}static scaleSize(e,i){if(typeof e=="number")return e*i;{const n=parseFloat(e),a=e.replace(/[\d.\s]/g,"");return`${n*i}${a}`}}static isBold(e){if(e){if(typeof e=="number")return e>=600;{const i=parseInt(e,10);return isNaN(i)?e.toLowerCase()==="bold":i>=600}}else return!1}static isItalic(e){return e?e.toLowerCase()===Ut.ITALIC:!1}static load(e,i,n){return _i(this,void 0,void 0,function*(){if(typeof FontFace>"u")return Promise.reject(new Error("FontFace API is not available in this environment. Cannot load fonts."));if(i===void 0){const s=W.FILES;if(!(e in s))return Promise.reject(new Error(`Font ${e} not found in Font.FILES`));i=W.HOST_URL+s[e]}const a=new FontFace(e,`url(${i})`,n),o=a.load();let r;return typeof document<"u"?r=document.fonts:typeof self<"u"&&"fonts"in self&&(r=self.fonts),r?.add(a),o})}static getURLForFont(e){const i=W.FILES;if(e in i)return W.HOST_URL+i[e]}}W.scaleToPxFrom={pt:4/3,px:1,em:16,"%":4/25,in:96,mm:96/25.4,cm:96/2.54};W.HOST_URL="https://cdn.jsdelivr.net/npm/@vexflow-fonts/";W.FILES={Academico:"academico/academico.woff2",Bravura:"bravura/bravura.woff2","Bravura Text":"bravuratext/bravuratext.woff2",Edwin:"edwin/edwin-roman.woff2","Finale Ash":"finaleash/finaleash.woff2","Finale Ash Text":"finaleashtext/finaleashtext.woff2","Finale Broadway":"finalebroadway/finalebroadway.woff2","Finale Broadway Text":"finalebroadwaytext/finalebroadwaytext.woff2","Finale Jazz":"finalejazz/finalejazz.woff2","Finale Jazz Text":"finalejazztext/finalejazztext.woff2","Finale Maestro":"finalemaestro/finalemaestro.woff2","Finale Maestro Text":"finalemaestrotext/finalemaestrotext-regular.woff2",Gonville:"gonville/gonville.woff2",Gootville:"gootville/gootville.woff2","Gootville Text":"gootvilletext/gootvilletext.woff2",Leipzig:"leipzig/leipzig.woff2",Leland:"leland/leland.woff2","Leland Text":"lelandtext/lelandtext.woff2",MuseJazz:"musejazz/musejazz.woff2","MuseJazz Text":"musejazztext/musejazztext.woff2",Nepomuk:"nepomuk/nepomuk.woff2",Petaluma:"petaluma/petaluma.woff2","Petaluma Script":"petalumascript/petalumascript.woff2","Petaluma Text":"petalumatext/petalumatext.woff2","Roboto Slab":"robotoslab/robotoslab-regular-400.woff2",Sebastian:"sebastian/sebastian.woff2","Sebastian Text":"sebastiantext/sebastiantext.woff2"};class ri{constructor(){this.id={},this.type={},this.class={}}}class Zt{static getDefaultRegistry(){return Zt.defaultRegistry}static enableDefaultRegistry(e){Zt.defaultRegistry=e}static disableDefaultRegistry(){Zt.defaultRegistry=void 0}constructor(){this.index=new ri}clear(){return this.index=new ri,this}setIndexValue(e,i,n,a){const o=this.index;o[e][i]||(o[e][i]={}),o[e][i][n]=a}updateIndex({id:e,name:i,value:n,oldValue:a}){const o=this.getElementById(e);a!==void 0&&this.index[i][a]&&delete this.index[i][a][e],n&&o&&this.setIndexValue(i,n,o.getAttribute("id"),o)}register(e,i){if(i=i||e.getAttribute("id"),!i)throw new w("Can't add element without `id` attribute to registry");return e.setAttribute("id",i),this.setIndexValue("id",i,i,e),this.updateIndex({id:i,name:"type",value:e.getAttribute("type"),oldValue:void 0}),e.onRegister(this),this}getElementById(e){var i,n;return(n=(i=this.index.id)===null||i===void 0?void 0:i[e])===null||n===void 0?void 0:n[e]}getElementsByAttribute(e,i){const n=this.index[e];if(n){const a=n[i];if(a)return Object.keys(a).map(r=>a[r])}return[]}getElementsByType(e){return this.getElementsByAttribute("type",e)}getElementsByClass(e){return this.getElementsByAttribute("class",e)}onUpdate(e){return["id","type","class"].includes(e.name)&&this.updateIndex(e),this}}class p{static get CATEGORY(){return"Element"}static newID(){return`auto${p.ID++}`}static setTextMeasurementCanvas(e){p.txtCanvas=e}static getTextMeasurementCanvas(){let e=p.txtCanvas;return e||(typeof document<"u"?e=document.createElement("canvas"):typeof OffscreenCanvas<"u"&&(e=new OffscreenCanvas(300,150)),p.txtCanvas=e),e}constructor(e){var i;this.children=[],this.style={},this._text="",this.metricsValid=!1,this._textMetrics={fontBoundingBoxAscent:0,fontBoundingBoxDescent:0,actualBoundingBoxAscent:0,actualBoundingBoxDescent:0,actualBoundingBoxLeft:0,actualBoundingBoxRight:0,width:0,alphabeticBaseline:0,emHeightAscent:0,emHeightDescent:0,hangingBaseline:0,ideographicBaseline:0},this._height=0,this._width=0,this.xShift=0,this.yShift=0,this.x=0,this.y=0,this.attrs={id:p.newID(),type:e??this.constructor.CATEGORY,class:""},this.rendered=!1,this._fontInfo=F.getFontInfo(this.attrs.type),this.style=F.getStyle(this.attrs.type),this.fontScale=F.get(`${this.attrs.type}.fontScale`),(i=Zt.getDefaultRegistry())===null||i===void 0||i.register(this)}addChild(e){if(e.parent)throw new w("Element","Parent already defined");return e.parent=this,this.children.push(e),this}getCategory(){return this.attrs.type}setStyle(e){return this.style=e,this}setGroupStyle(e){return this.style=e,this.children.forEach(i=>i.setGroupStyle(e)),this}getStyle(){return this.style}applyStyle(e=this.context,i=this.getStyle()){return e?(i.shadowColor&&e.setShadowColor(i.shadowColor),i.shadowBlur&&e.setShadowBlur(i.shadowBlur),i.fillStyle&&e.setFillStyle(i.fillStyle),i.strokeStyle&&e.setStrokeStyle(i.strokeStyle),i.lineWidth&&e.setLineWidth(i.lineWidth),i.lineDash&&e.setLineDash(i.lineDash.split(" ").map(Number)),this):this}drawWithStyle(){const e=this.checkContext();return e.save(),this.applyStyle(e),this.draw(),e.restore(),this}draw(){throw new w("Element","Draw not defined")}hasClass(e){var i;return this.attrs.class?((i=this.attrs.class)===null||i===void 0?void 0:i.split(" ").indexOf(e))!==-1:!1}addClass(e){var i;return this.hasClass(e)?this:(this.attrs.class?this.attrs.class=`${this.attrs.class} ${e}`:this.attrs.class=`${e}`,(i=this.registry)===null||i===void 0||i.onUpdate({id:this.attrs.id,name:"class",value:e,oldValue:void 0}),this)}removeClass(e){var i,n;if(!this.hasClass(e))return this;const a=(i=this.attrs.class)===null||i===void 0?void 0:i.split(" ");return a&&(a.splice(a.indexOf(e)),this.attrs.class=a.join(" ")),(n=this.registry)===null||n===void 0||n.onUpdate({id:this.attrs.id,name:"class",value:void 0,oldValue:e}),this}onRegister(e){return this.registry=e,this}isRendered(){return this.rendered}setRendered(e=!0){return this.rendered=e,this}getAttributes(){return this.attrs}getAttribute(e){return this.attrs[e]}getSVGElement(e=""){const i=je(this.attrs.id+e),n=document.getElementById(i);if(n)return n}setAttribute(e,i){var n;const a=this.attrs.id,o=this.attrs[e];return this.attrs[e]=i,(n=this.registry)===null||n===void 0||n.onUpdate({id:a,name:e,value:i,oldValue:o}),this}getBoundingBox(){return new Nt(this.x+this.xShift,this.y+this.yShift-this.textMetrics.actualBoundingBoxAscent,this.width,this.height)}getContext(){return this.context}setContext(e){return this.context=e,this}checkContext(){return _(this.context,"NoContext","No rendering context attached to instance.")}set font(e){this.setFont(e)}get font(){return W.toCSSString(this._fontInfo)}setFont(e,i,n,a){const o=F.getFontInfo(this.attrs.type),r=typeof e=="object",s=typeof e=="string",c=i===void 0&&n===void 0&&a===void 0;return this.metricsValid=!1,r?this._fontInfo=Object.assign(Object.assign({},o),e):s&&c?this._fontInfo=W.fromCSSString(e):this._fontInfo=W.validate(e??o.family,i??o.size,n??o.weight,a??o.style),this}getFont(){return W.toCSSString(this._fontInfo)}get fontInfo(){return this._fontInfo}set fontInfo(e){this.setFont(e)}setFontSize(e){const i=this.fontInfo;return this.setFont(i.family,e,i.weight,i.style),this}getFontSize(){return this.fontSize}getFontScale(){return this.fontScale}set fontSize(e){this.setFontSize(e)}get fontSize(){let e=this.fontInfo.size;return typeof e=="number"&&(e=`${e}pt`),e}get fontSizeInPoints(){return W.convertSizeToPointValue(this.fontSize)}get fontSizeInPixels(){return W.convertSizeToPixelValue(this.fontSize)}get fontStyle(){return this.fontInfo.style}set fontStyle(e){const i=this.fontInfo;this.setFont(i.family,i.size,i.weight,e)}get fontWeight(){return this.fontInfo.weight+""}set fontWeight(e){const i=this.fontInfo;this.setFont(i.family,i.size,e,i.style)}getWidth(){return this.width}get width(){return this.metricsValid||this.measureText(),this._width}setWidth(e){return this.width=e,this}set width(e){this.metricsValid||this.measureText(),this._width=e}setX(e){return this.x=e,this}getX(){return this.x}getY(){return this.y}setY(e){return this.y=e,this}setYShift(e){return this.yShift=e,this}getYShift(){return this.yShift}setXShift(e){return this.xShift=e,this}getXShift(){return this.xShift}setText(e){return this.text=e,this}set text(e){this.metricsValid=!1,this._text=e}getText(){return this._text}get text(){return this._text}renderText(e,i,n){e.setFont(this._fontInfo),e.fillText(this._text,i+this.x+this.xShift,n+this.y+this.yShift),this.children.forEach(a=>{e.setFont(a.fontInfo),e.fillText(a.text,i+a.x+a.xShift,n+a.y+a.yShift)})}measureText(){var e;const i=(e=p.getTextMeasurementCanvas())===null||e===void 0?void 0:e.getContext("2d");return i?(i.font=W.toCSSString(W.validate(this.fontInfo)),this._textMetrics=i.measureText(this.text),this._height=this._textMetrics.actualBoundingBoxAscent+this._textMetrics.actualBoundingBoxDescent,this._width=this._textMetrics.width,this.metricsValid=!0,this._textMetrics):(console.warn("Element: No context for txtCanvas. Returning empty text metrics."),this._textMetrics)}static measureWidth(e,i=""){var n;const a=(n=p.getTextMeasurementCanvas())===null||n===void 0?void 0:n.getContext("2d");return a?(a.font=W.toCSSString(F.getFontInfo(i)),a.measureText(e).width):(console.warn("Element: No context for txtCanvas. Returning empty text metrics."),0)}getTextMetrics(){return this.textMetrics}get textMetrics(){return this.metricsValid||this.measureText(),this._textMetrics}getHeight(){return this.height}get height(){return this.metricsValid||this.measureText(),this._height}set height(e){this.metricsValid||this.measureText(),this._height=e}setOriginX(e){const i=this.getBoundingBox(),n=Math.abs((i.getX()-this.xShift)/i.getW()),a=(e-n)*i.getW();this.xShift=-a}setOriginY(e){const i=this.getBoundingBox(),n=Math.abs((i.getY()-this.yShift)/i.getH()),a=(e-n)*i.getH();this.yShift=-a}setOrigin(e,i){this.setOriginX(e),this.setOriginY(i)}}p.ID=1e3;var U;(function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.ABOVE=3]="ABOVE",t[t.BELOW=4]="BELOW"})(U||(U={}));class v extends p{static get CATEGORY(){return"Modifier"}static get Position(){return U}static get PositionString(){return{center:U.CENTER,above:U.ABOVE,below:U.BELOW,left:U.LEFT,right:U.RIGHT}}constructor(){super(),this.width=0,this.textLine=0,this.position=v.Position.LEFT,this.spacingFromNextModifier=0}reset(){}getNote(){return _(this.note,"NoNote","Modifier has no note.")}checkAttachedNote(){const e=this.getCategory();return _(this.index,"NoIndex",`Can't draw ${e} without an index.`),_(this.note,"NoNote",`Can't draw ${e} without a note.`)}setNote(e){return this.note=e,this}getIndex(){return this.index}checkIndex(){return _(this.index,"NoIndex","Modifier has an invalid index.")}setIndex(e){return this.index=e,this}getModifierContext(){return this.modifierContext}checkModifierContext(){return _(this.modifierContext,"NoModifierContext","Modifier Context Required")}setModifierContext(e){return this.modifierContext=e,this}getPosition(){return this.position}setPosition(e){return this.position=typeof e=="string"?v.PositionString[e]:e,this.reset(),this}setTextLine(e){return this.textLine=e,this}setYShift(e){return this.yShift=e,this}setSpacingFromNextModifier(e){this.spacingFromNextModifier=e}getSpacingFromNextModifier(){return this.spacingFromNextModifier}setXShift(e){return this.xShift=0,this.position===v.Position.LEFT?this.xShift-=e:this.xShift+=e,this}getXShift(){return this.xShift}draw(){throw this.checkContext(),new w("NotImplemented","draw() not implemented for this modifier.")}alignSubNotesWithNote(e,i,n=v.Position.LEFT){const a=i.getTickContext(),o=a.getMetrics(),r=i.getStave(),s=n===v.Position.RIGHT?a.getX()+this.getSpacingFromNextModifier()*e.length+10:a.getX()-o.modLeftPx-o.modRightPx+this.getSpacingFromNextModifier();e.forEach(c=>{const u=c.getTickContext();r&&c.setStave(r),u.setXOffset(s)})}}class H{static get NUM_TONES(){return this.canonicalNotes.length}static get roots(){return["c","d","e","f","g","a","b"]}static get rootValues(){return[0,2,4,5,7,9,11]}static get rootIndexes(){return{c:0,d:1,e:2,f:3,g:4,a:5,b:6}}static get canonicalNotes(){return["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"]}static get diatonicIntervals(){return["unison","m2","M2","m3","M3","p4","dim5","p5","m6","M6","b7","M7","octave"]}static get diatonicAccidentals(){return{unison:{note:0,accidental:0},m2:{note:1,accidental:-1},M2:{note:1,accidental:0},m3:{note:2,accidental:-1},M3:{note:2,accidental:0},p4:{note:3,accidental:0},dim5:{note:4,accidental:-1},p5:{note:4,accidental:0},m6:{note:5,accidental:-1},M6:{note:5,accidental:0},b7:{note:6,accidental:-1},M7:{note:6,accidental:0},octave:{note:7,accidental:0}}}static get intervals(){return{u:0,unison:0,m2:1,b2:1,min2:1,S:1,H:1,2:2,M2:2,maj2:2,T:2,W:2,m3:3,b3:3,min3:3,M3:4,3:4,maj3:4,4:5,p4:5,"#4":6,b5:6,aug4:6,dim5:6,5:7,p5:7,"#5":8,b6:8,aug5:8,6:9,M6:9,maj6:9,b7:10,m7:10,min7:10,dom7:10,M7:11,maj7:11,8:12,octave:12}}static get scales(){return{major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2],ionian:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],phyrgian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2]}}static get scaleTypes(){return{M:H.scales.major,m:H.scales.minor}}static get accidentals(){return["bb","b","n","#","##"]}static get noteValues(){return{c:{rootIndex:0,intVal:0},cn:{rootIndex:0,intVal:0},"c#":{rootIndex:0,intVal:1},"c##":{rootIndex:0,intVal:2},cb:{rootIndex:0,intVal:11},cbb:{rootIndex:0,intVal:10},d:{rootIndex:1,intVal:2},dn:{rootIndex:1,intVal:2},"d#":{rootIndex:1,intVal:3},"d##":{rootIndex:1,intVal:4},db:{rootIndex:1,intVal:1},dbb:{rootIndex:1,intVal:0},e:{rootIndex:2,intVal:4},en:{rootIndex:2,intVal:4},"e#":{rootIndex:2,intVal:5},"e##":{rootIndex:2,intVal:6},eb:{rootIndex:2,intVal:3},ebb:{rootIndex:2,intVal:2},f:{rootIndex:3,intVal:5},fn:{rootIndex:3,intVal:5},"f#":{rootIndex:3,intVal:6},"f##":{rootIndex:3,intVal:7},fb:{rootIndex:3,intVal:4},fbb:{rootIndex:3,intVal:3},g:{rootIndex:4,intVal:7},gn:{rootIndex:4,intVal:7},"g#":{rootIndex:4,intVal:8},"g##":{rootIndex:4,intVal:9},gb:{rootIndex:4,intVal:6},gbb:{rootIndex:4,intVal:5},a:{rootIndex:5,intVal:9},an:{rootIndex:5,intVal:9},"a#":{rootIndex:5,intVal:10},"a##":{rootIndex:5,intVal:11},ab:{rootIndex:5,intVal:8},abb:{rootIndex:5,intVal:7},b:{rootIndex:6,intVal:11},bn:{rootIndex:6,intVal:11},"b#":{rootIndex:6,intVal:0},"b##":{rootIndex:6,intVal:1},bb:{rootIndex:6,intVal:10},bbb:{rootIndex:6,intVal:9}}}isValidNoteValue(e){return e>=0&&e<H.canonicalNotes.length}isValidIntervalValue(e){return e>=0&&e<H.diatonicIntervals.length}getNoteParts(e){if(!e||e.length<1)throw new w("BadArguments","Invalid note name: "+e);if(e.length>3)throw new w("BadArguments","Invalid note name: "+e);const i=e.toLowerCase(),a=/^([cdefgab])(b|bb|n|#|##)?$/.exec(i);if(a!==null){const o=a[1],r=a[2];return{root:o,accidental:r}}else throw new w("BadArguments","Invalid note name: "+e)}getKeyParts(e){if(!e||e.length<1)throw new w("BadArguments","Invalid key: "+e);const i=e.toLowerCase(),a=/^([cdefgab])(b|#)?(mel|harm|m|M)?$/.exec(i);if(a!==null){const o=a[1],r=a[2];let s=a[3];return s||(s="M"),{root:o,accidental:r,type:s}}else throw new w("BadArguments",`Invalid key: ${e}`)}getNoteValue(e){const i=H.noteValues[e];if(i===void 0)throw new w("BadArguments",`Invalid note name: ${e}`);return i.intVal}getIntervalValue(e){const i=H.intervals[e];if(i===void 0)throw new w("BadArguments",`Invalid interval name: ${e}`);return i}getCanonicalNoteName(e){if(!this.isValidNoteValue(e))throw new w("BadArguments",`Invalid note value: ${e}`);return H.canonicalNotes[e]}getCanonicalIntervalName(e){if(!this.isValidIntervalValue(e))throw new w("BadArguments",`Invalid interval value: ${e}`);return H.diatonicIntervals[e]}getRelativeNoteValue(e,i,n=1){if(n!==1&&n!==-1)throw new w("BadArguments",`Invalid direction: ${n}`);let a=(e+n*i)%H.NUM_TONES;return a<0&&(a+=H.NUM_TONES),a}getRelativeNoteName(e,i){const n=this.getNoteParts(e),a=this.getNoteValue(n.root);let o=i-a;if(Math.abs(o)>H.NUM_TONES-3){let s=1;o>0&&(s=-1);const c=(i+1+(a+1))%H.NUM_TONES*s;if(Math.abs(c)>2)throw new w("BadArguments",`Notes not related: ${e}, ${i})`);o=c}if(Math.abs(o)>2)throw new w("BadArguments",`Notes not related: ${e}, ${i})`);let r=n.root;if(o>0)for(let s=1;s<=o;++s)r+="#";else if(o<0)for(let s=-1;s>=o;--s)r+="b";return r}getScaleTones(e,i){const n=[e];let a=e;for(let o=0;o<i.length;o++)a=this.getRelativeNoteValue(a,i[o]),a!==e&&n.push(a);return n}getIntervalBetween(e,i,n=1){if(n!==1&&n!==-1)throw new w("BadArguments",`Invalid direction: ${n}`);if(!this.isValidNoteValue(e)||!this.isValidNoteValue(i))throw new w("BadArguments",`Invalid notes: ${e}, ${i}`);let a=n===1?i-e:e-i;return a<0&&(a+=H.NUM_TONES),a}createScaleMap(e){const i=this.getKeyParts(e);if(!i.type)throw new w("BadArguments","Unsupported key type: undefined");const n=H.scaleTypes[i.type];let a=i.root;if(i.accidental&&(a+=i.accidental),!n)throw new w("BadArguments","Unsupported key type: "+e);const o=this.getScaleTones(this.getNoteValue(a),n),r=H.rootIndexes[i.root],s={};for(let c=0;c<H.roots.length;++c){const u=(r+c)%H.roots.length,d=H.roots[u];let h=this.getRelativeNoteName(d,o[c]);h.length===1&&(h+="n"),s[d]=h}return s}}var E;(function(t){t.null="\0",t.fourStringTabClef="",t.sixStringTabClef="",t.accSagittal11LargeDiesisDown="",t.accSagittal11LargeDiesisUp="",t.accSagittal11MediumDiesisDown="",t.accSagittal11MediumDiesisUp="",t.accSagittal11v19LargeDiesisDown="",t.accSagittal11v19LargeDiesisUp="",t.accSagittal11v19MediumDiesisDown="",t.accSagittal11v19MediumDiesisUp="",t.accSagittal11v49CommaDown="",t.accSagittal11v49CommaUp="",t.accSagittal143CommaDown="",t.accSagittal143CommaUp="",t.accSagittal17CommaDown="",t.accSagittal17CommaUp="",t.accSagittal17KleismaDown="",t.accSagittal17KleismaUp="",t.accSagittal19CommaDown="",t.accSagittal19CommaUp="",t.accSagittal19SchismaDown="",t.accSagittal19SchismaUp="",t.accSagittal1MinaDown="",t.accSagittal1MinaUp="",t.accSagittal1TinaDown="",t.accSagittal1TinaUp="",t.accSagittal23CommaDown="",t.accSagittal23CommaUp="",t.accSagittal23SmallDiesisDown="",t.accSagittal23SmallDiesisUp="",t.accSagittal25SmallDiesisDown="",t.accSagittal25SmallDiesisUp="",t.accSagittal2MinasDown="",t.accSagittal2MinasUp="",t.accSagittal2TinasDown="",t.accSagittal2TinasUp="",t.accSagittal35LargeDiesisDown="",t.accSagittal35LargeDiesisUp="",t.accSagittal35MediumDiesisDown="",t.accSagittal35MediumDiesisUp="",t.accSagittal3TinasDown="",t.accSagittal3TinasUp="",t.accSagittal49LargeDiesisDown="",t.accSagittal49LargeDiesisUp="",t.accSagittal49MediumDiesisDown="",t.accSagittal49MediumDiesisUp="",t.accSagittal49SmallDiesisDown="",t.accSagittal49SmallDiesisUp="",t.accSagittal4TinasDown="",t.accSagittal4TinasUp="",t.accSagittal55CommaDown="",t.accSagittal55CommaUp="",t.accSagittal5CommaDown="",t.accSagittal5CommaUp="",t.accSagittal5TinasDown="",t.accSagittal5TinasUp="",t.accSagittal5v11SmallDiesisDown="",t.accSagittal5v11SmallDiesisUp="",t.accSagittal5v13LargeDiesisDown="",t.accSagittal5v13LargeDiesisUp="",t.accSagittal5v13MediumDiesisDown="",t.accSagittal5v13MediumDiesisUp="",t.accSagittal5v19CommaDown="",t.accSagittal5v19CommaUp="",t.accSagittal5v23SmallDiesisDown="",t.accSagittal5v23SmallDiesisUp="",t.accSagittal5v49MediumDiesisDown="",t.accSagittal5v49MediumDiesisUp="",t.accSagittal5v7KleismaDown="",t.accSagittal5v7KleismaUp="",t.accSagittal6TinasDown="",t.accSagittal6TinasUp="",t.accSagittal7CommaDown="",t.accSagittal7CommaUp="",t.accSagittal7TinasDown="",t.accSagittal7TinasUp="",t.accSagittal7v11CommaDown="",t.accSagittal7v11CommaUp="",t.accSagittal7v11KleismaDown="",t.accSagittal7v11KleismaUp="",t.accSagittal7v19CommaDown="",t.accSagittal7v19CommaUp="",t.accSagittal8TinasDown="",t.accSagittal8TinasUp="",t.accSagittal9TinasDown="",t.accSagittal9TinasUp="",t.accSagittalAcute="",t.accSagittalDoubleFlat="",t.accSagittalDoubleFlat11v49CUp="",t.accSagittalDoubleFlat143CUp="",t.accSagittalDoubleFlat17CUp="",t.accSagittalDoubleFlat17kUp="",t.accSagittalDoubleFlat19CUp="",t.accSagittalDoubleFlat19sUp="",t.accSagittalDoubleFlat23CUp="",t.accSagittalDoubleFlat23SUp="",t.accSagittalDoubleFlat25SUp="",t.accSagittalDoubleFlat49SUp="",t.accSagittalDoubleFlat55CUp="",t.accSagittalDoubleFlat5CUp="",t.accSagittalDoubleFlat5v11SUp="",t.accSagittalDoubleFlat5v19CUp="",t.accSagittalDoubleFlat5v23SUp="",t.accSagittalDoubleFlat5v7kUp="",t.accSagittalDoubleFlat7CUp="",t.accSagittalDoubleFlat7v11CUp="",t.accSagittalDoubleFlat7v11kUp="",t.accSagittalDoubleFlat7v19CUp="",t.accSagittalDoubleSharp="",t.accSagittalDoubleSharp11v49CDown="",t.accSagittalDoubleSharp143CDown="",t.accSagittalDoubleSharp17CDown="",t.accSagittalDoubleSharp17kDown="",t.accSagittalDoubleSharp19CDown="",t.accSagittalDoubleSharp19sDown="",t.accSagittalDoubleSharp23CDown="",t.accSagittalDoubleSharp23SDown="",t.accSagittalDoubleSharp25SDown="",t.accSagittalDoubleSharp49SDown="",t.accSagittalDoubleSharp55CDown="",t.accSagittalDoubleSharp5CDown="",t.accSagittalDoubleSharp5v11SDown="",t.accSagittalDoubleSharp5v19CDown="",t.accSagittalDoubleSharp5v23SDown="",t.accSagittalDoubleSharp5v7kDown="",t.accSagittalDoubleSharp7CDown="",t.accSagittalDoubleSharp7v11CDown="",t.accSagittalDoubleSharp7v11kDown="",t.accSagittalDoubleSharp7v19CDown="",t.accSagittalFlat="",t.accSagittalFlat11LDown="",t.accSagittalFlat11MDown="",t.accSagittalFlat11v19LDown="",t.accSagittalFlat11v19MDown="",t.accSagittalFlat11v49CDown="",t.accSagittalFlat11v49CUp="",t.accSagittalFlat143CDown="",t.accSagittalFlat143CUp="",t.accSagittalFlat17CDown="",t.accSagittalFlat17CUp="",t.accSagittalFlat17kDown="",t.accSagittalFlat17kUp="",t.accSagittalFlat19CDown="",t.accSagittalFlat19CUp="",t.accSagittalFlat19sDown="",t.accSagittalFlat19sUp="",t.accSagittalFlat23CDown="",t.accSagittalFlat23CUp="",t.accSagittalFlat23SDown="",t.accSagittalFlat23SUp="",t.accSagittalFlat25SDown="",t.accSagittalFlat25SUp="",t.accSagittalFlat35LDown="",t.accSagittalFlat35MDown="",t.accSagittalFlat49LDown="",t.accSagittalFlat49MDown="",t.accSagittalFlat49SDown="",t.accSagittalFlat49SUp="",t.accSagittalFlat55CDown="",t.accSagittalFlat55CUp="",t.accSagittalFlat5CDown="",t.accSagittalFlat5CUp="",t.accSagittalFlat5v11SDown="",t.accSagittalFlat5v11SUp="",t.accSagittalFlat5v13LDown="",t.accSagittalFlat5v13MDown="",t.accSagittalFlat5v19CDown="",t.accSagittalFlat5v19CUp="",t.accSagittalFlat5v23SDown="",t.accSagittalFlat5v23SUp="",t.accSagittalFlat5v49MDown="",t.accSagittalFlat5v7kDown="",t.accSagittalFlat5v7kUp="",t.accSagittalFlat7CDown="",t.accSagittalFlat7CUp="",t.accSagittalFlat7v11CDown="",t.accSagittalFlat7v11CUp="",t.accSagittalFlat7v11kDown="",t.accSagittalFlat7v11kUp="",t.accSagittalFlat7v19CDown="",t.accSagittalFlat7v19CUp="",t.accSagittalFractionalTinaDown="",t.accSagittalFractionalTinaUp="",t.accSagittalGrave="",t.accSagittalShaftDown="",t.accSagittalShaftUp="",t.accSagittalSharp="",t.accSagittalSharp11LUp="",t.accSagittalSharp11MUp="",t.accSagittalSharp11v19LUp="",t.accSagittalSharp11v19MUp="",t.accSagittalSharp11v49CDown="",t.accSagittalSharp11v49CUp="",t.accSagittalSharp143CDown="",t.accSagittalSharp143CUp="",t.accSagittalSharp17CDown="",t.accSagittalSharp17CUp="",t.accSagittalSharp17kDown="",t.accSagittalSharp17kUp="",t.accSagittalSharp19CDown="",t.accSagittalSharp19CUp="",t.accSagittalSharp19sDown="",t.accSagittalSharp19sUp="",t.accSagittalSharp23CDown="",t.accSagittalSharp23CUp="",t.accSagittalSharp23SDown="",t.accSagittalSharp23SUp="",t.accSagittalSharp25SDown="",t.accSagittalSharp25SUp="",t.accSagittalSharp35LUp="",t.accSagittalSharp35MUp="",t.accSagittalSharp49LUp="",t.accSagittalSharp49MUp="",t.accSagittalSharp49SDown="",t.accSagittalSharp49SUp="",t.accSagittalSharp55CDown="",t.accSagittalSharp55CUp="",t.accSagittalSharp5CDown="",t.accSagittalSharp5CUp="",t.accSagittalSharp5v11SDown="",t.accSagittalSharp5v11SUp="",t.accSagittalSharp5v13LUp="",t.accSagittalSharp5v13MUp="",t.accSagittalSharp5v19CDown="",t.accSagittalSharp5v19CUp="",t.accSagittalSharp5v23SDown="",t.accSagittalSharp5v23SUp="",t.accSagittalSharp5v49MUp="",t.accSagittalSharp5v7kDown="",t.accSagittalSharp5v7kUp="",t.accSagittalSharp7CDown="",t.accSagittalSharp7CUp="",t.accSagittalSharp7v11CDown="",t.accSagittalSharp7v11CUp="",t.accSagittalSharp7v11kDown="",t.accSagittalSharp7v11kUp="",t.accSagittalSharp7v19CDown="",t.accSagittalSharp7v19CUp="",t.accSagittalUnused1="",t.accSagittalUnused2="",t.accSagittalUnused3="",t.accSagittalUnused4="",t.accdnCombDot="",t.accdnCombLH2RanksEmpty="",t.accdnCombLH3RanksEmptySquare="",t.accdnCombRH3RanksEmpty="",t.accdnCombRH4RanksEmpty="",t.accdnDiatonicClef="",t.accdnLH2Ranks16Round="",t.accdnLH2Ranks8Plus16Round="",t.accdnLH2Ranks8Round="",t.accdnLH2RanksFullMasterRound="",t.accdnLH2RanksMasterPlus16Round="",t.accdnLH2RanksMasterRound="",t.accdnLH3Ranks2Plus8Square="",t.accdnLH3Ranks2Square="",t.accdnLH3Ranks8Square="",t.accdnLH3RanksDouble8Square="",t.accdnLH3RanksTuttiSquare="",t.accdnPull="",t.accdnPush="",t.accdnRH3RanksAccordion="",t.accdnRH3RanksAuthenticMusette="",t.accdnRH3RanksBandoneon="",t.accdnRH3RanksBassoon="",t.accdnRH3RanksClarinet="",t.accdnRH3RanksDoubleTremoloLower8ve="",t.accdnRH3RanksDoubleTremoloUpper8ve="",t.accdnRH3RanksFullFactory="",t.accdnRH3RanksHarmonium="",t.accdnRH3RanksImitationMusette="",t.accdnRH3RanksLowerTremolo8="",t.accdnRH3RanksMaster="",t.accdnRH3RanksOboe="",t.accdnRH3RanksOrgan="",t.accdnRH3RanksPiccolo="",t.accdnRH3RanksTremoloLower8ve="",t.accdnRH3RanksTremoloUpper8ve="",t.accdnRH3RanksTwoChoirs="",t.accdnRH3RanksUpperTremolo8="",t.accdnRH3RanksViolin="",t.accdnRH4RanksAlto="",t.accdnRH4RanksBassAlto="",t.accdnRH4RanksMaster="",t.accdnRH4RanksSoftBass="",t.accdnRH4RanksSoftTenor="",t.accdnRH4RanksSoprano="",t.accdnRH4RanksTenor="",t.accdnRicochet2="",t.accdnRicochet3="",t.accdnRicochet4="",t.accdnRicochet5="",t.accdnRicochet6="",t.accdnRicochetStem2="",t.accdnRicochetStem3="",t.accdnRicochetStem4="",t.accdnRicochetStem5="",t.accdnRicochetStem6="",t.accidental1CommaFlat="",t.accidental1CommaSharp="",t.accidental2CommaFlat="",t.accidental2CommaSharp="",t.accidental3CommaFlat="",t.accidental3CommaSharp="",t.accidental4CommaFlat="",t.accidental5CommaSharp="",t.accidentalArrowDown="",t.accidentalArrowUp="",t.accidentalBakiyeFlat="",t.accidentalBakiyeSharp="",t.accidentalBracketLeft="",t.accidentalBracketRight="",t.accidentalBuyukMucennebFlat="",t.accidentalBuyukMucennebSharp="",t.accidentalCombiningCloseCurlyBrace="",t.accidentalCombiningLower17Schisma="",t.accidentalCombiningLower19Schisma="",t.accidentalCombiningLower23Limit29LimitComma="",t.accidentalCombiningLower29LimitComma="",t.accidentalCombiningLower31Schisma="",t.accidentalCombiningLower37Quartertone="",t.accidentalCombiningLower41Comma="",t.accidentalCombiningLower43Comma="",t.accidentalCombiningLower47Quartertone="",t.accidentalCombiningLower53LimitComma="",t.accidentalCombiningOpenCurlyBrace="",t.accidentalCombiningRaise17Schisma="",t.accidentalCombiningRaise19Schisma="",t.accidentalCombiningRaise23Limit29LimitComma="",t.accidentalCombiningRaise29LimitComma="",t.accidentalCombiningRaise31Schisma="",t.accidentalCombiningRaise37Quartertone="",t.accidentalCombiningRaise41Comma="",t.accidentalCombiningRaise43Comma="",t.accidentalCombiningRaise47Quartertone="",t.accidentalCombiningRaise53LimitComma="",t.accidentalCommaSlashDown="",t.accidentalCommaSlashUp="",t.accidentalDoubleFlat="",t.accidentalDoubleFlatArabic="",t.accidentalDoubleFlatEqualTempered="",t.accidentalDoubleFlatOneArrowDown="",t.accidentalDoubleFlatOneArrowUp="",t.accidentalDoubleFlatReversed="",t.accidentalDoubleFlatThreeArrowsDown="",t.accidentalDoubleFlatThreeArrowsUp="",t.accidentalDoubleFlatTurned="",t.accidentalDoubleFlatTwoArrowsDown="",t.accidentalDoubleFlatTwoArrowsUp="",t.accidentalDoubleSharp="",t.accidentalDoubleSharpArabic="",t.accidentalDoubleSharpEqualTempered="",t.accidentalDoubleSharpOneArrowDown="",t.accidentalDoubleSharpOneArrowUp="",t.accidentalDoubleSharpThreeArrowsDown="",t.accidentalDoubleSharpThreeArrowsUp="",t.accidentalDoubleSharpTwoArrowsDown="",t.accidentalDoubleSharpTwoArrowsUp="",t.accidentalEnharmonicAlmostEqualTo="",t.accidentalEnharmonicEquals="",t.accidentalEnharmonicTilde="",t.accidentalFilledReversedFlatAndFlat="",t.accidentalFilledReversedFlatAndFlatArrowDown="",t.accidentalFilledReversedFlatAndFlatArrowUp="",t.accidentalFilledReversedFlatArrowDown="",t.accidentalFilledReversedFlatArrowUp="",t.accidentalFiveQuarterTonesFlatArrowDown="",t.accidentalFiveQuarterTonesSharpArrowUp="",t.accidentalFlat="",t.accidentalFlatArabic="",t.accidentalFlatEqualTempered="",t.accidentalFlatLoweredStockhausen="",t.accidentalFlatOneArrowDown="",t.accidentalFlatOneArrowUp="",t.accidentalFlatRaisedStockhausen="",t.accidentalFlatRepeatedLineStockhausen="",t.accidentalFlatRepeatedSpaceStockhausen="",t.accidentalFlatThreeArrowsDown="",t.accidentalFlatThreeArrowsUp="",t.accidentalFlatTurned="",t.accidentalFlatTwoArrowsDown="",t.accidentalFlatTwoArrowsUp="",t.accidentalHabaFlatQuarterToneHigher="",t.accidentalHabaFlatThreeQuarterTonesLower="",t.accidentalHabaQuarterToneHigher="",t.accidentalHabaQuarterToneLower="",t.accidentalHabaSharpQuarterToneLower="",t.accidentalHabaSharpThreeQuarterTonesHigher="",t.accidentalHalfSharpArrowDown="",t.accidentalHalfSharpArrowUp="",t.accidentalJohnston13="",t.accidentalJohnston31="",t.accidentalJohnstonDown="",t.accidentalJohnstonEl="",t.accidentalJohnstonMinus="",t.accidentalJohnstonPlus="",t.accidentalJohnstonSeven="",t.accidentalJohnstonUp="",t.accidentalKomaFlat="",t.accidentalKomaSharp="",t.accidentalKoron="",t.accidentalKucukMucennebFlat="",t.accidentalKucukMucennebSharp="",t.accidentalLargeDoubleSharp="",t.accidentalLowerOneSeptimalComma="",t.accidentalLowerOneTridecimalQuartertone="",t.accidentalLowerOneUndecimalQuartertone="",t.accidentalLowerTwoSeptimalCommas="",t.accidentalLoweredStockhausen="",t.accidentalNarrowReversedFlat="",t.accidentalNarrowReversedFlatAndFlat="",t.accidentalNatural="",t.accidentalNaturalArabic="",t.accidentalNaturalEqualTempered="",t.accidentalNaturalFlat="",t.accidentalNaturalLoweredStockhausen="",t.accidentalNaturalOneArrowDown="",t.accidentalNaturalOneArrowUp="",t.accidentalNaturalRaisedStockhausen="",t.accidentalNaturalReversed="",t.accidentalNaturalSharp="",t.accidentalNaturalThreeArrowsDown="",t.accidentalNaturalThreeArrowsUp="",t.accidentalNaturalTwoArrowsDown="",t.accidentalNaturalTwoArrowsUp="",t.accidentalOneAndAHalfSharpsArrowDown="",t.accidentalOneAndAHalfSharpsArrowUp="",t.accidentalOneQuarterToneFlatFerneyhough="",t.accidentalOneQuarterToneFlatStockhausen="",t.accidentalOneQuarterToneSharpFerneyhough="",t.accidentalOneQuarterToneSharpStockhausen="",t.accidentalOneThirdToneFlatFerneyhough="",t.accidentalOneThirdToneSharpFerneyhough="",t.accidentalParensLeft="",t.accidentalParensRight="",t.accidentalQuarterFlatEqualTempered="",t.accidentalQuarterSharpEqualTempered="",t.accidentalQuarterToneFlat4="",t.accidentalQuarterToneFlatArabic="",t.accidentalQuarterToneFlatArrowUp="",t.accidentalQuarterToneFlatFilledReversed="",t.accidentalQuarterToneFlatNaturalArrowDown="",t.accidentalQuarterToneFlatPenderecki="",t.accidentalQuarterToneFlatStein="",t.accidentalQuarterToneFlatVanBlankenburg="",t.accidentalQuarterToneSharp4="",t.accidentalQuarterToneSharpArabic="",t.accidentalQuarterToneSharpArrowDown="",t.accidentalQuarterToneSharpBusotti="",t.accidentalQuarterToneSharpNaturalArrowUp="",t.accidentalQuarterToneSharpStein="",t.accidentalQuarterToneSharpWiggle="",t.accidentalRaiseOneSeptimalComma="",t.accidentalRaiseOneTridecimalQuartertone="",t.accidentalRaiseOneUndecimalQuartertone="",t.accidentalRaiseTwoSeptimalCommas="",t.accidentalRaisedStockhausen="",t.accidentalReversedFlatAndFlatArrowDown="",t.accidentalReversedFlatAndFlatArrowUp="",t.accidentalReversedFlatArrowDown="",t.accidentalReversedFlatArrowUp="",t.accidentalSharp="",t.accidentalSharpArabic="",t.accidentalSharpEqualTempered="",t.accidentalSharpLoweredStockhausen="",t.accidentalSharpOneArrowDown="",t.accidentalSharpOneArrowUp="",t.accidentalSharpOneHorizontalStroke="",t.accidentalSharpRaisedStockhausen="",t.accidentalSharpRepeatedLineStockhausen="",t.accidentalSharpRepeatedSpaceStockhausen="",t.accidentalSharpReversed="",t.accidentalSharpSharp="",t.accidentalSharpThreeArrowsDown="",t.accidentalSharpThreeArrowsUp="",t.accidentalSharpTwoArrowsDown="",t.accidentalSharpTwoArrowsUp="",t.accidentalSims12Down="",t.accidentalSims12Up="",t.accidentalSims4Down="",t.accidentalSims4Up="",t.accidentalSims6Down="",t.accidentalSims6Up="",t.accidentalSori="",t.accidentalTavenerFlat="",t.accidentalTavenerSharp="",t.accidentalThreeQuarterTonesFlatArabic="",t.accidentalThreeQuarterTonesFlatArrowDown="",t.accidentalThreeQuarterTonesFlatArrowUp="",t.accidentalThreeQuarterTonesFlatCouper="",t.accidentalThreeQuarterTonesFlatGrisey="",t.accidentalThreeQuarterTonesFlatTartini="",t.accidentalThreeQuarterTonesFlatZimmermann="",t.accidentalThreeQuarterTonesSharpArabic="",t.accidentalThreeQuarterTonesSharpArrowDown="",t.accidentalThreeQuarterTonesSharpArrowUp="",t.accidentalThreeQuarterTonesSharpBusotti="",t.accidentalThreeQuarterTonesSharpStein="",t.accidentalThreeQuarterTonesSharpStockhausen="",t.accidentalTripleFlat="",t.accidentalTripleSharp="",t.accidentalTwoThirdTonesFlatFerneyhough="",t.accidentalTwoThirdTonesSharpFerneyhough="",t.accidentalUpsAndDownsDown="",t.accidentalUpsAndDownsLess="",t.accidentalUpsAndDownsMore="",t.accidentalUpsAndDownsUp="",t.accidentalWilsonMinus="",t.accidentalWilsonPlus="",t.accidentalWyschnegradsky10TwelfthsFlat="",t.accidentalWyschnegradsky10TwelfthsSharp="",t.accidentalWyschnegradsky11TwelfthsFlat="",t.accidentalWyschnegradsky11TwelfthsSharp="",t.accidentalWyschnegradsky1TwelfthsFlat="",t.accidentalWyschnegradsky1TwelfthsSharp="",t.accidentalWyschnegradsky2TwelfthsFlat="",t.accidentalWyschnegradsky2TwelfthsSharp="",t.accidentalWyschnegradsky3TwelfthsFlat="",t.accidentalWyschnegradsky3TwelfthsSharp="",t.accidentalWyschnegradsky4TwelfthsFlat="",t.accidentalWyschnegradsky4TwelfthsSharp="",t.accidentalWyschnegradsky5TwelfthsFlat="",t.accidentalWyschnegradsky5TwelfthsSharp="",t.accidentalWyschnegradsky6TwelfthsFlat="",t.accidentalWyschnegradsky6TwelfthsSharp="",t.accidentalWyschnegradsky7TwelfthsFlat="",t.accidentalWyschnegradsky7TwelfthsSharp="",t.accidentalWyschnegradsky8TwelfthsFlat="",t.accidentalWyschnegradsky8TwelfthsSharp="",t.accidentalWyschnegradsky9TwelfthsFlat="",t.accidentalWyschnegradsky9TwelfthsSharp="",t.accidentalXenakisOneThirdToneSharp="",t.accidentalXenakisTwoThirdTonesSharp="",t.analyticsChoralmelodie="",t.analyticsEndStimme="",t.analyticsHauptrhythmus="",t.analyticsHauptstimme="",t.analyticsInversion1="",t.analyticsNebenstimme="",t.analyticsStartStimme="",t.analyticsTheme="",t.analyticsTheme1="",t.analyticsThemeInversion="",t.analyticsThemeRetrograde="",t.analyticsThemeRetrogradeInversion="",t.arpeggiato="",t.arpeggiatoDown="",t.arpeggiatoUp="",t.arrowBlackDown="",t.arrowBlackDownLeft="",t.arrowBlackDownRight="",t.arrowBlackLeft="",t.arrowBlackRight="",t.arrowBlackUp="",t.arrowBlackUpLeft="",t.arrowBlackUpRight="",t.arrowOpenDown="",t.arrowOpenDownLeft="",t.arrowOpenDownRight="",t.arrowOpenLeft="",t.arrowOpenRight="",t.arrowOpenUp="",t.arrowOpenUpLeft="",t.arrowOpenUpRight="",t.arrowWhiteDown="",t.arrowWhiteDownLeft="",t.arrowWhiteDownRight="",t.arrowWhiteLeft="",t.arrowWhiteRight="",t.arrowWhiteUp="",t.arrowWhiteUpLeft="",t.arrowWhiteUpRight="",t.arrowheadBlackDown="",t.arrowheadBlackDownLeft="",t.arrowheadBlackDownRight="",t.arrowheadBlackLeft="",t.arrowheadBlackRight="",t.arrowheadBlackUp="",t.arrowheadBlackUpLeft="",t.arrowheadBlackUpRight="",t.arrowheadOpenDown="",t.arrowheadOpenDownLeft="",t.arrowheadOpenDownRight="",t.arrowheadOpenLeft="",t.arrowheadOpenRight="",t.arrowheadOpenUp="",t.arrowheadOpenUpLeft="",t.arrowheadOpenUpRight="",t.arrowheadWhiteDown="",t.arrowheadWhiteDownLeft="",t.arrowheadWhiteDownRight="",t.arrowheadWhiteLeft="",t.arrowheadWhiteRight="",t.arrowheadWhiteUp="",t.arrowheadWhiteUpLeft="",t.arrowheadWhiteUpRight="",t.articAccentAbove="",t.articAccentBelow="",t.articAccentStaccatoAbove="",t.articAccentStaccatoBelow="",t.articLaissezVibrerAbove="",t.articLaissezVibrerBelow="",t.articMarcatoAbove="",t.articMarcatoBelow="",t.articMarcatoStaccatoAbove="",t.articMarcatoStaccatoBelow="",t.articMarcatoTenutoAbove="",t.articMarcatoTenutoBelow="",t.articSoftAccentAbove="",t.articSoftAccentBelow="",t.articSoftAccentStaccatoAbove="",t.articSoftAccentStaccatoBelow="",t.articSoftAccentTenutoAbove="",t.articSoftAccentTenutoBelow="",t.articSoftAccentTenutoStaccatoAbove="",t.articSoftAccentTenutoStaccatoBelow="",t.articStaccatissimoAbove="",t.articStaccatissimoBelow="",t.articStaccatissimoStrokeAbove="",t.articStaccatissimoStrokeBelow="",t.articStaccatissimoWedgeAbove="",t.articStaccatissimoWedgeBelow="",t.articStaccatoAbove="",t.articStaccatoBelow="",t.articStressAbove="",t.articStressBelow="",t.articTenutoAbove="",t.articTenutoAccentAbove="",t.articTenutoAccentBelow="",t.articTenutoBelow="",t.articTenutoStaccatoAbove="",t.articTenutoStaccatoBelow="",t.articUnstressAbove="",t.articUnstressBelow="",t.augmentationDot="",t.barlineDashed="",t.barlineDotted="",t.barlineDouble="",t.barlineFinal="",t.barlineHeavy="",t.barlineHeavyHeavy="",t.barlineReverseFinal="",t.barlineShort="",t.barlineSingle="",t.barlineTick="",t.beamAccelRit1="",t.beamAccelRit10="",t.beamAccelRit11="",t.beamAccelRit12="",t.beamAccelRit13="",t.beamAccelRit14="",t.beamAccelRit15="",t.beamAccelRit2="",t.beamAccelRit3="",t.beamAccelRit4="",t.beamAccelRit5="",t.beamAccelRit6="",t.beamAccelRit7="",t.beamAccelRit8="",t.beamAccelRit9="",t.beamAccelRitFinal="",t.brace="",t.bracket="",t.bracketBottom="",t.bracketTop="",t.brassBend="",t.brassDoitLong="",t.brassDoitMedium="",t.brassDoitShort="",t.brassFallLipLong="",t.brassFallLipMedium="",t.brassFallLipShort="",t.brassFallRoughLong="",t.brassFallRoughMedium="",t.brassFallRoughShort="",t.brassFallSmoothLong="",t.brassFallSmoothMedium="",t.brassFallSmoothShort="",t.brassFlip="",t.brassHarmonMuteClosed="",t.brassHarmonMuteStemHalfLeft="",t.brassHarmonMuteStemHalfRight="",t.brassHarmonMuteStemOpen="",t.brassJazzTurn="",t.brassLiftLong="",t.brassLiftMedium="",t.brassLiftShort="",t.brassLiftSmoothLong="",t.brassLiftSmoothMedium="",t.brassLiftSmoothShort="",t.brassMuteClosed="",t.brassMuteHalfClosed="",t.brassMuteOpen="",t.brassPlop="",t.brassScoop="",t.brassSmear="",t.brassValveTrill="",t.breathMarkComma="",t.breathMarkSalzedo="",t.breathMarkTick="",t.breathMarkUpbow="",t.bridgeClef="",t.buzzRoll="",t.cClef="",t.cClef8vb="",t.cClefArrowDown="",t.cClefArrowUp="",t.cClefChange="",t.cClefCombining="",t.cClefReversed="",t.cClefSquare="",t.caesura="",t.caesuraCurved="",t.caesuraShort="",t.caesuraSingleStroke="",t.caesuraThick="",t.chantAccentusAbove="",t.chantAccentusBelow="",t.chantAuctumAsc="",t.chantAuctumDesc="",t.chantAugmentum="",t.chantCaesura="",t.chantCclef="",t.chantCirculusAbove="",t.chantCirculusBelow="",t.chantConnectingLineAsc2nd="",t.chantConnectingLineAsc3rd="",t.chantConnectingLineAsc4th="",t.chantConnectingLineAsc5th="",t.chantConnectingLineAsc6th="",t.chantCustosStemDownPosHigh="",t.chantCustosStemDownPosHighest="",t.chantCustosStemDownPosMiddle="",t.chantCustosStemUpPosLow="",t.chantCustosStemUpPosLowest="",t.chantCustosStemUpPosMiddle="",t.chantDeminutumLower="",t.chantDeminutumUpper="",t.chantDivisioFinalis="",t.chantDivisioMaior="",t.chantDivisioMaxima="",t.chantDivisioMinima="",t.chantEntryLineAsc2nd="",t.chantEntryLineAsc3rd="",t.chantEntryLineAsc4th="",t.chantEntryLineAsc5th="",t.chantEntryLineAsc6th="",t.chantEpisema="",t.chantFclef="",t.chantIctusAbove="",t.chantIctusBelow="",t.chantLigaturaDesc2nd="",t.chantLigaturaDesc3rd="",t.chantLigaturaDesc4th="",t.chantLigaturaDesc5th="",t.chantOriscusAscending="",t.chantOriscusDescending="",t.chantOriscusLiquescens="",t.chantPodatusLower="",t.chantPodatusUpper="",t.chantPunctum="",t.chantPunctumCavum="",t.chantPunctumDeminutum="",t.chantPunctumInclinatum="",t.chantPunctumInclinatumAuctum="",t.chantPunctumInclinatumDeminutum="",t.chantPunctumLinea="",t.chantPunctumLineaCavum="",t.chantPunctumVirga="",t.chantPunctumVirgaReversed="",t.chantQuilisma="",t.chantSemicirculusAbove="",t.chantSemicirculusBelow="",t.chantStaff="",t.chantStaffNarrow="",t.chantStaffWide="",t.chantStrophicus="",t.chantStrophicusAuctus="",t.chantStrophicusLiquescens2nd="",t.chantStrophicusLiquescens3rd="",t.chantStrophicusLiquescens4th="",t.chantStrophicusLiquescens5th="",t.chantVirgula="",t.clef15="",t.clef8="",t.clefChangeCombining="",t.coda="",t.codaSquare="",t.conductorBeat2Compound="",t.conductorBeat2Simple="",t.conductorBeat3Compound="",t.conductorBeat3Simple="",t.conductorBeat4Compound="",t.conductorBeat4Simple="",t.conductorLeftBeat="",t.conductorRightBeat="",t.conductorStrongBeat="",t.conductorUnconducted="",t.conductorWeakBeat="",t.controlBeginBeam="",t.controlBeginPhrase="",t.controlBeginSlur="",t.controlBeginTie="",t.controlEndBeam="",t.controlEndPhrase="",t.controlEndSlur="",t.controlEndTie="",t.csymAccidentalDoubleFlat="",t.csymAccidentalDoubleSharp="",t.csymAccidentalFlat="",t.csymAccidentalNatural="",t.csymAccidentalSharp="",t.csymAccidentalTripleFlat="",t.csymAccidentalTripleSharp="",t.csymAlteredBassSlash="",t.csymAugmented="",t.csymBracketLeftTall="",t.csymBracketRightTall="",t.csymDiagonalArrangementSlash="",t.csymDiminished="",t.csymHalfDiminished="",t.csymMajorSeventh="",t.csymMinor="",t.csymParensLeftTall="",t.csymParensLeftVeryTall="",t.csymParensRightTall="",t.csymParensRightVeryTall="",t.curlewSign="",t.daCapo="",t.dalSegno="",t.daseianExcellentes1="",t.daseianExcellentes2="",t.daseianExcellentes3="",t.daseianExcellentes4="",t.daseianFinales1="",t.daseianFinales2="",t.daseianFinales3="",t.daseianFinales4="",t.daseianGraves1="",t.daseianGraves2="",t.daseianGraves3="",t.daseianGraves4="",t.daseianResidua1="",t.daseianResidua2="",t.daseianSuperiores1="",t.daseianSuperiores2="",t.daseianSuperiores3="",t.daseianSuperiores4="",t.doubleLateralRollStevens="",t.doubleTongueAbove="",t.doubleTongueBelow="",t.dynamicCombinedSeparatorColon="",t.dynamicCombinedSeparatorHyphen="",t.dynamicCombinedSeparatorSlash="",t.dynamicCombinedSeparatorSpace="",t.dynamicCrescendoHairpin="",t.dynamicDiminuendoHairpin="",t.dynamicFF="",t.dynamicFFF="",t.dynamicFFFF="",t.dynamicFFFFF="",t.dynamicFFFFFF="",t.dynamicForte="",t.dynamicFortePiano="",t.dynamicForzando="",t.dynamicHairpinBracketLeft="",t.dynamicHairpinBracketRight="",t.dynamicHairpinParenthesisLeft="",t.dynamicHairpinParenthesisRight="",t.dynamicMF="",t.dynamicMP="",t.dynamicMessaDiVoce="",t.dynamicMezzo="",t.dynamicNiente="",t.dynamicNienteForHairpin="",t.dynamicPF="",t.dynamicPP="",t.dynamicPPP="",t.dynamicPPPP="",t.dynamicPPPPP="",t.dynamicPPPPPP="",t.dynamicPiano="",t.dynamicRinforzando="",t.dynamicRinforzando1="",t.dynamicRinforzando2="",t.dynamicSforzando="",t.dynamicSforzando1="",t.dynamicSforzandoPianissimo="",t.dynamicSforzandoPiano="",t.dynamicSforzato="",t.dynamicSforzatoFF="",t.dynamicSforzatoPiano="",t.dynamicZ="",t.elecAudioChannelsEight="",t.elecAudioChannelsFive="",t.elecAudioChannelsFour="",t.elecAudioChannelsOne="",t.elecAudioChannelsSeven="",t.elecAudioChannelsSix="",t.elecAudioChannelsThreeFrontal="",t.elecAudioChannelsThreeSurround="",t.elecAudioChannelsTwo="",t.elecAudioIn="",t.elecAudioMono="",t.elecAudioOut="",t.elecAudioStereo="",t.elecCamera="",t.elecDataIn="",t.elecDataOut="",t.elecDisc="",t.elecDownload="",t.elecEject="",t.elecFastForward="",t.elecHeadphones="",t.elecHeadset="",t.elecLineIn="",t.elecLineOut="",t.elecLoop="",t.elecLoudspeaker="",t.elecMIDIController0="",t.elecMIDIController100="",t.elecMIDIController20="",t.elecMIDIController40="",t.elecMIDIController60="",t.elecMIDIController80="",t.elecMIDIIn="",t.elecMIDIOut="",t.elecMicrophone="",t.elecMicrophoneMute="",t.elecMicrophoneUnmute="",t.elecMixingConsole="",t.elecMonitor="",t.elecMute="",t.elecPause="",t.elecPlay="",t.elecPowerOnOff="",t.elecProjector="",t.elecReplay="",t.elecRewind="",t.elecShuffle="",t.elecSkipBackwards="",t.elecSkipForwards="",t.elecStop="",t.elecTape="",t.elecUSB="",t.elecUnmute="",t.elecUpload="",t.elecVideoCamera="",t.elecVideoIn="",t.elecVideoOut="",t.elecVolumeFader="",t.elecVolumeFaderThumb="",t.elecVolumeLevel0="",t.elecVolumeLevel100="",t.elecVolumeLevel20="",t.elecVolumeLevel40="",t.elecVolumeLevel60="",t.elecVolumeLevel80="",t.fClef="",t.fClef15ma="",t.fClef15mb="",t.fClef8va="",t.fClef8vb="",t.fClefArrowDown="",t.fClefArrowUp="",t.fClefChange="",t.fClefReversed="",t.fClefTurned="",t.fermataAbove="",t.fermataBelow="",t.fermataLongAbove="",t.fermataLongBelow="",t.fermataLongHenzeAbove="",t.fermataLongHenzeBelow="",t.fermataShortAbove="",t.fermataShortBelow="",t.fermataShortHenzeAbove="",t.fermataShortHenzeBelow="",t.fermataVeryLongAbove="",t.fermataVeryLongBelow="",t.fermataVeryShortAbove="",t.fermataVeryShortBelow="",t.figbass0="",t.figbass1="",t.figbass2="",t.figbass2Raised="",t.figbass3="",t.figbass4="",t.figbass4Raised="",t.figbass5="",t.figbass5Raised1="",t.figbass5Raised2="",t.figbass5Raised3="",t.figbass6="",t.figbass6Raised="",t.figbass6Raised2="",t.figbass7="",t.figbass7Diminished="",t.figbass7Raised1="",t.figbass7Raised2="",t.figbass8="",t.figbass9="",t.figbass9Raised="",t.figbassBracketLeft="",t.figbassBracketRight="",t.figbassCombiningLowering="",t.figbassCombiningRaising="",t.figbassDoubleFlat="",t.figbassDoubleSharp="",t.figbassFlat="",t.figbassNatural="",t.figbassParensLeft="",t.figbassParensRight="",t.figbassPlus="",t.figbassSharp="",t.figbassTripleFlat="",t.figbassTripleSharp="",t.fingering0="",t.fingering0Italic="",t.fingering1="",t.fingering1Italic="",t.fingering2="",t.fingering2Italic="",t.fingering3="",t.fingering3Italic="",t.fingering4="",t.fingering4Italic="",t.fingering5="",t.fingering5Italic="",t.fingering6="",t.fingering6Italic="",t.fingering7="",t.fingering7Italic="",t.fingering8="",t.fingering8Italic="",t.fingering9="",t.fingering9Italic="",t.fingeringALower="",t.fingeringCLower="",t.fingeringELower="",t.fingeringILower="",t.fingeringLeftBracket="",t.fingeringLeftBracketItalic="",t.fingeringLeftParenthesis="",t.fingeringLeftParenthesisItalic="",t.fingeringMLower="",t.fingeringMultipleNotes="",t.fingeringOLower="",t.fingeringPLower="",t.fingeringQLower="",t.fingeringRightBracket="",t.fingeringRightBracketItalic="",t.fingeringRightParenthesis="",t.fingeringRightParenthesisItalic="",t.fingeringSLower="",t.fingeringSeparatorMiddleDot="",t.fingeringSeparatorMiddleDotWhite="",t.fingeringSeparatorSlash="",t.fingeringSubstitutionAbove="",t.fingeringSubstitutionBelow="",t.fingeringSubstitutionDash="",t.fingeringTLower="",t.fingeringTUpper="",t.fingeringXLower="",t.flag1024thDown="",t.flag1024thUp="",t.flag128thDown="",t.flag128thUp="",t.flag16thDown="",t.flag16thUp="",t.flag256thDown="",t.flag256thUp="",t.flag32ndDown="",t.flag32ndUp="",t.flag512thDown="",t.flag512thUp="",t.flag64thDown="",t.flag64thUp="",t.flag8thDown="",t.flag8thUp="",t.flagInternalDown="",t.flagInternalUp="",t.fretboard3String="",t.fretboard3StringNut="",t.fretboard4String="",t.fretboard4StringNut="",t.fretboard5String="",t.fretboard5StringNut="",t.fretboard6String="",t.fretboard6StringNut="",t.fretboardFilledCircle="",t.fretboardO="",t.fretboardX="",t.functionAngleLeft="",t.functionAngleRight="",t.functionBracketLeft="",t.functionBracketRight="",t.functionDD="",t.functionDLower="",t.functionDUpper="",t.functionEight="",t.functionFUpper="",t.functionFive="",t.functionFour="",t.functionGLower="",t.functionGUpper="",t.functionGreaterThan="",t.functionILower="",t.functionIUpper="",t.functionKLower="",t.functionKUpper="",t.functionLLower="",t.functionLUpper="",t.functionLessThan="",t.functionMLower="",t.functionMUpper="",t.functionMinus="",t.functionNLower="",t.functionNUpper="",t.functionNUpperSuperscript="",t.functionNine="",t.functionOne="",t.functionPLower="",t.functionPUpper="",t.functionParensLeft="",t.functionParensRight="",t.functionPlus="",t.functionRLower="",t.functionRepetition1="",t.functionRepetition2="",t.functionRing="",t.functionSLower="",t.functionSSLower="",t.functionSSUpper="",t.functionSUpper="",t.functionSeven="",t.functionSix="",t.functionSlashedDD="",t.functionTLower="",t.functionTUpper="",t.functionThree="",t.functionTwo="",t.functionVLower="",t.functionVUpper="",t.functionZero="",t.gClef="",t.gClef15ma="",t.gClef15mb="",t.gClef8va="",t.gClef8vb="",t.gClef8vbCClef="",t.gClef8vbOld="",t.gClef8vbParens="",t.gClefArrowDown="",t.gClefArrowUp="",t.gClefChange="",t.gClefLigatedNumberAbove="",t.gClefLigatedNumberBelow="",t.gClefReversed="",t.gClefTurned="",t.glissandoDown="",t.glissandoUp="",t.graceNoteAcciaccaturaStemDown="",t.graceNoteAcciaccaturaStemUp="",t.graceNoteAppoggiaturaStemDown="",t.graceNoteAppoggiaturaStemUp="",t.graceNoteSlashStemDown="",t.graceNoteSlashStemUp="",t.guitarBarreFull="",t.guitarBarreHalf="",t.guitarClosePedal="",t.guitarFadeIn="",t.guitarFadeOut="",t.guitarGolpe="",t.guitarHalfOpenPedal="",t.guitarLeftHandTapping="",t.guitarOpenPedal="",t.guitarRightHandTapping="",t.guitarShake="",t.guitarString0="",t.guitarString1="",t.guitarString10="",t.guitarString11="",t.guitarString12="",t.guitarString13="",t.guitarString2="",t.guitarString3="",t.guitarString4="",t.guitarString5="",t.guitarString6="",t.guitarString7="",t.guitarString8="",t.guitarString9="",t.guitarStrumDown="",t.guitarStrumUp="",t.guitarVibratoBarDip="",t.guitarVibratoBarScoop="",t.guitarVibratoStroke="",t.guitarVolumeSwell="",t.guitarWideVibratoStroke="",t.handbellsBelltree="",t.handbellsDamp3="",t.handbellsEcho1="",t.handbellsEcho2="",t.handbellsGyro="",t.handbellsHandMartellato="",t.handbellsMalletBellOnTable="",t.handbellsMalletBellSuspended="",t.handbellsMalletLft="",t.handbellsMartellato="",t.handbellsMartellatoLift="",t.handbellsMutedMartellato="",t.handbellsPluckLift="",t.handbellsSwing="",t.handbellsSwingDown="",t.handbellsSwingUp="",t.handbellsTablePairBells="",t.handbellsTableSingleBell="",t.harpMetalRod="",t.harpPedalCentered="",t.harpPedalDivider="",t.harpPedalLowered="",t.harpPedalRaised="",t.harpSalzedoAeolianAscending="",t.harpSalzedoAeolianDescending="",t.harpSalzedoDampAbove="",t.harpSalzedoDampBelow="",t.harpSalzedoDampBothHands="",t.harpSalzedoDampLowStrings="",t.harpSalzedoFluidicSoundsLeft="",t.harpSalzedoFluidicSoundsRight="",t.harpSalzedoIsolatedSounds="",t.harpSalzedoMetallicSounds="",t.harpSalzedoMetallicSoundsOneString="",t.harpSalzedoMuffleTotally="",t.harpSalzedoOboicFlux="",t.harpSalzedoPlayUpperEnd="",t.harpSalzedoSlideWithSuppleness="",t.harpSalzedoSnareDrum="",t.harpSalzedoTamTamSounds="",t.harpSalzedoThunderEffect="",t.harpSalzedoTimpanicSounds="",t.harpSalzedoWhistlingSounds="",t.harpStringNoiseStem="",t.harpTuningKey="",t.harpTuningKeyGlissando="",t.harpTuningKeyHandle="",t.harpTuningKeyShank="",t.indianDrumClef="",t.kahnBackChug="",t.kahnBackFlap="",t.kahnBackRiff="",t.kahnBackRip="",t.kahnBallChange="",t.kahnBallDig="",t.kahnBrushBackward="",t.kahnBrushForward="",t.kahnChug="",t.kahnClap="",t.kahnDoubleSnap="",t.kahnDoubleWing="",t.kahnDrawStep="",t.kahnDrawTap="",t.kahnFlam="",t.kahnFlap="",t.kahnFlapStep="",t.kahnFlat="",t.kahnFleaHop="",t.kahnFleaTap="",t.kahnGraceTap="",t.kahnGraceTapChange="",t.kahnGraceTapHop="",t.kahnGraceTapStamp="",t.kahnHeel="",t.kahnHeelChange="",t.kahnHeelClick="",t.kahnHeelDrop="",t.kahnHeelStep="",t.kahnHeelTap="",t.kahnHop="",t.kahnJumpApart="",t.kahnJumpTogether="",t.kahnKneeInward="",t.kahnKneeOutward="",t.kahnLeap="",t.kahnLeapFlatFoot="",t.kahnLeapHeelClick="",t.kahnLeftCatch="",t.kahnLeftCross="",t.kahnLeftFoot="",t.kahnLeftToeStrike="",t.kahnLeftTurn="",t.kahnOverTheTop="",t.kahnOverTheTopTap="",t.kahnPull="",t.kahnPush="",t.kahnRiff="",t.kahnRiffle="",t.kahnRightCatch="",t.kahnRightCross="",t.kahnRightFoot="",t.kahnRightToeStrike="",t.kahnRightTurn="",t.kahnRip="",t.kahnRipple="",t.kahnScrape="",t.kahnScuff="",t.kahnScuffle="",t.kahnShuffle="",t.kahnSlam="",t.kahnSlap="",t.kahnSlideStep="",t.kahnSlideTap="",t.kahnSnap="",t.kahnStamp="",t.kahnStampStamp="",t.kahnStep="",t.kahnStepStamp="",t.kahnStomp="",t.kahnStompBrush="",t.kahnTap="",t.kahnToe="",t.kahnToeClick="",t.kahnToeDrop="",t.kahnToeStep="",t.kahnToeTap="",t.kahnTrench="",t.kahnWing="",t.kahnWingChange="",t.kahnZank="",t.kahnZink="",t.keyboardBebung2DotsAbove="",t.keyboardBebung2DotsBelow="",t.keyboardBebung3DotsAbove="",t.keyboardBebung3DotsBelow="",t.keyboardBebung4DotsAbove="",t.keyboardBebung4DotsBelow="",t.keyboardLeftPedalPictogram="",t.keyboardMiddlePedalPictogram="",t.keyboardPedalD="",t.keyboardPedalDot="",t.keyboardPedalE="",t.keyboardPedalHalf="",t.keyboardPedalHalf2="",t.keyboardPedalHalf3="",t.keyboardPedalHeel1="",t.keyboardPedalHeel2="",t.keyboardPedalHeel3="",t.keyboardPedalHeelToToe="",t.keyboardPedalHeelToe="",t.keyboardPedalHookEnd="",t.keyboardPedalHookStart="",t.keyboardPedalHyphen="",t.keyboardPedalP="",t.keyboardPedalParensLeft="",t.keyboardPedalParensRight="",t.keyboardPedalPed="",t.keyboardPedalS="",t.keyboardPedalSost="",t.keyboardPedalToe1="",t.keyboardPedalToe2="",t.keyboardPedalToeToHeel="",t.keyboardPedalUp="",t.keyboardPedalUpNotch="",t.keyboardPedalUpSpecial="",t.keyboardPlayWithLH="",t.keyboardPlayWithLHEnd="",t.keyboardPlayWithRH="",t.keyboardPlayWithRHEnd="",t.keyboardPluckInside="",t.keyboardRightPedalPictogram="",t.kievanAccidentalFlat="",t.kievanAccidentalSharp="",t.kievanAugmentationDot="",t.kievanCClef="",t.kievanEndingSymbol="",t.kievanNote8thStemDown="",t.kievanNote8thStemUp="",t.kievanNoteBeam="",t.kievanNoteHalfStaffLine="",t.kievanNoteHalfStaffSpace="",t.kievanNoteQuarterStemDown="",t.kievanNoteQuarterStemUp="",t.kievanNoteReciting="",t.kievanNoteWhole="",t.kievanNoteWholeFinal="",t.kodalyHandDo="",t.kodalyHandFa="",t.kodalyHandLa="",t.kodalyHandMi="",t.kodalyHandRe="",t.kodalyHandSo="",t.kodalyHandTi="",t.leftRepeatSmall="",t.legerLine="",t.legerLineNarrow="",t.legerLineWide="",t.luteBarlineEndRepeat="",t.luteBarlineFinal="",t.luteBarlineStartRepeat="",t.luteDuration16th="",t.luteDuration32nd="",t.luteDuration8th="",t.luteDurationDoubleWhole="",t.luteDurationHalf="",t.luteDurationQuarter="",t.luteDurationWhole="",t.luteFingeringRHFirst="",t.luteFingeringRHSecond="",t.luteFingeringRHThird="",t.luteFingeringRHThumb="",t.luteFrench10thCourse="",t.luteFrench7thCourse="",t.luteFrench8thCourse="",t.luteFrench9thCourse="",t.luteFrenchAppoggiaturaAbove="",t.luteFrenchAppoggiaturaBelow="",t.luteFrenchFretA="",t.luteFrenchFretB="",t.luteFrenchFretC="",t.luteFrenchFretD="",t.luteFrenchFretE="",t.luteFrenchFretF="",t.luteFrenchFretG="",t.luteFrenchFretH="",t.luteFrenchFretI="",t.luteFrenchFretK="",t.luteFrenchFretL="",t.luteFrenchFretM="",t.luteFrenchFretN="",t.luteFrenchMordentInverted="",t.luteFrenchMordentLower="",t.luteFrenchMordentUpper="",t.luteGermanALower="",t.luteGermanAUpper="",t.luteGermanBLower="",t.luteGermanBUpper="",t.luteGermanCLower="",t.luteGermanCUpper="",t.luteGermanDLower="",t.luteGermanDUpper="",t.luteGermanELower="",t.luteGermanEUpper="",t.luteGermanFLower="",t.luteGermanFUpper="",t.luteGermanGLower="",t.luteGermanGUpper="",t.luteGermanHLower="",t.luteGermanHUpper="",t.luteGermanILower="",t.luteGermanIUpper="",t.luteGermanKLower="",t.luteGermanKUpper="",t.luteGermanLLower="",t.luteGermanLUpper="",t.luteGermanMLower="",t.luteGermanMUpper="",t.luteGermanNLower="",t.luteGermanNUpper="",t.luteGermanOLower="",t.luteGermanPLower="",t.luteGermanQLower="",t.luteGermanRLower="",t.luteGermanSLower="",t.luteGermanTLower="",t.luteGermanVLower="",t.luteGermanXLower="",t.luteGermanYLower="",t.luteGermanZLower="",t.luteItalianClefCSolFaUt="",t.luteItalianClefFFaUt="",t.luteItalianFret0="",t.luteItalianFret1="",t.luteItalianFret2="",t.luteItalianFret3="",t.luteItalianFret4="",t.luteItalianFret5="",t.luteItalianFret6="",t.luteItalianFret7="",t.luteItalianFret8="",t.luteItalianFret9="",t.luteItalianHoldFinger="",t.luteItalianHoldNote="",t.luteItalianReleaseFinger="",t.luteItalianTempoFast="",t.luteItalianTempoNeitherFastNorSlow="",t.luteItalianTempoSlow="",t.luteItalianTempoSomewhatFast="",t.luteItalianTempoVerySlow="",t.luteItalianTimeTriple="",t.luteItalianTremolo="",t.luteItalianVibrato="",t.luteStaff6Lines="",t.luteStaff6LinesNarrow="",t.luteStaff6LinesWide="",t.lyricsElision="",t.lyricsElisionNarrow="",t.lyricsElisionWide="",t.lyricsHyphenBaseline="",t.lyricsHyphenBaselineNonBreaking="",t.lyricsTextRepeat="",t.medRenFlatHardB="",t.medRenFlatSoftB="",t.medRenFlatWithDot="",t.medRenGClefCMN="",t.medRenLiquescenceCMN="",t.medRenLiquescentAscCMN="",t.medRenLiquescentDescCMN="",t.medRenNatural="",t.medRenNaturalWithCross="",t.medRenOriscusCMN="",t.medRenPlicaCMN="",t.medRenPunctumCMN="",t.medRenQuilismaCMN="",t.medRenSharpCroix="",t.medRenStrophicusCMN="",t.mensuralAlterationSign="",t.mensuralBlackBrevis="",t.mensuralBlackBrevisVoid="",t.mensuralBlackDragma="",t.mensuralBlackLonga="",t.mensuralBlackMaxima="",t.mensuralBlackMinima="",t.mensuralBlackMinimaVoid="",t.mensuralBlackSemibrevis="",t.mensuralBlackSemibrevisCaudata="",t.mensuralBlackSemibrevisOblique="",t.mensuralBlackSemibrevisVoid="",t.mensuralBlackSemiminima="",t.mensuralCclef="",t.mensuralCclefPetrucciPosHigh="",t.mensuralCclefPetrucciPosHighest="",t.mensuralCclefPetrucciPosLow="",t.mensuralCclefPetrucciPosLowest="",t.mensuralCclefPetrucciPosMiddle="",t.mensuralColorationEndRound="",t.mensuralColorationEndSquare="",t.mensuralColorationStartRound="",t.mensuralColorationStartSquare="",t.mensuralCombStemDiagonal="",t.mensuralCombStemDown="",t.mensuralCombStemDownFlagExtended="",t.mensuralCombStemDownFlagFlared="",t.mensuralCombStemDownFlagFusa="",t.mensuralCombStemDownFlagLeft="",t.mensuralCombStemDownFlagRight="",t.mensuralCombStemDownFlagSemiminima="",t.mensuralCombStemUp="",t.mensuralCombStemUpFlagExtended="",t.mensuralCombStemUpFlagFlared="",t.mensuralCombStemUpFlagFusa="",t.mensuralCombStemUpFlagLeft="",t.mensuralCombStemUpFlagRight="",t.mensuralCombStemUpFlagSemiminima="",t.mensuralCustosCheckmark="",t.mensuralCustosDown="",t.mensuralCustosTurn="",t.mensuralCustosUp="",t.mensuralFclef="",t.mensuralFclefPetrucci="",t.mensuralGclef="",t.mensuralGclefPetrucci="",t.mensuralModusImperfectumVert="",t.mensuralModusPerfectumVert="",t.mensuralNoteheadLongaBlack="",t.mensuralNoteheadLongaBlackVoid="",t.mensuralNoteheadLongaVoid="",t.mensuralNoteheadLongaWhite="",t.mensuralNoteheadMaximaBlack="",t.mensuralNoteheadMaximaBlackVoid="",t.mensuralNoteheadMaximaVoid="",t.mensuralNoteheadMaximaWhite="",t.mensuralNoteheadMinimaWhite="",t.mensuralNoteheadSemibrevisBlack="",t.mensuralNoteheadSemibrevisBlackVoid="",t.mensuralNoteheadSemibrevisBlackVoidTurned="",t.mensuralNoteheadSemibrevisVoid="",t.mensuralNoteheadSemiminimaWhite="",t.mensuralObliqueAsc2ndBlack="",t.mensuralObliqueAsc2ndBlackVoid="",t.mensuralObliqueAsc2ndVoid="",t.mensuralObliqueAsc2ndWhite="",t.mensuralObliqueAsc3rdBlack="",t.mensuralObliqueAsc3rdBlackVoid="",t.mensuralObliqueAsc3rdVoid="",t.mensuralObliqueAsc3rdWhite="",t.mensuralObliqueAsc4thBlack="",t.mensuralObliqueAsc4thBlackVoid="",t.mensuralObliqueAsc4thVoid="",t.mensuralObliqueAsc4thWhite="",t.mensuralObliqueAsc5thBlack="",t.mensuralObliqueAsc5thBlackVoid="",t.mensuralObliqueAsc5thVoid="",t.mensuralObliqueAsc5thWhite="",t.mensuralObliqueDesc2ndBlack="",t.mensuralObliqueDesc2ndBlackVoid="",t.mensuralObliqueDesc2ndVoid="",t.mensuralObliqueDesc2ndWhite="",t.mensuralObliqueDesc3rdBlack="",t.mensuralObliqueDesc3rdBlackVoid="",t.mensuralObliqueDesc3rdVoid="",t.mensuralObliqueDesc3rdWhite="",t.mensuralObliqueDesc4thBlack="",t.mensuralObliqueDesc4thBlackVoid="",t.mensuralObliqueDesc4thVoid="",t.mensuralObliqueDesc4thWhite="",t.mensuralObliqueDesc5thBlack="",t.mensuralObliqueDesc5thBlackVoid="",t.mensuralObliqueDesc5thVoid="",t.mensuralObliqueDesc5thWhite="",t.mensuralProlation1="",t.mensuralProlation10="",t.mensuralProlation11="",t.mensuralProlation2="",t.mensuralProlation3="",t.mensuralProlation4="",t.mensuralProlation5="",t.mensuralProlation6="",t.mensuralProlation7="",t.mensuralProlation8="",t.mensuralProlation9="",t.mensuralProlationCombiningDot="",t.mensuralProlationCombiningDotVoid="",t.mensuralProlationCombiningStroke="",t.mensuralProlationCombiningThreeDots="",t.mensuralProlationCombiningThreeDotsTri="",t.mensuralProlationCombiningTwoDots="",t.mensuralProportion1="",t.mensuralProportion2="",t.mensuralProportion3="",t.mensuralProportion4="",t.mensuralProportion5="",t.mensuralProportion6="",t.mensuralProportion7="",t.mensuralProportion8="",t.mensuralProportion9="",t.mensuralProportionMajor="",t.mensuralProportionMinor="",t.mensuralProportionProportioDupla1="",t.mensuralProportionProportioDupla2="",t.mensuralProportionProportioQuadrupla="",t.mensuralProportionProportioTripla="",t.mensuralProportionTempusPerfectum="",t.mensuralRestBrevis="",t.mensuralRestFusa="",t.mensuralRestLongaImperfecta="",t.mensuralRestLongaPerfecta="",t.mensuralRestMaxima="",t.mensuralRestMinima="",t.mensuralRestSemibrevis="",t.mensuralRestSemifusa="",t.mensuralRestSemiminima="",t.mensuralSignumDown="",t.mensuralSignumUp="",t.mensuralTempusImperfectumHoriz="",t.mensuralTempusPerfectumHoriz="",t.mensuralWhiteBrevis="",t.mensuralWhiteFusa="",t.mensuralWhiteLonga="",t.mensuralWhiteMaxima="",t.mensuralWhiteMinima="",t.mensuralWhiteSemibrevis="",t.mensuralWhiteSemiminima="",t.metAugmentationDot="",t.metNote1024thDown="",t.metNote1024thUp="",t.metNote128thDown="",t.metNote128thUp="",t.metNote16thDown="",t.metNote16thUp="",t.metNote256thDown="",t.metNote256thUp="",t.metNote32ndDown="",t.metNote32ndUp="",t.metNote512thDown="",t.metNote512thUp="",t.metNote64thDown="",t.metNote64thUp="",t.metNote8thDown="",t.metNote8thUp="",t.metNoteDoubleWhole="",t.metNoteDoubleWholeSquare="",t.metNoteHalfDown="",t.metNoteHalfUp="",t.metNoteQuarterDown="",t.metNoteQuarterUp="",t.metNoteWhole="",t.metricModulationArrowLeft="",t.metricModulationArrowRight="",t.miscDoNotCopy="",t.miscDoNotPhotocopy="",t.miscEyeglasses="",t.note1024thDown="",t.note1024thUp="",t.note128thDown="",t.note128thUp="",t.note16thDown="",t.note16thUp="",t.note256thDown="",t.note256thUp="",t.note32ndDown="",t.note32ndUp="",t.note512thDown="",t.note512thUp="",t.note64thDown="",t.note64thUp="",t.note8thDown="",t.note8thUp="",t.noteABlack="",t.noteAFlatBlack="",t.noteAFlatHalf="",t.noteAFlatWhole="",t.noteAHalf="",t.noteASharpBlack="",t.noteASharpHalf="",t.noteASharpWhole="",t.noteAWhole="",t.noteBBlack="",t.noteBFlatBlack="",t.noteBFlatHalf="",t.noteBFlatWhole="",t.noteBHalf="",t.noteBSharpBlack="",t.noteBSharpHalf="",t.noteBSharpWhole="",t.noteBWhole="",t.noteCBlack="",t.noteCFlatBlack="",t.noteCFlatHalf="",t.noteCFlatWhole="",t.noteCHalf="",t.noteCSharpBlack="",t.noteCSharpHalf="",t.noteCSharpWhole="",t.noteCWhole="",t.noteDBlack="",t.noteDFlatBlack="",t.noteDFlatHalf="",t.noteDFlatWhole="",t.noteDHalf="",t.noteDSharpBlack="",t.noteDSharpHalf="",t.noteDSharpWhole="",t.noteDWhole="",t.noteDiBlack="",t.noteDiHalf="",t.noteDiWhole="",t.noteDoBlack="",t.noteDoHalf="",t.noteDoWhole="",t.noteDoubleWhole="",t.noteDoubleWholeSquare="",t.noteEBlack="",t.noteEFlatBlack="",t.noteEFlatHalf="",t.noteEFlatWhole="",t.noteEHalf="",t.noteESharpBlack="",t.noteESharpHalf="",t.noteESharpWhole="",t.noteEWhole="",t.noteEmptyBlack="",t.noteEmptyHalf="",t.noteEmptyWhole="",t.noteFBlack="",t.noteFFlatBlack="",t.noteFFlatHalf="",t.noteFFlatWhole="",t.noteFHalf="",t.noteFSharpBlack="",t.noteFSharpHalf="",t.noteFSharpWhole="",t.noteFWhole="",t.noteFaBlack="",t.noteFaHalf="",t.noteFaWhole="",t.noteFiBlack="",t.noteFiHalf="",t.noteFiWhole="",t.noteGBlack="",t.noteGFlatBlack="",t.noteGFlatHalf="",t.noteGFlatWhole="",t.noteGHalf="",t.noteGSharpBlack="",t.noteGSharpHalf="",t.noteGSharpWhole="",t.noteGWhole="",t.noteHBlack="",t.noteHHalf="",t.noteHSharpBlack="",t.noteHSharpHalf="",t.noteHSharpWhole="",t.noteHWhole="",t.noteHalfDown="",t.noteHalfUp="",t.noteLaBlack="",t.noteLaHalf="",t.noteLaWhole="",t.noteLeBlack="",t.noteLeHalf="",t.noteLeWhole="",t.noteLiBlack="",t.noteLiHalf="",t.noteLiWhole="",t.noteMeBlack="",t.noteMeHalf="",t.noteMeWhole="",t.noteMiBlack="",t.noteMiHalf="",t.noteMiWhole="",t.noteQuarterDown="",t.noteQuarterUp="",t.noteRaBlack="",t.noteRaHalf="",t.noteRaWhole="",t.noteReBlack="",t.noteReHalf="",t.noteReWhole="",t.noteRiBlack="",t.noteRiHalf="",t.noteRiWhole="",t.noteSeBlack="",t.noteSeHalf="",t.noteSeWhole="",t.noteShapeArrowheadLeftBlack="",t.noteShapeArrowheadLeftDoubleWhole="",t.noteShapeArrowheadLeftWhite="",t.noteShapeDiamondBlack="",t.noteShapeDiamondDoubleWhole="",t.noteShapeDiamondWhite="",t.noteShapeIsoscelesTriangleBlack="",t.noteShapeIsoscelesTriangleDoubleWhole="",t.noteShapeIsoscelesTriangleWhite="",t.noteShapeKeystoneBlack="",t.noteShapeKeystoneDoubleWhole="",t.noteShapeKeystoneWhite="",t.noteShapeMoonBlack="",t.noteShapeMoonDoubleWhole="",t.noteShapeMoonLeftBlack="",t.noteShapeMoonLeftDoubleWhole="",t.noteShapeMoonLeftWhite="",t.noteShapeMoonWhite="",t.noteShapeQuarterMoonBlack="",t.noteShapeQuarterMoonDoubleWhole="",t.noteShapeQuarterMoonWhite="",t.noteShapeRoundBlack="",t.noteShapeRoundDoubleWhole="",t.noteShapeRoundWhite="",t.noteShapeSquareBlack="",t.noteShapeSquareDoubleWhole="",t.noteShapeSquareWhite="",t.noteShapeTriangleLeftBlack="",t.noteShapeTriangleLeftDoubleWhole="",t.noteShapeTriangleLeftWhite="",t.noteShapeTriangleRightBlack="",t.noteShapeTriangleRightDoubleWhole="",t.noteShapeTriangleRightWhite="",t.noteShapeTriangleRoundBlack="",t.noteShapeTriangleRoundDoubleWhole="",t.noteShapeTriangleRoundLeftBlack="",t.noteShapeTriangleRoundLeftDoubleWhole="",t.noteShapeTriangleRoundLeftWhite="",t.noteShapeTriangleRoundWhite="",t.noteShapeTriangleUpBlack="",t.noteShapeTriangleUpDoubleWhole="",t.noteShapeTriangleUpWhite="",t.noteSiBlack="",t.noteSiHalf="",t.noteSiWhole="",t.noteSoBlack="",t.noteSoHalf="",t.noteSoWhole="",t.noteTeBlack="",t.noteTeHalf="",t.noteTeWhole="",t.noteTiBlack="",t.noteTiHalf="",t.noteTiWhole="",t.noteWhole="",t.noteheadBlack="",t.noteheadCircleSlash="",t.noteheadCircleX="",t.noteheadCircleXDoubleWhole="",t.noteheadCircleXHalf="",t.noteheadCircleXWhole="",t.noteheadCircledBlack="",t.noteheadCircledBlackLarge="",t.noteheadCircledDoubleWhole="",t.noteheadCircledDoubleWholeLarge="",t.noteheadCircledHalf="",t.noteheadCircledHalfLarge="",t.noteheadCircledWhole="",t.noteheadCircledWholeLarge="",t.noteheadCircledXLarge="",t.noteheadClusterDoubleWhole2nd="",t.noteheadClusterDoubleWhole3rd="",t.noteheadClusterDoubleWholeBottom="",t.noteheadClusterDoubleWholeMiddle="",t.noteheadClusterDoubleWholeTop="",t.noteheadClusterHalf2nd="",t.noteheadClusterHalf3rd="",t.noteheadClusterHalfBottom="",t.noteheadClusterHalfMiddle="",t.noteheadClusterHalfTop="",t.noteheadClusterQuarter2nd="",t.noteheadClusterQuarter3rd="",t.noteheadClusterQuarterBottom="",t.noteheadClusterQuarterMiddle="",t.noteheadClusterQuarterTop="",t.noteheadClusterRoundBlack="",t.noteheadClusterRoundWhite="",t.noteheadClusterSquareBlack="",t.noteheadClusterSquareWhite="",t.noteheadClusterWhole2nd="",t.noteheadClusterWhole3rd="",t.noteheadClusterWholeBottom="",t.noteheadClusterWholeMiddle="",t.noteheadClusterWholeTop="",t.noteheadCowellEleventhNoteSeriesHalf="",t.noteheadCowellEleventhNoteSeriesWhole="",t.noteheadCowellEleventhSeriesBlack="",t.noteheadCowellFifteenthNoteSeriesBlack="",t.noteheadCowellFifteenthNoteSeriesHalf="",t.noteheadCowellFifteenthNoteSeriesWhole="",t.noteheadCowellFifthNoteSeriesBlack="",t.noteheadCowellFifthNoteSeriesHalf="",t.noteheadCowellFifthNoteSeriesWhole="",t.noteheadCowellNinthNoteSeriesBlack="",t.noteheadCowellNinthNoteSeriesHalf="",t.noteheadCowellNinthNoteSeriesWhole="",t.noteheadCowellSeventhNoteSeriesBlack="",t.noteheadCowellSeventhNoteSeriesHalf="",t.noteheadCowellSeventhNoteSeriesWhole="",t.noteheadCowellThirdNoteSeriesBlack="",t.noteheadCowellThirdNoteSeriesHalf="",t.noteheadCowellThirdNoteSeriesWhole="",t.noteheadCowellThirteenthNoteSeriesBlack="",t.noteheadCowellThirteenthNoteSeriesHalf="",t.noteheadCowellThirteenthNoteSeriesWhole="",t.noteheadDiamondBlack="",t.noteheadDiamondBlackOld="",t.noteheadDiamondBlackWide="",t.noteheadDiamondClusterBlack2nd="",t.noteheadDiamondClusterBlack3rd="",t.noteheadDiamondClusterBlackBottom="",t.noteheadDiamondClusterBlackMiddle="",t.noteheadDiamondClusterBlackTop="",t.noteheadDiamondClusterWhite2nd="",t.noteheadDiamondClusterWhite3rd="",t.noteheadDiamondClusterWhiteBottom="",t.noteheadDiamondClusterWhiteMiddle="",t.noteheadDiamondClusterWhiteTop="",t.noteheadDiamondDoubleWhole="",t.noteheadDiamondDoubleWholeOld="",t.noteheadDiamondHalf="",t.noteheadDiamondHalfFilled="",t.noteheadDiamondHalfOld="",t.noteheadDiamondHalfWide="",t.noteheadDiamondOpen="",t.noteheadDiamondWhite="",t.noteheadDiamondWhiteWide="",t.noteheadDiamondWhole="",t.noteheadDiamondWholeOld="",t.noteheadDoubleWhole="",t.noteheadDoubleWholeSquare="",t.noteheadDoubleWholeWithX="",t.noteheadHalf="",t.noteheadHalfFilled="",t.noteheadHalfWithX="",t.noteheadHeavyX="",t.noteheadHeavyXHat="",t.noteheadLargeArrowDownBlack="",t.noteheadLargeArrowDownDoubleWhole="",t.noteheadLargeArrowDownHalf="",t.noteheadLargeArrowDownWhole="",t.noteheadLargeArrowUpBlack="",t.noteheadLargeArrowUpDoubleWhole="",t.noteheadLargeArrowUpHalf="",t.noteheadLargeArrowUpWhole="",t.noteheadMoonBlack="",t.noteheadMoonWhite="",t.noteheadNancarrowSine="",t.noteheadNull="",t.noteheadParenthesis="",t.noteheadParenthesisLeft="",t.noteheadParenthesisRight="",t.noteheadPlusBlack="",t.noteheadPlusDoubleWhole="",t.noteheadPlusHalf="",t.noteheadPlusWhole="",t.noteheadRectangularClusterBlackBottom="",t.noteheadRectangularClusterBlackMiddle="",t.noteheadRectangularClusterBlackTop="",t.noteheadRectangularClusterWhiteBottom="",t.noteheadRectangularClusterWhiteMiddle="",t.noteheadRectangularClusterWhiteTop="",t.noteheadRoundBlack="",t.noteheadRoundBlackDoubleSlashed="",t.noteheadRoundBlackLarge="",t.noteheadRoundBlackSlashed="",t.noteheadRoundBlackSlashedLarge="",t.noteheadRoundWhite="",t.noteheadRoundWhiteDoubleSlashed="",t.noteheadRoundWhiteLarge="",t.noteheadRoundWhiteSlashed="",t.noteheadRoundWhiteSlashedLarge="",t.noteheadRoundWhiteWithDot="",t.noteheadRoundWhiteWithDotLarge="",t.noteheadSlashDiamondWhite="",t.noteheadSlashHorizontalEnds="",t.noteheadSlashHorizontalEndsMuted="",t.noteheadSlashVerticalEnds="",t.noteheadSlashVerticalEndsMuted="",t.noteheadSlashVerticalEndsSmall="",t.noteheadSlashWhiteDoubleWhole="",t.noteheadSlashWhiteHalf="",t.noteheadSlashWhiteMuted="",t.noteheadSlashWhiteWhole="",t.noteheadSlashX="",t.noteheadSlashedBlack1="",t.noteheadSlashedBlack2="",t.noteheadSlashedDoubleWhole1="",t.noteheadSlashedDoubleWhole2="",t.noteheadSlashedHalf1="",t.noteheadSlashedHalf2="",t.noteheadSlashedWhole1="",t.noteheadSlashedWhole2="",t.noteheadSquareBlack="",t.noteheadSquareBlackLarge="",t.noteheadSquareBlackWhite="",t.noteheadSquareWhite="",t.noteheadTriangleDownBlack="",t.noteheadTriangleDownDoubleWhole="",t.noteheadTriangleDownHalf="",t.noteheadTriangleDownWhite="",t.noteheadTriangleDownWhole="",t.noteheadTriangleLeftBlack="",t.noteheadTriangleLeftWhite="",t.noteheadTriangleRightBlack="",t.noteheadTriangleRightWhite="",t.noteheadTriangleRoundDownBlack="",t.noteheadTriangleRoundDownWhite="",t.noteheadTriangleUpBlack="",t.noteheadTriangleUpDoubleWhole="",t.noteheadTriangleUpHalf="",t.noteheadTriangleUpRightBlack="",t.noteheadTriangleUpRightWhite="",t.noteheadTriangleUpWhite="",t.noteheadTriangleUpWhole="",t.noteheadVoidWithX="",t.noteheadWhole="",t.noteheadWholeFilled="",t.noteheadWholeWithX="",t.noteheadXBlack="",t.noteheadXDoubleWhole="",t.noteheadXHalf="",t.noteheadXOrnate="",t.noteheadXOrnateEllipse="",t.noteheadXWhole="",t.octaveBaselineA="",t.octaveBaselineB="",t.octaveBaselineM="",t.octaveBaselineV="",t.octaveBassa="",t.octaveLoco="",t.octaveParensLeft="",t.octaveParensRight="",t.octaveSuperscriptA="",t.octaveSuperscriptB="",t.octaveSuperscriptM="",t.octaveSuperscriptV="",t.oneHandedRollStevens="",t.organGerman2Fusae="",t.organGerman2Minimae="",t.organGerman2OctaveUp="",t.organGerman2Semifusae="",t.organGerman2Semiminimae="",t.organGerman3Fusae="",t.organGerman3Minimae="",t.organGerman3Semifusae="",t.organGerman3Semiminimae="",t.organGerman4Fusae="",t.organGerman4Minimae="",t.organGerman4Semifusae="",t.organGerman4Semiminimae="",t.organGerman5Fusae="",t.organGerman5Minimae="",t.organGerman5Semifusae="",t.organGerman5Semiminimae="",t.organGerman6Fusae="",t.organGerman6Minimae="",t.organGerman6Semifusae="",t.organGerman6Semiminimae="",t.organGermanALower="",t.organGermanAUpper="",t.organGermanAugmentationDot="",t.organGermanBLower="",t.organGermanBUpper="",t.organGermanBuxheimerBrevis2="",t.organGermanBuxheimerBrevis3="",t.organGermanBuxheimerMinimaRest="",t.organGermanBuxheimerSemibrevis="",t.organGermanBuxheimerSemibrevisRest="",t.organGermanCLower="",t.organGermanCUpper="",t.organGermanCisLower="",t.organGermanCisUpper="",t.organGermanDLower="",t.organGermanDUpper="",t.organGermanDisLower="",t.organGermanDisUpper="",t.organGermanELower="",t.organGermanEUpper="",t.organGermanFLower="",t.organGermanFUpper="",t.organGermanFisLower="",t.organGermanFisUpper="",t.organGermanFusa="",t.organGermanFusaRest="",t.organGermanGLower="",t.organGermanGUpper="",t.organGermanGisLower="",t.organGermanGisUpper="",t.organGermanHLower="",t.organGermanHUpper="",t.organGermanMinima="",t.organGermanMinimaRest="",t.organGermanOctaveDown="",t.organGermanOctaveUp="",t.organGermanSemibrevis="",t.organGermanSemibrevisRest="",t.organGermanSemifusa="",t.organGermanSemifusaRest="",t.organGermanSemiminima="",t.organGermanSemiminimaRest="",t.organGermanTie="",t.ornamentBottomLeftConcaveStroke="",t.ornamentBottomLeftConcaveStrokeLarge="",t.ornamentBottomLeftConvexStroke="",t.ornamentBottomRightConcaveStroke="",t.ornamentBottomRightConvexStroke="",t.ornamentComma="",t.ornamentDoubleObliqueLinesAfterNote="",t.ornamentDoubleObliqueLinesBeforeNote="",t.ornamentDownCurve="",t.ornamentHaydn="",t.ornamentHighLeftConcaveStroke="",t.ornamentHighLeftConvexStroke="",t.ornamentHighRightConcaveStroke="",t.ornamentHighRightConvexStroke="",t.ornamentHookAfterNote="",t.ornamentHookBeforeNote="",t.ornamentLeftFacingHalfCircle="",t.ornamentLeftFacingHook="",t.ornamentLeftPlus="",t.ornamentLeftShakeT="",t.ornamentLeftVerticalStroke="",t.ornamentLeftVerticalStrokeWithCross="",t.ornamentLowLeftConcaveStroke="",t.ornamentLowLeftConvexStroke="",t.ornamentLowRightConcaveStroke="",t.ornamentLowRightConvexStroke="",t.ornamentMiddleVerticalStroke="",t.ornamentMordent="",t.ornamentObliqueLineAfterNote="",t.ornamentObliqueLineBeforeNote="",t.ornamentObliqueLineHorizAfterNote="",t.ornamentObliqueLineHorizBeforeNote="",t.ornamentOriscus="",t.ornamentPinceCouperin="",t.ornamentPortDeVoixV="",t.ornamentPrecompAppoggTrill="",t.ornamentPrecompAppoggTrillSuffix="",t.ornamentPrecompCadence="",t.ornamentPrecompCadenceUpperPrefix="",t.ornamentPrecompCadenceUpperPrefixTurn="",t.ornamentPrecompCadenceWithTurn="",t.ornamentPrecompDescendingSlide="",t.ornamentPrecompDoubleCadenceLowerPrefix="",t.ornamentPrecompDoubleCadenceUpperPrefix="",t.ornamentPrecompDoubleCadenceUpperPrefixTurn="",t.ornamentPrecompInvertedMordentUpperPrefix="",t.ornamentPrecompMordentRelease="",t.ornamentPrecompMordentUpperPrefix="",t.ornamentPrecompPortDeVoixMordent="",t.ornamentPrecompSlide="",t.ornamentPrecompSlideTrillBach="",t.ornamentPrecompSlideTrillDAnglebert="",t.ornamentPrecompSlideTrillMarpurg="",t.ornamentPrecompSlideTrillMuffat="",t.ornamentPrecompSlideTrillSuffixMuffat="",t.ornamentPrecompTrillLowerSuffix="",t.ornamentPrecompTrillSuffixDandrieu="",t.ornamentPrecompTrillWithMordent="",t.ornamentPrecompTurnTrillBach="",t.ornamentPrecompTurnTrillDAnglebert="",t.ornamentQuilisma="",t.ornamentRightFacingHalfCircle="",t.ornamentRightFacingHook="",t.ornamentRightVerticalStroke="",t.ornamentSchleifer="",t.ornamentShake3="",t.ornamentShakeMuffat1="",t.ornamentShortObliqueLineAfterNote="",t.ornamentShortObliqueLineBeforeNote="",t.ornamentShortTrill="",t.ornamentTopLeftConcaveStroke="",t.ornamentTopLeftConvexStroke="",t.ornamentTopRightConcaveStroke="",t.ornamentTopRightConvexStroke="",t.ornamentTremblement="",t.ornamentTremblementCouperin="",t.ornamentTrill="",t.ornamentTurn="",t.ornamentTurnInverted="",t.ornamentTurnSlash="",t.ornamentTurnUp="",t.ornamentTurnUpS="",t.ornamentUpCurve="",t.ornamentVerticalLine="",t.ornamentZigZagLineNoRightEnd="",t.ornamentZigZagLineWithRightEnd="",t.ottava="",t.ottavaAlta="",t.ottavaBassa="",t.ottavaBassaBa="",t.ottavaBassaVb="",t.pendereckiTremolo="",t.pictAgogo="",t.pictAlmglocken="",t.pictAnvil="",t.pictBambooChimes="",t.pictBambooScraper="",t.pictBassDrum="",t.pictBassDrumOnSide="",t.pictBeaterBow="",t.pictBeaterBox="",t.pictBeaterBrassMalletsDown="",t.pictBeaterBrassMalletsLeft="",t.pictBeaterBrassMalletsRight="",t.pictBeaterBrassMalletsUp="",t.pictBeaterCombiningDashedCircle="",t.pictBeaterCombiningParentheses="",t.pictBeaterDoubleBassDrumDown="",t.pictBeaterDoubleBassDrumUp="",t.pictBeaterFinger="",t.pictBeaterFingernails="",t.pictBeaterFist="",t.pictBeaterGuiroScraper="",t.pictBeaterHammer="",t.pictBeaterHammerMetalDown="",t.pictBeaterHammerMetalUp="",t.pictBeaterHammerPlasticDown="",t.pictBeaterHammerPlasticUp="",t.pictBeaterHammerWoodDown="",t.pictBeaterHammerWoodUp="",t.pictBeaterHand="",t.pictBeaterHardBassDrumDown="",t.pictBeaterHardBassDrumUp="",t.pictBeaterHardGlockenspielDown="",t.pictBeaterHardGlockenspielLeft="",t.pictBeaterHardGlockenspielRight="",t.pictBeaterHardGlockenspielUp="",t.pictBeaterHardTimpaniDown="",t.pictBeaterHardTimpaniLeft="",t.pictBeaterHardTimpaniRight="",t.pictBeaterHardTimpaniUp="",t.pictBeaterHardXylophoneDown="",t.pictBeaterHardXylophoneLeft="",t.pictBeaterHardXylophoneRight="",t.pictBeaterHardXylophoneUp="",t.pictBeaterHardYarnDown="",t.pictBeaterHardYarnLeft="",t.pictBeaterHardYarnRight="",t.pictBeaterHardYarnUp="",t.pictBeaterJazzSticksDown="",t.pictBeaterJazzSticksUp="",t.pictBeaterKnittingNeedle="",t.pictBeaterMallet="",t.pictBeaterMalletDown="",t.pictBeaterMediumBassDrumDown="",t.pictBeaterMediumBassDrumUp="",t.pictBeaterMediumTimpaniDown="",t.pictBeaterMediumTimpaniLeft="",t.pictBeaterMediumTimpaniRight="",t.pictBeaterMediumTimpaniUp="",t.pictBeaterMediumXylophoneDown="",t.pictBeaterMediumXylophoneLeft="",t.pictBeaterMediumXylophoneRight="",t.pictBeaterMediumXylophoneUp="",t.pictBeaterMediumYarnDown="",t.pictBeaterMediumYarnLeft="",t.pictBeaterMediumYarnRight="",t.pictBeaterMediumYarnUp="",t.pictBeaterMetalBassDrumDown="",t.pictBeaterMetalBassDrumUp="",t.pictBeaterMetalDown="",t.pictBeaterMetalHammer="",t.pictBeaterMetalLeft="",t.pictBeaterMetalRight="",t.pictBeaterMetalUp="",t.pictBeaterSnareSticksDown="",t.pictBeaterSnareSticksUp="",t.pictBeaterSoftBassDrumDown="",t.pictBeaterSoftBassDrumUp="",t.pictBeaterSoftGlockenspielDown="",t.pictBeaterSoftGlockenspielLeft="",t.pictBeaterSoftGlockenspielRight="",t.pictBeaterSoftGlockenspielUp="",t.pictBeaterSoftTimpaniDown="",t.pictBeaterSoftTimpaniLeft="",t.pictBeaterSoftTimpaniRight="",t.pictBeaterSoftTimpaniUp="",t.pictBeaterSoftXylophone="",t.pictBeaterSoftXylophoneDown="",t.pictBeaterSoftXylophoneLeft="",t.pictBeaterSoftXylophoneRight="",t.pictBeaterSoftXylophoneUp="",t.pictBeaterSoftYarnDown="",t.pictBeaterSoftYarnLeft="",t.pictBeaterSoftYarnRight="",t.pictBeaterSoftYarnUp="",t.pictBeaterSpoonWoodenMallet="",t.pictBeaterSuperballDown="",t.pictBeaterSuperballLeft="",t.pictBeaterSuperballRight="",t.pictBeaterSuperballUp="",t.pictBeaterTriangleDown="",t.pictBeaterTrianglePlain="",t.pictBeaterTriangleUp="",t.pictBeaterWireBrushesDown="",t.pictBeaterWireBrushesUp="",t.pictBeaterWoodTimpaniDown="",t.pictBeaterWoodTimpaniLeft="",t.pictBeaterWoodTimpaniRight="",t.pictBeaterWoodTimpaniUp="",t.pictBeaterWoodXylophoneDown="",t.pictBeaterWoodXylophoneLeft="",t.pictBeaterWoodXylophoneRight="",t.pictBeaterWoodXylophoneUp="",t.pictBell="",t.pictBellOfCymbal="",t.pictBellPlate="",t.pictBellTree="",t.pictBirdWhistle="",t.pictBoardClapper="",t.pictBongos="",t.pictBrakeDrum="",t.pictCabasa="",t.pictCannon="",t.pictCarHorn="",t.pictCastanets="",t.pictCastanetsWithHandle="",t.pictCelesta="",t.pictCencerro="",t.pictCenter1="",t.pictCenter2="",t.pictCenter3="",t.pictChainRattle="",t.pictChimes="",t.pictChineseCymbal="",t.pictChokeCymbal="",t.pictClaves="",t.pictCoins="",t.pictConga="",t.pictCowBell="",t.pictCrashCymbals="",t.pictCrotales="",t.pictCrushStem="",t.pictCuica="",t.pictCymbalTongs="",t.pictDamp1="",t.pictDamp2="",t.pictDamp3="",t.pictDamp4="",t.pictDeadNoteStem="",t.pictDrumStick="",t.pictDuckCall="",t.pictEdgeOfCymbal="",t.pictEmptyTrap="",t.pictFingerCymbals="",t.pictFlexatone="",t.pictFootballRatchet="",t.pictGlassHarmonica="",t.pictGlassHarp="",t.pictGlassPlateChimes="",t.pictGlassTubeChimes="",t.pictGlsp="",t.pictGlspSmithBrindle="",t.pictGobletDrum="",t.pictGong="",t.pictGongWithButton="",t.pictGuiro="",t.pictGumHardDown="",t.pictGumHardLeft="",t.pictGumHardRight="",t.pictGumHardUp="",t.pictGumMediumDown="",t.pictGumMediumLeft="",t.pictGumMediumRight="",t.pictGumMediumUp="",t.pictGumSoftDown="",t.pictGumSoftLeft="",t.pictGumSoftRight="",t.pictGumSoftUp="",t.pictHalfOpen1="",t.pictHalfOpen2="",t.pictHandbell="",t.pictHiHat="",t.pictHiHatOnStand="",t.pictJawHarp="",t.pictJingleBells="",t.pictKlaxonHorn="",t.pictLeftHandCircle="",t.pictLionsRoar="",t.pictLithophone="",t.pictLogDrum="",t.pictLotusFlute="",t.pictMar="",t.pictMarSmithBrindle="",t.pictMaraca="",t.pictMaracas="",t.pictMegaphone="",t.pictMetalPlateChimes="",t.pictMetalTubeChimes="",t.pictMusicalSaw="",t.pictNormalPosition="",t.pictOnRim="",t.pictOpen="",t.pictOpenRimShot="",t.pictPistolShot="",t.pictPoliceWhistle="",t.pictQuijada="",t.pictRainstick="",t.pictRatchet="",t.pictRecoReco="",t.pictRightHandSquare="",t.pictRim1="",t.pictRim2="",t.pictRim3="",t.pictRimShotOnStem="",t.pictSandpaperBlocks="",t.pictScrapeAroundRim="",t.pictScrapeAroundRimClockwise="",t.pictScrapeCenterToEdge="",t.pictScrapeEdgeToCenter="",t.pictShellBells="",t.pictShellChimes="",t.pictSiren="",t.pictSistrum="",t.pictSizzleCymbal="",t.pictSleighBell="",t.pictSlideBrushOnGong="",t.pictSlideWhistle="",t.pictSlitDrum="",t.pictSnareDrum="",t.pictSnareDrumMilitary="",t.pictSnareDrumSnaresOff="",t.pictSteelDrums="",t.pictStickShot="",t.pictSuperball="",t.pictSuspendedCymbal="",t.pictSwishStem="",t.pictTabla="",t.pictTamTam="",t.pictTamTamWithBeater="",t.pictTambourine="",t.pictTempleBlocks="",t.pictTenorDrum="",t.pictThundersheet="",t.pictTimbales="",t.pictTimpani="",t.pictTomTom="",t.pictTomTomChinese="",t.pictTomTomIndoAmerican="",t.pictTomTomJapanese="",t.pictTriangle="",t.pictTubaphone="",t.pictTubularBells="",t.pictTurnLeftStem="",t.pictTurnRightLeftStem="",t.pictTurnRightStem="",t.pictVib="",t.pictVibMotorOff="",t.pictVibSmithBrindle="",t.pictVibraslap="",t.pictVietnameseHat="",t.pictWhip="",t.pictWindChimesGlass="",t.pictWindMachine="",t.pictWindWhistle="",t.pictWoodBlock="",t.pictWoundHardDown="",t.pictWoundHardLeft="",t.pictWoundHardRight="",t.pictWoundHardUp="",t.pictWoundSoftDown="",t.pictWoundSoftLeft="",t.pictWoundSoftRight="",t.pictWoundSoftUp="",t.pictXyl="",t.pictXylBass="",t.pictXylSmithBrindle="",t.pictXylTenor="",t.pictXylTenorTrough="",t.pictXylTrough="",t.pluckedBuzzPizzicato="",t.pluckedDamp="",t.pluckedDampAll="",t.pluckedDampOnStem="",t.pluckedFingernailFlick="",t.pluckedLeftHandPizzicato="",t.pluckedPlectrum="",t.pluckedSnapPizzicatoAbove="",t.pluckedSnapPizzicatoBelow="",t.pluckedWithFingernails="",t.quindicesima="",t.quindicesimaAlta="",t.quindicesimaBassa="",t.quindicesimaBassaMb="",t.repeat1Bar="",t.repeat2Bars="",t.repeat4Bars="",t.repeatBarLowerDot="",t.repeatBarSlash="",t.repeatBarUpperDot="",t.repeatDot="",t.repeatDots="",t.repeatLeft="",t.repeatRight="",t.repeatRightLeft="",t.rest1024th="",t.rest128th="",t.rest16th="",t.rest256th="",t.rest32nd="",t.rest512th="",t.rest64th="",t.rest8th="",t.restDoubleWhole="",t.restDoubleWholeLegerLine="",t.restHBar="",t.restHBarLeft="",t.restHBarMiddle="",t.restHBarRight="",t.restHalf="",t.restHalfLegerLine="",t.restLonga="",t.restMaxima="",t.restQuarter="",t.restQuarterOld="",t.restQuarterZ="",t.restWhole="",t.restWholeLegerLine="",t.reversedBrace="",t.reversedBracketBottom="",t.reversedBracketTop="",t.rightRepeatSmall="",t.scaleDegree1="",t.scaleDegree2="",t.scaleDegree3="",t.scaleDegree4="",t.scaleDegree5="",t.scaleDegree6="",t.scaleDegree7="",t.scaleDegree8="",t.scaleDegree9="",t.schaefferClef="",t.schaefferFClefToGClef="",t.schaefferGClefToFClef="",t.schaefferPreviousClef="",t.segno="",t.segnoSerpent1="",t.segnoSerpent2="",t.semipitchedPercussionClef1="",t.semipitchedPercussionClef2="",t.smnFlat="",t.smnFlatWhite="",t.smnHistoryDoubleFlat="",t.smnHistoryDoubleSharp="",t.smnHistoryFlat="",t.smnHistorySharp="",t.smnNatural="",t.smnSharp="",t.smnSharpDown="",t.smnSharpWhite="",t.smnSharpWhiteDown="",t.splitBarDivider="",t.staff1Line="",t.staff1LineNarrow="",t.staff1LineWide="",t.staff2Lines="",t.staff2LinesNarrow="",t.staff2LinesWide="",t.staff3Lines="",t.staff3LinesNarrow="",t.staff3LinesWide="",t.staff4Lines="",t.staff4LinesNarrow="",t.staff4LinesWide="",t.staff5Lines="",t.staff5LinesNarrow="",t.staff5LinesWide="",t.staff6Lines="",t.staff6LinesNarrow="",t.staff6LinesWide="",t.staffDivideArrowDown="",t.staffDivideArrowUp="",t.staffDivideArrowUpDown="",t.staffPosLower1="",t.staffPosLower2="",t.staffPosLower3="",t.staffPosLower4="",t.staffPosLower5="",t.staffPosLower6="",t.staffPosLower7="",t.staffPosLower8="",t.staffPosRaise1="",t.staffPosRaise2="",t.staffPosRaise3="",t.staffPosRaise4="",t.staffPosRaise5="",t.staffPosRaise6="",t.staffPosRaise7="",t.staffPosRaise8="",t.stem="",t.stemBowOnBridge="",t.stemBowOnTailpiece="",t.stemBuzzRoll="",t.stemDamp="",t.stemHarpStringNoise="",t.stemMultiphonicsBlack="",t.stemMultiphonicsBlackWhite="",t.stemMultiphonicsWhite="",t.stemPendereckiTremolo="",t.stemRimShot="",t.stemSprechgesang="",t.stemSulPonticello="",t.stemSussurando="",t.stemSwished="",t.stemVibratoPulse="",t.stockhausenTremolo="",t.stringsBowBehindBridge="",t.stringsBowBehindBridgeFourStrings="",t.stringsBowBehindBridgeOneString="",t.stringsBowBehindBridgeThreeStrings="",t.stringsBowBehindBridgeTwoStrings="",t.stringsBowOnBridge="",t.stringsBowOnTailpiece="",t.stringsChangeBowDirection="",t.stringsDownBow="",t.stringsDownBowAwayFromBody="",t.stringsDownBowBeyondBridge="",t.stringsDownBowTowardsBody="",t.stringsDownBowTurned="",t.stringsFouette="",t.stringsHalfHarmonic="",t.stringsHarmonic="",t.stringsJeteAbove="",t.stringsJeteBelow="",t.stringsMuteOff="",t.stringsMuteOn="",t.stringsOverpressureDownBow="",t.stringsOverpressureNoDirection="",t.stringsOverpressurePossibileDownBow="",t.stringsOverpressurePossibileUpBow="",t.stringsOverpressureUpBow="",t.stringsScrapeCircularClockwise="",t.stringsScrapeCircularCounterclockwise="",t.stringsScrapeParallelInward="",t.stringsScrapeParallelOutward="",t.stringsThumbPosition="",t.stringsThumbPositionTurned="",t.stringsTripleChopInward="",t.stringsTripleChopOutward="",t.stringsUpBow="",t.stringsUpBowAwayFromBody="",t.stringsUpBowBeyondBridge="",t.stringsUpBowTowardsBody="",t.stringsUpBowTurned="",t.stringsVibratoPulse="",t.swissRudimentsNoteheadBlackDouble="",t.swissRudimentsNoteheadBlackFlam="",t.swissRudimentsNoteheadHalfDouble="",t.swissRudimentsNoteheadHalfFlam="",t.systemDivider="",t.systemDividerExtraLong="",t.systemDividerLong="",t.textAugmentationDot="",t.textBlackNoteFrac16thLongStem="",t.textBlackNoteFrac16thShortStem="",t.textBlackNoteFrac32ndLongStem="",t.textBlackNoteFrac8thLongStem="",t.textBlackNoteFrac8thShortStem="",t.textBlackNoteLongStem="",t.textBlackNoteShortStem="",t.textCont16thBeamLongStem="",t.textCont16thBeamShortStem="",t.textCont32ndBeamLongStem="",t.textCont8thBeamLongStem="",t.textCont8thBeamShortStem="",t.textHeadlessBlackNoteFrac16thLongStem="",t.textHeadlessBlackNoteFrac16thShortStem="",t.textHeadlessBlackNoteFrac32ndLongStem="",t.textHeadlessBlackNoteFrac8thLongStem="",t.textHeadlessBlackNoteFrac8thShortStem="",t.textHeadlessBlackNoteLongStem="",t.textHeadlessBlackNoteShortStem="",t.textTie="",t.textTuplet3LongStem="",t.textTuplet3ShortStem="",t.textTupletBracketEndLongStem="",t.textTupletBracketEndShortStem="",t.textTupletBracketStartLongStem="",t.textTupletBracketStartShortStem="",t.timeSig0="",t.timeSig0Reversed="",t.timeSig0Turned="",t.timeSig1="",t.timeSig1Reversed="",t.timeSig1Turned="",t.timeSig2="",t.timeSig2Reversed="",t.timeSig2Turned="",t.timeSig3="",t.timeSig3Reversed="",t.timeSig3Turned="",t.timeSig4="",t.timeSig4Reversed="",t.timeSig4Turned="",t.timeSig5="",t.timeSig5Reversed="",t.timeSig5Turned="",t.timeSig6="",t.timeSig6Reversed="",t.timeSig6Turned="",t.timeSig7="",t.timeSig7Reversed="",t.timeSig7Turned="",t.timeSig8="",t.timeSig8Reversed="",t.timeSig8Turned="",t.timeSig9="",t.timeSig9Reversed="",t.timeSig9Turned="",t.timeSigBracketLeft="",t.timeSigBracketLeftSmall="",t.timeSigBracketRight="",t.timeSigBracketRightSmall="",t.timeSigCombDenominator="",t.timeSigCombNumerator="",t.timeSigComma="",t.timeSigCommon="",t.timeSigCommonReversed="",t.timeSigCommonTurned="",t.timeSigCut2="",t.timeSigCut3="",t.timeSigCutCommon="",t.timeSigCutCommonReversed="",t.timeSigCutCommonTurned="",t.timeSigEquals="",t.timeSigFractionHalf="",t.timeSigFractionOneThird="",t.timeSigFractionQuarter="",t.timeSigFractionThreeQuarters="",t.timeSigFractionTwoThirds="",t.timeSigFractionalSlash="",t.timeSigMinus="",t.timeSigMultiply="",t.timeSigOpenPenderecki="",t.timeSigParensLeft="",t.timeSigParensLeftSmall="",t.timeSigParensRight="",t.timeSigParensRightSmall="",t.timeSigPlus="",t.timeSigPlusSmall="",t.timeSigSlash="",t.timeSigX="",t.tremolo1="",t.tremolo2="",t.tremolo3="",t.tremolo4="",t.tremolo5="",t.tremoloDivisiDots2="",t.tremoloDivisiDots3="",t.tremoloDivisiDots4="",t.tremoloDivisiDots6="",t.tremoloFingered1="",t.tremoloFingered2="",t.tremoloFingered3="",t.tremoloFingered4="",t.tremoloFingered5="",t.tripleTongueAbove="",t.tripleTongueBelow="",t.tuplet0="",t.tuplet1="",t.tuplet2="",t.tuplet3="",t.tuplet4="",t.tuplet5="",t.tuplet6="",t.tuplet7="",t.tuplet8="",t.tuplet9="",t.tupletColon="",t.unmeasuredTremolo="",t.unmeasuredTremoloSimple="",t.unpitchedPercussionClef1="",t.unpitchedPercussionClef2="",t.ventiduesima="",t.ventiduesimaAlta="",t.ventiduesimaBassa="",t.ventiduesimaBassaMb="",t.vocalFingerClickStockhausen="",t.vocalHalbGesungen="",t.vocalMouthClosed="",t.vocalMouthOpen="",t.vocalMouthPursed="",t.vocalMouthSlightlyOpen="",t.vocalMouthWideOpen="",t.vocalNasalVoice="",t.vocalSprechgesang="",t.vocalTongueClickStockhausen="",t.vocalTongueFingerClickStockhausen="",t.vocalsSussurando="",t.wiggleArpeggiatoDown="",t.wiggleArpeggiatoDownArrow="",t.wiggleArpeggiatoDownSwash="",t.wiggleArpeggiatoUp="",t.wiggleArpeggiatoUpArrow="",t.wiggleArpeggiatoUpSwash="",t.wiggleCircular="",t.wiggleCircularConstant="",t.wiggleCircularConstantFlipped="",t.wiggleCircularConstantFlippedLarge="",t.wiggleCircularConstantLarge="",t.wiggleCircularEnd="",t.wiggleCircularLarge="",t.wiggleCircularLarger="",t.wiggleCircularLargerStill="",t.wiggleCircularLargest="",t.wiggleCircularSmall="",t.wiggleCircularStart="",t.wiggleGlissando="",t.wiggleGlissandoGroup1="",t.wiggleGlissandoGroup2="",t.wiggleGlissandoGroup3="",t.wiggleRandom1="",t.wiggleRandom2="",t.wiggleRandom3="",t.wiggleRandom4="",t.wiggleSawtooth="",t.wiggleSawtoothNarrow="",t.wiggleSawtoothWide="",t.wiggleSquareWave="",t.wiggleSquareWaveNarrow="",t.wiggleSquareWaveWide="",t.wiggleTrill="",t.wiggleTrillFast="",t.wiggleTrillFaster="",t.wiggleTrillFasterStill="",t.wiggleTrillFastest="",t.wiggleTrillSlow="",t.wiggleTrillSlower="",t.wiggleTrillSlowerStill="",t.wiggleTrillSlowest="",t.wiggleVIbratoLargestSlower="",t.wiggleVIbratoMediumSlower="",t.wiggleVibrato="",t.wiggleVibratoLargeFast="",t.wiggleVibratoLargeFaster="",t.wiggleVibratoLargeFasterStill="",t.wiggleVibratoLargeFastest="",t.wiggleVibratoLargeSlow="",t.wiggleVibratoLargeSlower="",t.wiggleVibratoLargeSlowest="",t.wiggleVibratoLargestFast="",t.wiggleVibratoLargestFaster="",t.wiggleVibratoLargestFasterStill="",t.wiggleVibratoLargestFastest="",t.wiggleVibratoLargestSlow="",t.wiggleVibratoLargestSlowest="",t.wiggleVibratoMediumFast="",t.wiggleVibratoMediumFaster="",t.wiggleVibratoMediumFasterStill="",t.wiggleVibratoMediumFastest="",t.wiggleVibratoMediumSlow="",t.wiggleVibratoMediumSlowest="",t.wiggleVibratoSmallFast="",t.wiggleVibratoSmallFaster="",t.wiggleVibratoSmallFasterStill="",t.wiggleVibratoSmallFastest="",t.wiggleVibratoSmallSlow="",t.wiggleVibratoSmallSlower="",t.wiggleVibratoSmallSlowest="",t.wiggleVibratoSmallestFast="",t.wiggleVibratoSmallestFaster="",t.wiggleVibratoSmallestFasterStill="",t.wiggleVibratoSmallestFastest="",t.wiggleVibratoSmallestSlow="",t.wiggleVibratoSmallestSlower="",t.wiggleVibratoSmallestSlowest="",t.wiggleVibratoStart="",t.wiggleVibratoWide="",t.wiggleWavy="",t.wiggleWavyNarrow="",t.wiggleWavyWide="",t.windClosedHole="",t.windFlatEmbouchure="",t.windHalfClosedHole1="",t.windHalfClosedHole2="",t.windHalfClosedHole3="",t.windLessRelaxedEmbouchure="",t.windLessTightEmbouchure="",t.windMouthpiecePop="",t.windMultiphonicsBlackStem="",t.windMultiphonicsBlackWhiteStem="",t.windMultiphonicsWhiteStem="",t.windOpenHole="",t.windReedPositionIn="",t.windReedPositionNormal="",t.windReedPositionOut="",t.windRelaxedEmbouchure="",t.windRimOnly="",t.windSharpEmbouchure="",t.windStrongAirPressure="",t.windThreeQuartersClosedHole="",t.windTightEmbouchure="",t.windTrillKey="",t.windVeryTightEmbouchure="",t.windWeakAirPressure=""})(E||(E={}));const Et=16384,si={"1/2":Et*2,1:Et/1,2:Et/2,4:Et/4,8:Et/8,16:Et/16,32:Et/32,64:Et/64,128:Et/128,256:Et/256},zi={w:"1",h:"2",q:"4",b:"256"},_e={C:{num:0},Am:{num:0},F:{accidental:"b",num:1},Dm:{accidental:"b",num:1},Bb:{accidental:"b",num:2},Gm:{accidental:"b",num:2},Eb:{accidental:"b",num:3},Cm:{accidental:"b",num:3},Ab:{accidental:"b",num:4},Fm:{accidental:"b",num:4},Db:{accidental:"b",num:5},Bbm:{accidental:"b",num:5},Gb:{accidental:"b",num:6},Ebm:{accidental:"b",num:6},Cb:{accidental:"b",num:7},Abm:{accidental:"b",num:7},G:{accidental:"#",num:1},Em:{accidental:"#",num:1},D:{accidental:"#",num:2},Bm:{accidental:"#",num:2},A:{accidental:"#",num:3},"F#m":{accidental:"#",num:3},E:{accidental:"#",num:4},"C#m":{accidental:"#",num:4},B:{accidental:"#",num:5},"G#m":{accidental:"#",num:5},"F#":{accidental:"#",num:6},"D#m":{accidental:"#",num:6},"C#":{accidental:"#",num:7},"A#m":{accidental:"#",num:7}},ci={treble:{lineShift:0},bass:{lineShift:6},tenor:{lineShift:4},alto:{lineShift:3},soprano:{lineShift:1},percussion:{lineShift:0},"mezzo-soprano":{lineShift:2},"baritone-c":{lineShift:5},"baritone-f":{lineShift:5},subbass:{lineShift:7},french:{lineShift:-1}},ji={C:{index:0,intVal:0},CN:{index:0,intVal:0},"C#":{index:0,intVal:1},"C##":{index:0,intVal:2},CB:{index:0,intVal:11},CBB:{index:0,intVal:10},D:{index:1,intVal:2},DN:{index:1,intVal:2},"D#":{index:1,intVal:3},"D##":{index:1,intVal:4},DB:{index:1,intVal:1},DBB:{index:1,intVal:0},E:{index:2,intVal:4},EN:{index:2,intVal:4},"E#":{index:2,intVal:5},"E##":{index:2,intVal:6},EB:{index:2,intVal:3},EBB:{index:2,intVal:2},F:{index:3,intVal:5},FN:{index:3,intVal:5},"F#":{index:3,intVal:6},"F##":{index:3,intVal:7},FB:{index:3,intVal:4},FBB:{index:3,intVal:3},G:{index:4,intVal:7},GN:{index:4,intVal:7},"G#":{index:4,intVal:8},"G##":{index:4,intVal:9},GB:{index:4,intVal:6},GBB:{index:4,intVal:5},A:{index:5,intVal:9},AN:{index:5,intVal:9},"A#":{index:5,intVal:10},"A##":{index:5,intVal:11},AB:{index:5,intVal:8},ABB:{index:5,intVal:7},B:{index:6,intVal:11},BN:{index:6,intVal:11},"B#":{index:6,intVal:12},"B##":{index:6,intVal:13},BB:{index:6,intVal:10},BBB:{index:6,intVal:9},R:{index:6},X:{index:6}},qi={n:{name:"note"},r:{name:"rest"},h:{name:"harmonic"},m:{name:"muted"},s:{name:"slash"},g:{name:"ghost"},d:{name:"diamond"},x:{name:"x"},ci:{name:"circled"},cx:{name:"circle x"},sf:{name:"slashed"},sb:{name:"slashed backward"},sq:{name:"square"},tu:{name:"triangle up"},td:{name:"triangle down"}},$i={"#":E.accidentalSharp,"##":E.accidentalDoubleSharp,b:E.accidentalFlat,bb:E.accidentalDoubleFlat,n:E.accidentalNatural,"{":E.accidentalParensLeft,"}":E.accidentalParensRight,db:E.accidentalThreeQuarterTonesFlatZimmermann,d:E.accidentalQuarterToneFlatStein,"++":E.accidentalThreeQuarterTonesSharpStein,"+":E.accidentalQuarterToneSharpStein,"+-":E.accidentalKucukMucennebSharp,bs:E.accidentalBakiyeFlat,bss:E.accidentalBuyukMucennebFlat,o:E.accidentalSori,k:E.accidentalKoron,bbs:E.accidentalBuyukMucennebSharp,"++-":E.accidentalBuyukMucennebSharp,ashs:E.accidentalBuyukMucennebSharp,afhf:E.accidentalBuyukMucennebSharp},Ki={1:{a:[1],b:[1]},2:{a:[1,2]},3:{a:[1,3,2],b:[1,2,1],secondOnBottom:[1,2,3]},4:{a:[1,3,4,2],b:[1,2,3,1],spacedOutTetrachord:[1,2,1,2]},5:{a:[1,3,5,4,2],b:[1,2,4,3,1],spacedOutPentachord:[1,2,3,2,1],verySpacedOutPentachord:[1,2,1,2,1]},6:{a:[1,3,5,6,4,2],b:[1,2,4,5,3,1],spacedOutHexachord:[1,3,2,1,3,2],verySpacedOutHexachord:[1,2,1,2,1,2]}},Qi={"a.":{code:E.augmentationDot,betweenLines:!0},av:{aboveCode:E.articStaccatissimoAbove,belowCode:E.articStaccatissimoBelow,betweenLines:!0},"a>":{aboveCode:E.articAccentAbove,belowCode:E.articAccentBelow,betweenLines:!0},"a-":{aboveCode:E.articTenutoAbove,belowCode:E.articTenutoBelow,betweenLines:!0},"a^":{aboveCode:E.articMarcatoAbove,belowCode:E.articMarcatoBelow,betweenLines:!1},"a+":{code:E.pluckedLeftHandPizzicato,betweenLines:!1},ao:{aboveCode:E.pluckedSnapPizzicatoAbove,belowCode:E.pluckedSnapPizzicatoBelow,betweenLines:!1},ah:{code:E.stringsHarmonic,betweenLines:!1},"a@":{aboveCode:E.fermataAbove,belowCode:E.fermataBelow,betweenLines:!1},"a@a":{code:E.fermataAbove,betweenLines:!1},"a@u":{code:E.fermataBelow,betweenLines:!1},"a@s":{aboveCode:E.fermataShortAbove,belowCode:E.fermataShortBelow,betweenLines:!1},"a@as":{code:E.fermataShortAbove,betweenLines:!1},"a@us":{code:E.fermataShortBelow,betweenLines:!1},"a@l":{aboveCode:E.fermataLongAbove,belowCode:E.fermataLongBelow,betweenLines:!1},"a@al":{code:E.fermataLongAbove,betweenLines:!1},"a@ul":{code:E.fermataLongBelow,betweenLines:!1},"a@vl":{aboveCode:E.fermataVeryLongAbove,belowCode:E.fermataVeryLongBelow,betweenLines:!1},"a@avl":{code:E.fermataVeryLongAbove,betweenLines:!1},"a@uvl":{code:E.fermataVeryLongBelow,betweenLines:!1},"a|":{code:E.stringsUpBow,betweenLines:!1},am:{code:E.stringsDownBow,betweenLines:!1},"a,":{code:E.pictChokeCymbal,betweenLines:!1}},Ji={mordent:E.ornamentShortTrill,mordentInverted:E.ornamentMordent,turn:E.ornamentTurn,turnInverted:E.ornamentTurnSlash,tr:E.ornamentTrill,upprall:E.ornamentPrecompSlideTrillDAnglebert,downprall:E.ornamentPrecompDoubleCadenceUpperPrefix,prallup:E.ornamentPrecompTrillSuffixDandrieu,pralldown:E.ornamentPrecompTrillLowerSuffix,upmordent:E.ornamentPrecompSlideTrillBach,downmordent:E.ornamentPrecompDoubleCadenceUpperPrefixTurn,lineprall:E.ornamentPrecompAppoggTrill,prallprall:E.ornamentTremblement,scoop:E.brassScoop,doit:E.brassDoitMedium,fall:E.brassFallLipShort,doitLong:E.brassLiftMedium,fallLong:E.brassFallRoughMedium,bend:E.brassBend,plungerClosed:E.brassMuteClosed,plungerOpen:E.brassMuteOpen,flip:E.brassFlip,jazzTurn:E.brassJazzTurn,smear:E.brassSmear};class D{static clefProperties(e){if(!e||!(e in ci))throw new w("BadArgument","Invalid clef: "+e);return ci[e]}static keyProperties(e,i="treble",n="N",a){let o={octaveShift:0,duration:"4"};typeof a=="object"&&(o=Object.assign(Object.assign({},o),a));const r=D.sanitizeDuration(o.duration),s=e.split("/");if(s.length<2)throw new w("BadArguments",`First argument must be note/octave or note/octave/glyph-code: ${e}`);const c=s[0].toUpperCase();n=n.toUpperCase();const u=ji[c];if(!u)throw new w("BadArguments","Invalid key name: "+c);let d=parseInt(s[1],10);d-=o.octaveShift;let l=(d*7-28+u.index)/2;l+=D.clefProperties(i).lineShift;const g=typeof u.intVal<"u"?d*12+u.intVal:void 0;let f="",S="N";return s.length>2&&s[2]?S=s[2].toUpperCase():n!=="N"?S=n:S=c,f=this.codeNoteHead(S,r),{key:c,octave:d,line:l,intValue:g,code:f,displaced:!1}}static integerToNote(e){if(typeof e>"u"||e<0||e>11)throw new w("BadArguments",`integerToNote() requires an integer in the range [0, 11]: ${e}`);const n={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"}[e];if(!n)throw new w("BadArguments",`Unknown note value for integer: ${e}`);return n}static textWidth(e){return 7*e.toString().length}static articulationCodes(e){return Qi[e]}static accidentalCodes(e){var i;return(i=$i[e])!==null&&i!==void 0?i:e}static ornamentCodes(e){var i;return(i=Ji[e])!==null&&i!==void 0?i:e}static keySignature(e){const i=_e[e];if(!i)throw new w("BadKeySignature",`Bad key signature spec: '${e}'`);if(!i.accidental)return[];const a={b:[2,.5,2.5,1,3,1.5,3.5],"#":[0,1.5,-.5,1,2.5,.5,2]}[i.accidental],o=[];for(let r=0;r<i.num;++r){const s=a[r];o.push({type:i.accidental,line:s})}return o}static getKeySignatures(){return _e}static hasKeySignature(e){return e in _e}static sanitizeDuration(e){const i=zi[e];if(i!==void 0&&(e=i),si[e]===void 0)throw new w("BadArguments",`The provided duration is not valid: ${e}`);return e}static durationToFraction(e){return new P().parse(D.sanitizeDuration(e))}static durationToNumber(e){return D.durationToFraction(e).value()}static durationToTicks(e){e=D.sanitizeDuration(e);const i=si[e];if(i===void 0)throw new w("InvalidDuration");return i}static codeNoteHead(e,i){switch(e){case"D0":return E.noteheadDiamondWhole;case"D1":return E.noteheadDiamondHalf;case"D2":return E.noteheadDiamondBlack;case"D3":return E.noteheadDiamondBlack;case"T0":return E.noteheadTriangleUpWhole;case"T1":return E.noteheadTriangleUpHalf;case"T2":return E.noteheadTriangleUpBlack;case"T3":return E.noteheadTriangleUpBlack;case"X0":return E.noteheadXWhole;case"X1":return E.noteheadXHalf;case"X2":return E.noteheadXBlack;case"X3":return E.noteheadCircleX;case"S1":return E.noteheadSquareWhite;case"S2":return E.noteheadSquareBlack;case"R1":return E.noteheadSquareWhite;case"R2":return E.noteheadSquareWhite;case"DO":return E.noteheadTriangleUpBlack;case"RE":return E.noteheadMoonBlack;case"MI":return E.noteheadDiamondBlack;case"FA":return E.noteheadTriangleLeftBlack;case"FAUP":return E.noteheadTriangleRightBlack;case"SO":return E.noteheadBlack;case"LA":return E.noteheadSquareBlack;case"TI":return E.noteheadTriangleRoundDownBlack;case"DI":case"H":switch(i){case"1/2":return E.noteheadDiamondDoubleWhole;case"1":return E.noteheadDiamondWhole;case"2":return E.noteheadDiamondHalf;default:return E.noteheadDiamondBlack}case"X":case"M":switch(i){case"1/2":return E.noteheadXDoubleWhole;case"1":return E.noteheadXWhole;case"2":return E.noteheadXHalf;default:return E.noteheadXBlack}case"CX":switch(i){case"1/2":return E.noteheadCircleXDoubleWhole;case"1":return E.noteheadCircleXWhole;case"2":return E.noteheadCircleXHalf;default:return E.noteheadCircleX}case"CI":switch(i){case"1/2":return E.noteheadCircledDoubleWhole;case"1":return E.noteheadCircledWhole;case"2":return E.noteheadCircledHalf;default:return E.noteheadCircledBlack}case"SQ":switch(i){case"1/2":return E.noteheadDoubleWholeSquare;case"1":return E.noteheadSquareWhite;case"2":return E.noteheadSquareWhite;default:return E.noteheadSquareBlack}case"TU":switch(i){case"1/2":return E.noteheadTriangleUpDoubleWhole;case"1":return E.noteheadTriangleUpWhole;case"2":return E.noteheadTriangleUpHalf;default:return E.noteheadTriangleUpBlack}case"TD":switch(i){case"1/2":return E.noteheadTriangleDownDoubleWhole;case"1":return E.noteheadTriangleDownWhole;case"2":return E.noteheadTriangleDownHalf;default:return E.noteheadTriangleDownBlack}case"SF":switch(i){case"1/2":return E.noteheadSlashedDoubleWhole1;case"1":return E.noteheadSlashedWhole1;case"2":return E.noteheadSlashedHalf1;default:return E.noteheadSlashedBlack1}case"SB":switch(i){case"1/2":return E.noteheadSlashedDoubleWhole2;case"1":return E.noteheadSlashedWhole2;case"2":return E.noteheadSlashedHalf2;default:return E.noteheadSlashedBlack2}case"R":switch(i){case"1/2":return E.restDoubleWhole;case"1":return E.restWhole;case"2":return E.restHalf;case"4":return E.restQuarter;case"8":return E.rest8th;case"16":return E.rest16th;case"32":return E.rest32nd;case"64":return E.rest64th;case"128":return E.rest128th}break;case"S":switch(i){case"1/2":return E.noteheadSlashWhiteDoubleWhole;case"1":return E.noteheadSlashWhiteWhole;case"2":return E.noteheadSlashWhiteHalf;default:return E.noteheadSlashVerticalEnds}default:switch(i){case"1/2":return E.noteheadDoubleWhole;case"1":return E.noteheadWhole;case"2":return E.noteheadHalf;default:return E.noteheadBlack}}return E.null}}D.UNISON=!0;D.SOFTMAX_FACTOR=10;D.STEM_WIDTH=1.5;D.STEM_HEIGHT=35;D.STAVE_LINE_THICKNESS=1;D.RENDER_PRECISION_PLACES=3;D.RESOLUTION=Et;D.durationCodes={"1/2":{stem:!1},1:{stem:!1},2:{stem:!0},4:{stem:!0},8:{stem:!0,beamCount:1,stemBeamExtension:0,codeFlagUp:E.flag8thUp},16:{beamCount:2,stemBeamExtension:0,stem:!0,codeFlagUp:E.flag16thUp},32:{beamCount:3,stemBeamExtension:7.5,stem:!0,codeFlagUp:E.flag32ndUp},64:{beamCount:4,stemBeamExtension:15,stem:!0,codeFlagUp:E.flag64thUp},128:{beamCount:5,stemBeamExtension:22.5,stem:!0,codeFlagUp:E.flag128thUp}};D.NOTATION_FONT_SCALE=39;D.TABLATURE_FONT_SCALE=39;D.SLASH_NOTEHEAD_WIDTH=15;D.STAVE_LINE_DISTANCE=10;D.TEXT_HEIGHT_OFFSET_HACK=1;D.accidentalColumnsTable=Ki;D.unicode={sharp:"♯",flat:"♭",natural:"♮",triangle:"△","o-with-slash":"ø",degrees:"°",circle:"○"};D.validTypes=qi;D.TIME4_4={numBeats:4,beatValue:4,resolution:Et};function Lt(t,e,i=!0){if(typeof t!="object"||t===null)return!1;let n=t.constructor;if(i){for(;t!==null;){if(n=t.constructor,"CATEGORY"in n&&n.CATEGORY===e)return!0;t=Object.getPrototypeOf(t)}return!1}else return"CATEGORY"in n&&n.CATEGORY===e}const Zi=t=>Lt(t,"Accidental"),yi=t=>Lt(t,"Annotation"),Ci=t=>Lt(t,"Barline"),Gi=t=>Lt(t,"Dot"),wi=t=>Lt(t,"GraceNote"),tn=t=>Lt(t,"GraceNoteGroup"),Di=t=>Lt(t,"Note"),en=t=>Lt(t,"RenderContext"),Ot=t=>Lt(t,"StaveNote"),Fe=t=>Lt(t,"StemmableNote"),St=t=>Lt(t,"TabNote");function Ce(...t){Kt.DEBUG&&j("VexFlow.Accidental",t)}class Kt extends v{static get CATEGORY(){return"Accidental"}static format(e,i){if(!e||e.length===0)return;const n=F.get("Accidental.noteheadAccidentalPadding"),a=i.leftShift+n,o=F.get("Accidental.accidentalSpacing"),r=F.get("Accidental.leftPadding"),s=[];let c,u=0;for(let m=0;m<e.length;++m){const T=e[m],B=T.getNote(),C=B.getStave(),A=T.checkIndex(),L=B.getKeyProps()[A];if(B!==c){for(let N=0;N<B.keys.length;++N)u=Math.max(B.getLeftDisplacedHeadPx()-B.getXShift(),u);c=B}if(C){const N=C.getSpacingBetweenLines(),M=C.getYForLine(L.line),Z=Math.round(M/N*2)/2;s.push({y:M,line:Z,extraXSpaceNeeded:u,accidental:T,spacingBetweenStaveLines:N})}else s.push({line:L.line,extraXSpaceNeeded:u,accidental:T})}s.sort((m,T)=>T.line-m.line);const d=[];let h=0;for(let m=0;m<s.length;m++){const T=s[m],B=T.accidental.type,C=d[d.length-1];let A;!C||C?.line!==T.line?(A={line:T.line,flatLine:!0,dblSharpLine:!0,numAcc:0,width:0,column:0},d.push(A)):A=C,B!=="b"&&B!=="bb"&&(A.flatLine=!1),B!=="##"&&(A.dblSharpLine=!1),A.numAcc++,A.width+=T.accidental.getWidth()+o,h=Math.max(T.extraXSpaceNeeded,h)}let l=0;for(let m=0;m<d.length;m++){let T=!1;const B=m;let C=m;for(;C+1<d.length&&!T;)this.checkCollision(d[C],d[C+1])?C++:T=!0;const A=K=>d[B+K],L=K=>K.map(A),N=(K,J)=>{const[ht,Qt]=L([K,J]).map(_t=>_t.line);return ht-Qt},M=(...K)=>K.map(L).every(([J,ht])=>!this.checkCollision(J,ht)),Z=C-B+1;let q=this.checkCollision(d[B],d[C])?"a":"b";switch(Z){case 3:q==="a"&&N(1,2)===.5&&N(0,1)!==.5&&(q="secondOnBottom");break;case 4:M([0,2],[1,3])&&(q="spacedOutTetrachord");break;case 5:q==="b"&&M([1,3])&&(q="spacedOutPentachord",M([0,2],[2,4])&&(q="verySpacedOutPentachord"));break;case 6:M([0,3],[1,4],[2,5])&&(q="spacedOutHexachord"),M([0,2],[2,4],[1,3],[3,5])&&(q="verySpacedOutHexachord");break}let y,it;if(Z>=7){let K=2,J=!0;for(;J===!0;){J=!1;for(let ht=0;ht+K<d.length;ht++)if(this.checkCollision(d[ht],d[ht+K])){J=!0,K++;break}}for(y=m;y<=C;y++)it=(y-m)%K+1,d[y].column=it,l=l>it?l:it}else for(y=m;y<=C;y++)it=D.accidentalColumnsTable[Z][q][y-m],d[y].column=it,l=l>it?l:it;m=C}const g=[],f=[];for(let m=0;m<=l;m++)g[m]=0,f[m]=0;g[0]=a+h,f[0]=a,d.forEach(m=>{m.width>g[m.column]&&(g[m.column]=m.width)});for(let m=1;m<g.length;m++)f[m]=g[m]+f[m-1];const S=f[f.length-1];let x=0;d.forEach(m=>{let T=0;const B=x+m.numAcc;for(x;x<B;x++){const C=f[m.column-1]+T+h;s[x].accidental.setXShift(C),T+=s[x].accidental.getWidth()+o,Ce("Line, accCount, shift: ",m.line,x,C)}}),i.leftShift=S+r}static checkCollision(e,i){let n=i.line-e.line,a=3;n>0?(a=i.flatLine||i.dblSharpLine?2.5:3,e.dblSharpLine&&(n-=.5)):(a=e.flatLine||e.dblSharpLine?2.5:3,i.dblSharpLine&&(n-=.5));const o=Math.abs(n)<a;return Ce("Line1, Line2, Collision: ",e.line,i.line,o),o}static applyAccidentals(e,i){const n=[],a={};e.forEach(c=>{const u=new P(0,1);c.getTickables().forEach(h=>{if(h.shouldIgnoreTicks())return;const l=a[u.value()];l?l.push(h):(n.push(u.value()),a[u.value()]=[h]),u.add(h.getTicks())})});const o=new H;i||(i="C");const r=o.createScaleMap(i),s={};n.forEach(c=>{const u=a[c],d=[],h=l=>{if(!Ot(l)||l.isRest()||l.shouldIgnoreTicks())return;const g=l;g.keys.forEach((f,S)=>{const x=o.getNoteParts(f.split("/")[0]),m=f.split("/")[1],T=x.accidental||"n",B=x.root+T;s[x.root+m]||(s[x.root+m]=r[x.root]);const C=s[x.root+m]===B,A=d.indexOf(f)>-1;if(g.getModifiers().forEach((L,N)=>{Zi(L)&&L.type==T&&L.getIndex()==S&&g.getModifiers().splice(N,1)}),!C||C&&A){s[x.root+m]=B;const L=new Kt(T);g.addModifier(L,S),d.push(f)}}),g.getModifiers().forEach(f=>{tn(f)&&f.getGraceNotes().forEach(h)})};u.forEach(h)})}constructor(e){super(),Ce("New accidental: ",e),this.type=e,this.position=v.Position.LEFT,this.cautionary=!1,this.reset()}reset(){this.text="",this.cautionary?(this.text+=D.accidentalCodes("{"),this.text+=D.accidentalCodes(this.type),this.text+=D.accidentalCodes("}"),this.fontInfo.size=F.get("Accidental.cautionary.fontSize")):(this.text+=D.accidentalCodes(this.type),this.fontInfo.size=F.get("Accidental.fontSize")),wi(this.note)&&(this.fontInfo.size=F.get("Accidental.grace.fontSize"))}setNote(e){return _(e,"ArgumentError",`Bad note value: ${e}`),this.note=e,this.reset(),this}setAsCautionary(){return this.cautionary=!0,this.reset(),this}draw(){const{type:e,position:i,index:n}=this,a=this.checkContext(),o=this.checkAttachedNote();this.setRendered();const r=o.getModifierStartXY(i,n);this.x=r.x-this.width,this.y=r.y,Ce("Rendering: ",e,r.x,r.y),this.renderText(a,0,0)}}Kt.DEBUG=!1;function nn(...t){k.DEBUG&&j("VexFlow.Stem",t)}class k extends p{static get CATEGORY(){return"Stem"}static get UP(){return 1}static get DOWN(){return-1}static get WIDTH(){return D.STEM_WIDTH}static get HEIGHT(){return D.STEM_HEIGHT}constructor(e){var i,n,a,o,r,s,c;super(),this.stemUpYOffset=0,this.stemDownYOffset=0,this.stemUpYBaseOffset=0,this.stemDownYBaseOffset=0,this.xBegin=(i=e?.xBegin)!==null&&i!==void 0?i:0,this.xEnd=(n=e?.xEnd)!==null&&n!==void 0?n:0,this.yTop=(a=e?.yTop)!==null&&a!==void 0?a:0,this.yBottom=(o=e?.yBottom)!==null&&o!==void 0?o:0,this.stemExtension=(r=e?.stemExtension)!==null&&r!==void 0?r:0,this.stemDirection=(s=e?.stemDirection)!==null&&s!==void 0?s:0,this.hide=e?.hide||!1,this.isStemlet=e?.isStemlet||!1,this.stemletHeight=(c=e?.stemletHeight)!==null&&c!==void 0?c:0,this.renderHeightAdjustment=0,this.setOptions(e)}setOptions(e){var i,n,a,o;this.stemUpYOffset=(i=e?.stemUpYOffset)!==null&&i!==void 0?i:0,this.stemDownYOffset=(n=e?.stemDownYOffset)!==null&&n!==void 0?n:0,this.stemUpYBaseOffset=(a=e?.stemUpYBaseOffset)!==null&&a!==void 0?a:0,this.stemDownYBaseOffset=(o=e?.stemDownYBaseOffset)!==null&&o!==void 0?o:0}setNoteHeadXBounds(e,i){return this.xBegin=e,this.xEnd=i,this}setDirection(e){this.stemDirection=e}setExtension(e){this.stemExtension=e}getExtension(){return this.stemExtension}setYBounds(e,i){this.yTop=e,this.yBottom=i}getHeight(){const e=this.stemDirection===k.UP?this.stemUpYOffset:this.stemDownYOffset;return(this.yBottom-this.yTop+(k.HEIGHT-e+this.stemExtension))*this.stemDirection}getBoundingBox(){throw new w("NotImplemented","getBoundingBox() not implemented.")}getExtents(){const e=this.stemDirection===k.UP,i=[this.yTop,this.yBottom],n=k.HEIGHT+this.stemExtension,a=(e?Math.min:Math.max)(...i),o=(e?Math.max:Math.min)(...i);return{topY:a+n*-this.stemDirection,baseY:o}}setVisibility(e){return this.hide=!e,this}setStemlet(e,i){return this.isStemlet=e,this.stemletHeight=i,this}adjustHeightForFlag(){this.renderHeightAdjustment=F.get("Stem.heightAdjustmentForFlag",-3)}adjustHeightForBeam(){this.renderHeightAdjustment=-k.WIDTH/2}draw(){if(this.setRendered(),this.hide)return;const e=this.checkContext();let i,n;const a=this.stemDirection;let o=0;a===k.DOWN?(i=this.xBegin,n=this.yTop+this.stemDownYOffset,o=this.stemDownYBaseOffset):(i=this.xEnd,n=this.yBottom-this.stemUpYOffset,o=this.stemUpYBaseOffset);const r=this.getHeight();nn("Rendering stem - ","Top Y: ",this.yTop,"Bottom Y: ",this.yBottom);const s=this.isStemlet?r-this.stemletHeight*this.stemDirection:0;e.openGroup("stem",this.getAttribute("id")),e.beginPath(),e.setLineWidth(k.WIDTH),e.moveTo(i,n-s+o),e.lineTo(i,n-r-this.renderHeightAdjustment*a),e.stroke(),e.closeGroup()}}k.DEBUG=!1;function an(...t){dt.DEBUG&&j("VexFlow.Annotation",t)}var at;(function(t){t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT",t[t.CENTER_STEM=4]="CENTER_STEM"})(at||(at={}));var ot;(function(t){t[t.TOP=1]="TOP",t[t.CENTER=2]="CENTER",t[t.BOTTOM=3]="BOTTOM",t[t.CENTER_STEM=4]="CENTER_STEM"})(ot||(ot={}));class dt extends v{static get CATEGORY(){return"Annotation"}static get minAnnotationPadding(){return F.get("NoteHead.minPadding")}static format(e,i){if(!e||e.length===0)return!1;let n=0,a=0,o=0,r=0;for(let u=0;u<e.length;++u){const d=e[u];let l=(2+W.convertSizeToPixelValue(d.fontInfo.size))/D.STAVE_LINE_DISTANCE;const g=d.checkAttachedNote(),f=g.getGlyphWidth(),S=d.getWidth();d.horizontalJustification===at.RIGHT?(o=Math.max(f,o),n=Math.max(n,S)+dt.minAnnotationPadding):d.horizontalJustification===at.LEFT?(r=Math.max(f,r),a=Math.max(a,S)):(n=Math.max(n,S/2)+dt.minAnnotationPadding,a=Math.max(a,S/2),o=Math.max(f/2,o),r=Math.max(f/2,r));const x=g.getStave(),m=g.hasStem()?g.getStemDirection():k.UP;let T=0,B=5;if(St(g))if(g.renderOptions.drawStem){const C=g.getStem();C&&(T=Math.abs(C.getHeight())/D.STAVE_LINE_DISTANCE)}else T=0;else if(Fe(g)){const C=g.getStem();C&&g.getNoteType()==="n"&&(T=Math.abs(C.getHeight())/D.STAVE_LINE_DISTANCE)}if(x&&(B=x.getNumLines()),d.verticalJustification===this.VerticalJustify.TOP){let C=g.getLineNumber(!0);St(g)&&(C=B-(g.leastString()-.5)),m===k.UP&&(C+=T),C+i.topTextLine+.5<B?(d.setTextLine(B-C),l+=B-C,i.topTextLine=l):(d.setTextLine(i.topTextLine),i.topTextLine+=l)}else if(d.verticalJustification===this.VerticalJustify.BOTTOM){let C=B-g.getLineNumber();St(g)&&(C=g.greatestString()-1),m===k.DOWN&&(C+=T);const A=C+i.textLine+1;A<B?(d.setTextLine(B-A),l+=B-A,i.textLine=l):(d.setTextLine(i.textLine),i.textLine+=l)}else d.setTextLine(i.textLine)}const s=Math.min(Math.max(a-r,0),Math.max(a-i.rightShift,0)),c=Math.min(Math.max(n-o,0),Math.max(n-i.leftShift,0));return i.leftShift+=c,i.rightShift+=s,!0}constructor(e){super(),this.text=e,this.horizontalJustification=at.CENTER,this.verticalJustification=ot.TOP}setVerticalJustification(e){return this.verticalJustification=typeof e=="string"?dt.VerticalJustifyString[e]:e,this}getJustification(){return this.horizontalJustification}setJustification(e){return this.horizontalJustification=typeof e=="string"?dt.HorizontalJustifyString[e]:e,this}draw(){const e=this.checkContext(),i=this.checkAttachedNote(),n=i.hasStem()?i.getStemDirection():k.UP,a=i.getModifierStartXY(U.ABOVE,this.index);this.setRendered(),e.openGroup("annotation",this.getAttribute("id"));const o=this.getWidth(),r=W.convertSizeToPixelValue(this.fontInfo.size);let s,c;this.horizontalJustification===at.LEFT?s=a.x:this.horizontalJustification===at.RIGHT?s=a.x-o:this.horizontalJustification===at.CENTER?s=a.x-o/2:s=i.getStemX()-o/2;let u={},d=0;const h=i.hasStem(),l=i.checkStave();if(h&&(u=i.checkStem().getExtents(),d=l.getSpacingBetweenLines()),this.verticalJustification===ot.BOTTOM)c=i.getYs().reduce((f,S)=>f>S?f:S),c+=(this.textLine+1)*D.STAVE_LINE_DISTANCE+r,h&&n===k.DOWN&&(c=Math.max(c,u.topY+r+d*this.textLine));else if(this.verticalJustification===ot.CENTER){const g=i.getYForTopText(this.textLine)-1,f=l.getYForBottomText(this.textLine);c=g+(f-g)/2+r/2}else if(this.verticalJustification===ot.TOP)c=Math.min(...i.getYs())-(this.textLine+1)*D.STAVE_LINE_DISTANCE,h&&n===k.UP&&(d=u.topY<l.getTopLineTopY()?D.STAVE_LINE_DISTANCE:d,c=Math.min(c,u.topY-d*(this.textLine+1)));else{const g=i.getStemExtents();c=g.topY+(g.baseY-g.topY)/2+r/2}an("Rendering annotation: ",this.text,s,c),this.x=s,this.y=c,this.renderText(e,0,0),e.closeGroup()}}dt.DEBUG=!1;dt.HorizontalJustify=at;dt.HorizontalJustifyString={left:at.LEFT,right:at.RIGHT,center:at.CENTER,centerStem:at.CENTER_STEM};dt.VerticalJustify=ot;dt.VerticalJustifyString={above:ot.TOP,top:ot.TOP,below:ot.BOTTOM,bottom:ot.BOTTOM,center:ot.CENTER,centerStem:ot.CENTER_STEM};function on(...t){Rt.DEBUG&&j("VexFlow.Articulation",t)}const{ABOVE:vt,BELOW:de}=v.Position;function Bi(t,e){return t(e/.5)*.5}function $e(t,e){return e===vt?t<=5:t>=1}function bi(t,e){return $e(t,e)?e===vt?Math.ceil:Math.floor:Math.round}function rn(t,e,i,n){const a=Bi(bi(e,i),e),o=t&&$e(a,i),r=a%1===0;return o&&r?a+.5*-n:a}const Ke=t=>Ot(t)||wi(t);function Ai(t,e){const i=t.getStemDirection(),{topY:n,baseY:a}=t.getStemExtents();if(Ke(t))return t.hasStem()?i===k.UP?n:a:Math.min(...t.getYs());if(St(t))return t.hasStem()&&i===k.UP?n:t.checkStave().getYForTopText(e);throw new w("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")}function ki(t,e){const i=t.getStemDirection(),{topY:n,baseY:a}=t.getStemExtents();if(Ke(t))return t.hasStem()?i===k.UP?a:n:Math.max(...t.getYs());if(St(t))return t.hasStem()?i===k.UP?t.checkStave().getYForBottomText(e):n:t.checkStave().getYForBottomText(e);throw new w("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")}function Li(t,e){const i=e===vt&&t.getStemDirection()===k.UP||e===de&&t.getStemDirection()===k.DOWN;return Ke(t)?t.hasStem()&&i?.5:1:t.hasStem()&&i?1:0}class Rt extends v{static get CATEGORY(){return"Articulation"}static format(e,i){if(!e||e.length===0)return!1;const n=.5;let a=0;const o=(c,u,d)=>Bi(bi(u,d),c.height/10+n);e.forEach(c=>{const u=c.checkAttachedNote();a=Math.max(u.getGlyphWidth(),a);let d=5;const h=u.hasStem()?u.getStemDirection():k.UP;let l=0;if(Fe(u)){const f=u.getStem();f&&(l=Math.abs(f.getHeight())/D.STAVE_LINE_DISTANCE)}const g=u.getStave();if(g&&(d=g.getNumLines()),c.getPosition()===vt){let f=u.getLineNumber(!0);h===k.UP&&(f+=l);let S=o(c,i.topTextLine,vt);const x=f+i.topTextLine+.5;!c.articulation.betweenLines&&x<d&&(S+=d-x),c.setTextLine(i.topTextLine),i.topTextLine+=S,c.setOrigin(.5,1)}else if(c.getPosition()===de){let f=Math.max(d-u.getLineNumber(),0);h===k.DOWN&&(f+=l);let S=o(c,i.textLine,de);const x=f+i.textLine+.5;!c.articulation.betweenLines&&x<d&&(S+=d-x),c.setTextLine(i.textLine),i.textLine+=S,c.setOrigin(.5,0)}});const r=e.map(c=>c.getWidth()).reduce((c,u)=>Math.max(u,c)),s=Math.min(Math.max(r-a,0),Math.max(r-(i.leftShift+i.rightShift),0));return i.leftShift+=s/2,i.rightShift+=s/2,!0}static easyScoreHook({articulations:e},i,n){if(!e)return;const a={staccato:"a.",tenuto:"a-",accent:"a>"};e.split(",").map(o=>o.trim().split(".")).map(([o,r])=>{const s={type:a[o]};return r&&(s.position=v.PositionString[r]),n.getFactory().Articulation(s)}).map(o=>i.addModifier(o,0))}constructor(e){var i;super(),this.heightShift=0,this.type=e,this.position=vt,D.articulationCodes(this.type)||(((i=this.type.codePointAt(0))!==null&&i!==void 0?i:0)%2===0?this.position=vt:this.position=de),this.articulation={betweenLines:!1},this.reset()}reset(){this.articulation=D.articulationCodes(this.type),this.articulation||(this.articulation={code:this.type,betweenLines:!1});const e=(this.position===vt?this.articulation.aboveCode:this.articulation.belowCode)||this.articulation.code||E.null;this.text=e}setBetweenLines(e=!0){return this.articulation.betweenLines=e,this}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const n=this.checkIndex(),{position:a,textLine:o}=this,r=this.articulation.betweenLines,s=i.checkStave(),c=s.getSpacingBetweenLines(),u=St(i),{x:d}=i.getModifierStartXY(a,n),h=!r||u,l=Li(i,a);let g={[vt]:()=>{const f=Ai(i,o)-(o+l)*c;return h?Math.min(s.getYForTopText(Rt.INITIAL_OFFSET),f):f},[de]:()=>{const f=ki(i,o)+(o+l)*c;return h?Math.max(s.getYForBottomText(Rt.INITIAL_OFFSET),f):f}}[a]();if(!u){const f=a===vt?-1:1,S=i.getKeyProps()[n].line,m=(i.getYs()[n]-g)/c+Number(S),T=rn(r,m,a,f);$e(T,a)&&this.setOrigin(.5,.5),g+=Math.abs(T-m)*c*f}on(`Rendering articulation at (x: ${d}, y: ${g})`),this.x=d,this.y=g,this.renderText(e,0,0)}}Rt.DEBUG=!1;Rt.INITIAL_OFFSET=-.5;class Qe{static get CATEGORY(){return"RenderContext"}set font(e){this.setFont(e)}get font(){return this.getFont()}}function sn(t,e,i,n="#F55"){t.save(),t.setFillStyle(n),t.beginPath(),t.arc(e,i,3,0,Math.PI*2,!1),t.closePath(),t.fill(),t.restore()}class cn extends p{static get CATEGORY(){return"Tickable"}constructor(){super(),this._preFormatted=!1,this._postFormatted=!1,this.ticks=new P(0,1),this.intrinsicTicks=0,this.tickMultiplier=new P(1,1),this.modifiers=[],this.tupletStack=[],this.alignCenter=!1,this.centerXShift=0,this.ignoreTicks=!1,this.formatterMetrics={freedom:{left:0,right:0},duration:"",iterations:0,space:{used:0,mean:0,deviation:0}}}reset(){return this}getTicks(){return this.ticks}shouldIgnoreTicks(){return this.ignoreTicks}setIgnoreTicks(e){return this.ignoreTicks=e,this}getWidth(){if(!this._preFormatted)throw new w("UnformattedNote","Can't call GetWidth on an unformatted note.");return this.width+(this.modifierContext?this.modifierContext.getWidth():0)}getX(){return this.checkTickContext("Can't getX() without a TickContext.").getX()+this.xShift}getFormatterMetrics(){return this.formatterMetrics}getCenterXShift(){return this.isCenterAligned()?this.centerXShift:0}setCenterXShift(e){return this.centerXShift=e,this}isCenterAligned(){return this.alignCenter}setCenterAlignment(e){return this.alignCenter=e,this}getVoice(){return _(this.voice,"NoVoice","Tickable has no voice.")}setVoice(e){this.voice=e}getTuplet(){return this.tuplet}getTupletStack(){return this.tupletStack}resetTuplet(e){let i,n;if(e){const a=this.tupletStack.indexOf(e);return a!==-1&&(this.tupletStack.splice(a,1),i=e.getNoteCount(),n=e.getNotesOccupied(),this.applyTickMultiplier(i,n)),this}for(;this.tupletStack.length;)e=this.tupletStack.pop(),i=e.getNoteCount(),n=e.getNotesOccupied(),this.applyTickMultiplier(i,n);return this}setTuplet(e){if(e){this.tupletStack.push(e);const i=e.getNoteCount(),n=e.getNotesOccupied();this.applyTickMultiplier(n,i)}return this.tuplet=e,this}addToModifierContext(e){this.modifierContext=e;for(let i=0;i<this.modifiers.length;++i)this.modifierContext.addMember(this.modifiers[i]);return this.modifierContext.addMember(this),this._preFormatted=!1,this}addModifier(e,i=0){return this.modifiers.push(e),this._preFormatted=!1,this}getModifiers(){return this.modifiers}setTickContext(e){this.tickContext=e,this._preFormatted=!1}checkTickContext(e="Tickable has no tick context."){return _(this.tickContext,"NoTickContext",e)}preFormat(){this._preFormatted||(this.width=0,this.modifierContext&&(this.modifierContext.preFormat(),this.width+=this.modifierContext.getWidth()))}set preFormatted(e){this._preFormatted=e}get preFormatted(){return this._preFormatted}postFormat(){return this._postFormatted?this:(this._postFormatted=!0,this)}set postFormatted(e){this._postFormatted=e}get postFormatted(){return this._postFormatted}getIntrinsicTicks(){return this.intrinsicTicks}setIntrinsicTicks(e){this.intrinsicTicks=e,this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)}getTickMultiplier(){return this.tickMultiplier}applyTickMultiplier(e,i){this.tickMultiplier.multiply(e,i),this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)}setDuration(e){const i=e.numerator*(D.RESOLUTION/e.denominator);this.ticks=this.tickMultiplier.clone().multiply(i),this.intrinsicTicks=this.ticks.value()}getAbsoluteX(){return this.checkTickContext("Can't getAbsoluteX() without a TickContext.").getX()}setModifierContext(e){return this.modifierContext=e,this}getModifierContext(){return this.modifierContext}checkModifierContext(){return _(this.modifierContext,"NoModifierContext","No modifier context attached to this tickable.")}}class $ extends cn{static get CATEGORY(){return"Note"}static getGlyphProps(e,i="n"){e=D.sanitizeDuration(e);let n=D.durationCodes[e];n===void 0&&(n=D.durationCodes[4]);const a=D.codeNoteHead(i.toUpperCase(),e);return a!==E.null&&(n=Object.assign(Object.assign({},n),{codeHead:a})),n}static plotMetrics(e,i,n){var a;const o=i.getMetrics(),r=i.getAbsoluteX()-o.modLeftPx-o.leftDisplacedHeadPx,s=i.getAbsoluteX()-o.leftDisplacedHeadPx,c=i.getAbsoluteX(),u=i.getAbsoluteX()+o.notePx,d=i.getAbsoluteX()+o.notePx+o.rightDisplacedHeadPx,h=i.getAbsoluteX()+o.notePx+o.rightDisplacedHeadPx+o.modRightPx,l=h+((a=i.getFormatterMetrics().freedom.right)!==null&&a!==void 0?a:0),g=h-r;e.save(),e.setFont(F.get("fontFamily"),8),e.fillText(Math.round(g)+"px",r+i.getXShift(),n);const f=n+7;function S(m,T,B,C=f){e.beginPath(),e.setStrokeStyle(B),e.setFillStyle(B),e.setLineWidth(3),e.moveTo(m+i.getXShift(),C),e.lineTo(T+i.getXShift(),C),e.stroke()}S(r,s,"red"),S(s,c,"#999"),S(c,u,"green"),S(u,d,"#999"),S(d,h,"red"),S(h,l,"#DD0"),S(r-i.getXShift(),r,"#BBB"),sn(e,c+i.getXShift(),f,"blue");const x=i.getFormatterMetrics();if(x.iterations>0){const m=x.space.deviation,T=m>=0?"+":"";e.setFillStyle("red"),e.fillText(T+Math.round(m),c+i.getXShift(),n-10)}e.restore()}static parseDuration(e){if(!e)return;const n=/(\d*\/?\d+|[a-z])(d*)([nrhms]|$)/.exec(e);if(!n)return;const a=n[1],o=n[2].length,r=n[3]||"n";return{duration:a,dots:o,type:r}}static parseNoteStruct(e){const i=$.parseDuration(e.duration);if(!i)return;let n=e.type;if(n&&!D.validTypes[n])return;const a=[];n||(n=i.type||"n",e.keys!==void 0&&e.keys.forEach((c,u)=>{const d=c.split("/");a[u]=d&&d.length===3?d[2]:n}));let o=D.durationToTicks(i.duration);if(!o)return;const r=e.dots?e.dots:i.dots;if(typeof r!="number")return;let s=o;for(let c=0;c<r;c++){if(s<=1)return;s=s/2,o+=s}return{duration:i.duration,type:n,customTypes:a,dots:r,ticks:o}}constructor(e){if(super(),!e)throw new w("BadArguments","Note must have valid initialization data to identify duration and type.");const i=$.parseNoteStruct(e);if(!i)throw new w("BadArguments",`Invalid note initialization object: ${JSON.stringify(e)}`);this.keys=e.keys||[],this.keyProps=[],this.duration=i.duration,this.noteType=i.type,this.customTypes=i.customTypes,e.durationOverride?this.setDuration(e.durationOverride):this.setIntrinsicTicks(i.ticks),this.modifiers=[],this.glyphProps=$.getGlyphProps(this.duration,this.noteType),this.customGlyphs=this.customTypes.map(n=>$.getGlyphProps(this.duration,n)),this.playNote=void 0,this.ignoreTicks=!1,this.width=0,this.leftDisplacedHeadPx=0,this.rightDisplacedHeadPx=0,this.xShift=0,this.ys=[],e.alignCenter&&this.setCenterAlignment(e.alignCenter),this.renderOptions={annotationSpacing:5,strokePx:1,yShift:0}}getPlayNote(){return this.playNote}setPlayNote(e){return this.playNote=e,this}isRest(){return!1}addStroke(e,i){return i.setNote(this),i.setIndex(e),this.modifiers.push(i),this.preFormatted=!1,this}getStave(){return this.stave}checkStave(){return _(this.stave,"NoStave","No stave attached to instance.")}setStave(e){return this.stave=e,this.setYs([e.getYForLine(0)]),this.setContext(this.stave.getContext()),this}getLeftDisplacedHeadPx(){return this.leftDisplacedHeadPx}getRightDisplacedHeadPx(){return this.rightDisplacedHeadPx}setLeftDisplacedHeadPx(e){return this.leftDisplacedHeadPx=e,this}setRightDisplacedHeadPx(e){return this.rightDisplacedHeadPx=e,this}shouldIgnoreTicks(){return this.ignoreTicks}getLineNumber(e){return 0}getLineForRest(){return 0}getGlyphProps(){return this.glyphProps}getGlyphWidth(){return 0}setYs(e){return this.ys=e,this}getYs(){if(this.ys.length===0)throw new w("NoYValues","No Y-values calculated for this note.");return this.ys}getYForTopText(e){return this.checkStave().getYForTopText(e)}getVoice(){if(!this.voice)throw new w("NoVoice","Note has no voice.");return this.voice}setVoice(e){return this.voice=e,this.preFormatted=!1,this}getTickContext(){return this.checkTickContext()}setTickContext(e){return this.tickContext=e,this.preFormatted=!1,this}getDuration(){return this.duration}isDotted(){return this.getModifiersByType("Dot").length>0}hasStem(){return!1}getNoteType(){return this.noteType}getBeam(){return this.beam}checkBeam(){return _(this.beam,"NoBeam","No beam attached to instance")}hasBeam(){return this.beam!==void 0}setBeam(e){return this.beam=e,this}addModifier(e,i=0){const n="Note.addModifier(modifier: Modifier, index: number=0)";if(typeof i=="string"&&(i=parseInt(i),console.warn(n+" expected a number for `index`, but received a string.")),typeof e!="object"||typeof i!="number")throw new w("WrongParams","Incorrect call signature. Use "+n+" instead.");return e.setNote(this),e.setIndex(i),super.addModifier(e),this}getModifiersByType(e){return this.modifiers.filter(i=>i.getCategory()===e)}getModifierStartXY(e,i,n){if(!this.preFormatted)throw new w("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");return{x:this.getAbsoluteX(),y:this.ys[0]}}getRightParenthesisPx(e){return this.getKeyProps()[e].displaced?this.getRightDisplacedHeadPx():0}getLeftParenthesisPx(e){return this.getKeyProps()[e].displaced?this.getLeftDisplacedHeadPx()-this.xShift:-this.xShift}getFirstDotPx(){let e=this.getRightDisplacedHeadPx();const i=this.checkModifierContext().getMembers("Parenthesis");return i.length!==0&&(e+=i[0].getWidth()+1),e}getMetrics(){if(!this.preFormatted)throw new w("UnformattedNote","Can't call getMetrics on an unformatted note.");const e=this.modifierContext?this.modifierContext.getState().leftShift:0,i=this.modifierContext?this.modifierContext.getState().rightShift:0,n=this.getWidth(),a=this.getGlyphWidth(),o=n-e-i-this.leftDisplacedHeadPx-this.rightDisplacedHeadPx;return{width:n,glyphWidth:a,notePx:o,modLeftPx:e,modRightPx:i,leftDisplacedHeadPx:this.leftDisplacedHeadPx,rightDisplacedHeadPx:this.rightDisplacedHeadPx,glyphPx:0}}getAbsoluteX(){let i=this.checkTickContext("Can't getAbsoluteX() without a TickContext.").getX();return this.stave&&(i+=this.stave.getNoteStartX()+F.get("Stave.padding",0)),this.isCenterAligned()&&(i+=this.getCenterXShift()),i}getStemDirection(){throw new w("NoStem","No stem attached to this note.")}getStemExtents(){throw new w("NoStem","No stem attached to this note.")}getTieRightX(){let e=this.getAbsoluteX();const i=this.getGlyphWidth();return e+=i/2,e+=-this.width/2+this.width+2,e}getTieLeftX(){let e=this.getAbsoluteX();const i=this.getGlyphWidth();return e+=i/2,e-=this.width/2+2,e}getKeys(){return this.keys}getKeyProps(){return this.keyProps}getBoundingBox(){const e=super.getBoundingBox();for(let i=0;i<this.modifiers.length;i++)e.mergeWith(this.modifiers[i].getBoundingBox());return e}}var O;(function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.ABOVE=3]="ABOVE",t[t.BELOW=4]="BELOW",t[t.BEGIN=5]="BEGIN",t[t.END=6]="END"})(O||(O={}));class Pt extends p{static get CATEGORY(){return"StaveModifier"}static get Position(){return O}constructor(){super(),this.padding=10,this.position=O.ABOVE}getPosition(){return this.position}setPosition(e){return this.position=e,this}getStave(){return this.stave}checkStave(){return _(this.stave,"NoStave","No stave attached to instance.")}setStave(e){return this.stave=e,this}getPadding(e){return e!==void 0&&e<2?0:this.padding}setPadding(e){return this.padding=e,this}setLayoutMetrics(e){return this.layoutMetrics=e,this}getLayoutMetrics(){return this.layoutMetrics}}var I;(function(t){t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE",t[t.END=3]="END",t[t.REPEAT_BEGIN=4]="REPEAT_BEGIN",t[t.REPEAT_END=5]="REPEAT_END",t[t.REPEAT_BOTH=6]="REPEAT_BOTH",t[t.NONE=7]="NONE"})(I||(I={}));class At extends Pt{static get CATEGORY(){return"Barline"}static get type(){return I}static get typeString(){return{single:I.SINGLE,double:I.DOUBLE,end:I.END,repeatBegin:I.REPEAT_BEGIN,repeatEnd:I.REPEAT_END,repeatBoth:I.REPEAT_BOTH,none:I.NONE}}constructor(e){super(),this.thickness=D.STAVE_LINE_THICKNESS;const i=I;this.widths={},this.widths[i.SINGLE]=5,this.widths[i.DOUBLE]=5,this.widths[i.END]=5,this.widths[i.REPEAT_BEGIN]=5,this.widths[i.REPEAT_END]=5,this.widths[i.REPEAT_BOTH]=5,this.widths[i.NONE]=5,this.paddings={},this.paddings[i.SINGLE]=0,this.paddings[i.DOUBLE]=0,this.paddings[i.END]=0,this.paddings[i.REPEAT_BEGIN]=15,this.paddings[i.REPEAT_END]=15,this.paddings[i.REPEAT_BOTH]=15,this.paddings[i.NONE]=0,this.layoutMetricsMap={},this.layoutMetricsMap[i.SINGLE]={xMin:0,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[i.DOUBLE]={xMin:-3,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[i.END]={xMin:-5,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[i.REPEAT_END]={xMin:-10,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[i.REPEAT_BEGIN]={xMin:-2,xMax:10,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[i.REPEAT_BOTH]={xMin:-10,xMax:10,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[i.NONE]={xMin:0,xMax:0,paddingLeft:5,paddingRight:5},this.setPosition(O.BEGIN),this.setType(e)}getType(){return this.type}setType(e){return this.type=typeof e=="string"?At.typeString[e]:e,this.setWidth(this.widths[this.type]),this.setPadding(this.paddings[this.type]),this.setLayoutMetrics(this.layoutMetricsMap[this.type]),this}draw(){const e=this.checkStave(),i=e.checkContext();switch(this.setRendered(),i.openGroup("stavebarline",this.getAttribute("id")),this.type){case I.SINGLE:this.drawVerticalBar(e,this.x,!1);break;case I.DOUBLE:this.drawVerticalBar(e,this.x,!0);break;case I.END:this.drawVerticalEndBar(e,this.x);break;case I.REPEAT_BEGIN:this.drawRepeatBar(e,this.x,!0),e.getX()!==this.x&&this.drawVerticalBar(e,e.getX());break;case I.REPEAT_END:this.drawRepeatBar(e,this.x,!1);break;case I.REPEAT_BOTH:this.drawRepeatBar(e,this.x,!1),this.drawRepeatBar(e,this.x,!0);break}i.closeGroup()}drawVerticalBar(e,i,n){const a=e.checkContext(),o=e.getTopLineTopY(),r=e.getBottomLineBottomY();n&&a.fillRect(i-3,o,1,r-o),a.fillRect(i,o,1,r-o)}drawVerticalEndBar(e,i){const n=e.checkContext(),a=e.getTopLineTopY(),o=e.getBottomLineBottomY();n.fillRect(i-5,a,1,o-a),n.fillRect(i-2,a,3,o-a)}drawRepeatBar(e,i,n){const a=e.checkContext(),o=e.getTopLineTopY(),r=e.getBottomLineBottomY();let s=3;n||(s=-5),a.fillRect(i+s,o,1,r-o),a.fillRect(i-2,o,3,r-o);const c=2;n?s+=4:s-=4;const u=i+s+c/2;let d=(e.getNumLines()-1)*e.getSpacingBetweenLines();d=d/2-e.getSpacingBetweenLines()/2;let h=o+d+c/2;a.beginPath(),a.arc(u,h,c,0,Math.PI*2,!1),a.fill(),h+=e.getSpacingBetweenLines(),a.beginPath(),a.arc(u,h,c,0,Math.PI*2,!1),a.fill()}}function un(...t){ve.DEBUG&&j("VexFlow.BarNote",t)}class ve extends ${static get CATEGORY(){return"BarNote"}constructor(e=I.SINGLE){super({duration:"b"}),this.metrics={widths:{}};const i=I;this.metrics.widths={[i.SINGLE]:8,[i.DOUBLE]:12,[i.END]:15,[i.REPEAT_BEGIN]:14,[i.REPEAT_END]:14,[i.REPEAT_BOTH]:18,[i.NONE]:0},this.ignoreTicks=!0,this.setType(e)}getType(){return this.type}setType(e){return this.type=typeof e=="string"?At.typeString[e]:e,this.setWidth(this.metrics.widths[this.type]),this}addToModifierContext(e){return this}preFormat(){return this.preFormatted=!0,this}draw(){const e=this.checkContext();un("Rendering bar line at: ",this.getAbsoluteX());const i=new At(this.type);i.setX(this.getAbsoluteX()),i.setStave(this.checkStave()),i.setContext(e),i.drawWithStyle(),this.setRendered()}}ve.DEBUG=!1;function ui(t){let e=0;return t.forEach(i=>{i.keyProps&&i.keyProps.forEach(n=>{e+=n.line-3})}),e>=0?k.DOWN:k.UP}function dn(t,e){const i=t.getStemExtents().topY,n=t.getStemX(),a=e.getStemExtents().topY,o=e.getStemX();return(a-i)/(o-n)}const ze="L",hn="R",di="B";class Yt extends p{static get CATEGORY(){return"Beam"}getStemDirection(){return this._stemDirection}static getDefaultBeamGroups(e){(!e||e==="c")&&(e="4/4");const n={"1/2":["1/2"],"2/2":["1/2"],"3/2":["1/2"],"4/2":["1/2"],"1/4":["1/4"],"2/4":["1/4"],"3/4":["1/4"],"4/4":["1/4"],"1/8":["1/8"],"2/8":["2/8"],"3/8":["3/8"],"4/8":["2/8"],"1/16":["1/16"],"2/16":["2/16"],"3/16":["3/16"],"4/16":["2/16"]}[e];if(n===void 0){const a=parseInt(e.split("/")[0],10),o=parseInt(e.split("/")[1],10);if(a%3===0)return[new P(3,o)];if(o>4)return[new P(2,o)];if(o<=4)return[new P(1,o)]}else return n.map(a=>new P().parse(a));return[new P(1,4)]}static applyAndGetBeams(e,i,n){return Yt.generateBeams(e.getTickables(),{groups:n,stemDirection:i})}static generateBeams(e,i={}){(!i.groups||!i.groups.length)&&(i.groups=[new P(2,8)]);const n=i.groups.map(C=>{if(!C.multiply)throw new w("InvalidBeamGroups","The beam groups must be an array of VexFlow.Fractions");return C.clone().multiply(D.RESOLUTION,1)}),a=e;let o=0,r=[],s=[];function c(C){return C.reduce((A,L)=>L.getTicks().clone().add(A),new P(0,1))}function u(){n.length-1>o?o+=1:o=0}function d(){let C=[],A=new P(0,1);a.forEach(L=>{if(C=[],L.shouldIgnoreTicks()){r.push(s),s=C;return}s.push(L);const N=n[o].clone(),M=c(s).add(A),Z=D.durationToNumber(L.getDuration())<8;if(Z&&L.getTuplet()&&(N.numerator*=2),M.greaterThan(N)){if(!Z){const q=s.pop();q&&C.push(q)}r.push(s);do A=M.subtract(n[o]),u();while(A.greaterThanEquals(n[o]));s=C}else M.equals(N)&&(r.push(s),A=new P(0,1),s=C,u())}),s.length>0&&r.push(s)}function h(){return r.filter(C=>{if(C.length>1){let A=!0;return C.forEach(L=>{L.getIntrinsicTicks()>=D.durationToTicks("4")&&(A=!1)}),A}return!1})}function l(){const C=[];r.forEach(A=>{let L=[];A.forEach((N,M,Z)=>{const q=M===0||M===Z.length-1,y=Z[M-1],it=!i.beamRests&&N.isRest(),K=i.beamRests&&i.beamMiddleOnly&&N.isRest()&&q;let J=!1;if(i.maintainStemDirections&&y&&!N.isRest()&&!y.isRest()){const _t=y.getStemDirection();J=N.getStemDirection()!==_t}const ht=parseInt(N.getDuration(),10)<8;it||K||J||ht?(L.length>0&&C.push(L),L=J?[N]:[]):L.push(N)}),L.length>0&&C.push(L)}),r=C}function g(){r.forEach(C=>{let A;if(i.maintainStemDirections){const L=f(C);A=L?L.getStemDirection():k.UP}else i.stemDirection?A=i.stemDirection:A=ui(C);S(C,A)})}function f(C){for(let A=0;A<C.length;A++){const L=C[A];if(!L.isRest())return L}return!1}function S(C,A){C.forEach(L=>{L.setStemDirection(A)})}function x(){const C=[];return r.forEach(A=>{let L;A.forEach(N=>{const M=N.getTuplet();M&&L!==M&&(L=M,C.push(L))})}),C}d(),l(),g();const m=h(),T=x(),B=[];return m.forEach(C=>{const A=new Yt(C);i.showStemlets&&(A.renderOptions.showStemlets=!0),i.secondaryBreaks&&(A.renderOptions.secondaryBreakTicks=D.durationToTicks(i.secondaryBreaks)),i.flatBeams===!0&&(A.renderOptions.flatBeams=!0,A.renderOptions.flatBeamOffset=i.flatBeamOffset),B.push(A)}),T.forEach(C=>{const A=C.notes[0].stemDirection===k.DOWN?-1:1;C.setTupletLocation(A);let L=!1;for(let N=0;N<C.notes.length;N++)if(!C.notes[N].hasBeam()){L=!0;break}C.setBracketed(L)}),B}constructor(e,i=!1){if(super(),this.slope=0,this.yShift=0,this.forcedPartialDirections={},!e||e.length===0)throw new w("BadArguments","No notes provided for beam.");if(e.length===1)throw new w("BadArguments","Too few notes for beam.");if(this._ticks=e[0].getIntrinsicTicks(),this._ticks>=D.durationToTicks("4"))throw new w("BadArguments","Beams can only be applied to notes shorter than a quarter note.");let n,a;this._stemDirection=e[0].getStemDirection();let o=this._stemDirection;for(i&&Ot(e[0])?o=ui(e):i&&St(e[0])&&(o=e.reduce((s,c)=>s+c.getStemDirection(),0)>-1?k.UP:k.DOWN),n=0;n<e.length;++n)a=e[n],i&&(a.setStemDirection(o),this._stemDirection=o),a.setBeam(this);this.postFormatted=!1,this.notes=e,this._beamCount=this.getBeamCount(),this.breakOnIndexes=[],this.renderOptions={beamWidth:5,maxSlope:.25,minSlope:-.25,slopeIterations:20,slopeCost:100,showStemlets:!1,stemletExtension:7,partialBeamLength:10,flatBeams:!1,minFlatBeamOffset:15}}getNotes(){return this.notes}getBeamCount(){return this.notes.map(n=>n.getGlyphProps().beamCount).reduce((n,a)=>a>n?a:n)}breakSecondaryAt(e){return this.breakOnIndexes=e,this}setPartialBeamSideAt(e,i){return this.forcedPartialDirections[e]=i,this}unsetPartialBeamSideAt(e){return delete this.forcedPartialDirections[e],this}getSlopeY(e,i,n,a){return n+(e-i)*a}calculateSlope(){const{notes:e,renderOptions:{maxSlope:i,minSlope:n,slopeIterations:a,slopeCost:o}}=this,r=this._stemDirection,s=e[0],c=dn(s,e[e.length-1]),u=(i-n)/a;let d=Number.MAX_VALUE,h=0,l=0;for(let g=n;g<=i;g+=u){let f=0,S=0;for(let B=1;B<e.length;++B){const C=e[B];if(C.hasStem()||C.isRest()){const A=this.getSlopeY(C.getStemX(),s.getStemX(),s.getStemExtents().topY,g)+S,L=C.getStemExtents().topY;if(L*r<A*r){const N=Math.abs(L-A);S+=N*-r,f+=N*B}else f+=(L-A)*r}}const x=c/2,m=Math.abs(x-g),T=o*m+Math.abs(f);T<d&&(d=T,h=g,l=S)}this.slope=h,this.yShift=l}calculateFlatSlope(){const{notes:e,renderOptions:{beamWidth:i,minFlatBeamOffset:n,flatBeamOffset:a}}=this,o=this._stemDirection;let r=0,s=0,c=0,u=0;for(let g=0;g<e.length;g++){const f=e[g],S=f.getStemExtents().topY;r+=S,o===k.DOWN&&u<S?(u=S,s=Math.max(...f.getYs()),c=f.getBeamCount()):o===k.UP&&(u===0||u>S)&&(u=S,s=Math.min(...f.getYs()),c=f.getBeamCount())}let d=r/e.length;const h=n+c*i*1.5,l=s+h*-o;o===k.DOWN&&d<l?d=s+h:o===k.UP&&d>l&&(d=s-h),a?o===k.DOWN&&d>a?this.renderOptions.flatBeamOffset=d:o===k.UP&&d<a&&(this.renderOptions.flatBeamOffset=d):this.renderOptions.flatBeamOffset=d,this.slope=0,this.yShift=0}getBeamYToDraw(){let n=this.notes[0].getStemExtents().topY;return this.renderOptions.flatBeams&&this.renderOptions.flatBeamOffset&&(n=this.renderOptions.flatBeamOffset),n}applyStemExtensions(){const{notes:e,slope:i,renderOptions:{showStemlets:n,stemletExtension:a,beamWidth:o}}=this,r=this.yShift,s=this._beamCount,c=e[0],u=this.getBeamYToDraw(),d=c.getStemX();for(let h=0;h<e.length;++h){const l=e[h],g=l.getStem();if(g){const f=l.getStemX(),{topY:S}=l.getStemExtents(),x=this.getSlopeY(f,d,u,i)+r,m=g.getExtension(),T=l.getStemDirection()===k.UP?S-x:x-S;let B=0;if(l.getStemDirection()!==this._stemDirection&&(B=(1+(l.getGlyphProps().beamCount-1)*1.5)*this.renderOptions.beamWidth),g.setExtension(m+T+B),g.adjustHeightForBeam(),l.isRest()&&n){const C=(s-1)*o*1.5+o;g.setVisibility(!0).setStemlet(!0,C+a)}}}}lookupBeamDirection(e,i,n,a,o){if(e==="4")return ze;const r=this.forcedPartialDirections[o];if(r)return r;const s=`${D.durationToNumber(e)/2}`,c=i<D.durationToTicks(s),u=a<D.durationToTicks(s),d=n<D.durationToTicks(s);return c&&u&&d?di:c&&!u&&d?ze:!c&&u&&d?hn:this.lookupBeamDirection(s,i,n,a,o)}getBeamLines(e){const i=D.durationToTicks(e);let n=!1;const a=[];let o;const r=this.renderOptions.partialBeamLength;let s=!1,c=0;for(let d=0;d<this.notes.length;++d){const h=this.notes[d],l=h.getTicks().value();c+=l;let g=!1;parseInt(e,10)>=8&&(g=this.breakOnIndexes.indexOf(d)!==-1,this.renderOptions.secondaryBreakTicks&&c>=this.renderOptions.secondaryBreakTicks&&(c=0,g=!0));const f=h.getIntrinsicTicks()<i,S=h.getStemX()-k.WIDTH/2,x=this.notes[d-1],m=this.notes[d+1],T=m&&m.getIntrinsicTicks()<i,B=x&&x.getIntrinsicTicks()<i,C=x&&m&&f&&!B&&!T;if(f)if(n)o=a[a.length-1],o.end=S,g&&(n=!1,m&&!T&&o.end===void 0&&(o.end=o.start-r));else{if(o={start:S,end:void 0},n=!0,C){const A=x.getIntrinsicTicks(),L=m.getIntrinsicTicks(),N=h.getIntrinsicTicks(),M=this.lookupBeamDirection(e,A,N,L,d);[ze,di].includes(M)?o.end=o.start-r:o.end=o.start+r}else T?g&&(o.end=o.start-r,n=!1):(s||d===0)&&m?o.end=o.start+r:o.end=o.start-r;a.push(o)}else n=!1;s=g}const u=a[a.length-1];return u&&u.end===void 0&&(u.end=u.start-r),a}drawStems(e){this.notes.forEach(i=>{const n=i.getStem();if(n){const a=i.getStemX();n.setNoteHeadXBounds(a,a),n.setContext(e).drawWithStyle()}},this)}drawBeamLines(e){const i=["4","8","16","32","64"],n=this.notes[0];let a=this.getBeamYToDraw();const o=n.getStemX(),r=this.renderOptions.beamWidth*this._stemDirection;for(let s=0;s<i.length;++s){const c=i[s],u=this.getBeamLines(c);for(let d=0;d<u.length;++d){const h=u[d],l=h.start,g=this.getSlopeY(l,o,a,this.slope),f=h.end;if(f){const S=this.getSlopeY(f,o,a,this.slope);e.beginPath(),e.moveTo(l,g),e.lineTo(l,g+r),e.lineTo(f+1,S+r),e.lineTo(f+1,S),e.closePath(),e.fill()}else throw new w("NoLastBeamX","lastBeamX undefined.")}a+=r*1.5}}preFormat(){return this}postFormat(){this.postFormatted||(St(this.notes[0])||this.renderOptions.flatBeams?this.calculateFlatSlope():this.calculateSlope(),this.applyStemExtensions(),this.postFormatted=!0)}draw(){const e=this.checkContext();this.setRendered(),!this.unbeamable&&(this.postFormatted||this.postFormat(),e.openGroup("beam",this.getAttribute("id")),this.drawStems(e),this.drawBeamLines(e),e.closeGroup())}}class gt extends v{static get CATEGORY(){return"Bend"}static get UP(){return 0}static get DOWN(){return 1}static format(e,i){if(!e||e.length===0)return!1;let n=0;for(let a=0;a<e.length;++a){const o=e[a],r=o.checkAttachedNote();if(St(r)){const s=r.leastString()-1;i.topTextLine<s&&(i.topTextLine=s)}o.setXShift(n),n=o.getWidth(),o.setTextLine(i.topTextLine)}return i.rightShift+=n,i.topTextLine+=1,!0}setStyleLine(e){return this.styleLine=e,this}getStyleLine(){return this.styleLine}constructor(e){super(),this.styleLine=F.getStyle("Bend.line"),this.xShift=0,this.tap="",this.renderOptions={bendWidth:8,releaseWidth:8},this.phrase=e,this.updateWidth()}setXShift(e){return this.xShift=e,this.updateWidth(),this}setTap(e){return this.tap=e,this}getTextHeight(){const e=new p("Bend");return e.setText(this.phrase[0].text),e.getHeight()}updateWidth(){const e=n=>{const a=new p("Bend");return a.setText(n),a.getWidth()};let i=0;for(let n=0;n<this.phrase.length;++n){const a=this.phrase[n];if(a.width!==void 0)i+=a.width;else{const o=a.type===gt.UP?this.renderOptions.bendWidth:this.renderOptions.releaseWidth;a.width=Math.max(o,e(a.text))+3,a.drawWidth=a.width/2,i+=a.width}}return this.setWidth(i+this.xShift),this}draw(){var e;const i=this.checkContext(),n=this.checkAttachedNote();this.setRendered();const a=n.getModifierStartXY(v.Position.RIGHT,this.index);a.x+=3,a.y+=.5;const o=this.xShift,s=n.checkStave().getSpacingBetweenLines(),c=n.getYs().reduce((T,B)=>T<B?T:B),u=a.y-((this.textLine+1)*s+a.y-c)+3,d=a.y-((this.textLine+1)*s+a.y-c)-1,h=(T,B,C,A)=>{const L=T+C,N=B;this.applyStyle(i,this.styleLine),i.beginPath(),i.moveTo(T,B),i.quadraticCurveTo(L,N,T+C,A),i.stroke()},l=(T,B,C,A)=>{this.applyStyle(i,this.styleLine),i.beginPath(),i.moveTo(T,A),i.quadraticCurveTo(T+C,A,T+C,B),i.stroke()},g=(T,B,C)=>{const L=B+4*C;i.beginPath(),i.moveTo(T,B),i.lineTo(T-4,L),i.lineTo(T+4,L),i.closePath(),i.fill()},f=(T,B)=>{i.setFont(this.fontInfo);const C=T-i.measureText(B).width/2;i.fillText(B,C,d)};let S,x=0,m=0;if(!((e=this.tap)===null||e===void 0)&&e.length){const T=n.getModifierStartXY(v.Position.CENTER,this.index);f(T.x,this.tap)}for(let T=0;T<this.phrase.length;++T){const B=this.phrase[T];B.drawWidth||(B.drawWidth=0),T===0&&(B.drawWidth+=o),m=B.drawWidth+x-(T===1?o:0),B.type===gt.UP&&(S&&S.type===gt.UP&&g(a.x,u,1),h(a.x,a.y,m,u)),B.type===gt.DOWN&&(S&&S.type===gt.UP&&l(a.x,a.y,m,u),S&&S.type===gt.DOWN&&(g(a.x,a.y,-1),l(a.x,a.y,m,u)),S||(m=B.drawWidth,l(a.x,a.y,m,u))),f(a.x+m,B.text),S=B,x=B.drawWidth,S.x=a.x,a.x+=m}if(!S||S.x===void 0)throw new w("NoLastBendForBend","Internal error.");S.type===gt.UP?g(S.x+m,u,1):S.type===gt.DOWN&&g(S.x+m,a.y,-1)}}function Je(t){if(!t)return!1;const e=ge();return typeof e.HTMLCanvasElement=="function"&&t instanceof e.HTMLCanvasElement||typeof t.getContext=="function"&&typeof t.toDataURL=="function"}function ln(t){if(!t)return!1;const e=ge();return typeof e.HTMLDivElement=="function"&&t instanceof e.HTMLDivElement||typeof t.appendChild=="function"&&typeof t.style=="object"}class yt extends Qe{static get WIDTH(){return 600}static get HEIGHT(){return 400}static get CANVAS_BROWSER_SIZE_LIMIT(){return 32767}static sanitizeCanvasDims(e,i){const n=this.CANVAS_BROWSER_SIZE_LIMIT;return Math.max(e,i)>n&&(Vi("Canvas dimensions exceed browser limit. Cropping to "+n),e>n&&(e=n),i>n&&(i=n)),[e,i]}constructor(e){super(),this.textHeight=0,this.context2D=e,this.curTransfrom=e.getTransform(),e.canvas?this.canvas=e.canvas:this.canvas={width:yt.WIDTH,height:yt.HEIGHT}}clear(){this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height)}openGroup(e,i){}closeGroup(){}openRotation(e,i,n){this.curTransfrom=this.context2D.getTransform(),this.context2D.translate(i,n),this.context2D.rotate(e*Math.PI/180),this.context2D.translate(-i,-n)}closeRotation(){this.context2D.setTransform(this.curTransfrom)}add(e){}setFillStyle(e){return this.context2D.fillStyle=e,this}setBackgroundFillStyle(e){return this}setStrokeStyle(e){return this.context2D.strokeStyle=e,this}setShadowColor(e){return this.context2D.shadowColor=e,this}setShadowBlur(e){const i=this.context2D.getTransform(),n=Math.sqrt(i.a*i.a+i.b*i.b+i.c*i.c+i.d*i.d);return this.context2D.shadowBlur=n*e,this}setLineWidth(e){return this.context2D.lineWidth=e,this}setLineCap(e){return this.context2D.lineCap=e,this}setLineDash(e){return this.context2D.setLineDash(e),this}scale(e,i){return this.context2D.scale(e,i),this}resize(e,i,n){var a;const o=this.context2D.canvas,r=(a=n??ge().devicePixelRatio)!==null&&a!==void 0?a:1;return[e,i]=yt.sanitizeCanvasDims(e*r,i*r),e=e/r|0,i=i/r|0,o.width=e*r,o.height=i*r,Je(o)&&(o.style.width=e+"px",o.style.height=i+"px"),this.scale(r,r)}rect(e,i,n,a){return this.context2D.rect(e,i,n,a),this}fillRect(e,i,n,a){return this.context2D.fillRect(e,i,n,a),this}pointerRect(e,i,n,a){return this}clearRect(e,i,n,a){return this.context2D.clearRect(e,i,n,a),this}beginPath(){return this.context2D.beginPath(),this}moveTo(e,i){return this.context2D.moveTo(e,i),this}lineTo(e,i){return this.context2D.lineTo(e,i),this}bezierCurveTo(e,i,n,a,o,r){return this.context2D.bezierCurveTo(e,i,n,a,o,r),this}quadraticCurveTo(e,i,n,a){return this.context2D.quadraticCurveTo(e,i,n,a),this}arc(e,i,n,a,o,r){return this.context2D.arc(e,i,n,a,o,r),this}fill(){return this.context2D.fill(),this}stroke(){return this.context2D.stroke(),this}closePath(){return this.context2D.closePath(),this}measureText(e){const i=this.context2D.measureText(e);let n=0,a=0;return i.fontBoundingBoxAscent?(n=-i.fontBoundingBoxAscent,a=i.fontBoundingBoxDescent+i.fontBoundingBoxAscent):(n=-i.actualBoundingBoxAscent,a=i.actualBoundingBoxDescent+i.actualBoundingBoxAscent),{x:0,y:n,width:i.width,height:a}}fillText(e,i,n){return this.context2D.fillText(e,i,n),this}save(){return this.context2D.save(),this}restore(){return this.context2D.restore(),this}set fillStyle(e){this.context2D.fillStyle=e}get fillStyle(){return this.context2D.fillStyle}set strokeStyle(e){this.context2D.strokeStyle=e}get strokeStyle(){return this.context2D.strokeStyle}setFont(e,i,n,a){const o=W.validate(e,i,n,a);return this.context2D.font=W.toCSSString(o),this.textHeight=W.convertSizeToPixelValue(o.size),this}getFont(){return this.context2D.font}}function hi(...t){Y.DEBUG&&j("VexFlow.ChordSymbol",t)}class En extends p{constructor(e,i,n,a,o){super(),this.text=e,this.symbolModifier=i,this.xShift=n,this.yShift=a,this.vAlign=o}isSuperscript(){return this.symbolModifier===It.SUPERSCRIPT}isSubscript(){return this.symbolModifier===It.SUBSCRIPT}}var ct;(function(t){t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT",t[t.CENTER_STEM=4]="CENTER_STEM"})(ct||(ct={}));var kt;(function(t){t[t.TOP=1]="TOP",t[t.BOTTOM=2]="BOTTOM"})(kt||(kt={}));var It;(function(t){t[t.NONE=1]="NONE",t[t.SUBSCRIPT=2]="SUBSCRIPT",t[t.SUPERSCRIPT=3]="SUPERSCRIPT"})(It||(It={}));class Y extends v{static get CATEGORY(){return"ChordSymbol"}static get superSubRatio(){return F.get("ChordSymbol.superSubRatio")}static get spacingBetweenBlocks(){return F.get("ChordSymbol.spacing")}static get superscriptOffset(){return F.get("ChordSymbol.superscriptOffset")}static get subscriptOffset(){return F.get("ChordSymbol.subscriptOffset")}static get minPadding(){return F.get("NoteHead.minPadding")}static format(e,i){if(!e||e.length===0)return!1;let n=0,a=0,o=0,r=0,s=0;for(const d of e){const h=d.checkAttachedNote();let l=1;for(let g=0;g<d.symbolBlocks.length;++g){const f=d.symbolBlocks[g],S=f.isSuperscript(),x=f.isSubscript();if(f.setXShift(n),(S||x)&&(l=2),x&&g>0){const m=d.symbolBlocks[g-1];m.isSuperscript()&&(f.setXShift(n-m.getWidth()-Y.minPadding),f.vAlign=!0,n+=-m.getWidth()-Y.minPadding+(m.getWidth()>f.getWidth()?m.getWidth()-f.getWidth():0))}n+=f.getWidth()+Y.minPadding}if(d.getVertical()===kt.TOP?(d.setTextLine(i.topTextLine),i.topTextLine+=l):(d.setTextLine(i.textLine+1),i.textLine+=l+1),d.getReportWidth()){if(Fe(h)){const g=h.getGlyphWidth();d.getHorizontal()===ct.RIGHT?(r=Math.max(g,r),a=Math.max(a,n)+Y.minPadding):d.getHorizontal()===ct.LEFT?(s=Math.max(g,s),o=Math.max(o,n)):(a=Math.max(a,n/2)+Y.minPadding,o=Math.max(o,n/2),r=Math.max(g/2,r),s=Math.max(g/2,s))}d.width=n}n=0}const c=Math.min(Math.max(o-s,0),Math.max(o-i.rightShift,0)),u=Math.min(Math.max(a-r,0),Math.max(a-i.leftShift,0));return i.leftShift+=u,i.rightShift+=c,!0}constructor(){super(),this.symbolBlocks=[],this.horizontal=ct.LEFT,this.vertical=kt.TOP,this.reportWidth=!0}get superscriptOffset(){return Y.superscriptOffset*W.convertSizeToPixelValue(this.fontInfo.size)}get subscriptOffset(){return Y.subscriptOffset*W.convertSizeToPixelValue(this.fontInfo.size)}setReportWidth(e){return this.reportWidth=e,this}getReportWidth(){return this.reportWidth}getSymbolBlock(e={}){var i,n;const a=new En((i=e.text)!==null&&i!==void 0?i:"",(n=e.symbolModifier)!==null&&n!==void 0?n:It.NONE,0,0,!1);if(a.isSubscript()&&a.setYShift(this.subscriptOffset),a.isSuperscript()&&a.setYShift(this.superscriptOffset),a.isSubscript()||a.isSuperscript()){const{family:o,size:r,weight:s,style:c}=this.fontInfo,u=W.scaleSize(r,Y.superSubRatio);a.setFont(o,u,s,c)}else a.setFont(this.fontInfo);return a}addSymbolBlock(e){return this.symbolBlocks.push(this.getSymbolBlock(e)),this}addText(e,i={}){return this.addSymbolBlock(Object.assign(Object.assign({},i),{text:e}))}addTextSuperscript(e){const i=It.SUPERSCRIPT;return this.addSymbolBlock({text:e,symbolModifier:i})}addTextSubscript(e){const i=It.SUBSCRIPT;return this.addSymbolBlock({text:e,symbolModifier:i})}addGlyphSuperscript(e){return this.addTextSuperscript(Y.glyphs[e])}addGlyph(e,i={}){return this.addText(Y.glyphs[e],i)}addGlyphOrText(e,i={}){let n="";for(let a=0;a<e.length;++a){const o=e[a],r=Y.glyphs[o];r?n+=r:n+=o}return n.length>0&&this.addText(n,i),this}addLine(e={}){return this.addText("",e)}setVertical(e){return this.vertical=typeof e=="string"?Y.VerticalJustifyString[e]:e,this}getVertical(){return this.vertical}setHorizontal(e){return this.horizontal=typeof e=="string"?Y.HorizontalJustifyString[e]:e,this}getHorizontal(){return this.horizontal}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered(),e.openGroup("chordsymbol",this.getAttribute("id"));const n=i.getModifierStartXY(v.Position.ABOVE,this.index);e.setFont(this.fontInfo);let a;const o=i.hasStem(),r=i.checkStave();if(this.vertical===kt.BOTTOM){if(a=r.getYForBottomText(this.textLine+D.TEXT_HEIGHT_OFFSET_HACK),o){const c=i.checkStem().getExtents(),u=r.getSpacingBetweenLines(),d=i.getStemDirection()===1?c.baseY:c.topY;a=Math.max(a,d+u*(this.textLine+2))}}else{const c=Math.min(...i.getYs());if(a=Math.min(r.getYForTopText(this.textLine),c-10),o){const u=i.checkStem().getExtents(),d=r.getSpacingBetweenLines();a=Math.min(a,u.topY-5-d*this.textLine)}}let s=n.x;this.horizontal===ct.LEFT?s=n.x:this.horizontal===ct.RIGHT?s=n.x+this.getWidth():this.horizontal===ct.CENTER?s=n.x-this.getWidth()/2:s=i.getStemX()-this.getWidth()/2,hi("Rendering ChordSymbol: ",s,a),this.symbolBlocks.forEach(c=>{hi("Rendering Text: ",c.getText(),s+c.getXShift(),a+c.getYShift()),c.setX(s),c.setY(a),c.renderText(e,0,0)}),e.closeGroup()}getBoundingBox(){const e=this.symbolBlocks[0].getBoundingBox();for(let i=1;i<this.symbolBlocks.length;i++)e.mergeWith(this.symbolBlocks[i].getBoundingBox());return e}}Y.DEBUG=!1;Y.HorizontalJustify=ct;Y.HorizontalJustifyString={left:ct.LEFT,right:ct.RIGHT,center:ct.CENTER,centerStem:ct.CENTER_STEM};Y.VerticalJustify=kt;Y.VerticalJustifyString={top:kt.TOP,above:kt.TOP,below:kt.BOTTOM,bottom:kt.BOTTOM};Y.glyphs={diminished:E.csymDiminished,dim:E.csymDiminished,halfDiminished:E.csymHalfDiminished,"+":E.csymAugmented,augmented:E.csymAugmented,majorSeventh:E.csymMajorSeventh,minor:E.csymMinor,"-":E.csymMinor,"(":"(",leftParen:"(",")":")",rightParen:")",leftBracket:E.csymBracketLeftTall,rightBracket:E.csymBracketRightTall,leftParenTall:"(",rightParenTall:")","/":E.csymDiagonalArrangementSlash,over:E.csymDiagonalArrangementSlash,"#":E.csymAccidentalSharp,b:E.csymAccidentalFlat};Y.symbolModifiers=It;function gn(...t){ut.DEBUG&&j("VexFlow.Clef",t)}class ut extends Pt{static get CATEGORY(){return"Clef"}static get types(){const{gClef:e,fClef:i,cClef:n,unpitchedPercussionClef1:a,sixStringTabClef:o}=E;return{treble:{code:e,line:3},bass:{code:i,line:1},alto:{code:n,line:2},tenor:{code:n,line:1},percussion:{code:a,line:2},soprano:{code:n,line:4},"mezzo-soprano":{code:n,line:3},"baritone-c":{code:n,line:0},"baritone-f":{code:i,line:2},subbass:{code:i,line:0},french:{code:e,line:4},tab:{code:o,line:2.5}}}constructor(e,i,n){super(),this.code=ut.types.treble.code,this.line=ut.types.treble.line,this.size="default",this.type="treble",this.setPosition(O.BEGIN),this.setType(e,i,n),gn("Creating clef:",e)}setType(e,i="default",n){return this.type=e,this.code=ut.types[e].code,this.line=ut.types[e].line,this.size=i??"default",n==="8va"&&(this.code===E.gClef&&(this.code=E.gClef8va),this.code===E.fClef&&(this.code=E.fClef8va)),n==="8vb"&&(this.code===E.gClef&&(this.code=E.gClef8vb),this.code===E.fClef&&(this.code=E.fClef8vb)),this.text=this.code,this.fontInfo.size=Math.floor(ut.getPoint(this.size)),this}static getPoint(e){return e==="default"?F.get("fontSize"):F.get("fontSize")*2/3}setStave(e){return this.stave=e,this}draw(){const e=this.checkStave(),i=e.checkContext();this.setRendered(),i.openGroup("clef",this.getAttribute("id")),this.y=e.getYForLine(this.line),this.renderText(i,0,0),i.closeGroup()}}ut.DEBUG=!1;class Fi extends ${static get CATEGORY(){return"ClefNote"}constructor(e,i="default",n){super({duration:"b"}),this.setType(e,i,n),this.ignoreTicks=!0}setType(e,i,n){return this.clef=new ut(e,i,n),this.setWidth(this.clef.getWidth()),this}getClef(){return this.clef}preFormat(){return this.preFormatted=!0,this}draw(){const e=this.checkStave(),i=this.checkContext();this.setRendered(),this.clef.setX(this.getAbsoluteX()),this.clef.setY(e.getYForLine(this.clef.line)),this.clef.renderText(i,0,0)}getBoundingBox(){return this.clef.getBoundingBox()}}class le{static getNextContext(e){const i=e.tContexts,n=i.indexOf(e);if(n+1<i.length)return i[n+1]}constructor(e){var i;this.preFormatted=!1,this.postFormatted=!1,this.tickID=(i=e?.tickID)!==null&&i!==void 0?i:0,this.currentTick=new P(0,1),this.maxTicks=new P(0,1),this.maxTickable=void 0,this.minTicks=void 0,this.minTickable=void 0,this.padding=1,this.x=0,this.xBase=0,this.xOffset=0,this.tickables=[],this.tickablesByVoice={},this.notePx=0,this.glyphPx=0,this.leftDisplacedHeadPx=0,this.rightDisplacedHeadPx=0,this.modLeftPx=0,this.modRightPx=0,this.totalLeftPx=0,this.totalRightPx=0,this.tContexts=[],this.width=0,this.formatterMetrics={freedom:{left:0,right:0}}}getTickID(){return this.tickID}getX(){return this.x}setX(e){return this.x=e,this.xBase=e,this.xOffset=0,this}getXBase(){return this.xBase}setXBase(e){this.xBase=e,this.x=e+this.xOffset}getXOffset(){return this.xOffset}setXOffset(e){this.xOffset=e,this.x=this.xBase+e}getWidth(){return this.width+this.padding*2}setPadding(e){return this.padding=e,this}getMaxTicks(){return this.maxTicks}getMinTicks(){return this.minTicks}getMaxTickable(){return this.maxTickable}getMinTickable(){return this.minTickable}getTickables(){return this.tickables}getTickableForVoice(e){return this.tickablesByVoice[e]}getTickablesByVoice(){return this.tickablesByVoice}getCenterAlignedTickables(){return this.tickables.filter(e=>e.isCenterAligned())}getMetrics(){const{width:e,glyphPx:i,notePx:n,leftDisplacedHeadPx:a,rightDisplacedHeadPx:o,modLeftPx:r,modRightPx:s,totalLeftPx:c,totalRightPx:u}=this;return{width:e,glyphPx:i,notePx:n,leftDisplacedHeadPx:a,rightDisplacedHeadPx:o,modLeftPx:r,modRightPx:s,totalLeftPx:c,totalRightPx:u}}getCurrentTick(){return this.currentTick}setCurrentTick(e){this.currentTick=e,this.preFormatted=!1}addTickable(e,i){if(!e)throw new w("BadArgument","Invalid tickable added.");if(!e.shouldIgnoreTicks()){const n=e.getTicks();n.greaterThan(this.maxTicks)&&(this.maxTicks=n.clone(),this.maxTickable=e),this.minTicks===void 0?(this.minTicks=n.clone(),this.minTickable=e):n.lessThan(this.minTicks)&&(this.minTicks=n.clone(),this.minTickable=e)}return e.setTickContext(this),this.tickables.push(e),this.tickablesByVoice[i??0]=e,this.preFormatted=!1,this}preFormat(){var e;if(this.preFormatted)return this;for(let i=0;i<this.tickables.length;++i){const n=this.tickables[i];n.preFormat();const a=n.getMetrics();this.leftDisplacedHeadPx=Math.max(this.leftDisplacedHeadPx,a.leftDisplacedHeadPx),this.rightDisplacedHeadPx=Math.max(this.rightDisplacedHeadPx,a.rightDisplacedHeadPx),this.notePx=Math.max(this.notePx,a.notePx),this.glyphPx=Math.max(this.glyphPx,(e=a.glyphWidth)!==null&&e!==void 0?e:0),this.modLeftPx=Math.max(this.modLeftPx,a.modLeftPx),this.modRightPx=Math.max(this.modRightPx,a.modRightPx),this.totalLeftPx=Math.max(this.totalLeftPx,a.modLeftPx+a.leftDisplacedHeadPx),this.totalRightPx=Math.max(this.totalRightPx,a.modRightPx+a.rightDisplacedHeadPx),this.width=this.notePx+this.totalLeftPx+this.totalRightPx}return this}postFormat(){return this.postFormatted?this:(this.postFormatted=!0,this)}getFormatterMetrics(){return this.formatterMetrics}move(e,i,n){this.setX(this.getX()+e),this.getFormatterMetrics().freedom.left+=e,this.getFormatterMetrics().freedom.right-=e,i&&(i.getFormatterMetrics().freedom.right+=e),n&&(n.getFormatterMetrics().freedom.left-=e)}getDeviationCost(){return he(this.tickables.map(e=>e.getFormatterMetrics().space.deviation))}getAverageDeviationCost(){return this.tickables.length?this.getDeviationCost()/this.tickables.length:0}}function fn(...t){Ze.DEBUG&&j("VexFlow.Crescendo",t)}function mn(t,e){const i=e.beginX,n=e.endX,a=e.y,o=e.height/2;t.beginPath(),e.reverse?(t.moveTo(i,a-o),t.lineTo(n,a),t.lineTo(i,a+o)):(t.moveTo(n,a-o),t.lineTo(i,a),t.lineTo(n,a+o)),t.stroke(),t.closePath()}class Ze extends ${static get CATEGORY(){return"Crescendo"}constructor(e){var i;super(e),this.options={extendLeft:0,extendRight:0,yShift:0},this.decrescendo=!1,this.line=(i=e.line)!==null&&i!==void 0?i:0,this.height=15}setLine(e){return this.line=e,this}setHeight(e){return this.height=e,this}setDecrescendo(e){return this.decrescendo=e,this}preFormat(){return this.preFormatted=!0,this}draw(){const e=this.checkContext(),i=this.checkStave();this.setRendered();const n=this.getTickContext(),a=le.getNextContext(n),o=this.getAbsoluteX(),r=a?a.getX():i.getX()+i.getWidth(),s=i.getYForLine(this.line+-3)+1;fn("Drawing ",this.decrescendo?"decrescendo ":"crescendo ",this.height,"x",o-r),mn(e,{beginX:o-this.options.extendLeft,endX:r+this.options.extendRight,y:s+this.options.yShift,height:this.height,reverse:this.decrescendo})}}Ze.DEBUG=!1;var wt;(function(t){t[t.NEAR_HEAD=1]="NEAR_HEAD",t[t.NEAR_TOP=2]="NEAR_TOP"})(wt||(wt={}));class pe extends p{static get CATEGORY(){return"Curve"}static get Position(){return wt}static get PositionString(){return{nearHead:wt.NEAR_HEAD,nearTop:wt.NEAR_TOP}}constructor(e,i,n){super(),this.renderOptions=Object.assign({thickness:2,xShift:0,yShift:10,position:wt.NEAR_HEAD,positionEnd:wt.NEAR_HEAD,invert:!1,cps:[{x:0,y:10},{x:0,y:10}],openingDirection:"auto"},n),this.setNotes(e,i)}setNotes(e,i){if(!e&&!i)throw new w("BadArguments","Curve needs to have either `from` or `to` set.");return this.from=e,this.to=i,this}isPartial(){return!this.from||!this.to}renderCurve(e){var i,n;const a=this.checkContext(),o=this.renderOptions.xShift,r=this.renderOptions.yShift*e.direction,s=e.firstX+o,c=e.firstY+r,u=e.lastX-o,d=e.lastY+r,h=this.renderOptions.thickness,l=this.renderOptions.cps,{x:g,y:f}=l[0],{x:S,y:x}=l[1],m=(u-s)/(l.length+2);a.beginPath(),a.moveTo(s,c),a.bezierCurveTo(s+m+g,c+f*e.direction,u-m+S,d+x*e.direction,u,d),!((i=this.style)===null||i===void 0)&&i.lineDash||a.bezierCurveTo(u-m+S,d+(x+h)*e.direction,s+m+g,c+(f+h)*e.direction,s,c),a.stroke(),a.closePath(),!((n=this.style)===null||n===void 0)&&n.lineDash||a.fill()}draw(){this.checkContext(),this.setRendered();const e=this.from,i=this.to;let n,a,o,r,s=0,c="baseY",u="baseY";function d(g){return typeof g=="string"?pe.PositionString[g]:g}const h=d(this.renderOptions.position),l=d(this.renderOptions.positionEnd);return h===wt.NEAR_TOP&&(c="topY",u="topY"),l===wt.NEAR_HEAD?u="baseY":l===wt.NEAR_TOP&&(u="topY"),e?(n=e.getTieRightX(),s=e.getStemDirection(),o=e.getStemExtents()[c]):(n=i.checkStave().getTieStartX(),o=i.getStemExtents()[c]),i?(a=i.getTieLeftX(),s=i.getStemDirection(),r=i.getStemExtents()[u]):(a=e.checkStave().getTieEndX(),r=e.getStemExtents()[u]),this.renderOptions.openingDirection==="up"&&(s=1),this.renderOptions.openingDirection==="down"&&(s=-1),this.renderCurve({firstX:n,lastX:a,firstY:o,lastY:r,direction:s*(this.renderOptions.invert===!0?-1:1)}),!0}}class Xt extends v{static get CATEGORY(){return"Dot"}static getDots(e){return e.getModifiersByType(Xt.CATEGORY)}static buildAndAttach(e,i){for(const n of e)if(i?.all)for(let a=0;a<n.keys.length;a++){const o=new Xt;n.addModifier(o,a)}else if(i?.index!==void 0){const a=new Xt;n.addModifier(a,i?.index)}else{const a=new Xt;n.addModifier(a,0)}}static format(e,i){const n=i.rightShift,a=1;if(!e||e.length===0)return!1;const o=[],r={};for(let g=0;g<e.length;++g){const f=e[g],S=f.getNote();let x,m;if(Ot(S)){const B=f.checkIndex();x=S.getKeyProps()[B],m=S.getFirstDotPx()}else if(St(S))x={line:.5},m=n;else throw new w("Internal","Unexpected instance.");const T=S.getAttribute("id");o.push({line:x.line,note:S,noteId:T,dot:f}),r[T]=Math.max(r[T]||m,m)}o.sort((g,f)=>f.line-g.line);let s=n,c=0,u=null,d=null,h=null,l=0;for(let g=0;g<o.length;++g){const{dot:f,note:S,noteId:x,line:m}=o[g];(m!==u||S!==d)&&(s=r[x]),!S.isRest()&&m!==u&&(Math.abs(m%1)===.5?l=0:(l=.5,(d!==null&&!d.isRest()&&u!==null&&u-m===.5||m+l===h)&&(l=-.5))),S.isRest()?f.dotShiftY+=-l:f.dotShiftY=-l,h=m+l,f.setXShift(s),s+=f.getWidth()+a,c=s>c?s:c,u=m,d=S}return i.rightShift+=c,!0}constructor(){super(),this.position=v.Position.RIGHT,this.setText(E.augmentationDot),this.dotShiftY=0}setNote(e){return this.note=e,this.font=e.font,this}setDotShiftY(e){return this.dotShiftY=e,this}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const a=i.checkStave().getSpacingBetweenLines(),o=i.getModifierStartXY(this.position,this.index,{forceFlagRight:!0});St(i)&&(o.y=i.getStemExtents().baseY),this.x=o.x,this.y=o.y+this.dotShiftY*a,this.renderText(e,0,0)}}class Ne extends v{static get CATEGORY(){return"FretHandFinger"}static format(e,i){const{leftShift:n,rightShift:a}=i,o=1;if(!e||e.length===0)return!1;const r=[];let s=null,c=0,u=0;for(let x=0;x<e.length;++x){const m=e[x],T=m.getNote(),B=m.getPosition(),C=m.checkIndex(),A=T.getKeyProps()[C],L=F.get("FretHandFinger.fontSize");if(m.position===U.ABOVE&&(i.topTextLine+=L/D.STAVE_LINE_DISTANCE+.5),m.position===U.BELOW&&(i.textLine+=L/D.STAVE_LINE_DISTANCE+.5),T!==s){for(let N=0;N<T.keys.length;++N)n===0&&(c=Math.max(T.getLeftDisplacedHeadPx(),c)),a===0&&(u=Math.max(T.getRightDisplacedHeadPx(),u));s=T}r.push({note:T,num:m,pos:B,line:A.line,shiftL:c,shiftR:u})}r.sort((x,m)=>m.line-x.line);let d=0,h=0,l=0,g=0,f=null,S=null;for(let x=0;x<r.length;++x){let m=0;const{note:T,pos:B,num:C,line:A,shiftL:L,shiftR:N}=r[x];(A!==f||T!==S)&&(d=n+L,h=a+N);const M=C.getWidth()+o;B===v.Position.LEFT?(C.setXShift(n+d),m=n+M,l=m>l?m:l):B===v.Position.RIGHT&&(C.setXShift(h),m=u+M,g=m>g?m:g),f=A,S=T}return i.leftShift+=l,i.rightShift+=g,!0}static easyScoreHook({fingerings:e}={},i,n){e?.split(",").map(a=>{const o=a.trim().split("."),r={number:o[0]};return o[1]&&(r.position=o[1]),n.getFactory().Fingering(r)}).map((a,o)=>i.addModifier(a,o))}constructor(e){super(),this.setFretHandFinger(e),this.position=v.Position.LEFT,this.xOffset=0,this.yOffset=0}setFretHandFinger(e){return this.text=e,this}getFretHandFinger(){return this.text}setOffsetX(e){return this.xOffset=e,this}setOffsetY(e){return this.yOffset=e,this}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const n=i.getModifierStartXY(this.position,this.index);let a=n.x+this.xOffset,o=n.y+this.yOffset+5;switch(this.position){case v.Position.ABOVE:a-=4,o-=12;break;case v.Position.BELOW:a-=2,o+=10;break;case v.Position.LEFT:a-=this.width;break;case v.Position.RIGHT:a+=1;break;default:throw new w("InvalidPosition",`The position ${this.position} does not exist`)}this.renderText(e,a,o)}}function li(...t){Oe.DEBUG&&j("VexFlow.Parser",t)}const we=-1;function be(t){if("matchedString"in t)return t.matchedString;if("results"in t)return be(t.results);const e=t;return e.length===1?be(e[0]):e.length===0?null:e.map(be)}class Oe{constructor(e){this.grammar=e,this.line="",this.pos=0,this.errorPos=we}parse(e){this.line=e,this.pos=0,this.errorPos=we;const i=this.expect(this.grammar.begin());return i.errorPos=this.errorPos,i}matchFail(e){this.errorPos===we&&(this.errorPos=this.pos),this.pos=e}matchSuccess(){this.errorPos=we}matchToken(e,i=!1){const n=i?new RegExp("^(("+e+"))"):new RegExp("^(("+e+")\\s*)"),o=this.line.slice(this.pos).match(n);return o!==null?{success:!0,matchedString:o[2],incrementPos:o[1].length,pos:this.pos}:{success:!1,pos:this.pos}}expectOne(e,i=!1){const n=[],a=this.pos;let o=!0,r=!1;if(i=i===!0||e.maybe===!0,e.expect)for(const d of e.expect){const h=this.pos,l=this.expect(d);if(l.success){if(n.push(l),r=!0,e.or)break}else if(o=!1,!e.or){this.pos=h;break}}const s=e.or&&r||o,c=s||i===!0,u=s?1:0;return i&&!s&&(this.pos=a),c?this.matchSuccess():this.matchFail(a),{success:c,results:n,numMatches:u}}expectOneOrMore(e,i=!1){const n=[],a=this.pos;let o=0,r=!0;do{const c=this.expectOne(e);c.success&&c.results?(o++,n.push(c.results)):r=!1}while(r);const s=o>0||i===!0;return i&&!(o>0)&&(this.pos=a),s?this.matchSuccess():this.matchFail(a),{success:s,results:n,numMatches:o}}expectZeroOrMore(e){return this.expectOneOrMore(e,!0)}expect(e){if(li("Evaluating rule function:",e),!e)throw new w("Invalid rule function");let i;const n=e.bind(this.grammar)();if(n.token)i=this.matchToken(n.token,n.noSpace===!0),i.success&&(this.pos+=i.incrementPos);else if(n.expect)n.oneOrMore?i=this.expectOneOrMore(n):n.zeroOrMore?i=this.expectZeroOrMore(n):i=this.expectOne(n);else throw li(n),new w("Bad grammar! No `token` or `expect` property "+n);const a=[];return i.matches=a,i.results&&i.results.forEach(o=>a.push(be(o))),n.run&&i.success&&n.run({matches:a}),i}}Oe.DEBUG=!1;function xt(...t){Re.DEBUG&&j("VexFlow.EasyScore",t)}class Sn{constructor(e){this.builder=e}begin(){return this.LINE}LINE(){return{expect:[this.PIECE,this.PIECES,this.EOL]}}PIECE(){return{expect:[this.CHORDORNOTE,this.PARAMS],run:()=>this.builder.commitPiece()}}PIECES(){return{expect:[this.COMMA,this.PIECE],zeroOrMore:!0}}PARAMS(){return{expect:[this.DURATION,this.TYPE,this.DOTS,this.OPTS]}}CHORDORNOTE(){return{expect:[this.CHORD,this.SINGLENOTE],or:!0}}CHORD(){return{expect:[this.LPAREN,this.NOTES,this.RPAREN],run:e=>this.builder.addChord(e.matches[1])}}NOTES(){return{expect:[this.NOTE],oneOrMore:!0}}NOTE(){return{expect:[this.NOTENAME,this.ACCIDENTAL,this.OCTAVE]}}SINGLENOTE(){return{expect:[this.NOTENAME,this.ACCIDENTAL,this.OCTAVE],run:e=>{const i=e;this.builder.addSingleNote(i.matches[0],i.matches[1],i.matches[2])}}}ACCIDENTAL(){return{expect:[this.MICROTONES,this.ACCIDENTALS],maybe:!0,or:!0}}DOTS(){return{expect:[this.DOT],zeroOrMore:!0,run:e=>this.builder.setNoteDots(e.matches)}}TYPE(){return{expect:[this.SLASH,this.MAYBESLASH,this.TYPES],maybe:!0,run:e=>this.builder.setNoteType(e.matches[2])}}DURATION(){return{expect:[this.SLASH,this.DURATIONS],maybe:!0,run:e=>this.builder.setNoteDuration(e.matches[1])}}OPTS(){return{expect:[this.LBRACKET,this.KEYVAL,this.KEYVALS,this.RBRACKET],maybe:!0}}KEYVALS(){return{expect:[this.COMMA,this.KEYVAL],zeroOrMore:!0}}KEYVAL(){const e=i=>i.slice(1,-1);return{expect:[this.KEY,this.EQUALS,this.VAL],run:i=>this.builder.addNoteOption(i.matches[0],e(i.matches[2]))}}VAL(){return{expect:[this.SVAL,this.DVAL],or:!0}}KEY(){return{token:"[a-zA-Z][a-zA-Z0-9]*"}}DVAL(){return{token:'["][^"]*["]'}}SVAL(){return{token:"['][^']*[']"}}NOTENAME(){return{token:"[a-gA-G]"}}OCTAVE(){return{token:"[0-9]+"}}ACCIDENTALS(){return{token:"bb|b|##|#|n"}}MICROTONES(){return{token:"bbs|bss|bs|db|d|\\+\\+-|\\+-|\\+\\+|\\+|k|o"}}DURATIONS(){return{token:"[0-9whq]+"}}TYPES(){return{token:"[rRsSmMhHgG]"}}LPAREN(){return{token:"[(]"}}RPAREN(){return{token:"[)]"}}COMMA(){return{token:"[,]"}}DOT(){return{token:"[.]"}}SLASH(){return{token:"[/]"}}MAYBESLASH(){return{token:"[/]?"}}EQUALS(){return{token:"[=]"}}LBRACKET(){return{token:"\\["}}RBRACKET(){return{token:"\\]"}}EOL(){return{token:"$"}}}class Tn{constructor(e){this.chord=[],this.dots=0,this.options={},this.duration=e}}class xn{constructor(e){this.commitHooks=[],this.factory=e,this.reset()}reset(e){this.options=Object.assign({stem:"auto",clef:"treble"},e),this.elements={notes:[],accidentals:[]},this.rollingDuration="8",this.resetPiece()}getFactory(){return this.factory}getElements(){return this.elements}addCommitHook(e){this.commitHooks.push(e)}resetPiece(){xt("resetPiece"),this.piece=new Tn(this.rollingDuration)}setNoteDots(e){xt("setNoteDots:",e),e&&(this.piece.dots=e.length)}setNoteDuration(e){xt("setNoteDuration:",e),this.rollingDuration=this.piece.duration=e||this.rollingDuration}setNoteType(e){xt("setNoteType:",e),e&&(this.piece.type=e)}addNoteOption(e,i){xt("addNoteOption: key:",e,"value:",i),this.piece.options[e]=i}addNote(e,i,n){xt("addNote:",e,i,n),this.piece.chord.push({key:e,accid:i,octave:n})}addSingleNote(e,i,n){xt("addSingleNote:",e,i,n),this.addNote(e,i,n)}addChord(e){xt("startChord"),typeof e[0]!="object"?this.addSingleNote(e[0]):e.forEach(i=>{i&&this.addNote(...i)}),xt("endChord")}commitPiece(){xt("commitPiece");const{factory:e}=this;if(!e)return;const i=Object.assign(Object.assign({},this.options),this.piece.options),n=_(i.stem,"BadArguments","options.stem is not defined").toLowerCase(),a=_(i.clef,"BadArguments","options.clef is not defined").toLowerCase(),{chord:o,duration:r,dots:s,type:c}=this.piece,u=H.accidentals,d=o.map(f=>{var S;return f.key+(u.includes((S=f.accid)!==null&&S!==void 0?S:"")?f.accid:"")+"/"+f.octave}),h=n==="auto",l=c?.toLowerCase()==="g"?e.GhostNote({duration:r,dots:s}):e.StaveNote({keys:d,duration:r,dots:s,type:c,clef:a,autoStem:h});h||l.setStemDirection(n==="up"?k.UP:k.DOWN);const g=[];o.forEach((f,S)=>{const x=f.accid;if(typeof x=="string"){const m=e.Accidental({type:x});l.addModifier(m,S),g.push(m)}else g.push(void 0)});for(let f=0;f<s;f++)Xt.buildAndAttach([l],{all:!0});this.commitHooks.forEach(f=>f(i,l,this)),this.elements.notes.push(l),this.elements.accidentals.push(g),this.resetPiece()}}function Cn(t,e){t.id!==void 0&&e.setAttribute("id",t.id)}const wn=/\s*,\s*/;function Dn(t,e){t.class!==void 0&&t.class.split(wn).forEach(i=>e.addClass(i))}class Re{constructor(e={}){this.defaults={clef:"treble",time:"4/4",stem:"auto"},this.setOptions(e)}set(e){return this.defaults=Object.assign(Object.assign({},this.defaults),e),this}setOptions(e){var i,n;const a=e.factory,o=(i=e.builder)!==null&&i!==void 0?i:new xn(a);return this.options=Object.assign(Object.assign({commitHooks:[Cn,Dn,Rt.easyScoreHook,Ne.easyScoreHook],throwOnError:!1},e),{factory:a,builder:o}),this.factory=a,this.builder=o,this.grammar=new Sn(this.builder),this.parser=new Oe(this.grammar),(n=this.options.commitHooks)===null||n===void 0||n.forEach(r=>this.addCommitHook(r)),this}setContext(e){return this.factory.setContext(e),this}parse(e,i={}){this.builder.reset(i);const n=this.parser.parse(e);if(!n.success&&this.options.throwOnError)throw xt(n),new w("Error parsing line: "+e);return n}beam(e,i){return this.factory.Beam({notes:e,options:i}),e}tuplet(e,i){return this.factory.Tuplet({notes:e,options:i}),e}notes(e,i={}){return i=Object.assign({clef:this.defaults.clef,stem:this.defaults.stem},i),this.parse(e,i),this.builder.getElements().notes}voice(e,i={}){return i=Object.assign({time:this.defaults.time},i),this.factory.Voice(i).addTickables(e)}addCommitHook(e){this.builder.addCommitHook(e)}}Re.DEBUG=!1;function Bn(...t){Pe.DEBUG&&j("VexFlow.NoteHead",t)}class Pe extends ${static get CATEGORY(){return"NoteHead"}constructor(e){var i;super(e),this.customGlyph=!1,this.ledger={"":"","":""},this.index=e.index,this.x=e.x||0,this.y=e.y||0,e.noteType&&(this.noteType=e.noteType),this.displaced=e.displaced||!1,this.stemDirection=e.stemDirection||k.UP,this.line=e.line||0,this.glyphProps=$.getGlyphProps(this.duration,this.noteType),_(this.glyphProps,"BadArguments",`No glyph found for duration '${this.duration}' and type '${this.noteType}'`),(this.line>5||this.line<0)&&this.ledger[this.glyphProps.codeHead]&&(this.glyphProps.codeHead=this.ledger[this.glyphProps.codeHead]),this.text=this.glyphProps.codeHead,e.customGlyphCode&&(this.customGlyph=!0,this.text=e.customGlyphCode),this.setStyle((i=e.style)!==null&&i!==void 0?i:{}),this.slashed=e.slashed||!1,this.renderOptions=Object.assign({},this.renderOptions)}getWidth(){return this.width}isDisplaced(){return this.displaced===!0}getLine(){return this.line}setLine(e){return this.line=e,this}getAbsoluteX(){const e=this.preFormatted?super.getAbsoluteX():this.x,i=k.WIDTH/2;return e+(this.displaced?(this.width-i)*this.stemDirection:0)}setStave(e){const i=this.getLine();return this.stave=e,this.stave&&(this.setY(this.stave.getYForNote(i)),this.setContext(this.stave.getContext())),this}preFormat(){return this.preFormatted?this:(this.preFormatted=!0,this)}draw(){var e;const i=this.checkContext();this.setRendered(),i.openGroup("notehead",this.getAttribute("id")),Bn("Drawing note head '",this.noteType,this.duration,"' at",this.x,this.y),this.x=this.getAbsoluteX(),this.renderText(i,0,0),(e=this.parent)===null||e===void 0||e.drawModifiers(this),i.closeGroup()}}Pe.DEBUG=!1;function bn(...t){ye.DEBUG&&j("VexFlow.Flag",t)}class ye extends p{static get CATEGORY(){return"Flag"}draw(){const e=this.checkContext();this.setRendered(),e.openGroup("flag",this.getAttribute("id")),bn("Drawing flag '",this.text,"' at",this.x,this.y),this.renderText(e,0,0),e.closeGroup()}}ye.DEBUG=!1;class Ge extends ${static get CATEGORY(){return"StemmableNote"}constructor(e){super(e),this.flag=new ye}getStem(){return this.stem}checkStem(){if(!this.stem)throw new w("NoStem","No stem attached to instance");return this.stem}setStem(e){return this.stem=e,this.addChild(e),this}buildStem(){const e=new k;return this.setStem(e),this}buildFlag(){var e,i,n;const{glyphProps:a}=this;if(this.hasFlag()){const o=this.getStemDirection()===k.DOWN?String.fromCodePoint(((i=(e=a.codeFlagUp)===null||e===void 0?void 0:e.codePointAt(0))!==null&&i!==void 0?i:-1)+1):(n=a.codeFlagUp)!==null&&n!==void 0?n:E.null;this.flag.setText(o),this.flag.fontInfo=this.fontInfo}}getBaseCustomNoteHeadGlyphProps(){return this.getStemDirection()===k.DOWN?this.customGlyphs[this.customGlyphs.length-1]:this.customGlyphs[0]}getStemLength(){return k.HEIGHT+this.getStemExtension()}getBeamCount(){const e=this.getGlyphProps();return e?e.beamCount:0}getStemMinimumLength(){const e=D.durationToFraction(this.duration),i=this.beam===void 0;let n=e.value()<=1?0:20;switch(this.duration){case"8":case"16":n=i?35:25;break;case"32":n=i?45:35;break;case"64":n=i?50:40;break;case"128":n=i?55:45;break}return n}getStemDirection(){if(!this.stemDirection)throw new w("NoStem","No stem attached to this note.");return this.stemDirection}setStemDirection(e){if(e||(e=k.UP),e!==k.UP&&e!==k.DOWN)throw new w("BadArgument",`Invalid stem direction: ${e}`);return this.stemDirection=e,this.reset(),this.hasFlag()&&this.buildFlag(),this.beam=void 0,this.stem&&(this.stem.setDirection(e),this.stem.setExtension(this.getStemExtension())),this.preFormatted&&this.preFormat(),this}getStemX(){const e=this.getAbsoluteX()+this.xShift,i=this.getAbsoluteX()+this.xShift+this.getGlyphWidth();return this.stemDirection===k.DOWN?e:i}getCenterGlyphX(){return this.getAbsoluteX()+this.xShift+this.getGlyphWidth()/2}getStemExtension(){const e=this.getGlyphProps(),i=this.flag.getHeight(),n=this.getFontScale();return this.stemExtensionOverride!==void 0?this.stemExtensionOverride:this.beam?e.stemBeamExtension*n:i>k.HEIGHT*n?i-k.HEIGHT*n:0}setStemLength(e){return this.stemExtensionOverride=e-k.HEIGHT,this}getStemExtents(){if(!this.stem)throw new w("NoStem","No stem attached to this note.");return this.stem.getExtents()}getYForTopText(e){const i=this.checkStave();if(this.hasStem()){const n=this.getStemExtents();if(!n)throw new w("InvalidState","Stem does not have extents.");return Math.min(i.getYForTopText(e),n.topY-this.renderOptions.annotationSpacing*(e+1))}else return i.getYForTopText(e)}getYForBottomText(e){const i=this.checkStave();if(this.hasStem()){const n=this.getStemExtents();if(!n)throw new w("InvalidState","Stem does not have extents.");return Math.max(i.getYForTopText(e),n.baseY+this.renderOptions.annotationSpacing*e)}else return i.getYForBottomText(e)}hasFlag(){return this.glyphProps.codeFlagUp!==void 0&&!this.beam&&!this.isRest()}postFormat(){var e;return(e=this.beam)===null||e===void 0||e.postFormat(),this.postFormatted=!0,this}drawStem(e){var i;this.checkContext(),this.setRendered(),this.setStem(new k(e)),(i=this.stem)===null||i===void 0||i.setContext(this.getContext()).drawWithStyle()}}function An(...t){Tt.DEBUG&&j("VexFlow.StaveNote",t)}const kn=(t,e)=>e===(t.getStemDirection()===k.UP?t.keyProps.length-1:0);function De(t,e,i){const n=i;t.line+=n,t.maxLine+=n,t.minLine+=n,t.note.setKeyLine(0,t.note.getKeyLine(0)+n)}function Ln(t,e,i){const n=t.line-qe(e.minLine,i.maxLine);t.note.setKeyLine(0,t.note.getKeyLine(0)-n),t.line-=n,t.maxLine-=n,t.minLine-=n}class Tt extends Ge{static get CATEGORY(){return"StaveNote"}static get LEDGER_LINE_OFFSET(){return 3}static get minNoteheadPadding(){return F.get("NoteHead.minPadding")}static format(e,i){if(!e||e.length<2)return!1;const n=[];for(let h=0;h<e.length;h++){const l=e[h].sortedKeyProps,g=l[0].keyProps.line;let f=l[l.length-1].keyProps.line;const S=e[h].getStemDirection(),x=e[h].getStemLength()/10,m=e[h].getStemMinimumLength()/10;let T;e[h].isRest()?(T=g+Math.ceil(e[h]._noteHeads[0].getTextMetrics().actualBoundingBoxAscent/D.STAVE_LINE_DISTANCE),f=g-Math.ceil(e[h]._noteHeads[0].getTextMetrics().actualBoundingBoxDescent/D.STAVE_LINE_DISTANCE)):(T=S===1?l[l.length-1].keyProps.line+x:l[l.length-1].keyProps.line,f=S===1?l[0].keyProps.line:l[0].keyProps.line-x),n.push({line:l[0].keyProps.line,maxLine:T,minLine:f,isrest:e[h].isRest(),stemDirection:S,stemMax:x,stemMin:m,voiceShift:e[h].getVoiceShiftWidth(),isDisplaced:e[h].isDisplaced(),note:e[h]})}let a=0,o,r,s;const c=[!1,!1,!1];for(let h=0;h<n.length;h++)c[h]=n[h].note.renderOptions.draw!==!1;if(c[0]&&c[1]&&c[2])a=3,o=n[0],r=n[1],s=n[2];else if(c[0]&&c[1])a=2,o=n[0],s=n[1];else if(c[0]&&c[2])a=2,o=n[0],s=n[2];else if(c[1]&&c[2])a=2,o=n[1],s=n[2];else return!0;a===2&&o.stemDirection===-1&&s.stemDirection===1&&(o=n[1],s=n[0]);const u=Math.max(o.voiceShift,s.voiceShift);let d=0;if(a===2){const h=o.note.hasStem()&&s.note.hasStem()&&o.stemDirection===s.stemDirection?0:.5;if(s.isrest&&o.isrest&&o.note.duration===s.note.duration)s.note.renderOptions.draw=!1;else if(o.minLine<=s.maxLine+h)if(o.isrest)De(o,s,1);else if(s.isrest)De(s,o,-1);else{const l=Math.abs(o.line-s.line);if(o.note.hasStem()&&s.note.hasStem()){const g=o.note.sortedKeyProps[0].keyProps.code,f=s.note.sortedKeyProps[s.note.sortedKeyProps.length-1].keyProps.code;!D.UNISON||g!==f||o.note.getModifiers().filter(S=>S.getCategory()==="Dot"&&S.getIndex()===0).length!==s.note.getModifiers().filter(S=>S.getCategory()==="Dot"&&S.getIndex()===0).length||l<1&&l>0||JSON.stringify(o.note.getStyle())!==JSON.stringify(s.note.getStyle())?(d=u+2,o.stemDirection===s.stemDirection?o.note.setXShift(d):s.note.setXShift(d)):o.note.voice!==s.note.voice&&o.stemDirection===s.stemDirection&&(o.line!==s.line?(d=u+2,o.note.setXShift(d)):s.stemDirection===1&&(s.stemDirection=-1,s.note.setStemDirection(-1)))}else l<1?(d=u+2,o.note.duration<s.note.duration?o.note.setXShift(d):s.note.setXShift(d)):o.note.hasStem()?(o.stemDirection=-o.note.getStemDirection(),o.note.setStemDirection(o.stemDirection)):s.note.hasStem()&&(s.stemDirection=-s.note.getStemDirection(),s.note.setStemDirection(s.stemDirection))}return i.rightShift+=d,!0}if(!r)throw new w("InvalidState","noteM not defined.");if(r.isrest&&!o.isrest&&!s.isrest&&(o.minLine<=r.maxLine||r.minLine<=s.maxLine)){const h=r.maxLine-r.minLine,l=o.minLine-s.maxLine;return h<l?Ln(r,o,s):(d=u+2,r.note.setXShift(d),s.note.hasBeam()===!1&&(s.stemDirection=-1,s.note.setStemDirection(-1)),o.minLine<=s.maxLine&&o.note.hasBeam()===!1&&(o.stemDirection=1,o.note.setStemDirection(1))),i.rightShift+=d,!0}return o.isrest&&r.isrest&&s.isrest?(o.note.renderOptions.draw=!1,s.note.renderOptions.draw=!1,i.rightShift+=d,!0):(r.isrest&&o.isrest&&r.minLine<=s.maxLine&&(r.note.renderOptions.draw=!1),r.isrest&&s.isrest&&o.minLine<=r.maxLine&&(r.note.renderOptions.draw=!1),o.isrest&&o.minLine<=r.maxLine&&De(o,r,1),s.isrest&&r.minLine<=s.maxLine&&De(s,r,-1),(o.minLine<=r.maxLine+.5||r.minLine<=s.maxLine)&&(d=u+2,r.note.setXShift(d),s.note.hasBeam()===!1&&(s.stemDirection=-1,s.note.setStemDirection(-1)),o.minLine<=s.maxLine&&o.note.hasBeam()===!1&&(o.stemDirection=1,o.note.setStemDirection(1))),i.rightShift+=d,!0)}static postFormat(e){return e?(e.forEach(i=>i.postFormat()),!0):!1}constructor(e){var i,n,a;super(e),this.minLine=0,this.maxLine=0,this.sortedKeyProps=[],this.ledgerLineStyle={},this.clef=(i=e.clef)!==null&&i!==void 0?i:"treble",this.octaveShift=(n=e.octaveShift)!==null&&n!==void 0?n:0,this.glyphProps=$.getGlyphProps(this.duration,this.noteType),_(this.glyphProps,"BadArguments",`No glyph found for duration '${this.duration}' and type '${this.noteType}'`),this.displaced=!1,this.dotShiftY=0,this.useDefaultHeadX=!1,this._noteHeads=[],this.modifiers=[],this.renderOptions=Object.assign(Object.assign({},this.renderOptions),{strokePx:e.strokePx||Tt.LEDGER_LINE_OFFSET}),this.calculateKeyProps(),this.buildStem(),e.autoStem?this.autoStem():this.setStemDirection((a=e.stemDirection)!==null&&a!==void 0?a:k.UP),this.reset(),this.buildFlag()}reset(){super.reset();const e=this._noteHeads.map(n=>n.getStyle());this.buildNoteHeads(),this._noteHeads.forEach((n,a)=>{const o=e[a];o&&n.setStyle(o)});const i=this.stave;return i&&this.setStave(i),this.calcNoteDisplacements(),this}setBeam(e){return this.beam=e,this.calcNoteDisplacements(),this.stem&&this.stem.setExtension(this.getStemExtension()),this}buildStem(){return this.setStem(new k({hide:this.isRest()})),this}buildNoteHeads(){this._noteHeads=[];const e=this.getStemDirection(),i=this.getKeys();let n,a,o=!1,r,s,c;e===k.UP?(r=0,s=i.length,c=1):(r=i.length-1,s=-1,c=-1);for(let u=r;u!==s;u+=c){const d=this.sortedKeyProps[u].keyProps,h=d.line;n===void 0?n=h:(a=Math.abs(n-h),a===0||a===.5?o=!o:(o=!1,this.useDefaultHeadX=!0)),n=h;const l=new Pe({duration:this.duration,noteType:this.noteType,displaced:o,stemDirection:e,customGlyphCode:d.code,line:d.line});l.fontInfo=this.fontInfo,this.addChild(l),this._noteHeads[this.sortedKeyProps[u].index]=l}return this._noteHeads}autoStem(){this.setStemDirection(this.calculateOptimalStemDirection())}calculateOptimalStemDirection(){return this.minLine=this.sortedKeyProps[0].keyProps.line,this.maxLine=this.sortedKeyProps[this.keyProps.length-1].keyProps.line,(this.minLine+this.maxLine)/2<3?k.UP:k.DOWN}calculateKeyProps(){var e;let i;for(let n=0;n<this.keys.length;++n){const a=this.keys[n],o={octaveShift:(e=this.octaveShift)!==null&&e!==void 0?e:0,duration:this.duration},r=D.keyProperties(a,this.clef,this.noteType,o);if(!r)throw new w("BadArguments",`Invalid key for note properties: ${a}`);r.key==="R"&&(this.duration==="1"||this.duration==="w"?r.line=4:r.line=3);const s=r.line;i===void 0?i=s:Math.abs(i-s)<1&&(this.displaced=!0,r.displaced=!0,this.keyProps.length>0&&(this.keyProps[n-1].displaced=!0)),i=s,this.keyProps.push(r)}this.keyProps.forEach((n,a)=>{this.sortedKeyProps.push({keyProps:n,index:a})}),this.sortedKeyProps.sort((n,a)=>n.keyProps.line-a.keyProps.line)}getBoundingBox(){const e=new Nt(this.getAbsoluteX(),this.ys[0],0,0);this._noteHeads.forEach(a=>{e.mergeWith(a.getBoundingBox())});const{yTop:i,yBottom:n}=this.getNoteHeadBounds();if(!this.isRest()&&this.hasStem()){const a=this.stem.getHeight(),o=this.getStemDirection()===k.DOWN?i-a-this.flag.getTextMetrics().actualBoundingBoxDescent:n-a+this.flag.getTextMetrics().actualBoundingBoxAscent;e.mergeWith(new Nt(this.getAbsoluteX(),o,0,0))}if(this.hasFlag()){const a=this.flag.getBoundingBox();e.mergeWith(a)}for(let a=0;a<this.modifiers.length;a++)e.mergeWith(this.modifiers[a].getBoundingBox());return e}getLineNumber(e){if(!this.keyProps.length)throw new w("NoKeyProps","Can't get bottom note line, because note is not initialized properly.");let i=this.keyProps[0].line;for(let n=0;n<this.keyProps.length;n++){const a=this.keyProps[n].line;e?a>i&&(i=a):a<i&&(i=a)}return i}isRest(){const e=this.glyphProps.codeHead;return e>=""&&e<=""}isChord(){return!this.isRest()&&this.keys.length>1}hasStem(){return this.glyphProps.stem}hasFlag(){return super.hasFlag()&&!this.isRest()}getStemX(){return this.noteType==="r"?this.getCenterGlyphX():super.getStemX()+(this.stemDirection?k.WIDTH/(2*-this.stemDirection):0)}getYForTopText(e){const i=this.getStemExtents();return Math.min(this.checkStave().getYForTopText(e),i.topY-this.renderOptions.annotationSpacing*(e+1))}getYForBottomText(e){const i=this.getStemExtents();return Math.max(this.checkStave().getYForTopText(e),i.baseY+this.renderOptions.annotationSpacing*e)}setStave(e){super.setStave(e);const i=this._noteHeads.map(n=>(n.setStave(e),n.getY()));if(this.setYs(i),this.stem){const{yTop:n,yBottom:a}=this.getNoteHeadBounds();this.stem.setYBounds(n,a)}return this}isDisplaced(){return this.displaced}setNoteDisplaced(e){return this.displaced=e,this}getTieRightX(){let e=this.getAbsoluteX();return e+=this.getGlyphWidth()+this.xShift+this.rightDisplacedHeadPx,this.modifierContext&&(e+=this.modifierContext.getRightShift()),e}getTieLeftX(){let e=this.getAbsoluteX();return e+=this.xShift-this.leftDisplacedHeadPx,e}getLineForRest(){let e=this.keyProps[0].line;if(this.keyProps.length>1){const i=this.keyProps[this.keyProps.length-1].line,n=Math.max(e,i),a=Math.min(e,i);e=qe(n,a)}return e}getModifierStartXY(e,i,n={}){if(!this.preFormatted)throw new w("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");if(this.ys.length===0)throw new w("NoYValues","No Y-Values calculated for this note.");const{ABOVE:a,BELOW:o,LEFT:r,RIGHT:s}=v.Position;let c=0;e===r?c=-2:e===s?(c=this.getGlyphWidth()+this.xShift+2,this.stemDirection===k.UP&&this.hasFlag()&&(n.forceFlagRight||kn(this,i))&&(c+=this.flag.getWidth())):(e===o||e===a)&&(c=this.getGlyphWidth()/2);let u=0;switch(this._noteHeads[i].getText()){case E.restDoubleWhole:case E.restWhole:u+=.5;break;case E.restHalf:case E.restQuarter:case E.rest8th:case E.rest16th:u-=.5;break;case E.rest32nd:case E.rest64th:u-=1.5;break;case E.rest128th:u-=2.5;break}return{x:this.getAbsoluteX()+c,y:this.ys[i]+u*this.checkStave().getSpacingBetweenLines()}}setStyle(e){return super.setGroupStyle(e)}setStemStyle(e){const i=this.getStem();return i&&i.setStyle(e),this}getStemStyle(){var e;return(e=this.stem)===null||e===void 0?void 0:e.getStyle()}setLedgerLineStyle(e){this.ledgerLineStyle=e}getLedgerLineStyle(){return this.ledgerLineStyle}setFlagStyle(e){this.flag.setStyle(e)}getFlagStyle(){return this.flag.getStyle()}getGlyphWidth(){return this.noteHeads[0].getWidth()}setKeyStyle(e,i){return this._noteHeads[e].setStyle(i),this}setKeyLine(e,i){return this.keyProps[e].line=i,this.reset(),this}getKeyLine(e){return this.keyProps[e].line}getVoiceShiftWidth(){return this.getGlyphWidth()*(this.displaced?2:1)}calcNoteDisplacements(){this.setLeftDisplacedHeadPx(this.displaced&&this.stemDirection===k.DOWN?this.getGlyphWidth():0),this.setRightDisplacedHeadPx(!this.hasFlag()&&this.displaced&&this.stemDirection===k.UP?this.getGlyphWidth():0)}preFormat(){if(this.preFormatted)return;let e=0;this.modifierContext&&(this.modifierContext.preFormat(),this.modifierContext.getWidth()===0&&(e=Tt.minNoteheadPadding));let i=this.getGlyphWidth()+this.leftDisplacedHeadPx+this.rightDisplacedHeadPx+e;this.shouldDrawFlag()&&this.stemDirection===k.UP&&(i+=this.getGlyphWidth()),this.setWidth(i),this.preFormatted=!0}getNoteHeadBounds(){let e=1/0,i=-1/0,n,a,o=this.checkStave().getNumLines(),r=1,s,c,u=o,d=r;return this._noteHeads.forEach(h=>{const l=h.getLine(),g=h.getY();e=Math.min(g,e),i=Math.max(g,i),a===void 0&&h.isDisplaced()&&(a=h.getAbsoluteX()),n===void 0&&!h.isDisplaced()&&(n=h.getAbsoluteX()),o=Math.max(l,o),r=Math.min(l,r),h.isDisplaced()?(s=s===void 0?l:Math.max(l,s),c=c===void 0?l:Math.min(l,c)):(u=Math.max(l,u),d=Math.min(l,d))},this),{yTop:e,yBottom:i,displacedX:a,nonDisplacedX:n,highestLine:o,lowestLine:r,highestDisplacedLine:s,lowestDisplacedLine:c,highestNonDisplacedLine:u,lowestNonDisplacedLine:d}}getNoteHeadBeginX(){return this.getAbsoluteX()+this.xShift}getNoteHeadEndX(){return this.getNoteHeadBeginX()+this.getGlyphWidth()}get noteHeads(){return this._noteHeads.slice()}drawLedgerLines(){const e=this.checkStave(),{renderOptions:{strokePx:i}}=this,n=this.checkContext(),a=this.getGlyphWidth()+i*2,o=2*(this.getGlyphWidth()+i)-k.WIDTH/2;if(this.isRest())return;if(!n)throw new w("NoCanvasContext","Can't draw without a canvas context.");const{highestLine:r,lowestLine:s,highestDisplacedLine:c,highestNonDisplacedLine:u,lowestDisplacedLine:d,lowestNonDisplacedLine:h,displacedX:l,nonDisplacedX:g}=this.getNoteHeadBounds();if(r<6&&s>0)return;const f=Math.min(l??0,g??0),S=(m,T,B)=>{let C;B&&T?C=f-i:T?C=(g??0)-i:C=(l??0)-i;const A=T&&B?o:a;n.beginPath(),n.moveTo(C,m),n.lineTo(C+A,m),n.stroke()},x=Object.assign(Object.assign({},e.getDefaultLedgerLineStyle()),this.getLedgerLineStyle());n.save(),this.applyStyle(n,x);for(let m=6;m<=r;++m){const T=g!==void 0&&m<=u,B=c!==void 0&&m<=c;S(e.getYForNote(m),T,B)}for(let m=0;m>=s;--m){const T=g!==void 0&&m>=h,B=d!==void 0&&m>=d;S(e.getYForNote(m),T,B)}n.restore()}drawModifiers(e){const i=this.checkContext();for(let n=0;n<this.modifiers.length;n++){const a=this.modifiers[n],o=a.checkIndex();this._noteHeads[o]===e&&(a.setContext(i),a.drawWithStyle())}}shouldDrawFlag(){const e=this.stem!==void 0,i=this.glyphProps.codeFlagUp!==void 0,n=this.beam===void 0;return e&&i&&n&&!this.isRest()}drawFlag(){const e=this.checkContext();if(!e)throw new w("NoCanvasContext","Can't draw without a canvas context.");if(this.shouldDrawFlag()){const{yTop:i,yBottom:n}=this.getNoteHeadBounds(),a=this.stem.getHeight(),o=this.getStemX()-D.STEM_WIDTH/2,r=this.getStemDirection()===k.DOWN?i-a-this.flag.getTextMetrics().actualBoundingBoxDescent:n-a+this.flag.getTextMetrics().actualBoundingBoxAscent;this.flag.setContext(e).setX(o).setY(r).drawWithStyle()}}drawNoteHeads(){const e=this.checkContext();this._noteHeads.forEach(i=>{i.setContext(e).drawWithStyle()})}drawStem(e){const i=this.checkContext();e&&this.setStem(new k(e)),this.shouldDrawFlag()&&this.stem&&this.stem.adjustHeightForFlag(),this.stem&&this.stem.setContext(i).drawWithStyle()}getStemExtension(){const e=super.getStemExtension();if(!this.glyphProps.stem)return e;const i=this.getStemDirection();if(i!==this.calculateOptimalStemDirection())return e;let n;const a=3;i===k.UP?n=a-this.maxLine:n=this.minLine-a;const o=n-3.5;if(o<=0)return e;const r=this.getStave();let s=10;return r!==void 0&&(s=r.getSpacingBetweenLines()),e+o*s}draw(){if(this.renderOptions.draw===!1)return;if(this.ys.length===0)throw new w("NoYValues","Can't draw note without Y values.");const e=this.checkContext(),i=this.getNoteHeadBeginX(),n=this.hasStem()&&!this.beam;if(this._noteHeads.forEach(o=>o.setX(i)),this.stem){const o=this.getStemX();this.stem.setNoteHeadXBounds(o,o)}An("Rendering ",this.isChord()?"chord :":"note :",this.keys),e.openGroup("stavenote",this.getAttribute("id")),this.drawLedgerLines(),n&&this.drawStem(),this.drawNoteHeads(),this.drawFlag();const a=this.getBoundingBox();e.pointerRect(a.getX(),a.getY(),a.getW(),a.getH()),e.closeGroup(),this.setRendered()}}Tt.DEBUG=!1;class Me extends p{static get CATEGORY(){return"StaveTie"}constructor(e,i=""){super(),this.setNotes(e),this.text=i,this.renderOptions={cp1:8,cp2:12,shortTieCutoff:10,cp1Short:2,cp2Short:8,textShiftX:0,firstXShift:0,lastXShift:0,yShift:7,tieSpacing:0}}getDirection(){return this.direction!==void 0&&this.direction!==null?this.direction:this.notes.lastNote?this.notes.lastNote.getStemDirection():this.notes.firstNote?this.notes.firstNote.getStemDirection():0}setDirection(e){return this.direction=e,this}setNotes(e){if(!e.firstNote&&!e.lastNote)throw new w("BadArguments","Tie needs to have either firstNote or lastNote set.");if(e.firstIndexes||(e.firstIndexes=[0]),e.lastIndexes||(e.lastIndexes=[0]),e.firstIndexes.length!==e.lastIndexes.length)throw new w("BadArguments","Tied notes must have same number of indexes.");return this.notes=e,this}isPartial(){return!this.notes.firstNote||!this.notes.lastNote}renderTie(e){if(e.firstYs.length===0||e.lastYs.length===0)throw new w("BadArguments","No Y-values to render");const i=this.checkContext();let n=this.renderOptions.cp1,a=this.renderOptions.cp2;Math.abs(e.lastX-e.firstX)<this.renderOptions.shortTieCutoff&&(n=this.renderOptions.cp1Short,a=this.renderOptions.cp2Short);const o=this.renderOptions.firstXShift,r=this.renderOptions.lastXShift,s=this.renderOptions.yShift*e.direction,c=this.notes.firstIndexes,u=this.notes.lastIndexes;i.openGroup("stavetie",this.getAttribute("id"));for(let d=0;d<c.length;++d){const h=(e.lastX+r+(e.firstX+o))/2,l=e.firstYs[c[d]]+s,g=e.lastYs[u[d]]+s;if(isNaN(l)||isNaN(g))throw new w("BadArguments","Bad indexes for tie rendering.");const f=(l+g)/2+n*e.direction,S=(l+g)/2+a*e.direction;i.beginPath(),i.moveTo(e.firstX+o,l),i.quadraticCurveTo(h,f,e.lastX+r,g),i.quadraticCurveTo(h,S,e.firstX+o,l),i.closePath(),i.fill()}i.closeGroup()}renderTieText(e,i){var n,a,o;const r=this.checkContext();let s=(e+i)/2;s-=r.measureText(this.text).width/2;const c=(a=(n=this.notes.firstNote)===null||n===void 0?void 0:n.checkStave())!==null&&a!==void 0?a:(o=this.notes.lastNote)===null||o===void 0?void 0:o.checkStave();c&&(r.setFont(this.fontInfo),r.fillText(this.text,s+this.renderOptions.textShiftX,c.getYForTopText()-1))}getNotes(){return this.notes}getFirstX(){return this.notes.firstNote?this.notes.firstNote.getTieRightX()+this.renderOptions.tieSpacing:this.notes.lastNote?this.notes.lastNote.checkStave().getTieStartX():0}getLastX(){return this.notes.lastNote?this.notes.lastNote.getTieLeftX()+this.renderOptions.tieSpacing:this.notes.firstNote?this.notes.firstNote.checkStave().getTieEndX():0}getFirstYs(){return this.notes.firstNote?this.notes.firstNote.getYs():this.notes.lastNote?this.notes.lastNote.getYs():[0]}getLastYs(){return this.notes.lastNote?this.notes.lastNote.getYs():this.notes.firstNote?this.notes.firstNote.getYs():[0]}synchronizeIndexes(){if(!(this.notes.firstNote&&this.notes.lastNote)){if(!this.notes.firstNote&&!this.notes.lastNote)return;this.notes.firstNote?this.notes.lastIndexes=this.notes.firstIndexes:this.notes.firstIndexes=this.notes.lastIndexes}}draw(){this.checkContext(),this.setRendered(),this.synchronizeIndexes();const e=this.getFirstX(),i=this.getLastX();return this.renderTie({firstX:e,lastX:i,firstYs:this.getFirstYs(),lastYs:this.getLastYs(),direction:this.getDirection()}),this.renderTieText(e,i),!0}}class te extends Me{static get CATEGORY(){return"TabTie"}static createHammeron(e){return new te(e,"H")}static createPulloff(e){return new te(e,"P")}constructor(e,i){super(e,i),this.renderOptions.cp1=9,this.renderOptions.cp2=11,this.renderOptions.yShift=3,this.direction=-1}}var Dt;(function(t){t[t.STRICT=1]="STRICT",t[t.SOFT=2]="SOFT",t[t.FULL=3]="FULL"})(Dt||(Dt={}));class bt extends p{static get CATEGORY(){return"Voice"}static get Mode(){return Dt}constructor(e){super(),this.resolutionMultiplier=1,this.mode=Dt.STRICT,this.preFormatted=!1,this.ticksUsed=new P(0,1),this.largestTickWidth=0,this.tickables=[],this.options={softmaxFactor:D.SOFTMAX_FACTOR};let i;if(typeof e=="string"){const n=e.match(/(\d+)\/(\d+)/);n&&(i={numBeats:parseInt(n[1]),beatValue:parseInt(n[2])})}else i=e;this.time=Object.assign({numBeats:4,beatValue:4,resolution:D.RESOLUTION},i),this.totalTicks=new P(this.time.numBeats*(this.time.resolution/this.time.beatValue),1),this.smallestTickCount=this.totalTicks.clone()}getTotalTicks(){return this.totalTicks}getTicksUsed(){return this.ticksUsed}getLargestTickWidth(){return this.largestTickWidth}getSmallestTickCount(){return this.smallestTickCount}getTickables(){return this.tickables}getMode(){return this.mode}setMode(e){return this.mode=e,this}getResolutionMultiplier(){return this.resolutionMultiplier}getActualResolution(){return this.resolutionMultiplier*this.time.resolution}setStave(e){return this.stave=e,this}getStave(){return this.stave}getBoundingBox(){const e=this.tickables[0].getBoundingBox();for(let i=1;i<this.tickables.length;++i){const n=this.tickables[i];!n.getStave()&&this.stave&&n.setStave(this.stave);const a=n.getBoundingBox();e.mergeWith(a)}return e}setStrict(e){return this.mode=e?Dt.STRICT:Dt.SOFT,this}isComplete(){return this.mode===Dt.STRICT||this.mode===Dt.FULL?this.ticksUsed.equals(this.totalTicks):!0}setSoftmaxFactor(e){return this.options.softmaxFactor=e,this.expTicksUsed=0,this}reCalculateExpTicksUsed(){const e=this.ticksUsed.value(),i=n=>Math.pow(this.options.softmaxFactor,n.getTicks().value()/e);return this.expTicksUsed=he(this.tickables.map(i)),this.expTicksUsed}softmax(e){this.expTicksUsed||(this.expTicksUsed=this.reCalculateExpTicksUsed());const i=this.ticksUsed.value();return(o=>Math.pow(this.options.softmaxFactor,o/i))(e)/this.expTicksUsed}addTickable(e){if(!e.shouldIgnoreTicks()){const i=e.getTicks();if(this.ticksUsed.add(i),this.expTicksUsed=0,(this.mode===Dt.STRICT||this.mode===Dt.FULL)&&this.ticksUsed.greaterThan(this.totalTicks))throw this.ticksUsed.subtract(i),new w("BadArgument","Too many ticks.");i.lessThan(this.smallestTickCount)&&(this.smallestTickCount=i.clone()),this.resolutionMultiplier=this.ticksUsed.denominator,this.totalTicks.add(0,this.ticksUsed.denominator)}return this.tickables.push(e),e.setVoice(this),this}addTickables(e){for(let i=0;i<e.length;++i)this.addTickable(e[i]);return this}preFormat(){if(this.preFormatted)return this;const e=this.checkStave();return this.tickables.forEach(i=>{i.getStave()||i.setStave(e)}),this.preFormatted=!0,this}checkStave(){return _(this.stave,"NoStave","No stave attached to instance.")}draw(e=this.checkContext(),i){i=i??this.stave,this.setRendered();for(let n=0;n<this.tickables.length;++n){const a=this.tickables[n];i&&a.setStave(i),_(a.getStave(),"MissingStave","The voice cannot draw tickables without staves."),a.setContext(e),a.drawWithStyle()}}}function Fn(...t){fe.DEBUG&&j("VexFlow.GraceNoteGroup",t)}class fe extends v{static get CATEGORY(){return"GraceNoteGroup"}static format(e,i){if(!e||e.length===0)return!1;const o=[];let r=null,s=0;for(let l=0;l<e.length;++l){const g=e[l],f=g.getNote(),S=Ot(f),x=S?4:0;if(S&&f!==r){for(let m=0;m<f.keys.length;++m)s=Math.max(f.getLeftDisplacedHeadPx(),s);r=f}o.push({shift:s,gracenoteGroup:g,spacing:x})}let c=o[0].shift,u,d=!1,h=!1;for(let l=0;l<o.length;++l){const g=o[l].gracenoteGroup;g.position===v.Position.RIGHT?d=!0:h=!0,g.preFormat(),u=g.getWidth()+o[l].spacing,c=Math.max(u,c)}for(let l=0;l<o.length;++l){const g=o[l].gracenoteGroup;u=g.getWidth()+o[l].spacing,g.setSpacingFromNextModifier(c-Math.min(u,c)+Tt.minNoteheadPadding)}return d&&(i.rightShift+=c),h&&(i.leftShift+=c),!0}constructor(e,i){return super(),this.preFormatted=!1,this.position=v.Position.LEFT,this.graceNotes=e,this.width=0,this.showSlur=i,this.slur=void 0,this.voice=new bt({numBeats:4,beatValue:4,resolution:D.RESOLUTION}).setStrict(!1),this.renderOptions={slurYShift:0},this.beams=[],this.voice.addTickables(this.graceNotes),this}preFormat(){this.preFormatted||(this.formatter||(this.formatter=new rt),this.formatter.joinVoices([this.voice]).format([this.voice],0,{}),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)}beamNotes(e){if(e=e||this.graceNotes,e.length>1){const i=new Yt(e);i.renderOptions.beamWidth=3,i.renderOptions.partialBeamLength=4,this.beams.push(i)}return this}setWidth(e){return this.width=e,this}getWidth(){return this.width+Tt.minNoteheadPadding}getGraceNotes(){return this.graceNotes}draw(){const e=this.checkContext(),i=this.checkAttachedNote();if(this.setRendered(),Fn("Drawing grace note group for:",i),this.alignSubNotesWithNote(this.getGraceNotes(),i,this.position),this.graceNotes.forEach(n=>n.setContext(e).drawWithStyle()),this.beams.forEach(n=>n.setContext(e).drawWithStyle()),this.showSlur){const n=Ot(i),a=n?Me:te;this.slur=new a({lastNote:this.graceNotes[0],firstNote:i,firstIndexes:[0],lastIndexes:[0]}),this.slur.renderOptions.cp2=12,this.slur.renderOptions.yShift=(n?7:5)+this.renderOptions.slurYShift,this.slur.setContext(e).drawWithStyle()}}}fe.DEBUG=!1;class ti extends v{static get CATEGORY(){return"NoteSubGroup"}static format(e,i){if(!e||e.length===0)return!1;let n=0;for(let a=0;a<e.length;++a){const o=e[a];o.preFormat(),n+=o.getWidth()}return i.leftShift+=n,!0}constructor(e){super(),this.preFormatted=!1,this.position=v.Position.LEFT,this.subNotes=e,this.subNotes.forEach(i=>{i.setIgnoreTicks(!1)}),this.width=0,this.formatter=new rt,this.voice=new bt({numBeats:4,beatValue:4,resolution:D.RESOLUTION}).setStrict(!1),this.voice.addTickables(this.subNotes)}preFormat(){this.preFormatted||(this.formatter.joinVoices([this.voice]).format([this.voice],0),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)}setWidth(e){return this.width=e,this}getWidth(){return this.width}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered(),this.alignSubNotesWithNote(this.subNotes,i),this.subNotes.forEach(n=>n.setContext(e).drawWithStyle())}}function vn(...t){st.DEBUG&&j("VexFlow.Ornament",t)}class st extends v{static get CATEGORY(){return"Ornament"}static get minPadding(){return F.get("NoteHead.minPadding")}static format(e,i){var n,a;if(!e||e.length===0)return!1;let o=0,r=i.rightShift,s=i.leftShift;for(let c=0;c<e.length;++c){const u=e[c],d=2;if(u.position===U.RIGHT)u.xShift+=r+2,r+=u.width+st.minPadding;else if(u.position===U.LEFT)u.xShift-=s+u.width+2,s+=u.width+st.minPadding;else if(u.position===U.ABOVE){o=Math.max(u.getWidth(),o);const h=u.getNote();let l=h.getLineNumber(!0)+i.topTextLine;const g=h.getStem();g&&h.getStemDirection()===k.UP&&(l+=Math.abs(g.getHeight())/D.STAVE_LINE_DISTANCE);const f=(a=(n=h.getStave())===null||n===void 0?void 0:n.getNumLines())!==null&&a!==void 0?a:0;l<f&&(i.topTextLine+=f-l),u.setTextLine(i.topTextLine),i.topTextLine+=d}else o=Math.max(u.getWidth(),o),u.setTextLine(i.textLine),i.textLine+=d}return i.leftShift=s+o/2,i.rightShift=r+o/2,!0}static get ornamentNoteTransition(){return["flip","jazzTurn","smear"]}static get ornamentAttack(){return["scoop"]}static get ornamentAlignWithNoteHead(){return["doit","fall","fallLong","doitLong","scoop"]}static get ornamentRelease(){return["doit","fall","fallLong","doitLong","jazzTurn","smear","flip"]}static get ornamentLeft(){return["scoop"]}static get ornamentRight(){return["doit","fall","fallLong","doitLong"]}static get ornamentYShift(){return["fallLong"]}static get ornamentArticulation(){return["bend","plungerClosed","plungerOpen"]}constructor(e){super(),this.position=U.ABOVE,st.ornamentRight.indexOf(e)>=0&&(this.position=U.RIGHT),st.ornamentLeft.indexOf(e)>=0&&(this.position=U.LEFT),this.type=e,this.delayed=!1,this.renderOptions={accidentalLowerPadding:3,accidentalUpperPadding:3},this.adjustForStemDirection=!1,this.ornamentAlignWithNoteHead=st.ornamentAlignWithNoteHead.indexOf(this.type)>=0,st.ornamentNoteTransition.indexOf(this.type)>=0&&(this.delayed=!0),this.text=D.ornamentCodes(this.type)}setNote(e){return super.setNote(e),st.ornamentArticulation.indexOf(this.type)>=0&&(e.getLineNumber()>=3?this.position=v.Position.ABOVE:this.position=v.Position.BELOW),this}setDelayed(e){return this.delayed=e,this}setUpperAccidental(e){return this.accidentalUpper=new p,this.accidentalUpper.setText(D.accidentalCodes(e)),this}setLowerAccidental(e){return this.accidentalLower=new p,this.accidentalLower.setText(D.accidentalCodes(e)),this}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const n=i.checkStave();e.openGroup("ornament",this.getAttribute("id"));const a=i.getModifierStartXY(this.position,this.index);let o=a.x;const r=n.getSpacingBetweenLines(),s=Li(i,this.position);let c=this.ornamentAlignWithNoteHead?a.y:0;if(this.position===U.ABOVE&&(c=Ai(i,this.textLine)-(this.textLine+s)*r),this.position===U.BELOW&&(c=ki(i,this.textLine)+(this.textLine+s+1.5)*r),this.delayed){let u=0;const d=i.getTickContext().getX();if(this.delayXShift!==void 0)u=this.delayXShift;else{const h=i.getVoice().getTickables(),l=h.indexOf(i),g=l+1<h.length?h[l+1].checkTickContext():void 0;g?u+=(g.getX()-d)*.5:u+=(n.getX()+n.getWidth()-o)*.5,this.delayXShift=u}o+=u}vn("Rendering ornament: ",this.text.charCodeAt(0),o,c),this.accidentalLower&&(this.accidentalLower.renderText(e,o+this.xShift-this.accidentalLower.getWidth()*.5,c+this.yShift-this.accidentalLower.getTextMetrics().actualBoundingBoxDescent),c-=this.accidentalLower.getHeight()+this.renderOptions.accidentalLowerPadding),st.ornamentYShift.indexOf(this.type)>=0&&(this.yShift+=this.getHeight()),this.x=o-(this.position===U.ABOVE||this.position===U.BELOW?this.width*.5:0),this.y=c,this.renderText(e,0,0),this.accidentalUpper&&(c-=this.getHeight()+this.renderOptions.accidentalUpperPadding,this.accidentalUpper.renderText(e,o+this.xShift-this.accidentalUpper.getWidth()*.5,c+this.yShift-this.accidentalUpper.getTextMetrics().actualBoundingBoxDescent)),e.closeGroup()}}st.DEBUG=!1;class Ee extends v{static get CATEGORY(){return"Parenthesis"}static buildAndAttach(e){for(const i of e)for(let n=0;n<i.keys.length;n++)i.addModifier(new Ee(U.LEFT),n),i.addModifier(new Ee(U.RIGHT),n)}static format(e,i){if(!e||e.length===0)return!1;let n=0,a=0;for(let o=0;o<e.length;++o){const r=e[o],s=r.getNote(),c=r.getPosition(),u=r.checkIndex();let d=0;c===U.RIGHT&&(d=s.getRightParenthesisPx(u),a=a>d+r.width?a:d+r.width),c===U.LEFT&&(d=s.getLeftParenthesisPx(u)+r.width,n=n>d+r.width?n:d+r.width),r.setXShift(d)}return i.leftShift+=n,i.rightShift+=a,!0}constructor(e){super(),this.position=e??v.Position.LEFT,this.position===v.Position.RIGHT?this.text="":this.position===v.Position.LEFT&&(this.text="")}setNote(e){return this.note=e,this.setFont(e.getFont()),this}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const n=i.getModifierStartXY(this.position,this.index,{forceFlagRight:!0});this.renderText(e,n.x,n.y)}}const pn={path:{x:!0,y:!0,width:!0,height:!0,"font-family":!0,"font-weight":!0,"font-style":!0,"font-size":!0},rect:{"font-family":!0,"font-weight":!0,"font-style":!0,"font-size":!0},text:{width:!0,height:!0}},Nn="http://www.w3.org/2000/svg",Ei=2*Math.PI;class $t extends Qe{constructor(e){super(),this.width=0,this.height=0,this.precision=1,this.backgroundFillStyle="white",this.fontCSSString="",this.element=e,this.precision=Math.pow(10,D.RENDER_PRECISION_PLACES);const i=this.create("svg");i.setAttribute("pointer-events","none"),this.element.appendChild(i),this.svg=i,this.parent=this.svg,this.groups=[this.svg],this.path="",this.pen={x:NaN,y:NaN};const n={"font-family":F.get("fontFamily"),"font-size":"10pt","font-weight":qt.NORMAL,"font-style":Ut.NORMAL};this.state=Object.assign({scaleX:1,scaleY:1},n),this.attributes=Object.assign({"stroke-width":1,"stroke-dasharray":"none",fill:"black",stroke:"black",shadowBlur:0,shadowColor:"black"},n),this.groupAttributes=[],this.applyAttributes(i,this.attributes),this.groupAttributes.push(Object.assign({},this.attributes)),this.stateStack=[]}round(e){return Math.round(e*this.precision)/this.precision}create(e){return document.createElementNS(Nn,e)}openGroup(e,i){const n=this.create("g");return this.groups.push(n),this.parent.appendChild(n),this.parent=n,e&&n.setAttribute("class",je(e)),i&&n.setAttribute("id",je(i)),this.applyAttributes(n,this.attributes),this.groupAttributes.push(Object.assign(Object.assign({},this.groupAttributes[this.groupAttributes.length-1]),this.attributes)),n}closeGroup(){this.groups.pop(),this.groupAttributes.pop(),this.parent=this.groups[this.groups.length-1]}openRotation(e,i,n){this.openGroup().setAttribute("transform",`translate(${i},${n}) rotate(${e}) translate(-${i},-${n})`)}closeRotation(){this.closeGroup()}add(e){this.parent.appendChild(e)}setFillStyle(e){return this.attributes.fill=e,this}setBackgroundFillStyle(e){return this.backgroundFillStyle=e,this}setStrokeStyle(e){return this.attributes.stroke=e,this}setShadowColor(e){return this.attributes.shadowColor=e,this}setShadowBlur(e){return this.attributes.shadowBlur=e,this}setLineWidth(e){return this.attributes["stroke-width"]=e,this}setLineDash(e){if(Object.prototype.toString.call(e)==="[object Array]")return this.attributes["stroke-dasharray"]=e.join(","),this;throw new w("ArgumentError","lineDash must be an array of integers.")}setLineCap(e){return this.attributes["stroke-linecap"]=e,this}resize(e,i){this.width=e,this.height=i,this.element.style.width=e.toString(),this.svg.style.width=e.toString(),this.svg.style.height=i.toString();const n={width:e,height:i};return this.applyAttributes(this.svg,n),this.scale(this.state.scaleX,this.state.scaleY),this}scale(e,i){this.state.scaleX=this.state.scaleX?this.state.scaleX*e:e,this.state.scaleY=this.state.scaleY?this.state.scaleY*i:i;const n=this.width/this.state.scaleX,a=this.height/this.state.scaleY;return this.setViewBox(0,0,n,a),this}setViewBox(e,i,n,a){if(typeof e=="string")this.svg.setAttribute("viewBox",e);else{const o=e+" "+i+" "+n+" "+a;this.svg.setAttribute("viewBox",o)}}applyAttributes(e,i){const n=pn[e.nodeName];for(const a in i)n&&n[a]||i[a]&&(this.groupAttributes.length===0||i[a]!=this.groupAttributes[this.groupAttributes.length-1][a])&&e.setAttributeNS(null,a,i[a]);return e}clear(){for(;this.svg.lastChild;)this.svg.removeChild(this.svg.lastChild)}rect(e,i,n,a,o){a<0&&(i+=a,a*=-1);const r=this.create("rect");return o=o??{fill:"none","stroke-width":this.attributes["stroke-width"],stroke:"black"},e=this.round(e),i=this.round(i),n=this.round(n),a=this.round(a),this.applyAttributes(r,Object.assign({x:e,y:i,width:n,height:a},o)),this.add(r),this}fillRect(e,i,n,a){const o={fill:this.attributes.fill,stroke:"none"};return this.rect(e,i,n,a,o),this}pointerRect(e,i,n,a){const o={opacity:"0","pointer-events":"auto"};return this.rect(e,i,n,a,o),this}clearRect(e,i,n,a){return this.rect(e,i,n,a,{fill:this.backgroundFillStyle,stroke:"none"}),this}beginPath(){return this.path="",this.pen.x=NaN,this.pen.y=NaN,this}moveTo(e,i){return e=this.round(e),i=this.round(i),this.path+="M"+e+" "+i,this.pen.x=e,this.pen.y=i,this}lineTo(e,i){return e=this.round(e),i=this.round(i),this.path+="L"+e+" "+i,this.pen.x=e,this.pen.y=i,this}bezierCurveTo(e,i,n,a,o,r){return o=this.round(o),r=this.round(r),e=this.round(e),i=this.round(i),n=this.round(n),a=this.round(a),this.path+="C"+e+" "+i+","+n+" "+a+","+o+" "+r,this.pen.x=o,this.pen.y=r,this}quadraticCurveTo(e,i,n,a){return n=this.round(n),a=this.round(a),e=this.round(e),i=this.round(i),this.path+="Q"+e+" "+i+","+n+" "+a,this.pen.x=n,this.pen.y=a,this}arc(e,i,n,a,o,r){let s=e+n*Math.cos(a),c=i+n*Math.sin(a);s=this.round(s),c=this.round(c);const u=oi(a),d=oi(o);if(!r&&o-a>=Ei||r&&a-o>=Ei||u===d){let h=e+n*Math.cos(a+Math.PI),l=i+n*Math.sin(a+Math.PI);h=this.round(h),l=this.round(l),n=this.round(n),this.path+=`M${s} ${c} A${n} ${n} 0 0 0 ${h} ${l} `,this.path+=`A${n} ${n} 0 0 0 ${s} ${c}`,this.pen.x=s,this.pen.y=c}else{let h=e+n*Math.cos(o),l=i+n*Math.sin(o);a=u,o=d;let g;Math.abs(o-a)<Math.PI?g=r:g=!r,a>o&&(g=!g);const f=!r;h=this.round(h),l=this.round(l),n=this.round(n),this.path+=`M${s} ${c} A${n} ${n} 0 ${+g} ${+f} ${h} ${l}`,this.pen.x=h,this.pen.y=l}return this}closePath(){return this.path+="Z",this}getShadowStyle(){return`filter: drop-shadow(0 0 ${this.attributes.shadowBlur/1.5}px ${this.attributes.shadowColor})`}fill(e){const i=this.create("path");return typeof e>"u"&&(e=Object.assign(Object.assign({},this.attributes),{stroke:"none"})),e.d=this.path,this.attributes.shadowBlur>0&&(e.style=this.getShadowStyle()),this.applyAttributes(i,e),this.add(i),this}stroke(){const e=this.create("path"),i=Object.assign(Object.assign({},this.attributes),{fill:"none",d:this.path});return this.attributes.shadowBlur>0&&(i.style=this.getShadowStyle()),this.applyAttributes(e,i),this.add(e),this}measureText(e){$t.measureTextElement.setText(e),$t.measureTextElement.setFont(this.attributes["font-family"],this.attributes["font-size"],this.attributes["font-weight"],this.attributes["font-style"]);const i=$t.measureTextElement.getBoundingBox();return{x:i.x,y:i.y,width:i.w,height:i.h}}fillText(e,i,n){if(!e||e.length<=0)return this;i=this.round(i),n=this.round(n);const a=Object.assign(Object.assign({},this.attributes),{stroke:"none",x:i,y:n}),o=this.create("text");return o.textContent=e,this.applyAttributes(o,a),this.add(o),this}save(){return this.stateStack.push({state:structuredClone(this.state),attributes:structuredClone(this.attributes)}),this}restore(){const e=this.stateStack.pop();if(e){const i=e;this.state=structuredClone(i.state),this.attributes=structuredClone(i.attributes)}return this}set fillStyle(e){this.setFillStyle(e)}get fillStyle(){return this.attributes.fill}set strokeStyle(e){this.setStrokeStyle(e)}get strokeStyle(){return this.attributes.stroke}setFont(e,i,n,a){const o=W.validate(e,i,n,a);this.fontCSSString=W.toCSSString(o);const r={"font-family":o.family,"font-size":o.size,"font-weight":o.weight,"font-style":o.style};return this.attributes=Object.assign(Object.assign({},this.attributes),r),this.state=Object.assign(Object.assign({},this.state),r),this}getFont(){return this.fontCSSString}}$t.measureTextElement=new p;var Ae;(function(t){t[t.CANVAS=1]="CANVAS",t[t.SVG=2]="SVG"})(Ae||(Ae={}));var ke;(function(t){t[t.NONE=1]="NONE",t[t.UP=2]="UP",t[t.DOWN=3]="DOWN"})(ke||(ke={}));class V{static buildContext(e,i,n,a,o="#FFF"){const r=new V(e,i);n&&a&&r.resize(n,a);const s=r.getContext();return s.setBackgroundFillStyle(o),V.lastContext=s,s}static getCanvasContext(e,i,n,a){return V.buildContext(e,V.Backends.CANVAS,i,n,a)}static getSVGContext(e,i,n,a){return V.buildContext(e,V.Backends.SVG,i,n,a)}static drawDashedLine(e,i,n,a,o,r){e.beginPath();const s=a-i,c=o-n,u=Math.atan2(c,s);let d=i,h=n;e.moveTo(i,n);let l=0,g=!0;for(;!((s<0?d<=a:d>=a)&&(c<0?h<=o:h>=o));){const f=r[l++%r.length],S=d+Math.cos(u)*f;d=s<0?Math.max(a,S):Math.min(a,S);const x=h+Math.sin(u)*f;h=c<0?Math.max(o,x):Math.min(o,x),g?e.lineTo(d,h):e.moveTo(d,h),g=!g}e.closePath(),e.stroke()}constructor(e,i){if(en(e))this.ctx=e;else{if(i===void 0)throw new w("InvalidArgument","Missing backend argument");const n=i;let a;if(typeof e=="string"){const o=document.getElementById(e);if(!o)throw new w("BadElementId",`Can't find element with ID "${o}"`);a=o}else a=e;if(n===V.Backends.CANVAS){if(!Je(a))throw new w("BadElement","CANVAS context requires an HTMLCanvasElement.");const o=a.getContext("2d",{willReadFrequently:!0});if(!o)throw new w("BadElement","Can't get canvas context");this.ctx=new yt(o)}else if(n===V.Backends.SVG){if(!ln(a))throw new w("BadElement","SVG context requires an HTMLDivElement.");this.ctx=new $t(a)}else throw new w("InvalidBackend",`No support for backend: ${n}`)}}resize(e,i){return this.ctx.resize(e,i),this}getContext(){return this.ctx}}V.Backends=Ae;V.LineEndType=ke;V.lastContext=void 0;class ei extends v{static get CATEGORY(){return"StringNumber"}static format(e,i){const n=i.leftShift,a=i.rightShift,o=1;if(!e||e.length===0)return!1;const r=[];let s=null,c=0,u=0;for(let S=0;S<e.length;++S){const x=e[S],m=x.getNote(),T=x.getPosition();if(!Ot(m))throw new w("NoStaveNote");const B=x.checkIndex(),C=m.getKeyProps()[B],A=m.getModifierContext(),L=x.radius*2/D.STAVE_LINE_DISTANCE+.5;if(A&&(T===U.ABOVE?(x.textLine=A.getState().topTextLine,i.topTextLine+=L):T===U.BELOW&&(x.textLine=A.getState().textLine,i.textLine+=L)),m!==s){for(let M=0;M<m.keys.length;++M)T===v.Position.LEFT&&(c=Math.max(m.getLeftDisplacedHeadPx(),c)),a===0&&(u=Math.max(m.getRightDisplacedHeadPx(),u));s=m}const N=C.line;r.push({pos:T,note:m,num:x,line:N,shiftL:c,shiftR:u})}r.sort((S,x)=>x.line-S.line);let d=0,h=0,l=0,g=null,f=null;for(let S=0;S<r.length;++S){const x=r[S].note,m=r[S].pos,T=r[S].num,B=r[S].line,C=r[S].shiftR;(B!==g||x!==f)&&(d=a+C);const A=T.getWidth()+o;let L=0;m===v.Position.LEFT?(T.setXShift(n+c),L=A,h=Math.max(L,h)):m===v.Position.RIGHT&&(T.setXShift(d),L+=A,l=L>l?L:l),g=B,f=x}return i.leftShift+=h,i.rightShift+=l,!0}constructor(e){super(),this.stringNumber=e,this.position=v.Position.ABOVE,this.xShift=0,this.yShift=0,this.textLine=0,this.stemOffset=0,this.xOffset=0,this.yOffset=0,this.dashed=!0,this.leg=V.LineEndType.NONE,this.radius=8,this.drawCircle=!0,this.setWidth(this.radius*2+4)}setLineEndType(e){return e>=V.LineEndType.NONE&&e<=V.LineEndType.DOWN&&(this.leg=e),this}setStringNumber(e){return this.stringNumber=e,this}setOffsetX(e){return this.xOffset=e,this}setOffsetY(e){return this.yOffset=e,this}setLastNote(e){return this.lastNote=e,this}setDashed(e){return this.dashed=e,this}setDrawCircle(e){return this.drawCircle=e,this}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const n=i.getModifierStartXY(this.position,this.index),a=i.hasStem()?i.getStemDirection():k.UP;let o=n.x+this.xShift+this.xOffset,r={};i.hasStem()&&(r=i.checkStem().getExtents());let s=n.y+this.yShift+this.yOffset;switch(this.position){case v.Position.ABOVE:s=i.getYs().reduce((h,l)=>h<l?h:l),i.hasStem()&&a===k.UP&&(s=r.topY+F.get("StringNumber.stemPadding")),s-=this.radius+F.get("StringNumber.verticalPadding")+this.textLine*D.STAVE_LINE_DISTANCE;break;case v.Position.BELOW:s=i.getYs().reduce((h,l)=>h>l?h:l),i.hasStem()&&a===k.DOWN&&(s=r.topY-F.get("StringNumber.stemPadding")),s+=this.radius+F.get("StringNumber.verticalPadding")+this.textLine*D.STAVE_LINE_DISTANCE;break;case v.Position.LEFT:o-=this.radius/2+F.get("StringNumber.leftPadding");break;case v.Position.RIGHT:o+=this.radius/2+F.get("StringNumber.rightPadding");break;default:throw new w("InvalidPosition",`The position ${this.position} is invalid`)}this.drawCircle&&(e.beginPath(),e.arc(o,s,this.radius,0,Math.PI*2,!1),e.setLineWidth(1.5),e.stroke()),e.setFont(this.fontInfo);const c=o-e.measureText(this.stringNumber).width/2;e.fillText(""+this.stringNumber,c,s+4.5);const u=this.lastNote;if(Fe(u)){const d=u.getStemX()-i.getX()+5;e.setStrokeStyle("#000000"),e.setLineCap("round"),e.setLineWidth(.6),this.dashed?V.drawDashedLine(e,o+10,s,o+d,s,[3,3]):V.drawDashedLine(e,o+10,s,o+d,s,[3,0]);let h,l;switch(this.leg){case V.LineEndType.UP:h=-10,l=this.dashed?[3,3]:[3,0],V.drawDashedLine(e,o+d,s,o+d,s+h,l);break;case V.LineEndType.DOWN:h=10,l=this.dashed?[3,3]:[3,0],V.drawDashedLine(e,o+d,s,o+d,s+h,l);break}}}}class Q extends v{static get CATEGORY(){return"Stroke"}static format(e,i){const n=i.leftShift,a=5;if(!e||e.length===0)return!1;const o=e.map(c=>{const u=c.getNote(),d=c.checkIndex();if(Ot(u)){const{line:h}=u.getKeyProps()[d],l=u.getLeftDisplacedHeadPx();return{line:h,shift:l,stroke:c}}else if(St(u)){const{str:h}=u.getPositions()[d];return{line:h,shift:0,stroke:c}}else throw new w("Internal","Unexpected instance.")}),r=n,s=o.reduce((c,{stroke:u,shift:d})=>(u.setXShift(r+d),Math.max(u.getWidth()+a,c)),0);return i.leftShift+=s,!0}constructor(e,i){super(),this.options=Object.assign({allVoices:!0},i),this.allVoices=this.options.allVoices,this.type=e,this.position=v.Position.LEFT,this.renderOptions={fontScale:F.get("Stroke.fontSize")},this.setXShift(0),this.setWidth(10)}getPosition(){return this.position}addEndNote(e){return this.noteEnd=e,this}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const n=i.getModifierStartXY(this.position,this.index);let a=i.getYs(),o=n.y,r=n.y;const s=n.x-5,c=i.checkStave().getSpacingBetweenLines(),u=this.checkModifierContext().getMembers(i.getCategory());for(let g=0;g<u.length;g++){const f=u[g];if(Di(f)){a=f.getYs();for(let S=0;S<a.length;S++)(this.note===u[g]||this.allVoices)&&(o=Math.min(o,a[S]),r=Math.max(r,a[S]))}}let d="",h=0,l=0;switch(this.type){case Q.Type.BRUSH_DOWN:case Q.Type.ROLL_DOWN:case Q.Type.RASGUEADO_DOWN:d=E.arrowheadBlackUp,h=o,o-=c/2,r+=c/2;break;case Q.Type.BRUSH_UP:case Q.Type.ROLL_UP:case Q.Type.RASGUEADO_UP:d=E.arrowheadBlackDown,h=r+c,o-=c/2;break;case Q.Type.ARPEGGIO_DIRECTIONLESS:o-=c/2,r+=c/2;break;default:throw new w("InvalidType",`The stroke type ${this.type} does not exist`)}if(this.type===Q.Type.BRUSH_DOWN||this.type===Q.Type.BRUSH_UP)e.fillRect(s+this.xShift,o,1,r-o);else{const g=d===E.arrowheadBlackDown?E.wiggleArpeggiatoDown:E.wiggleArpeggiatoUp;let f="";const S=new p;for(;S.getWidth()<r-o;)f+=g,S.setText(f);this.type===Q.Type.RASGUEADO_DOWN||this.type===Q.Type.ROLL_DOWN||this.type===Q.Type.ARPEGGIO_DIRECTIONLESS?(e.openRotation(90,s+this.xShift,o),S.renderText(e,s+this.xShift,o-S.getTextMetrics().actualBoundingBoxDescent+S.getHeight()/2),e.closeRotation(),l=o+S.getWidth()+5):(e.openRotation(-90,s+this.xShift,r),S.renderText(e,s+this.xShift,r-S.getTextMetrics().actualBoundingBoxDescent+S.getHeight()/2),e.closeRotation(),l=r-S.getWidth()-5)}if(h!==0){const g=new p;g.setText(d),g.renderText(e,s+this.xShift-g.getWidth()/2,h)}if(this.type===Q.Type.RASGUEADO_DOWN||this.type===Q.Type.RASGUEADO_UP){const g=new p("Stroke.text");g.setText("R"),g.renderText(e,s+this.xShift-g.getWidth()/2,l+(this.type===Q.Type.RASGUEADO_DOWN?g.getHeight():0))}}}Q.Type={BRUSH_DOWN:1,BRUSH_UP:2,ROLL_DOWN:3,ROLL_UP:4,RASGUEADO_DOWN:5,RASGUEADO_UP:6,ARPEGGIO_DIRECTIONLESS:7};class ii extends v{static get CATEGORY(){return"Vibrato"}static format(e,i,n){if(!e||e.length===0)return!1;let a=i.topTextLine,o=0,r=i.rightShift-7;const s=n.getMembers(gt.CATEGORY);if(s&&s.length>0){const c=s.map(u=>u.getTextHeight()).reduce((u,d)=>u>d?u:d)/D.STAVE_LINE_DISTANCE;a=a-(c+1)}else i.topTextLine+=1;for(let c=0;c<e.length;++c){const u=e[c];u.setXShift(r),u.setTextLine(a),o+=u.getWidth(),r+=o}return i.rightShift+=o,!0}constructor(){super(),this.position=v.Position.RIGHT,this.renderOptions={code:60080,width:20},this.setVibratoWidth(this.renderOptions.width)}setVibratoWidth(e){this.renderOptions.width=e,this.text=String.fromCodePoint(this.renderOptions.code);const i=this.getWidth();if(!i)throw new w("Cannot set vibrato width if width is 0");const n=Math.round(this.renderOptions.width/i);for(let a=1;a<n;a++)this.text+=String.fromCodePoint(this.renderOptions.code);return this}setVibratoCode(e){return this.renderOptions.code=e,this.setVibratoWidth(this.renderOptions.width)}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const a=i.getModifierStartXY(v.Position.RIGHT,this.index).x,o=i.getYForTopText(this.textLine)+5;this.renderText(e,a,o)}}function Be(...t){ee.DEBUG&&j("VexFlow.ModifierContext",t)}class ee{constructor(){this.state={leftShift:0,rightShift:0,textLine:0,topTextLine:0},this.members={},this.preFormatted=!1,this.postFormatted=!1,this.formatted=!1,this.width=0,this.spacing=0}addModifier(e){return Be("addModifier is deprecated, use addMember instead."),this.addMember(e)}addMember(e){const i=e.getCategory();return this.members[i]||(this.members[i]=[]),this.members[i].push(e),e.setModifierContext(this),this.preFormatted=!1,this}getModifiers(e){return Be("getModifiers is deprecated, use getMembers instead."),this.getMembers(e)}getMembers(e){var i;return(i=this.members[e])!==null&&i!==void 0?i:[]}getWidth(){return this.width}getLeftShift(){return this.state.leftShift}getRightShift(){return this.state.rightShift}getState(){return this.state}getMetrics(){if(!this.formatted)throw new w("UnformattedMember","Unformatted member has no metrics.");return{width:this.state.leftShift+this.state.rightShift+this.spacing,spacing:this.spacing}}preFormat(){if(this.preFormatted)return;Be("Preformatting ModifierContext");const e=this.state,i=this.members;Tt.format(i.StaveNote,e),Ee.format(i.Parenthesis,e),Xt.format(i.Dot,e),Ne.format(i.FretHandFinger,e),Kt.format(i.Accidental,e),Q.format(i.Stroke,e),fe.format(i.GraceNoteGroup,e),ti.format(i.NoteSubGroup,e),ei.format(i.StringNumber,e),Rt.format(i.Articulation,e),st.format(i.Ornament,e),dt.format(i.Annotation,e),Y.format(i.ChordSymbol,e),gt.format(i.Bend,e),ii.format(i.Vibrato,e,this),this.width=e.leftShift+e.rightShift,this.preFormatted=!0}postFormat(){this.postFormatted||(Be("Postformatting ModifierContext"),Tt.postFormat(this.getMembers("StaveNote")))}}ee.DEBUG=!1;class ie extends Pt{static get CATEGORY(){return"KeySignature"}constructor(e,i,n){super(),this.accList=[],this.setKeySig(e,i,n),this.setPosition(O.BEGIN),this.children=[],this.paddingForced=!1}convertToGlyph(e,i,n){const a=D.accidentalCodes(e.type),o=new p("KeySignature");o.setText(a);let r=1;if(o.setYShift(n.getYForLine(e.line)),this.children.length>0){const s=this.children[this.children.length-1],c=d=>d.getText()===E.accidentalNatural,u=(d,h)=>Math.abs(h.getYShift()-d.getYShift());(c(s)||c(o))&&u(s,o)<10&&(r=2),o.setXShift(s.getXShift()+s.getWidth()+r)}this.children.push(o),this.width+=o.getWidth()+r}cancelKey(e){return this.formatted=!1,this.cancelKeySpec=e,this}convertToCancelAccList(e){const i=D.keySignature(e),n=this.accList.length>0&&i.length>0&&i[0].type!==this.accList[0].type,a=n?i.length:i.length-this.accList.length;if(a<1)return;const o=[];for(let r=0;r<a;r++){let s=r;n||(s=i.length-a+r);const c=i[s];o.push({type:"n",line:c.line})}return this.accList=o.concat(this.accList),{accList:o,type:i[0].type}}addToStave(e){return this.paddingForced=!0,e.addModifier(this),this}setStave(e){return this.formatted=!1,super.setStave(e)}getBoundingBox(){return this.formatted||this.format(),super.getBoundingBox()}calculateDimensions(){let e;this.children.length>0?e=this.children[0].getBoundingBox():e=new Nt(this.x+this.xShift,this.y+this.yShift,0,0),this.children.forEach(i=>{e.mergeWith(i.getBoundingBox())}),this.width=e.getW(),this.height=e.getH(),this.y=e.getY()}convertAccLines(e,i,n=this.accList){let a=0,o;switch(e){case"soprano":i==="#"?o=[2.5,.5,2,0,1.5,-.5,1]:a=-1;break;case"mezzo-soprano":i==="b"?o=[0,2,.5,2.5,1,3,1.5]:a=1.5;break;case"alto":a=.5;break;case"tenor":i==="#"?o=[3,1,2.5,.5,2,0,1.5]:a=-.5;break;case"baritone-f":case"baritone-c":i==="b"?o=[.5,2.5,1,3,1.5,3.5,2]:a=2;break;case"bass":case"french":a=1;break}let r;if(typeof o<"u")for(r=0;r<n.length;++r)n[r].line=o[r];else if(a!==0)for(r=0;r<n.length;++r)n[r].line+=a}getPadding(e){return this.formatted||this.format(),this.children.length===0||!this.paddingForced&&e<2?0:this.padding}getWidth(){return this.formatted||this.format(),this.width}setKeySig(e,i,n){return this.formatted=!1,this.keySpec=e,this.cancelKeySpec=i,this.alterKeySpec=n,this}alterKey(e){return this.formatted=!1,this.alterKeySpec=e,this}convertToAlterAccList(e){const i=Math.min(e.length,this.accList.length);for(let n=0;n<i;++n)e[n]&&(this.accList[n].type=e[n])}format(){let e=this.getStave();e||(e=new Vt(0,0,100),this.setStave(e)),this.width=0,this.children=[],this.accList=D.keySignature(_(this.keySpec));const i=this.accList,n=i.length>0?i[0].type:void 0;let a;if(this.cancelKeySpec&&(a=this.convertToCancelAccList(this.cancelKeySpec)),this.alterKeySpec&&this.convertToAlterAccList(this.alterKeySpec),this.accList.length>0){const o=(this.position===O.END?e.getEndClef():e.getClef())||e.getClef();a&&this.convertAccLines(o,a.type,a.accList),this.convertAccLines(o,n,i);for(let r=0;r<this.accList.length;++r)this.convertToGlyph(this.accList[r],this.accList[r+1],e)}this.calculateDimensions(),this.formatted=!0}draw(){const i=this.checkStave().checkContext();this.formatted||this.format(),this.setRendered(),i.openGroup("keysignature",this.getAttribute("id"));for(let n=0;n<this.children.length;n++)this.children[n].renderText(i,this.x,0);i.closeGroup()}}class z extends Pt{static get CATEGORY(){return"Repetition"}constructor(e,i,n){super(),this.symbolType=e,this.x=i,this.xShift=0,this.yShift=n}setShiftX(e){return this.xShift=e,this}setShiftY(e){return this.yShift=e,this}draw(){const e=this.checkStave(),i=e.getModifierXShift(this.getPosition());switch(this.setRendered(),this.symbolType){case z.type.CODA_RIGHT:this.drawCodaFixed(e,i+e.getWidth());break;case z.type.CODA_LEFT:this.drawSymbolText(e,i,"Coda",!0);break;case z.type.SEGNO_LEFT:this.drawSegnoFixed(e,i);break;case z.type.SEGNO_RIGHT:this.drawSegnoFixed(e,i+e.getWidth());break;case z.type.DC:this.drawSymbolText(e,i,"D.C.",!1);break;case z.type.DC_AL_CODA:this.drawSymbolText(e,i,"D.C. al",!0);break;case z.type.DC_AL_FINE:this.drawSymbolText(e,i,"D.C. al Fine",!1);break;case z.type.DS:this.drawSymbolText(e,i,"D.S.",!1);break;case z.type.DS_AL_CODA:this.drawSymbolText(e,i,"D.S. al",!0);break;case z.type.DS_AL_FINE:this.drawSymbolText(e,i,"D.S. al Fine",!1);break;case z.type.FINE:this.drawSymbolText(e,i,"Fine",!1);break;case z.type.TO_CODA:this.drawSymbolText(e,i,"To",!0);break}}drawCodaFixed(e,i){const n=e.getYForTopText(e.getNumLines());return this.text=E.coda,this.renderText(e.checkContext(),i,n+F.get("Repetition.coda.offsetY")),this}drawSegnoFixed(e,i){const n=e.getYForTopText(e.getNumLines());return this.text=E.segno,this.renderText(e.checkContext(),i,n+F.get("Repetition.segno.offsetY")),this}drawSymbolText(e,i,n,a){const o=e.checkContext();let r=0;switch(this.text=n,a&&(this.text+=" "),this.setFont(F.getFontInfo("Repetition.text")),this.symbolType){case z.type.CODA_LEFT:r=e.getVerticalBarWidth();break;case z.type.DC:case z.type.DC_AL_FINE:case z.type.DS:case z.type.DS_AL_FINE:case z.type.FINE:default:r=i-(e.getNoteStartX()-this.x)+e.getWidth()-this.width-F.get("Repetition.text.offsetX")}const s=e.getYForTopText(e.getNumLines())+F.get("Repetition.text.offsetY");return this.renderText(o,r,s),this}}z.type={NONE:1,CODA_LEFT:2,CODA_RIGHT:3,SEGNO_LEFT:4,SEGNO_RIGHT:5,DC:6,DC_AL_CODA:7,DC_AL_FINE:8,DS:9,DS_AL_CODA:10,DS_AL_FINE:11,FINE:12,TO_CODA:13};class On extends Pt{static get CATEGORY(){return"StaveSection"}constructor(e,i=0,n=0,a=!0){super(),this.setText(e),this.x=i,this.yShift=n,this.drawRect=a,this.padding=F.get("StaveSection.padding")}setDrawRect(e){return this.drawRect=e,this}draw(){const e=this.checkStave(),i=e.checkContext();this.setRendered(),this.x=e.getX()+e.getModifierXShift(this.getPosition());const n=-1*this.textMetrics.actualBoundingBoxDescent,a=this.width+2*this.padding,o=this.height+2*this.padding,r=e.getYForTopText(1.5)+this.yShift,s=this.x+this.xShift;this.drawRect&&(i.beginPath(),i.rect(s,r-o+n,a,o),i.stroke()),this.renderText(i,this.xShift+this.padding,r-this.padding)}}class vi extends Pt{static get CATEGORY(){return"StaveTempo"}constructor(e,i,n){super(),this.durationToCode={"1/4":E.metNoteDoubleWholeSquare,long:E.metNoteDoubleWholeSquare,"1/2":E.metNoteDoubleWhole,breve:E.metNoteDoubleWhole,1:E.metNoteWhole,whole:E.metNoteWhole,w:E.metNoteWhole,2:E.metNoteHalfUp,half:E.metNoteHalfUp,h:E.metNoteHalfUp,4:E.metNoteQuarterUp,quarter:E.metNoteQuarterUp,q:E.metNoteQuarterUp,8:E.metNote8thUp,eighth:E.metNote8thUp,16:E.metNote16thUp,"16th":E.metNote16thUp,32:E.metNote32ndUp,"32nd":E.metNote32ndUp,64:E.metNote64thUp,"64th":E.metNote64thUp,128:E.metNote128thUp,"128th":E.metNote128thUp,256:E.metNote256thUp,"256th":E.metNote256thUp,512:E.metNote512thUp,"512th":E.metNote512thUp,1024:E.metNote1024thUp,"1024th":E.metNote1024thUp},this.tempo=e,this.position=O.ABOVE,this.x=i,this.setXShift(10),this.setYShift(n)}setTempo(e){return this.tempo=e,this}draw(){const e=this.checkStave(),i=e.getModifierXShift(this.getPosition()),n=e.checkContext();this.setRendered();const{name:a,duration:o,dots:r,bpm:s,duration2:c,dots2:u,parenthesis:d}=this.tempo;let h=this.x+i;const l=e.getYForTopText(1),g=new p("StaveTempo.glyph"),f=new p("StaveTempo");if(a&&(this.text=a,this.fontInfo=F.getFontInfo("StaveTempo.name"),this.renderText(n,i,l),h+=this.getWidth()+3),(a&&o||d)&&(f.setText("("),f.renderText(n,h+this.xShift,l+this.yShift),h+=f.getWidth()+3),o){if(g.setText(this.durationToCode[o]),g.renderText(n,h+this.xShift,l+this.yShift),h+=g.getWidth()+3,r){g.setText(E.metAugmentationDot);for(let S=0;S<r;S++)g.renderText(n,h+this.xShift,l+2+this.yShift),h+=g.getWidth()+3}if(f.setText("="),f.renderText(n,h+this.xShift,l+this.yShift),h+=f.getWidth()+3,c){if(g.setText(this.durationToCode[c]),g.renderText(n,h+this.xShift,l+this.yShift),h+=g.getWidth()+3,u){g.setText(E.metAugmentationDot);for(let S=0;S<u;S++)g.renderText(n,h+this.xShift,l+2+this.yShift),h+=g.getWidth()+3}}else s&&(f.setText(""+s),f.renderText(n,h+this.xShift,l+this.yShift),h+=f.getWidth()+3);(a||d)&&(f.setText(")"),f.renderText(n,h+this.xShift,l+this.yShift))}}}var mt;(function(t){t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"})(mt||(mt={}));class ne extends ${static get CATEGORY(){return"TextNote"}static get GLYPHS(){return{segno:E.segno,tr:E.ornamentTrill,mordent:E.ornamentMordent,mordentUpper:E.ornamentShortTrill,mordentLower:E.ornamentMordent,f:E.dynamicForte,p:E.dynamicPiano,m:E.dynamicMezzo,s:E.dynamicSforzando,z:E.dynamicZ,coda:E.coda,pedalOpen:E.keyboardPedalPed,pedalClose:E.keyboardPedalUp,caesuraStraight:E.caesura,caesuraCurved:E.caesuraCurved,breath:E.breathMarkComma,tick:E.breathMarkTick,turn:E.ornamentTurn,turnInverted:E.ornamentTurnSlash}}constructor(e){var i,n;super(e),this.text=(i=e.text)!==null&&i!==void 0?i:"",e.glyph&&(this.text+=ne.GLYPHS[e.glyph]||e.glyph),e.font?this.setFont(e.font):e.glyph===void 0&&this.setFont(F.getFontInfo("TextNote.text.fontSize"));const a=W.convertSizeToPointValue(this.fontInfo.size)*.769231;e.superscript&&(this.superscript=new p("TexNote.subSuper"),this.superscript.setText(e.superscript),this.superscript.setFontSize(a)),e.subscript&&(this.subscript=new p("TexNote.subSuper"),this.subscript.setText(e.subscript),this.subscript.setFontSize(a)),this.line=(n=e.line)!==null&&n!==void 0?n:0,this.smooth=e.smooth||!1,this.ignoreTicks=e.ignoreTicks||!1,this.justification=mt.LEFT}setJustification(e){return this.justification=e,this}setLine(e){return this.line=e,this}getLine(){return this.line}preFormat(){if(this.preFormatted)return;const e=this.checkTickContext("Can't preformat without a TickContext.");this.justification===mt.CENTER?this.leftDisplacedHeadPx=this.width/2:this.justification===mt.RIGHT&&(this.leftDisplacedHeadPx=this.width),this.rightDisplacedHeadPx=e.getMetrics().glyphPx/2,this.preFormatted=!0}draw(){const e=this.checkContext(),i=this.checkStave(),n=this.checkTickContext("Can't draw without a TickContext.");this.setRendered();let a=this.getAbsoluteX()+n.getMetrics().glyphPx/2;const o=this.getWidth();this.justification===mt.CENTER?a-=o/2:this.justification===mt.RIGHT&&(a-=o);const r=i.getYForLine(this.line+-3);this.renderText(e,a,r);const s=this.getHeight();this.superscript&&this.superscript.renderText(e,a+this.width+2,r-s/2.2),this.subscript&&this.subscript.renderText(e,a+this.width+2,r+s/2.2-1)}}ne.Justification=mt;class pi extends Pt{static get CATEGORY(){return"StaveText"}constructor(e,i,n={}){var a,o,r;super(),this.setText(e),this.setXShift((a=n.shiftX)!==null&&a!==void 0?a:0),this.setYShift((o=n.shiftY)!==null&&o!==void 0?o:0),this.position=i,this.justification=(r=n.justification)!==null&&r!==void 0?r:ne.Justification.CENTER}draw(){const e=this.checkStave(),i=e.checkContext();this.setRendered();let n,a;switch(this.position){case O.LEFT:case O.RIGHT:a=(e.getYForLine(0)+e.getBottomLineY())/2,this.position===O.LEFT?n=e.getX()-this.width-24:n=e.getX()+e.getWidth()+24;break;case O.ABOVE:case O.BELOW:n=e.getX(),this.justification===mt.CENTER?n+=e.getWidth()/2-this.width/2:this.justification===mt.RIGHT&&(n+=e.getWidth()-this.width),this.position===O.ABOVE?a=e.getYForTopText(2):a=e.getYForBottomText(2);break;default:throw new w("InvalidPosition","Value Must be in Modifier.Position.")}this.renderText(i,n,a+4)}}var Wt;(function(t){t[t.NONE=1]="NONE",t[t.BEGIN=2]="BEGIN",t[t.MID=3]="MID",t[t.END=4]="END",t[t.BEGIN_END=5]="BEGIN_END"})(Wt||(Wt={}));class Ni extends Pt{static get CATEGORY(){return"Volta"}static get type(){return Wt}constructor(e,i,n,a){super(),this.type=e,this.x=n,this.yShift=a,this.text=i}draw(){const e=this.checkStave(),i=e.getModifierXShift(this.getPosition()),n=e.checkContext();this.setRendered();let a=e.getWidth()-i;const o=e.getYForTopText(e.getNumLines())+this.yShift,r=1.5*e.getSpacingBetweenLines();switch(this.type){case Wt.BEGIN:n.fillRect(this.x+i,o,1,r);break;case Wt.END:a-=5,n.fillRect(this.x+i+a,o,1,r);break;case Wt.BEGIN_END:a-=3,n.fillRect(this.x+i,o,1,r),n.fillRect(this.x+i+a,o,1,r);break}(this.type===Wt.BEGIN||this.type===Wt.BEGIN_END)&&this.renderText(n,i+5,o-this.yShift+15),n.fillRect(this.x+i,o,a,1)}}const Rn=t=>{t.split("/").forEach(i=>{if(/^[0-9+\-()]+$/.test(i)===!1)throw new w("BadTimeSignature",`Invalid time spec: ${t}. Must contain valid signatures.`)})};class pt extends Pt{static get CATEGORY(){return"TimeSignature"}constructor(e="4/4",i=15,n=!0){super(),this.timeSpec="4/4",this.line=0,this.isNumeric=!0,this.topStartX=0,this.botStartX=0,this.lineShift=0,this.topText=new p,this.botText=new p,this.validateArgs=n;const a=i;this.topLine=1,this.bottomLine=3,this.setPosition(O.BEGIN),this.setTimeSig(e),this.setPadding(a)}static getTimeSigCode(e,i=!1){let n=E.null;switch(e){case"C":n=E.timeSigCommon;break;case"C|":n=E.timeSigCutCommon;break;case"+":n=i?E.timeSigPlusSmall:E.timeSigPlus;break;case"-":n=E.timeSigMinus;break;case"(":n=i?E.timeSigParensLeftSmall:E.timeSigParensLeft;break;case")":n=i?E.timeSigParensRightSmall:E.timeSigParensRight;break;default:n=String.fromCodePoint(57472+Number(e[0]));break}return n}makeTimeSignatureGlyph(e,i){let n="",a=0,o=0;for(let s=0;s<e.length;++s){const c=pt.getTimeSigCode(e[s],i.length>0);n+=c}this.topText.setText(n),a=this.topText.getWidth(),o=this.topText.getHeight();let r=0;n="";for(let s=0;s<i.length;++s){const c=pt.getTimeSigCode(i[s],!0);n+=c}this.botText.setText(n),r=this.botText.getWidth(),o=Math.max(o,this.botText.getHeight()),this.lineShift=o>30?.5:0,this.width=Math.max(a,r),this.topStartX=(this.width-a)/2,this.botStartX=(this.width-r)/2}setTimeSig(e){var i,n;if(this.timeSpec=e,e==="C"||e==="C|"){const a=pt.getTimeSigCode(e);this.line=2,this.text=a,this.isNumeric=!1}else{this.validateArgs&&Rn(e);const a=e.split("/");this.line=0,this.isNumeric=!0,this.makeTimeSignatureGlyph((i=a[0])!==null&&i!==void 0?i:"",(n=a[1])!==null&&n!==void 0?n:"")}return this}getTimeSpec(){return this.timeSpec}getLine(){return this.line}setLine(e){this.line=e}getIsNumeric(){return this.isNumeric}setIsNumeric(e){this.isNumeric=e}draw(){const e=this.checkStave(),i=e.checkContext();this.setRendered(),i.openGroup("timesignature",this.getAttribute("id")),this.drawAt(i,e,this.x),i.closeGroup()}drawAt(e,i,n){if(this.setRendered(),this.isNumeric){let a=n+this.topStartX,o=0;this.botText.getText().length>0?o=i.getYForLine(this.topLine-this.lineShift):o=(i.getYForLine(this.topLine)+i.getYForLine(this.bottomLine))/2,this.topText.renderText(e,a,o),a=n+this.botStartX,o=i.getYForLine(this.bottomLine+this.lineShift),this.botText.renderText(e,a,o)}else this.renderText(e,n-this.x,i.getYForLine(this.line))}}const Pn={[At.CATEGORY]:0,[ut.CATEGORY]:1,[ie.CATEGORY]:2,[pt.CATEGORY]:3},Mn={[pt.CATEGORY]:0,[ie.CATEGORY]:1,[At.CATEGORY]:2,[ut.CATEGORY]:3};class Vt extends p{static get CATEGORY(){return"Stave"}static get defaultPadding(){return F.get("Stave.padding")+F.get("Stave.endPaddingMax")}static get rightPadding(){return F.get("Stave.endPaddingMax")}constructor(e,i,n,a){super(),this.x=e,this.y=i,this.width=n,this.formatted=!1,this.startX=e+5,this.endX=e+n,this.modifiers=[],this.measure=0,this.clef="treble",this.endClef=void 0,this.options=Object.assign({verticalBarWidth:10,numLines:5,leftBar:!0,rightBar:!0,spacingBetweenLinesPx:D.STAVE_LINE_DISTANCE,spaceAboveStaffLn:4,spaceBelowStaffLn:4,topTextPosition:1,bottomTextPosition:4,lineConfig:[]},a),this.bounds={x:this.x,y:this.y,w:this.width,h:0},this.defaultLedgerLineStyle={strokeStyle:"#444",lineWidth:2},this.resetLines(),this.addModifier(new At(this.options.leftBar?I.SINGLE:I.NONE)),this.addEndModifier(new At(this.options.rightBar?I.SINGLE:I.NONE))}setDefaultLedgerLineStyle(e){this.defaultLedgerLineStyle=e}getDefaultLedgerLineStyle(){return Object.assign(Object.assign({},this.getStyle()),this.defaultLedgerLineStyle)}space(e){return this.options.spacingBetweenLinesPx*e}resetLines(){this.options.lineConfig=[];for(let e=0;e<this.options.numLines;e++)this.options.lineConfig.push({visible:!0});this.height=(this.options.numLines+this.options.spaceAboveStaffLn)*this.options.spacingBetweenLinesPx,this.options.bottomTextPosition=this.options.numLines}setNoteStartX(e){return this.formatted||this.format(),this.startX=e,this}getNoteStartX(){return this.formatted||this.format(),this.startX}getNoteEndX(){return this.formatted||this.format(),this.endX}getTieStartX(){return this.startX}getTieEndX(){return this.endX}getNumLines(){return this.options.numLines}setNumLines(e){return this.options.numLines=e,this.resetLines(),this}getTopLineTopY(){return this.getYForLine(0)}getBottomLineBottomY(){var e;return this.getYForLine(this.getNumLines()-1)+((e=this.getStyle().lineWidth)!==null&&e!==void 0?e:1)}setX(e){const i=e-this.x;this.formatted=!1,this.x=e,this.startX+=i,this.endX+=i;for(let n=0;n<this.modifiers.length;n++){const a=this.modifiers[n];a.setX(a.getX()+i)}return this}setWidth(e){return this.formatted=!1,this.width=e,this.endX=this.x+e,this}setMeasure(e){return this.measure=e,this}getMeasure(){return this.measure}getModifierXShift(e=0){if(typeof e!="number")throw new w("InvalidIndex","Must be of number type");if(this.formatted||this.format(),this.getModifiers(O.BEGIN).length===1||this.modifiers[e].getPosition()===O.RIGHT)return 0;let i=this.startX-this.x;const n=this.modifiers[0];return n.getType()===I.REPEAT_BEGIN&&i>n.getWidth()&&(i-=n.getWidth()),i}setRepetitionType(e,i=0){return this.modifiers.push(new z(e,this.x,i)),this}setVoltaType(e,i,n){return this.modifiers.push(new Ni(e,i,this.x,n)),this}setSection(e,i,n=0,a,o=!0){const r=new On(e).setYShift(i).setXShift(n).setDrawRect(o);return a&&r.setFontSize(a),this.addModifier(r),this}setTempo(e,i){return this.modifiers.push(new vi(e,this.x,i)),this}setStaveText(e,i,n={}){return this.modifiers.push(new pi(e,i,n)),this}getSpacingBetweenLines(){return this.options.spacingBetweenLinesPx}getBoundingBox(){return new Nt(this.x,this.y,this.width,this.getBottomY()-this.y)}getBottomY(){const e=this.options,i=e.spacingBetweenLinesPx;return this.getYForLine(e.numLines)+e.spaceBelowStaffLn*i}getBottomLineY(){return this.getYForLine(this.options.numLines)}getYForLine(e){const i=this.options,n=i.spacingBetweenLinesPx,a=i.spaceAboveStaffLn;return this.y+e*n+a*n}getLineForY(e){const i=this.options,n=i.spacingBetweenLinesPx,a=i.spaceAboveStaffLn;return(e-this.y)/n-a}getYForTopText(e=0){return this.getYForLine(-e-this.options.topTextPosition)}getYForBottomText(e=0){return this.getYForLine(this.options.bottomTextPosition+e)}getYForNote(e){const i=this.options,n=i.spacingBetweenLinesPx,a=i.spaceAboveStaffLn;return this.y+a*n+5*n-e*n}getYForGlyphs(){return this.getYForLine(3)}addModifier(e,i){return i!==void 0&&e.setPosition(i),e.setStave(this),this.formatted=!1,this.modifiers.push(e),this}addEndModifier(e){return this.addModifier(e,O.END),this}setBegBarType(e){const{SINGLE:i,REPEAT_BEGIN:n,NONE:a}=I;return(e===i||e===n||e===a)&&(this.modifiers[0].setType(e),this.formatted=!1),this}setEndBarType(e){return e!==I.REPEAT_BEGIN&&(this.modifiers[1].setType(e),this.formatted=!1),this}setClef(e,i,n,a){a===void 0&&(a=O.BEGIN),a===O.END?this.endClef=e:this.clef=e;const o=this.getModifiers(a,ut.CATEGORY);return o.length===0?this.addClef(e,i,n,a):o[0].setType(e,i,n),this}getClef(){return this.clef}setEndClef(e,i,n){return this.setClef(e,i,n,O.END),this}getEndClef(){return this.endClef}setKeySignature(e,i,n){n===void 0&&(n=O.BEGIN);const a=this.getModifiers(n,ie.CATEGORY);return a.length===0?this.addKeySignature(e,i,n):a[0].setKeySig(e,i),this}setEndKeySignature(e,i){return this.setKeySignature(e,i,O.END),this}setTimeSignature(e,i,n){n===void 0&&(n=O.BEGIN);const a=this.getModifiers(n,pt.CATEGORY);return a.length===0?this.addTimeSignature(e,i,n):a[0].setTimeSig(e),this}setEndTimeSignature(e,i){return this.setTimeSignature(e,i,O.END),this}addKeySignature(e,i,n){return n===void 0&&(n=O.BEGIN),this.addModifier(new ie(e,i).setPosition(n),n),this}addClef(e,i,n,a){return a===void 0||a===O.BEGIN?this.clef=e:a===O.END&&(this.endClef=e),this.addModifier(new ut(e,i,n),a),this}addEndClef(e,i,n){return this.addClef(e,i,n,O.END),this}addTimeSignature(e,i,n){return this.addModifier(new pt(e,i),n),this}addEndTimeSignature(e,i){return this.addTimeSignature(e,i,O.END),this}addTrebleGlyph(){return this.addClef("treble"),this}getModifiers(e,i){const n=e===void 0,a=i===void 0;return n&&a?this.modifiers:n?this.modifiers.filter(o=>i===o.getCategory()):a?this.modifiers.filter(o=>e===o.getPosition()):this.modifiers.filter(o=>e===o.getPosition()&&i===o.getCategory())}sortByCategory(e,i){for(let n=e.length-1;n>=0;n--)for(let a=0;a<n;a++)if(i[e[a].getCategory()]>i[e[a+1].getCategory()]){const o=e[a];e[a]=e[a+1],e[a+1]=o}}format(){var e,i,n,a;const o=this.modifiers[0],r=this.modifiers[1],s=this.getModifiers(O.BEGIN),c=this.getModifiers(O.END);this.sortByCategory(s,Pn),this.sortByCategory(c,Mn),s.length>1&&o.getType()===I.REPEAT_BEGIN&&(s.push(s.splice(0,1)[0]),s.splice(0,0,new At(I.SINGLE))),c.indexOf(r)>0&&c.splice(0,0,new At(I.NONE));let u,d,h,l=0,g=this.x;for(let x=0;x<s.length;x++)h=s[x],d=h.getPadding(x+l),u=h.getWidth(),g+=d,h.setX(g),g+=u,d+u===0&&l--;this.startX=g,g=this.x+this.width;const f={left:0,right:0,paddingRight:0,paddingLeft:0};let S=0;for(let x=0;x<c.length;x++){h=c[x],S=Ci(h)?x:S,f.right=0,f.left=0,f.paddingRight=0,f.paddingLeft=0;const m=h.getLayoutMetrics();m?(x!==0&&(f.right=(e=m.xMax)!==null&&e!==void 0?e:0,f.paddingRight=(i=m.paddingRight)!==null&&i!==void 0?i:0),f.left=-((n=m.xMin)!==null&&n!==void 0?n:0),f.paddingLeft=(a=m.paddingLeft)!==null&&a!==void 0?a:0,x===c.length-1&&(f.paddingLeft=0)):(f.paddingRight=h.getPadding(x-S),x!==0&&(f.right=h.getWidth()),x===0&&(f.left=h.getWidth())),g-=f.paddingRight,g-=f.right,h.setX(g),g-=f.left,g-=f.paddingLeft}this.endX=c.length===1?this.x+this.width:g,this.formatted=!0}draw(){var e;const i=this.checkContext();this.setRendered(),i.openGroup("stave",this.getAttribute("id")),this.formatted||this.format();const n=this.options.numLines,a=this.width,o=this.x;let r;const c=((e=this.getStyle().lineWidth)!==null&&e!==void 0?e:1)%2===0?0:.5;for(let u=0;u<n;u++)r=this.getYForLine(u),this.options.lineConfig[u].visible&&(i.beginPath(),i.moveTo(o,r+c),i.lineTo(o+a,r+c),i.stroke());i.closeGroup();for(let u=0;u<this.modifiers.length;u++){const d=this.modifiers[u];d.setContext(i),d.setStave(this),d.drawWithStyle()}if(this.measure>0){i.setFont(this.fontInfo);const u=i.measureText(""+this.measure).width;r=this.getYForTopText(0)+3,i.fillText(""+this.measure,this.x-u/2,r)}}getVerticalBarWidth(){return this.options.verticalBarWidth}getConfigForLines(){return this.options.lineConfig}setConfigForLine(e,i){if(e>=this.options.numLines||e<0)throw new w("StaveConfigError","The line number must be within the range of the number of lines in the Stave.");if(i.visible===void 0)throw new w("StaveConfigError","The line configuration object is missing the 'visible' property.");if(typeof i.visible!="boolean")throw new w("StaveConfigError","The line configuration objects 'visible' property must be true or false.");return this.options.lineConfig[e]=i,this}setConfigForLines(e){if(e.length!==this.options.numLines)throw new w("StaveConfigError","The length of the lines configuration array must match the number of lines in the Stave");for(const i in e)e[i].visible===void 0&&(e[i]=this.options.lineConfig[i]),this.options.lineConfig[i]=Object.assign(Object.assign({},this.options.lineConfig[i]),e[i]);return this.options.lineConfig=e,this}static formatBegModifiers(e){const i=a=>{let o=0;e.forEach(s=>{const c=s.getModifiers(O.BEGIN,a);c.length>0&&c[0].getX()>o&&(o=c[0].getX())});let r=0;e.forEach(s=>{r=0,s.getModifiers(O.BEGIN,a).forEach(h=>{o-h.getX()>r&&(r=o-h.getX())});const u=s.getModifiers(O.BEGIN);let d=!1;u.forEach(h=>{h.getCategory()===a&&(d=!0),d&&r>0&&h.setX(h.getX()+r)}),s.setNoteStartX(s.getNoteStartX()+r)})};e.forEach(a=>{a.formatted||a.format()}),i("Clef"),i("KeySignature"),i("TimeSignature");let n=0;e.forEach(a=>{a.getNoteStartX()>n&&(n=a.getNoteStartX())}),e.forEach(a=>{a.setNoteStartX(n)}),n=0,e.forEach(a=>{a.getModifiers(O.BEGIN,"Barline").forEach(r=>{r.getType()===I.REPEAT_BEGIN&&r.getX()>n&&(n=r.getX())})}),e.forEach(a=>{a.getModifiers(O.BEGIN,"Barline").forEach(r=>{r.getType()===I.REPEAT_BEGIN&&r.setX(n)})})}}function gi(t,e,i,n,a){if(e!==R.type.BOLD_DOUBLE_LEFT&&e!==R.type.BOLD_DOUBLE_RIGHT)throw new w("InvalidConnector","A REPEAT_BEGIN or REPEAT_END type must be provided.");let o=3,r=3.5;const s=2;e===R.type.BOLD_DOUBLE_RIGHT&&(o=-5,r=3),t.fillRect(i+o,n,1,a-n),t.fillRect(i-s,n,r,a-n)}class R extends p{static get CATEGORY(){return"StaveConnector"}constructor(e,i){super(),this.thickness=D.STAVE_LINE_THICKNESS,this.topStave=e,this.bottomStave=i,this.type=R.type.DOUBLE,this.xShift=0,this.texts=[]}setType(e){const i=typeof e=="string"?R.typeString[e]:e;return Object.values(R.type).includes(i)&&(this.type=i),this}getType(){return this.type}setText(e,i={}){var n,a;const o=new p("StaveConnector.text");return o.setText(e),o.setXShift((n=i.shiftX)!==null&&n!==void 0?n:0),o.setYShift((a=i.shiftY)!==null&&a!==void 0?a:0),this.texts.push(o),this}draw(){const e=this.checkContext();this.setRendered();let i=this.topStave.getYForLine(0),n=this.bottomStave.getYForLine(this.bottomStave.getNumLines()-1)+this.thickness,a=3,o=this.topStave.getX();(this.type===R.type.SINGLE_RIGHT||this.type===R.type.BOLD_DOUBLE_RIGHT||this.type===R.type.THIN_DOUBLE)&&(o=this.topStave.getX()+this.topStave.getWidth());let s=n-i;const c=new p;switch(this.type){case R.type.SINGLE:a=1;break;case R.type.SINGLE_LEFT:a=1;break;case R.type.SINGLE_RIGHT:a=1;break;case R.type.DOUBLE:o-=5,i-=this.thickness,s+=.5;break;case R.type.BRACE:{a=12;const u=this.topStave.getX()-2+this.xShift,d=i,h=u,l=n,g=u-a,f=d+s/2,S=g-.9*a,x=d+.2*s,m=u+1.1*a,T=f-.135*s,B=m,C=f+.135*s,A=S,L=l-.2*s,N=g-a,M=L,Z=u+.4*a,q=f+.135*s,y=Z,it=f-.135*s,K=N,J=x;e.beginPath(),e.moveTo(u,d),e.bezierCurveTo(S,x,m,T,g,f),e.bezierCurveTo(B,C,A,L,h,l),e.bezierCurveTo(N,M,Z,q,g,f),e.bezierCurveTo(y,it,K,J,u,d),e.fill(),e.stroke();break}case R.type.BRACKET:i-=6,n+=6,s=n-i,c.setText(E.bracketTop),c.renderText(e,o-5,i),c.setText(E.bracketBottom),c.renderText(e,o-5,n),o-=5;break;case R.type.BOLD_DOUBLE_LEFT:gi(e,this.type,o+this.xShift,i,n-this.thickness);break;case R.type.BOLD_DOUBLE_RIGHT:gi(e,this.type,o,i,n-this.thickness);break;case R.type.THIN_DOUBLE:a=1,s-=this.thickness;break;case R.type.NONE:break;default:throw new w("InvalidType",`The provided StaveConnector.type (${this.type}) is invalid.`)}this.type!==R.type.BRACE&&this.type!==R.type.BOLD_DOUBLE_LEFT&&this.type!==R.type.BOLD_DOUBLE_RIGHT&&this.type!==R.type.NONE&&e.fillRect(o,i,a,s),this.type===R.type.THIN_DOUBLE&&e.fillRect(o-3,i,a,s);for(let u=0;u<this.texts.length;u++){const d=this.texts[u],h=this.topStave.getX()-d.getWidth()-24,l=(this.topStave.getYForLine(0)+this.bottomStave.getBottomLineY())/2;d.renderText(e,h,l+4)}}}R.type={SINGLE_RIGHT:0,SINGLE_LEFT:1,SINGLE:1,DOUBLE:2,BRACE:3,BRACKET:4,BOLD_DOUBLE_LEFT:5,BOLD_DOUBLE_RIGHT:6,THIN_DOUBLE:7,NONE:8};R.typeString={singleRight:R.type.SINGLE_RIGHT,singleLeft:R.type.SINGLE_LEFT,single:R.type.SINGLE,double:R.type.DOUBLE,brace:R.type.BRACE,bracket:R.type.BRACKET,boldDoubleLeft:R.type.BOLD_DOUBLE_LEFT,boldDoubleRight:R.type.BOLD_DOUBLE_RIGHT,thinDouble:R.type.THIN_DOUBLE,none:R.type.NONE};function Wn(t,e,i){if(t.length===0)return{map:{},array:[],list:[],resolutionMultiplier:0};const n={},a=[],o=[],r=rt.getResolutionMultiplier(t);return t.forEach((s,c)=>{const u=new P(0,r);s.getTickables().forEach(d=>{const h=u.numerator;if(!n[h]){const l=e({tickID:h});o.push(l),n[h]=l,a.push(h)}i(d,n[h],c),u.add(d.getTicks())})}),{map:n,array:o,list:a.sort((s,c)=>s-c),resolutionMultiplier:r}}function In(...t){rt.DEBUG&&j("VexFlow.Formatter",t)}function fi(t,e,i,n){let a=e;for(let o=i+1;o<t.length;o++){const r=t[o];if(Di(r)&&!r.isRest()&&!r.shouldIgnoreTicks()){a=r.getLineForRest();break}}if(n&&e!==a){const o=Math.max(e,a),r=Math.min(e,a);a=qe(o,r)}return a}class rt{static SimpleFormat(e,i=0,{paddingBetween:n=10}={}){e.reduce((a,o)=>{o.addToModifierContext(new ee);const r=new le().addTickable(o).preFormat(),s=r.getMetrics();return r.setX(a+s.totalLeftPx),a+r.getWidth()+s.totalRightPx+n},i)}static plotDebugging(e,i,n,a,o,r){var s,c;r=Object.assign({stavePadding:F.get("Stave.padding")},r);const u=n+r.stavePadding,d=i.contextGaps;function h(l,g,f){e.beginPath(),e.setStrokeStyle(f),e.setFillStyle(f),e.setLineWidth(1),e.fillRect(l,a,Math.max(g-l,0),o-a)}e.save(),e.setFont(F.get("fontFamily"),8),d.gaps.forEach(l=>{h(u+l.x1,u+l.x2,"rgba(100,200,100,0.4)"),e.setFillStyle("green"),e.fillText(Math.round(l.x2-l.x1).toString(),u+l.x1,o+12)}),e.setFillStyle("red"),e.fillText(`Loss: ${((s=i.totalCost)!==null&&s!==void 0?s:0).toFixed(2)} Shift: ${((c=i.totalShift)!==null&&c!==void 0?c:0).toFixed(2)} Gap: ${d.total.toFixed(2)}`,u-20,o+27),e.restore()}static FormatAndDraw(e,i,n,a){let o={autoBeam:!1,alignRests:!1};typeof a=="object"?o=Object.assign(Object.assign({},o),a):typeof a=="boolean"&&(o.autoBeam=a);const r=new bt(D.TIME4_4).setMode(bt.Mode.SOFT).addTickables(n),s=o.autoBeam?Yt.applyAndGetBeams(r):[];return new rt().joinVoices([r]).formatToStave([r],i,{alignRests:o.alignRests,stave:i}),r.setContext(e).setStave(i).drawWithStyle(),s.forEach(c=>c.setContext(e).drawWithStyle()),r.getBoundingBox()}static FormatAndDrawTab(e,i,n,a,o,r,s){let c={autoBeam:r,alignRests:!1};typeof s=="object"?c=Object.assign(Object.assign({},c),s):typeof s=="boolean"&&(c.autoBeam=s);const u=new bt(D.TIME4_4).setMode(bt.Mode.SOFT).addTickables(o),d=new bt(D.TIME4_4).setMode(bt.Mode.SOFT).addTickables(a),h=c.autoBeam?Yt.applyAndGetBeams(u):[];new rt().joinVoices([u]).joinVoices([d]).formatToStave([u,d],n,{alignRests:c.alignRests}),u.draw(e,n),d.draw(e,i),h.forEach(l=>l.setContext(e).drawWithStyle()),new R(n,i).setContext(e).drawWithStyle()}static AlignRestsToNotes(e,i,n){e.forEach((a,o)=>{if(Ot(a)&&a.isRest()){if(a.getTuplet()&&!n||a.getLineForRest()!==3)return;if(i||a.getBeam()){const s=a.getKeyProps()[0];if(o===0)s.line=fi(e,s.line,o,!1);else if(o>0&&o<e.length){const c=e[o-1];if(Ot(c))if(c.isRest())s.line=c.getKeyProps()[0].line;else{const u=c.getLineForRest();s.line=fi(e,u,o,!0)}}a.setKeyLine(0,s.line)}}})}constructor(e){this.formatterOptions=Object.assign({globalSoftmax:!1,softmaxFactor:D.SOFTMAX_FACTOR,maxIterations:5},e),this.justifyWidth=0,this.totalCost=0,this.totalShift=0,this.durationStats={},this.minTotalWidth=0,this.hasMinTotalWidth=!1,this.tickContexts={map:{},array:[],list:[],resolutionMultiplier:0},this.modifierContexts=[],this.contextGaps={total:0,gaps:[]},this.voices=[],this.lossHistory=[]}alignRests(e,i){if(!e||!e.length)throw new w("BadArgument","No voices to format rests");e.forEach(n=>rt.AlignRestsToNotes(n.getTickables(),i))}preCalculateMinTotalWidth(e){const i=F.get("Stave.unalignedNotePadding");let n=0,a=0,o=0;const r=[],s=[];if(this.hasMinTotalWidth)return this.minTotalWidth;if(!e)throw new w("BadArgument","'voices' required to run preCalculateMinTotalWidth");this.createTickContexts(e);const{list:c,map:u}=this.tickContexts;this.minTotalWidth=0,c.forEach(T=>{const B=u[T];B.preFormat(),B.getTickables().length<e.length&&(n+=1),B.getTickables().forEach(A=>{a+=A.getMetrics().width,o+=A.getTicks().value(),r.push(A.getMetrics().width),s.push(A.getTicks().value())});const C=B.getWidth();this.minTotalWidth+=C}),this.hasMinTotalWidth=!0;const d=a>0?a/r.length:1/r.length,h=he(r.map(T=>Math.pow(T-d,2))),l=Math.pow(h/r.length,.5)/d,g=o/s.length,f=he(s.map(T=>Math.pow(T-g,2))),S=Math.pow(f/s.length,.5)/g,x=Math.max(S,l)*c.length*i,m=i*n;return this.minTotalWidth+Math.max(m,x)}getMinTotalWidth(){if(!this.hasMinTotalWidth)throw new w("NoMinTotalWidth","Call 'preCalculateMinTotalWidth' or 'preFormat' before calling 'getMinTotalWidth'");return this.minTotalWidth}static getResolutionMultiplier(e){if(!e||!e.length)throw new w("BadArgument","No voices to format");const i=e[0].getTotalTicks();return e.reduce((a,o)=>{if(!o.getTotalTicks().equals(i))throw new w("TickMismatch","Voices should have same total note duration in ticks.");if(o.getMode()===bt.Mode.STRICT&&!o.isComplete())throw new w("IncompleteVoice","Voice does not have enough notes.");return Math.max(a,P.LCM(a,o.getResolutionMultiplier()))},1)}createModifierContexts(e){if(e.length===0)return;const i=rt.getResolutionMultiplier(e),n=new Map,a=[];e.forEach(o=>{const r=new P(0,i);o.getTickables().forEach(s=>{const c=r.numerator;let u=n.get(s.getStave());if(u||(n.set(s.getStave(),{}),u=n.get(s.getStave())),!(u&&u[c])){const d=new ee;a.push(d),u[c]=d}s.addToModifierContext(u[c]),r.add(s.getTicks())})}),this.modifierContexts.push({map:n,array:a,resolutionMultiplier:i})}createTickContexts(e){const n=Wn(e,o=>new le(o),(o,r,s)=>r.addTickable(o,s));this.tickContexts=n;const a=this.tickContexts.array;return a.forEach(o=>{o.tContexts=a}),n}getTickContexts(){return this.tickContexts}preFormat(e=0,i,n,a){const o=this.tickContexts;if(!o)throw new w("NoTickContexts","preFormat requires TickContexts");const{list:r,map:s}=o;this.lossHistory=[],n&&a&&n.forEach(tt=>tt.setStave(a).preFormat());let c=0,u=0;this.minTotalWidth=0;let d=0;r.forEach(tt=>{const et=s[tt];et.preFormat();const G=et.getWidth();this.minTotalWidth+=G;const nt=et.getMaxTicks().value();d+=nt;const Ft=et.getMetrics();c=c+u+Ft.totalLeftPx,et.setX(c),u=G-Ft.totalLeftPx});const{globalSoftmax:h,softmaxFactor:l,maxIterations:g}=this.formatterOptions,f=tt=>Math.pow(l,s[tt].getMaxTicks().value()/d),S=he(r.map(f));if(this.minTotalWidth=c+u,this.hasMinTotalWidth=!0,e<=0)return this.evaluate();const x=s[r[0]],m=s[r[r.length-1]];function T(tt){return r.map((G,nt)=>{const Ft=s[G],zt=Ft.getTickablesByVoice();let Mt;if(nt>0){const re=s[r[nt-1]];for(let Ht=nt-1;Ht>=0;Ht--){const se=s[r[Ht]].getTickablesByVoice(),Ue=[];if(Object.keys(zt).forEach(jt=>{se[jt]&&Ue.push(jt)}),Ue.length>0){let jt=0,ce=1/0,Xe=0;return Ue.forEach(Jt=>{const ai=se[Jt].getTicks().value();ai>jt&&(Mt=se[Jt],jt=ai);const Ve=zt[Jt],Ui=Ve.getX()-(Ve.getMetrics().modLeftPx+Ve.getMetrics().leftDisplacedHeadPx),Ye=se[Jt].getMetrics(),Xi=se[Jt].getX()+Ye.notePx+Ye.modRightPx+Ye.rightDisplacedHeadPx;ce=Math.min(ce,Ui-Xi)}),ce=Math.min(ce,Ft.getX()-(re.getX()+tt*.05)),h?Xe=Math.pow(l,jt/d)/S*tt:typeof Mt<"u"&&(Xe=Mt.getVoice().softmax(jt)*tt),{expectedDistance:Xe,maxNegativeShiftPx:ce,fromTickable:Mt}}}}return{expectedDistance:0,fromTickablePx:0,maxNegativeShiftPx:0}})}function B(tt){const et=C/2;let G=0;return r.forEach((nt,Ft)=>{const zt=s[nt];if(Ft>0){const Mt=zt.getX(),re=tt[Ft],Ht=_(re.fromTickable).getX()+re.expectedDistance-(Mt+G);let He=0;Ht>0?G+=Ht:Ht<0&&(He=Math.min(re.maxNegativeShiftPx,Math.abs(Ht)),G+=-He),zt.setX(Mt+G)}zt.getCenterAlignedTickables().forEach(Mt=>{Mt.setCenterXShift(et-zt.getX())})}),m.getX()-x.getX()}const C=e-m.getMetrics().notePx-m.getMetrics().totalRightPx-x.getMetrics().totalLeftPx,A=F.get("Stave.endPaddingMin"),L=F.get("Stave.endPaddingMax"),N=F.get("Stave.padding");let M=C;const Z=T(M);let q=B(Z);if(r.length===1)return 0;const it=((tt,et)=>{let G=tt/2;if(et.length>1)for(let nt=1;nt<et.length;++nt)G=Math.min(et[nt].expectedDistance/2,G);return G})(M,Z),K=tt=>{let et=0;const G=m&&m.getMaxTickable();if(G){const nt=G.getVoice();if(nt.getTicksUsed().value()>nt.getTotalTicks().value())return L*2<it?it:L;const Ft=G.getWidth();et=nt.softmax(m.getMaxTicks().value())*tt-(Ft+N)}return L*2<et?et:L};let J=K(M),ht=J-(L-A);const Qt=C-ht;let _t=g;for(;q>Qt&&_t>0||q+J<Qt&&_t>1;)M-=q-Qt,J=K(M),ht=J-(L-A),q=B(T(M)),_t--;return this.justifyWidth=e,this.evaluate()}evaluate(){const e=this.tickContexts,i=this.justifyWidth;this.contextGaps={total:0,gaps:[]},e.list.forEach((r,s)=>{if(s===0)return;const c=e.list[s-1],u=e.map[c],d=e.map[r],h=u.getMetrics(),l=d.getMetrics(),g=u.getX()+h.notePx+h.totalRightPx,f=d.getX()-l.totalLeftPx,S=f-g;this.contextGaps.total+=S,this.contextGaps.gaps.push({x1:g,x2:f}),d.getFormatterMetrics().freedom.left=S,u.getFormatterMetrics().freedom.right=S}),this.durationStats={};const n=this.durationStats;function a(r,s){const c=n[r];c===void 0?n[r]={mean:s,count:1,total:s}:(c.count+=1,c.total+=s,c.mean=c.total/c.count)}this.voices.forEach(r=>{r.getTickables().forEach((s,c,u)=>{const d=s.getTicks().clone().simplify().toString(),h=s.getMetrics(),l=s.getFormatterMetrics(),g=s.getX()+h.notePx+h.modRightPx+h.rightDisplacedHeadPx;let f=0;if(c<u.length-1){const S=u[c+1],x=S.getMetrics();f=S.getX()-x.modLeftPx-x.leftDisplacedHeadPx-g,l.space.used=S.getX()-s.getX(),S.getFormatterMetrics().freedom.left=f}else f=i-g,l.space.used=i-s.getX();l.freedom.right=f,a(d,l.space.used)})});let o=0;return this.voices.forEach(r=>{r.getTickables().forEach(s=>{const c=s.getTicks().clone().simplify().toString(),u=s.getFormatterMetrics();u.space.mean=n[c].mean,u.duration=c,u.iterations+=1,u.space.deviation=u.space.used-u.space.mean,o+=Math.pow(u.space.deviation,2)})}),this.totalCost=Math.sqrt(o),this.lossHistory.push(this.totalCost),this.totalCost}tune(e){var i;const n=this.tickContexts;if(!n)return 0;const a=(i=e?.alpha)!==null&&i!==void 0?i:.5;let o=0;return this.totalShift=0,n.list.forEach((r,s,c)=>{const u=n.map[r],d=s>0?n.map[c[s-1]]:void 0,h=s<c.length-1?n.map[c[s+1]]:void 0;u.move(o,d,h);const l=-u.getDeviationCost();l>0?o=-Math.min(u.getFormatterMetrics().freedom.right,Math.abs(l)):l<0&&(h?o=Math.min(h.getFormatterMetrics().freedom.right,Math.abs(l)):o=0),o*=a,this.totalShift+=o}),this.evaluate()}postFormat(){return this.modifierContexts.forEach(e=>{e.array.forEach(i=>i.postFormat())}),this.tickContexts.list.forEach(e=>{this.tickContexts.map[e].postFormat()}),this}joinVoices(e){return this.createModifierContexts(e),this.hasMinTotalWidth=!1,this}format(e,i,n){const a=Object.assign({alignRests:!1},n);this.voices=e;const o=this.formatterOptions.softmaxFactor;return o&&this.voices.forEach(r=>r.setSoftmaxFactor(o)),this.alignRests(e,a.alignRests),this.createTickContexts(e),this.preFormat(i,a.context,e,a.stave),a.stave&&this.postFormat(),this}formatToStave(e,i,n){const a=Object.assign({context:i.getContext()},n),o=i.getNoteEndX()-i.getNoteStartX()-Vt.defaultPadding;return In("Formatting voices to width: ",o),this.format(e,o,a)}getTickContext(e){var i;return(i=this.tickContexts)===null||i===void 0?void 0:i.map[e]}}rt.DEBUG=!1;const mi="Ghost note must have valid initialization data to identify duration.";class Oi extends Ge{static get CATEGORY(){return"GhostNote"}constructor(e){if(!e)throw new w("BadArguments",mi);let i;if(typeof e=="string")i={duration:e};else if(typeof e=="object")i=e;else throw new w("BadArguments",mi);super(i),this.setWidth(0)}isRest(){return!0}setStave(e){return super.setStave(e),this}addToModifierContext(e){return this}preFormat(){return this.preFormatted=!0,this}draw(){this.setRendered();for(let e=0;e<this.modifiers.length;++e){const i=this.modifiers[e];yi(i)&&(i.setContext(this.getContext()),i.drawWithStyle())}}}class ni extends ${static get CATEGORY(){return"GlyphNote"}constructor(e,i,n){super(i),this.options=Object.assign({ignoreTicks:!1,line:2},n),this.ignoreTicks=this.options.ignoreTicks,this.setGlyph(e)}setGlyph(e){return this.text=e,this}preFormat(){return!this.preFormatted&&this.modifierContext&&this.modifierContext.preFormat(),this.preFormatted=!0,this}drawModifiers(){const e=this.checkContext();for(let i=0;i<this.modifiers.length;i++){const n=this.modifiers[i];n.setContext(e),n.drawWithStyle()}}draw(){const e=this.checkStave(),i=e.checkContext();this.setRendered(),i.openGroup("glyphNote",this.getAttribute("id")),this.x=this.isCenterAligned()?this.getAbsoluteX()-this.getWidth()/2:this.getAbsoluteX(),this.y=e.getYForLine(this.options.line),this.renderText(i,0,0),this.drawModifiers(),i.closeGroup()}}class We extends Tt{static get CATEGORY(){return"GraceNote"}static get LEDGER_LINE_OFFSET(){return 2}constructor(e){super(Object.assign({strokePx:We.LEDGER_LINE_OFFSET},e)),this.slash=e.slash||!1,this.slur=!0,this.buildNoteHeads(),this.width=3}getStemExtension(){if(this.stemExtensionOverride)return this.stemExtensionOverride;let e=super.getStemExtension();return e=k.HEIGHT*this.getFontScale()-k.HEIGHT+e,e}draw(){super.draw(),this.setRendered();const e=this.stem;if(this.slash&&e){const i=this.getFontScale();let n;const a=this.beam;if(a)a.postFormatted||a.postFormat(),n=this.calcBeamedNotesSlashBBox(8*i,8*i,{stem:6*i,beam:5*i});else{const r=this.getStemDirection(),s=this.getNoteHeadBounds(),c=this.noteHeads[0].getWidth(),u=r===k.DOWN?this.getAbsoluteX():this.getAbsoluteX()+c,d=D.STEM_HEIGHT*i/2,h=r===k.DOWN?s.yBottom+d:s.yTop-d;r===k.DOWN?n={x1:u-c,y1:h-c,x2:u+c,y2:h+c}:n={x1:u-c,y1:h+c,x2:u+c,y2:h-c}}const o=this.checkContext();o.setLineWidth(1*i),o.beginPath(),o.moveTo(n.x1,n.y1),o.lineTo(n.x2,n.y2),o.closePath(),o.stroke()}}calcBeamedNotesSlashBBox(e,i,n){const a=this.beam;if(!a)throw new w("NoBeam","Can't calculate without a beam.");const o=a.slope,s=a.notes[a.notes.length-1]===this?-1:1,c=Math.atan(o*s),u={dx:Math.cos(c)*i,dy:Math.sin(c)*i};e*=this.getStemDirection();const d=Math.atan((u.dy-e)/u.dx),h=Math.cos(d)*n.stem*s,l=Math.sin(d)*n.stem,g=Math.cos(d)*n.beam*s,f=Math.sin(d)*n.beam,S=this.getStemX(),x=a.notes[0].getStemX(),m=a.getBeamYToDraw()+(S-x)*o;return{x1:S-h,y1:m+e-l,x2:S+u.dx*s+g,y2:m+u.dy+f}}}class Ri extends ${static get CATEGORY(){return"KeySigNote"}constructor(e,i,n){super({duration:"b"}),this.keySignature=new ie(e,i,n),this.ignoreTicks=!0}addToModifierContext(e){return this}preFormat(){return this.preFormatted=!0,this.keySignature.setStave(this.checkStave()),this.setWidth(this.keySignature.getWidth()),this}draw(){const e=this.checkStave().checkContext();this.setRendered(),this.keySignature.setX(this.getAbsoluteX()),this.keySignature.setContext(e),this.keySignature.drawWithStyle()}}class Pi extends p{static get CATEGORY(){return"MultiMeasureRest"}constructor(e,i){var n;super(),this.xs={left:NaN,right:NaN},this.hasPaddingLeft=!1,this.hasPaddingRight=!1,this.hasLineThickness=!1,this.hasSymbolSpacing=!1;const a=(n=i.numberGlyphPoint)!==null&&n!==void 0?n:F.get("MultiMeasureRest.fontSize");this.fontInfo.size=a,this.numberOfMeasures=e,this.text="";const o=`${this.numberOfMeasures}`;for(const r of o)this.text+=String.fromCodePoint(57472+Number(r));this.hasPaddingLeft=typeof i.paddingLeft=="number",this.hasPaddingRight=typeof i.paddingRight=="number",this.hasLineThickness=typeof i.lineThickness=="number",this.hasSymbolSpacing=typeof i.symbolSpacing=="number",this.renderOptions=Object.assign({useSymbols:!1,showNumber:!0,numberLine:-.5,numberGlyphPoint:a,line:2,spacingBetweenLinesPx:D.STAVE_LINE_DISTANCE,serifThickness:2,semibreveRestGlyphScale:F.get("fontSize"),paddingLeft:0,paddingRight:0,lineThickness:5,symbolSpacing:0},i)}getXs(){return this.xs}setStave(e){return this.stave=e,this}getStave(){return this.stave}checkStave(){return _(this.stave,"NoStave","No stave attached to instance.")}drawLine(e,i,n,a){const o=this.renderOptions,r=e.getYForLine(o.line),s=(a-n)*.1;n+=s,a-=s;let c="";const u=new p;u.setText(c);const d=u.getWidth();if(!d)throw new w("Cannot drawLine if width is 0");for(let h=1;(h+2)*d+n<=a;h++)c+="";c+="",u.setText(c),u.renderText(i,n+(a-n)*.5-u.getWidth()*.5,r)}drawSymbols(e,i,n,a){const o=Math.floor(this.numberOfMeasures/4),r=this.numberOfMeasures%4,s=Math.floor(r/2),c=r%2,u=this.renderOptions,d=new p;let h="";for(let T=0;T<o;++T)h+=E.restLonga+" ";for(let T=0;T<s;++T)h+=E.restDoubleWhole+" ";d.setText(h);const l=new p;h="";for(let T=0;T<c;++T)h+=E.restWhole+" ";l.setText(h);const g=d.getWidth()+l.getWidth();let f=n+(a-n)*.5-g*.5;const S=u.line,x=e.getYForLine(S-1),m=e.getYForLine(S);d.renderText(i,f,m),f+=d.getWidth(),l.renderText(i,f,x),f+=l.getWidth()}draw(){const e=this.checkContext();this.setRendered();const i=this.checkStave();let n=i.getNoteStartX(),a=i.getNoteEndX();const o=i.getModifiers(O.BEGIN);o.length===1&&Ci(o[0])&&(n-=o[0].getWidth());const r=this.renderOptions;this.hasPaddingLeft&&(n=i.getX()+r.paddingLeft),this.hasPaddingRight&&(a=i.getX()+i.getWidth()-r.paddingRight),this.xs.left=n,this.xs.right=a,r.useSymbols?this.drawSymbols(i,e,n,a):this.drawLine(i,e,n,a),r.showNumber&&this.renderText(e,n+(a-n)*.5-this.width*.5,i.getYForLine(r.numberLine)-this.height*.5)}}function Hn(...t){X.DEBUG&&j("VexFlow.PedalMarking",t)}class X extends p{static get CATEGORY(){return"PedalMarking"}static createSustain(e){return new X(e)}static createSostenuto(e){const i=new X(e);return i.setType(X.type.MIXED),i.setCustomText("Sost. Ped."),i}static createUnaCorda(e){const i=new X(e);return i.setType(X.type.TEXT),i.setCustomText("una corda","tre corda"),i}constructor(e){super(),this.notes=e,this.type=X.type.TEXT,this.line=0,this.depressText=X.GLYPHS.pedalDepress,this.releaseText=X.GLYPHS.pedalRelease,this.renderOptions={bracketHeight:10,textMarginRight:6,bracketLineWidth:1,color:"black"}}setType(e){return e=typeof e=="string"?X.typeString[e]:e,e>=X.type.TEXT&&e<=X.type.MIXED&&(this.type=e),this}setCustomText(e,i){return this.depressText=e||"",this.releaseText=i||"",this.setFont(F.getFontInfo("PedalMarking.text")),this}setLine(e){return this.line=e,this}drawBracketed(){const e=this.checkContext();let i=!1,n,a,o=0;this.notes.forEach((r,s,c)=>{var u,d,h,l;i=!i;const g=r.getAbsoluteX(),f=r.checkStave().getYForBottomText(this.line+3);if(g<n)throw new w("InvalidConfiguration","The notes provided must be in order of ascending x positions");const S=c[s+1]===r,x=c[s-1]===r;let m=0;if(i)m=x?5:0,this.type===X.type.MIXED&&!x?(o=e.measureText(this.depressText).width,e.fillText(this.depressText,g,f),m=o+this.renderOptions.textMarginRight):(e.beginPath(),e.moveTo(g,f-this.renderOptions.bracketHeight),e.lineTo(g+m,f),e.stroke(),e.closePath());else{const T=r.getVoice().getTickables().indexOf(r),B=r.getVoice().getTickables().length,C=T+1<B?r.getVoice().getTickables()[T+1].getAbsoluteX():((d=(u=r.getStave())===null||u===void 0?void 0:u.getX())!==null&&d!==void 0?d:0)+((l=(h=r.getStave())===null||h===void 0?void 0:h.getWidth())!==null&&l!==void 0?l:0);e.beginPath(),e.moveTo(n,a),e.lineTo(S?g-5:C-5,f),e.lineTo(S?g:C-5,f-this.renderOptions.bracketHeight),e.stroke(),e.closePath()}n=g+m,a=f})}drawText(){const e=this.checkContext();let i=!1,n=0;this.notes.forEach(a=>{var o,r,s,c;i=!i;const u=a.checkStave(),d=a.getAbsoluteX(),h=u.getYForBottomText(this.line+3);if(i)n=e.measureText(this.depressText).width,e.fillText(this.depressText,d,h);else{const l=a.getVoice().getTickables().indexOf(a),g=a.getVoice().getTickables().length,f=l+1<g?a.getVoice().getTickables()[l+1].getAbsoluteX():((r=(o=a.getStave())===null||o===void 0?void 0:o.getX())!==null&&r!==void 0?r:0)+((c=(s=a.getStave())===null||s===void 0?void 0:s.getWidth())!==null&&c!==void 0?c:0);n=e.measureText(this.releaseText).width,e.fillText(this.releaseText,f-n,h)}})}draw(){const e=this.checkContext();this.setRendered(),e.setStrokeStyle(this.renderOptions.color),e.setFillStyle(this.renderOptions.color),e.setFont(this.font),Hn("Rendering Pedal Marking"),this.type===X.type.BRACKET||this.type===X.type.MIXED?(e.setLineWidth(this.renderOptions.bracketLineWidth),this.drawBracketed()):this.type===X.type.TEXT&&this.drawText()}}X.DEBUG=!1;X.GLYPHS={pedalDepress:E.keyboardPedalPed,pedalRelease:E.keyboardPedalUp};X.type={TEXT:1,BRACKET:2,MIXED:3};X.typeString={text:X.type.TEXT,bracket:X.type.BRACKET,mixed:X.type.MIXED};const Un={1:E.repeat1Bar,2:E.repeat2Bars,4:E.repeat4Bars,slash:E.repeatBarSlash};class Mi extends ni{static get CATEGORY(){return"RepeatNote"}constructor(e,i,n){const a=Un[e]||"";super(a,Object.assign({duration:"q",alignCenter:e!=="slash"},i),n)}}function Si(t,e,i,n,a,o,r){t.beginPath(),t.moveTo(e,i),t.lineTo(n,a),t.lineTo(o,r),t.lineTo(e,i),t.closePath(),t.fill()}class ft extends p{static get CATEGORY(){return"StaveLine"}constructor(e){super(),this.setNotes(e),this.text="",this.renderOptions={paddingLeft:4,paddingRight:3,lineWidth:1,lineDash:void 0,roundedEnd:!0,color:void 0,drawStartArrow:!1,drawEndArrow:!1,arrowheadLength:10,arrowheadAngle:Math.PI/8,textPositionVertical:ft.TextVerticalPosition.TOP,textJustification:ft.TextJustification.CENTER}}setText(e){return this.text=e,this}setNotes(e){if(!e.firstNote&&!e.lastNote)throw new w("BadArguments","Notes needs to have either firstNote or lastNote set.");if(e.firstIndexes||(e.firstIndexes=[0]),e.lastIndexes||(e.lastIndexes=[0]),e.firstIndexes.length!==e.lastIndexes.length)throw new w("BadArguments","Connected notes must have same number of indexes.");return this.notes=e,this.firstNote=e.firstNote,this.firstIndexes=e.firstIndexes,this.lastNote=e.lastNote,this.lastIndexes=e.lastIndexes,this}applyLineStyle(){const e=this.checkContext(),i=this.renderOptions;i.lineDash&&e.setLineDash(i.lineDash),i.lineWidth&&e.setLineWidth(i.lineWidth),i.roundedEnd?e.setLineCap("round"):e.setLineCap("square")}drawArrowLine(e,i,n){const a=this.renderOptions.drawStartArrow&&this.renderOptions.drawEndArrow,o=i.x,r=i.y,s=n.x,c=n.y,u=Math.sqrt((s-o)*(s-o)+(c-r)*(c-r)),d=(u-this.renderOptions.arrowheadLength/3)/u;let h,l,g,f;this.renderOptions.drawEndArrow||a?(h=Math.round(o+(s-o)*d),l=Math.round(r+(c-r)*d)):(h=s,l=c),this.renderOptions.drawStartArrow||a?(g=o+(s-o)*(1-d),f=r+(c-r)*(1-d)):(g=o,f=r),this.renderOptions.color&&(e.setStrokeStyle(this.renderOptions.color),e.setFillStyle(this.renderOptions.color)),e.beginPath(),e.moveTo(g,f),e.lineTo(h,l),e.stroke(),e.closePath();const S=Math.atan2(c-r,s-o),x=Math.abs(this.renderOptions.arrowheadLength/Math.cos(this.renderOptions.arrowheadAngle));let m,T,B,C,A,L;(this.renderOptions.drawEndArrow||a)&&(m=S+Math.PI+this.renderOptions.arrowheadAngle,B=s+Math.cos(m)*x,C=c+Math.sin(m)*x,T=S+Math.PI-this.renderOptions.arrowheadAngle,A=s+Math.cos(T)*x,L=c+Math.sin(T)*x,Si(e,B,C,s,c,A,L)),(this.renderOptions.drawStartArrow||a)&&(m=S+this.renderOptions.arrowheadAngle,B=o+Math.cos(m)*x,C=r+Math.sin(m)*x,T=S-this.renderOptions.arrowheadAngle,A=o+Math.cos(T)*x,L=r+Math.sin(T)*x,Si(e,B,C,o,r,A,L))}draw(){const e=this.checkContext();this.setRendered();const i=this.firstNote,n=this.lastNote,a=this.renderOptions;this.applyLineStyle();let o={x:0,y:0},r={x:0,y:0};this.firstIndexes.forEach((g,f)=>{const S=this.lastIndexes[f];o=i.getModifierStartXY(2,g),r=n.getModifierStartXY(1,S);const x=o.y>r.y;o.x+=i.getMetrics().modRightPx+a.paddingLeft,r.x-=n.getMetrics().modLeftPx+a.paddingRight;const m=i.getGlyphWidth();i.getKeyProps()[g].displaced&&i.getStemDirection()===1&&(o.x+=m+a.paddingLeft),n.getKeyProps()[S].displaced&&n.getStemDirection()===-1&&(r.x-=m+a.paddingRight),o.y+=x?-3:1,r.y+=x?2:0,this.drawArrowLine(e,o,r)});const s=this.width,c=a.textJustification;let u=0;c===ft.TextJustification.LEFT?u=o.x:c===ft.TextJustification.CENTER?u=(r.x-o.x)/2+o.x-s/2:c===ft.TextJustification.RIGHT&&(u=r.x-s);let d=0;const h=a.textPositionVertical;h===ft.TextVerticalPosition.TOP?d=i.checkStave().getYForTopText():h===ft.TextVerticalPosition.BOTTOM&&(d=i.checkStave().getYForBottomText(D.TEXT_HEIGHT_OFFSET_HACK));const l=a.color;this.applyStyle(e,{fillStyle:l,strokeStyle:l}),this.renderText(e,u,d)}}ft.TextVerticalPosition={TOP:1,BOTTOM:2};ft.TextJustification=mt;class Wi extends p{static get CATEGORY(){return"System"}constructor(e={}){super(),this.setOptions(e),this.partStaves=[],this.partStaveInfos=[],this.partVoices=[]}setOptions(e={}){if(!e.factory)throw new w("NoFactory","System.setOptions(options) requires a factory.");this.factory=e.factory,this.options=Object.assign(Object.assign({factory:this.factory,x:10,y:10,width:500,spaceBetweenStaves:12,autoWidth:!1,noJustification:!1,debugFormatter:!1,formatIterations:0,noPadding:!1},e),{details:Object.assign({alpha:.5},e.details),formatOptions:Object.assign({},e.formatOptions)}),this.options.noJustification===!1&&typeof e.width>"u"&&(this.options.autoWidth=!0)}getX(){return this.options.x}setX(e){return this.options.x=e,this.partStaves.forEach(i=>{i.setX(e)}),this}getY(){return this.options.y}setY(e){return this.options.y=e,this.partStaves.forEach(i=>{i.setY(e)}),this}getStaves(){return this.partStaves}getVoices(){return this.partVoices}setContext(e){return super.setContext(e),this.factory.setContext(e),this}addConnector(e="double"){return this.connector=this.factory.StaveConnector({topStave:this.partStaves[0],bottomStave:this.partStaves[this.partStaves.length-1],type:e}),this.connector}addStave(e){var i;const n=Object.assign({leftBar:!1},e.options),a=(i=e.stave)!==null&&i!==void 0?i:this.factory.Stave({x:this.options.x,y:this.options.y,width:this.options.width,options:n}),o=Object.assign(Object.assign({spaceAbove:0,spaceBelow:0,debugNoteMetrics:!1,noJustification:!1},e),{options:n}),r=this.getContext();return o.voices.forEach(s=>{s.setContext(r).setStave(a).getTickables().forEach(c=>c.setStave(a)),this.partVoices.push(s)}),this.partStaves.push(a),this.partStaveInfos.push(o),a}addVoices(e){const i=this.getContext();e.forEach(n=>{n.setContext(i),this.partVoices.push(n)})}format(){const e=this.options.details;let i=0;const n=new rt(e);this.formatter=n;let a=this.options.y,o=0;const r=[];this.partStaves.forEach((s,c)=>{a=a+s.space(this.partStaveInfos[c].spaceAbove),s.setY(a),a=a+s.space(this.partStaveInfos[c].spaceBelow),a=a+s.space(this.options.spaceBetweenStaves),this.partStaveInfos[c].debugNoteMetrics&&(r.push({y:a,stave:s}),a+=15),o=Math.max(o,s.getNoteStartX())}),this.partVoices.forEach(s=>{s.getTickables().forEach(c=>{const u=c.getStave();u&&c.setStave(u)})}),n.joinVoices(this.partVoices),this.partStaves.forEach(s=>s.setNoteStartX(o)),this.options.autoWidth&&this.partVoices.length>0?(i=n.preCalculateMinTotalWidth(this.partVoices),this.options.width=i+Vt.rightPadding+(o-this.options.x),this.partStaves.forEach(s=>{s.setWidth(this.options.width)})):i=this.options.noPadding?this.options.width-(o-this.options.x):this.options.width-(o-this.options.x)-Vt.defaultPadding,this.partVoices.length>0&&n.format(this.partVoices,this.options.noJustification?0:i,this.options.formatOptions),n.postFormat();for(let s=0;s<this.options.formatIterations;s++)n.tune(e);this.startX=o,this.debugNoteMetricsYs=r,this.lastY=a,Vt.formatBegModifiers(this.partStaves)}getBoundingBox(){var e;return new Nt(this.options.x,this.options.y,this.options.width,((e=this.lastY)!==null&&e!==void 0?e:0)-this.options.y)}draw(){const e=this.checkContext();if(!this.formatter||!this.startX||!this.lastY||!this.debugNoteMetricsYs)throw new w("NoFormatter","format() must be called before draw()");this.setRendered(),this.options.debugFormatter&&rt.plotDebugging(e,this.formatter,this.startX,this.options.y,this.lastY),this.debugNoteMetricsYs.forEach(i=>{this.partVoices.forEach(n=>{n.getTickables().forEach(a=>{a.getStave()===i.stave&&$.plotMetrics(e,a,i.y)})})})}}function Xn(t,e){const i=[];let n=[];for(let a=1;a<=t;a++)e.indexOf(a)>-1?(i.push(n),n=[]):n.push(a);return n.length>0&&i.push(n),i}function Vn(t,e,i,n){const a=n!==1,o=n!==-1,r=i.getSpacingBetweenLines(),s=i.getNumLines(),c=[];return e.forEach(u=>{const d=u.indexOf(s)>-1,h=u.indexOf(1)>-1;if(a&&h||o&&d)return;u.length===1&&u.push(u[0]);const l=[];u.forEach((g,f,S)=>{const x=g===1,m=g===s;let T=i.getYForLine(g-1);f===0&&!x?T-=r/2-1:f===S.length-1&&!m&&(T+=r/2-1),l.push(T),n===1&&x?l.push(t-2):n===-1&&m&&l.push(t+2)}),c.push(l.sort((g,f)=>g-f))}),c}class me extends Ge{static get CATEGORY(){return"TabNote"}constructor(e,i=!1){super(e),this.fretElement=[],this.greatestString=()=>this.positions.map(n=>n.str).reduce((n,a)=>n>a?n:a),this.leastString=()=>this.positions.map(n=>n.str).reduce((n,a)=>n<a?n:a),this.ghost=!1,this.positions=e.positions||[],this.renderOptions=Object.assign(Object.assign({},this.renderOptions),{drawStem:i,drawDots:i,drawStemThroughStave:!1,yShift:0}),this.glyphProps=$.getGlyphProps(this.duration,this.noteType),_(this.glyphProps,"BadArguments",`No glyph found for duration '${this.duration}' and type '${this.noteType}'`),this.buildStem(),e.stemDirection?this.setStemDirection(e.stemDirection):this.setStemDirection(k.UP),this.ghost=!1,this.updateWidth()}reset(){return super.reset(),this.stave&&this.setStave(this.stave),this}setGhost(e){return this.ghost=e,this.updateWidth(),this}hasStem(){return!!this.renderOptions.drawStem}getStemExtension(){return this.stemExtensionOverride!==void 0?this.stemExtensionOverride:this.flag.getHeight()>k.HEIGHT?this.flag.getHeight()-k.HEIGHT:0}static tabToElement(e){let i;return e.toUpperCase()==="X"?(i=new p("TabNote"),i.setText(E.accidentalDoubleSharp)):(i=new p("TabNote.text"),i.setText(e),i.setYShift(i.getHeight()/2)),i}updateWidth(){this.fretElement=[],this.width=0;for(let e=0;e<this.positions.length;++e){let i=this.positions[e].fret;this.ghost&&(i="("+i+")");const n=me.tabToElement(i.toString());this.fretElement.push(n),this.width=Math.max(n.getWidth(),this.width)}}setStave(e){super.setStave(e);const i=e.getContext();this.setContext(i);const n=this.positions.map(({str:a})=>e.getYForLine(Number(a)-1));return this.setYs(n),this.stem&&this.stem.setYBounds(this.getStemY(),this.getStemY()),this}getPositions(){return this.positions}getModifierStartXY(e,i){if(!this.preFormatted)throw new w("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");if(this.ys.length===0)throw new w("NoYValues","No Y-Values calculated for this note.");let n=0;return e===v.Position.LEFT?n=-2:e===v.Position.RIGHT?n=this.width+2:(e===v.Position.BELOW||e===v.Position.ABOVE)&&(n=this.width/2),{x:this.getAbsoluteX()+n,y:this.ys[i]}}getLineForRest(){return Number(this.positions[0].str)}preFormat(){this.preFormatted||(this.modifierContext&&this.modifierContext.preFormat(),this.preFormatted=!0)}getStemX(){return this.getCenterGlyphX()}getStemY(){const e=this.checkStave().getNumLines(),i=-.5,n=e-.5,a=k.UP===this.stemDirection?i:n;return this.checkStave().getYForLine(a)}getStemExtents(){return this.checkStem().getExtents()}drawFlag(){const{beam:e,glyphProps:i,renderOptions:{drawStem:n}}=this,a=this.checkContext(),o=e===void 0&&n;if(i.codeFlagUp&&o){const r=this.getStemX(),s=this.getStemDirection()===k.DOWN?this.getStemY()-this.checkStem().getHeight()-this.getStemExtension():this.getStemY()-this.checkStem().getHeight()+this.getStemExtension();this.flag.setContext(a).setX(r).setY(s).drawWithStyle()}}drawModifiers(){this.modifiers.forEach(e=>{Gi(e)&&!this.renderOptions.drawDots||(e.setContext(this.getContext()),e.drawWithStyle())})}drawStemThrough(){const e=this.getStemX(),i=this.getStemY(),n=this.checkContext(),a=this.renderOptions.drawStem,o=this.renderOptions.drawStemThroughStave;if(a&&o){const r=this.checkStave().getNumLines(),s=this.positions.map(d=>Number(d.str)),c=Xn(r,s),u=Vn(i,c,this.checkStave(),this.getStemDirection());n.setLineWidth(k.WIDTH),u.forEach(d=>{d.length!==0&&(n.beginPath(),n.moveTo(e,d[0]),n.lineTo(e,d[d.length-1]),n.stroke(),n.closePath())})}}drawPositions(){const e=this.checkContext(),i=this.getAbsoluteX(),n=this.ys;for(let a=0;a<this.positions.length;++a){const o=n[a]+this.renderOptions.yShift,r=this.fretElement[a],s=i-r.getWidth()/2;e.clearRect(s-2,o-3,r.getWidth()+4,6),r.renderText(e,s,o)}}draw(){const e=this.checkContext();if(this.ys.length===0)throw new w("NoYValues","Can't draw note without Y values.");this.setRendered();const i=this.beam===void 0&&this.renderOptions.drawStem;if(e.openGroup("tabnote",this.getAttribute("id")),this.drawPositions(),this.drawStemThrough(),this.stem&&i){const n=this.getStemX();this.stem.setNoteHeadXBounds(n,n),this.stem.setContext(e).drawWithStyle()}this.drawFlag(),this.drawModifiers(),e.closeGroup()}}class Ii extends Vt{static get CATEGORY(){return"TabStave"}constructor(e,i,n,a){const o=Object.assign({spacingBetweenLinesPx:13,numLines:6,topTextPosition:1},a);super(e,i,n,o)}getYForGlyphs(){return this.getYForLine(2.5)}addTabGlyph(){return this.addClef("tab"),this}}function Yn(...t){ae.DEBUG&&j("VexFlow.TextBracket",t)}var Bt;(function(t){t[t.TOP=1]="TOP",t[t.BOTTOM=-1]="BOTTOM"})(Bt||(Bt={}));class ae extends p{static get CATEGORY(){return"TextBracket"}static get Position(){return Bt}static get PositionString(){return{top:Bt.TOP,bottom:Bt.BOTTOM}}constructor({start:e,stop:i,text:n="",superscript:a="",position:o=Bt.TOP}){super(),this.start=e,this.stop=i,this.textElement=new p("TextBracket"),this.textElement.setText(n),this.superscriptElement=new p("TextBracket"),this.superscriptElement.setText(a);const r=W.scaleSize(this.fontInfo.size,.714286);this.superscriptElement.setFontSize(r),this.position=typeof o=="string"?ae.PositionString[o]:o,this.line=1,this.renderOptions={dashed:!0,dash:[5],color:"black",lineWidth:1,showBracket:!0,bracketHeight:8,underlineSuperscript:!0}}applyStyle(e){this.textElement.setFont(this.fontInfo);const{family:i,size:n,weight:a,style:o}=this.fontInfo,r=W.scaleSize(n,.714286);this.superscriptElement.setFont(i,r,a,o);const s=this.renderOptions;return e.setStrokeStyle(s.color),e.setFillStyle(s.color),e.setLineWidth(s.lineWidth),this}setDashed(e,i){return this.renderOptions.dashed=e,i&&(this.renderOptions.dash=i),this}setLine(e){return this.line=e,this}draw(){const e=this.checkContext();this.setRendered();let i=0;switch(this.position){case Bt.TOP:i=this.start.checkStave().getYForTopText(this.line);break;case Bt.BOTTOM:i=this.start.checkStave().getYForBottomText(this.line+D.TEXT_HEIGHT_OFFSET_HACK);break;default:throw new w("InvalidPosition",`The position ${this.position} is invalid.`)}const n={x:this.start.getAbsoluteX(),y:i},a={x:this.stop.getAbsoluteX(),y:i};Yn("Rendering TextBracket: start:",n,"stop:",a,"y:",i);const o=this.renderOptions.bracketHeight*this.position;this.textElement.renderText(e,n.x,n.y);const r=this.textElement.getWidth(),s=this.textElement.getHeight(),c=n.y-s/2.5;this.superscriptElement.renderText(e,n.x+r+1,c);const u=this.superscriptElement.getWidth(),d=this.superscriptElement.getHeight();let h=n.x,l=c;const g=a.x+this.stop.getGlyphWidth();this.position===Bt.TOP?(h+=r+u+5,l-=d/2.7):this.position===Bt.BOTTOM&&(l+=d/2.7,h+=r+2,this.renderOptions.underlineSuperscript||(h+=u)),this.renderOptions.dashed?(V.drawDashedLine(e,h,l,g,l,this.renderOptions.dash),this.renderOptions.showBracket&&V.drawDashedLine(e,g,l+1*this.position,g,l+o,this.renderOptions.dash)):(e.beginPath(),e.moveTo(h,l),e.lineTo(g,l),this.renderOptions.showBracket&&e.lineTo(g,l+o),e.stroke(),e.closePath())}}ae.DEBUG=!1;function Ti(...t){oe.DEBUG&&j("VexFlow.TextDynamics",t)}class oe extends ${static get CATEGORY(){return"TextDynamics"}static get GLYPHS(){return{f:E.dynamicForte,p:E.dynamicPiano,m:E.dynamicMezzo,s:E.dynamicSforzando,z:E.dynamicZ,r:E.dynamicRinforzando}}constructor(e){var i,n;super(e),this.sequence=((i=e.text)!==null&&i!==void 0?i:"").toLowerCase(),this.line=(n=e.line)!==null&&n!==void 0?n:0,this.text="",Ti("New Dynamics Text: ",this.sequence)}setLine(e){return this.line=e,this}preFormat(){return this.text="",this.sequence.split("").forEach(e=>{const i=oe.GLYPHS[e];if(!i)throw new w("Invalid dynamics character: "+e);this.text+=i}),this.preFormatted=!0,this}draw(){this.setRendered();const e=this.getAbsoluteX(),i=this.checkStave().getYForLine(this.line+-3);Ti("Rendering Dynamics: ",this.sequence),this.renderText(this.checkContext(),e,i)}}oe.DEBUG=!1;class Hi extends ${static get CATEGORY(){return"TimeSigNote"}constructor(e,i){super({duration:"b"}),this.timeSig=new pt(e,i),this.setWidth(this.timeSig.getWidth()),this.ignoreTicks=!0}addToModifierContext(e){return this}preFormat(){return this.preFormatted=!0,this}draw(){const e=this.checkStave(),i=this.checkContext();this.setRendered(),i.openGroup("timesignote",this.getAttribute("id")),this.timeSig.drawAt(i,e,this.getAbsoluteX()),i.closeGroup()}}class lt extends p{static get CATEGORY(){return"Tuplet"}static get LOCATION_TOP(){return 1}static get LOCATION_BOTTOM(){return-1}static get NESTING_OFFSET(){return 15}constructor(e,i={}){if(super(),!e||!e.length)throw new w("BadArguments","No notes provided for tuplet.");this.notes=e;const n=i.numNotes!==void 0?i.numNotes:e.length,a=i.notesOccupied||2,o=i.bracketed!==void 0?i.bracketed:e.some(d=>!d.hasBeam()),r=i.ratioed!==void 0?i.ratioed:Math.abs(a-n)>1,s=i.location||lt.LOCATION_TOP,c=i.yOffset||F.get("Tuplet.yOffset"),u=i.textYOffset||F.get("Tuplet.textYOffset");this.options={bracketed:o,location:s,notesOccupied:a,numNotes:n,ratioed:r,yOffset:c,textYOffset:u},this.textElement=new p("Tuplet"),this.setTupletLocation(s||lt.LOCATION_TOP),rt.AlignRestsToNotes(e,!0,!0),this.resolveGlyphs(),this.attach()}attach(){for(let e=0;e<this.notes.length;e++)this.notes[e].setTuplet(this)}detach(){for(let e=0;e<this.notes.length;e++)this.notes[e].resetTuplet(this)}setBracketed(e){return this.options.bracketed=e,this}setRatioed(e){return this.options.ratioed=e,this}setTupletLocation(e){return e!==lt.LOCATION_TOP&&e!==lt.LOCATION_BOTTOM&&(console.warn(`Invalid tuplet location [${e}]. Using Tuplet.LOCATION_TOP.`),e=lt.LOCATION_TOP),this.options.location=e,this}getNotes(){return this.notes}getNoteCount(){return this.options.numNotes}getNotesOccupied(){return this.options.notesOccupied}setNotesOccupied(e){this.detach(),this.options.notesOccupied=e,this.resolveGlyphs(),this.attach()}resolveGlyphs(){let e="",i="",n=this.options.numNotes;for(;n>=1;)e=String.fromCharCode(59520+n%10)+e,n=Math.floor(n/10);if(this.options.ratioed){for(n=this.options.notesOccupied;n>=1;)i=String.fromCharCode(59520+n%10)+i,n=Math.floor(n/10);i=E.tupletColon+i}this.textElement.setText(e+i)}getNestedTupletCount(){const{location:e}=this.options,i=this.notes[0];let n=o(i,e),a=o(i,e);function o(r,s){return r.getTupletStack().filter(c=>c.options.location===s).length}return this.notes.forEach(r=>{const s=o(r,e);n=s>n?s:n,a=s<a?s:a}),n-a}getYPosition(){var e;const i=this.getNestedTupletCount()*lt.NESTING_OFFSET*-this.options.location,n=(e=this.options.yOffset)!==null&&e!==void 0?e:0,a=this.notes[0];let o;if(this.options.location===lt.LOCATION_TOP){o=a.checkStave().getYForLine(0)-1.5*D.STAVE_LINE_DISTANCE;for(let r=0;r<this.notes.length;++r){const s=this.notes[r];let c=0;const u=s.getModifierContext();u&&(c=Math.max(c,u.getState().topTextLine));const d=s.getYForTopText(c)-2*D.STAVE_LINE_DISTANCE;if(s.hasStem()||s.isRest()){const h=s.getStemDirection()===k.UP?s.getStemExtents().topY-D.STAVE_LINE_DISTANCE:s.getStemExtents().baseY-2*D.STAVE_LINE_DISTANCE;o=Math.min(h,o),c>0&&(o=Math.min(d,o))}}}else{let r=4;this.notes.forEach(s=>{const c=s.getModifierContext();c&&(r=Math.max(r,c.getState().textLine+1))}),o=a.checkStave().getYForLine(r)+2*D.STAVE_LINE_DISTANCE;for(let s=0;s<this.notes.length;++s)if(this.notes[s].hasStem()||this.notes[s].isRest()){const c=this.notes[s].getStemDirection()===k.UP?this.notes[s].getStemExtents().baseY+2*D.STAVE_LINE_DISTANCE:this.notes[s].getStemExtents().topY+D.STAVE_LINE_DISTANCE;c>o&&(o=c)}}return o+i+n}draw(){const{location:e,bracketed:i,textYOffset:n}=this.options,a=this.checkContext();let o=0,r=0;const s=this.notes[0],c=this.notes[this.notes.length-1];i?(o=s.getTieLeftX()-5,this.width=c.getTieRightX()-o+5):(o=s.getStemX(),this.width=c.getStemX()-o),r=this.getYPosition();const d=o+this.width/2-this.textElement.getWidth()/2;if(a.openGroup("tuplet",this.getAttribute("id")),i){const l=this.width/2-this.textElement.getWidth()/2-5;l>0&&(a.fillRect(o,r,l,1),a.fillRect(o+this.width/2+this.textElement.getWidth()/2+5,r,l,1),a.fillRect(o,r+(e===lt.LOCATION_BOTTOM?1:0),1,e*10),a.fillRect(o+this.width,r+(e===lt.LOCATION_BOTTOM?1:0),1,e*10))}this.textElement.renderText(a,d,r+this.textElement.getHeight()/2+(e===lt.LOCATION_TOP?-1:1)*n);const h=this.getBoundingBox();a.pointerRect(h.getX(),h.getY(),h.getW(),h.getH()),a.closeGroup(),this.setRendered()}}function _n(...t){Ie.DEBUG&&j("VexFlow.VibratoBracket",t)}class Ie extends p{static get CATEGORY(){return"VibratoBracket"}constructor(e){super(),this.vibrato=new ii,e.start&&(this.start=e.start),e.stop&&(this.stop=e.stop),this.line=1}setLine(e){return this.line=e,this}setVibratoCode(e){return this.vibrato.setVibratoCode(e),this}draw(){const e=this.checkContext();this.setRendered();const i=this.start&&this.start.checkStave().getYForTopText(this.line)||this.stop&&this.stop.checkStave().getYForTopText(this.line)||0,n=this.start&&this.start.getAbsoluteX()||this.stop&&this.stop.checkStave().getTieStartX()||0,a=this.stop&&this.stop.getAbsoluteX()-this.stop.getWidth()-5||this.start&&this.start.checkStave().getTieEndX()-10||0;this.vibrato.setVibratoWidth(a-n),_n("Rendering VibratoBracket: startX:",n,"stopX:",a,"y:",i),this.vibrato.renderText(e,n,i)}}Ie.DEBUG=!1;function xi(...t){Se.DEBUG&&j("VexFlow.Factory",t)}class Se{static newFromElementId(e,i=500,n=200){return new Se({renderer:{elementId:e,width:i,height:n}})}constructor(e={}){xi("New factory: ",e),this.options={stave:{space:10},renderer:{elementId:"",width:500,height:200,background:"#FFF"}},this.setOptions(e)}reset(){this.renderQ=[],this.systems=[],this.staves=[],this.voices=[],this.stave=void 0}setOptions(e){this.options=Object.assign(Object.assign({},this.options),e),this.initRenderer(),this.reset()}initRenderer(){const{elementId:e,width:i,height:n,background:a}=this.options.renderer;if(e===null)return;if(e==="")throw xi(this),new w("renderer.elementId not set in FactoryOptions");let o=this.options.renderer.backend;if(o===void 0){const r=document.getElementById(e);Je(r)?o=V.Backends.CANVAS:o=V.Backends.SVG}this.context=V.buildContext(e,o,i,n,a)}getContext(){return this.context}setContext(e){return this.context=e,this}getStave(){return this.stave}getVoices(){return this.voices}Stave(e){const i=this.options.stave.space,n=Object.assign({x:0,y:0,width:this.options.renderer.width-i*1,options:{spacingBetweenLinesPx:i*1}},e),a=new Vt(n.x,n.y,n.width,n.options);return this.staves.push(a),a.setContext(this.context),this.stave=a,a}TabStave(e){const i=this.options.stave.space,n=Object.assign({x:0,y:0,width:this.options.renderer.width-i*1,options:{spacingBetweenLinesPx:i*1.3}},e),a=new Ii(n.x,n.y,n.width,n.options);return this.staves.push(a),a.setContext(this.context),this.stave=a,a}StaveNote(e){const i=new Tt(e);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i}GlyphNote(e,i,n){const a=new ni(e,i,n);return this.stave&&a.setStave(this.stave),a.setContext(this.context),this.renderQ.push(a),a}RepeatNote(e,i,n){const a=new Mi(e,i,n);return this.stave&&a.setStave(this.stave),a.setContext(this.context),this.renderQ.push(a),a}GhostNote(e){const i=new Oi(e);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i}TextNote(e){const i=new ne(e);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i}BarNote(e={}){const i=new ve(e.type);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i}ClefNote(e){const i=Object.assign({type:"treble",options:{size:"default",annotation:void 0}},e),n=new Fi(i.type,i.options.size,i.options.annotation);return this.stave&&n.setStave(this.stave),n.setContext(this.context),this.renderQ.push(n),n}TimeSigNote(e){const i=Object.assign({time:"4/4"},e),n=new Hi(i.time);return this.stave&&n.setStave(this.stave),n.setContext(this.context),this.renderQ.push(n),n}KeySigNote(e){const i=new Ri(e.key,e.cancelKey,e.alterKey);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i}TabNote(e){const i=new me(e);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i}GraceNote(e){const i=new We(e);return this.stave&&i.setStave(this.stave),i.setContext(this.context),i}GraceNoteGroup(e){const i=new fe(e.notes,e.slur);return i.setContext(this.context),i}Accidental(e){const i=new Kt(e.type);return i.setContext(this.context),i}Annotation(e){const i=Object.assign({text:"p",hJustify:at.CENTER,vJustify:ot.BOTTOM},e),n=new dt(i.text);return n.setJustification(i.hJustify),n.setVerticalJustification(i.vJustify),n.setFont(i.font),n.setContext(this.context),n}ChordSymbol(e){const i=Object.assign({vJustify:"top",hJustify:"center"},e),n=new Y;return n.setHorizontal(i.hJustify),n.setVertical(i.vJustify),typeof i.fontFamily=="string"&&typeof i.fontSize=="number"?typeof i.fontWeight=="string"?n.setFont(i.fontFamily,i.fontSize,i.fontWeight):n.setFont(i.fontFamily,i.fontSize,""):typeof i.fontSize=="number"&&n.setFontSize(i.fontSize),n.setContext(this.context),n}Articulation(e){var i;const n=new Rt((i=e?.type)!==null&&i!==void 0?i:"a.");return e?.position!==void 0&&n.setPosition(e.position),e?.betweenLines!==void 0&&n.setBetweenLines(e.betweenLines),n.setContext(this.context),n}Ornament(e,i){const n=Object.assign({type:e,accidental:""},i),a=new st(e);return i?.position!==void 0&&a.setPosition(i.position),n.upperAccidental&&a.setUpperAccidental(n.upperAccidental),n.lowerAccidental&&a.setLowerAccidental(n.lowerAccidental),typeof n.delayed<"u"&&a.setDelayed(n.delayed),a.setContext(this.context),a}TextDynamics(e){const i=Object.assign({text:"p",duration:"q",dots:0,line:0},e),n=new oe({text:i.text,line:i.line,duration:i.duration,dots:i.dots});return this.stave&&n.setStave(this.stave),n.setContext(this.context),this.renderQ.push(n),n}Fingering(e){const i=Object.assign({number:"0",position:"left"},e),n=new Ne(i.number);return n.setPosition(i.position),n.setContext(this.context),n}StringNumber(e,i=!0){const n=new ei(e.number);return n.setPosition(e.position),n.setContext(this.context),n.setDrawCircle(i),n}TickContext(){return new le}ModifierContext(){return new ee}MultiMeasureRest(e){const i=_(e.numberOfMeasures,"NoNumberOfMeasures"),n=new Pi(i,e);return n.setContext(this.context),this.renderQ.push(n),n}Voice(e){const i=Object.assign({time:"4/4"},e),n=new bt(i.time);return this.voices.push(n),n}StaveConnector(e){const i=new R(e.topStave,e.bottomStave);return i.setType(e.type).setContext(this.context),this.renderQ.push(i),i}Formatter(e){return new rt(e)}Tuplet(e){const i=Object.assign({notes:[],options:{}},e),n=new lt(i.notes,i.options).setContext(this.context);return this.renderQ.push(n),n}Beam(e){var i,n,a,o,r;const s=new Yt(e.notes,(i=e.options)===null||i===void 0?void 0:i.autoStem).setContext(this.context);return s.breakSecondaryAt((a=(n=e.options)===null||n===void 0?void 0:n.secondaryBeamBreaks)!==null&&a!==void 0?a:[]),!((o=e.options)===null||o===void 0)&&o.partialBeamDirections&&Object.entries((r=e.options)===null||r===void 0?void 0:r.partialBeamDirections).forEach(([c,u])=>{s.setPartialBeamSideAt(Number(c),u)}),this.renderQ.push(s),s}Curve(e){const i=new pe(e.from,e.to,e.options).setContext(this.context);return this.renderQ.push(i),i}StaveTie(e){var i;const n=new Me({firstNote:e.from,lastNote:e.to,firstIndexes:e.firstIndexes,lastIndexes:e.lastIndexes},e.text);return!((i=e.options)===null||i===void 0)&&i.direction&&n.setDirection(e.options.direction),n.setContext(this.context),this.renderQ.push(n),n}StaveLine(e){var i,n;const a=new ft({firstNote:e.from,lastNote:e.to,firstIndexes:e.firstIndexes,lastIndexes:e.lastIndexes});return!((i=e.options)===null||i===void 0)&&i.text&&a.setText(e.options.text),!((n=e.options)===null||n===void 0)&&n.font&&a.setFont(e.options.font),a.setContext(this.context),this.renderQ.push(a),a}VibratoBracket(e){const i=new Ie({start:e.from,stop:e.to});return e.options.line&&i.setLine(e.options.line),e.options.code&&i.setVibratoCode(e.options.code),i.setContext(this.context),this.renderQ.push(i),i}TextBracket(e){const i=new ae({start:e.from,stop:e.to,text:e.text,superscript:e.options.superscript,position:e.options.position});return e.options.line&&i.setLine(e.options.line),e.options.font&&i.setFont(e.options.font),i.setContext(this.context),this.renderQ.push(i),i}System(e={}){e.factory=this;const i=new Wi(e).setContext(this.context);return this.systems.push(i),i}EasyScore(e={}){return e.factory=this,new Re(e)}PedalMarking(e){const i=Object.assign({notes:[],options:{style:"mixed"}},e),n=new X(i.notes);return n.setType(X.typeString[i.options.style]),n.setContext(this.context),this.renderQ.push(n),n}NoteSubGroup(e){const i=Object.assign({notes:[]},e),n=new ti(i.notes);return n.setContext(this.context),n}draw(){const e=this.context;this.systems.forEach(i=>i.setContext(e).format()),this.staves.forEach(i=>i.setContext(e).drawWithStyle()),this.voices.forEach(i=>i.setContext(e).drawWithStyle()),this.renderQ.forEach(i=>{i.isRendered()||i.setContext(e).drawWithStyle()}),this.systems.forEach(i=>i.setContext(e).drawWithStyle()),this.reset()}}Se.DEBUG=!1;class zn extends me{static get CATEGORY(){return"GraceTabNote"}constructor(e){super(e,!1),this.renderOptions=Object.assign(Object.assign({},this.renderOptions),{yShift:.3}),this.updateWidth()}}class jn{constructor(e){this.music=new H,this.setKey(e)}setKey(e){return this.key=e,this.reset(),this}getKey(){return this.key}reset(){if(this.keyParts=this.music.getKeyParts(this.key),this.keyString=this.keyParts.root,this.keyParts.accidental&&(this.keyString+=this.keyParts.accidental),!H.scaleTypes[this.keyParts.type])throw new w("BadArguments",`Unsupported key type: ${this.key}`);this.scale=this.music.getScaleTones(this.music.getNoteValue(this.keyString),H.scaleTypes[this.keyParts.type]),this.scaleMap={},this.scaleMapByValue={},this.originalScaleMapByValue={};const i=H.rootIndexes[this.keyParts.root];for(let n=0;n<H.roots.length;++n){const a=(i+n)%H.roots.length,o=H.roots[a],r=this.music.getRelativeNoteName(o,this.scale[n]);this.scaleMap[o]=r,this.scaleMapByValue[this.scale[n]]=r,this.originalScaleMapByValue[this.scale[n]]=r}return this}getAccidental(e){const i=this.music.getKeyParts(e).root,n=this.music.getNoteParts(this.scaleMap[i]);return{note:this.scaleMap[i],accidental:n.accidental}}selectNote(e){e=e.toLowerCase();const i=this.music.getNoteParts(e),n=this.scaleMap[i.root],a=this.music.getNoteParts(n);if(n===e)return{note:n,accidental:i.accidental,change:!1};const o=this.scaleMapByValue[this.music.getNoteValue(e)];if(o!==void 0)return{note:o,accidental:this.music.getNoteParts(o).accidental,change:!1};const r=this.originalScaleMapByValue[this.music.getNoteValue(e)];return r!==void 0?(this.scaleMap[a.root]=r,delete this.scaleMapByValue[this.music.getNoteValue(n)],this.scaleMapByValue[this.music.getNoteValue(e)]=r,{note:r,accidental:this.music.getNoteParts(r).accidental,change:!0}):a.root===e?(delete this.scaleMapByValue[this.music.getNoteValue(this.scaleMap[i.root])],this.scaleMapByValue[this.music.getNoteValue(a.root)]=a.root,this.scaleMap[a.root]=a.root,{note:a.root,accidental:void 0,change:!0}):(delete this.scaleMapByValue[this.music.getNoteValue(this.scaleMap[i.root])],this.scaleMapByValue[this.music.getNoteValue(e)]=e,delete this.scaleMap[a.root],this.scaleMap[a.root]=e,{note:e,accidental:i.accidental,change:!0})}}class Gt extends p{static get CATEGORY(){return"StaveHairpin"}static FormatByTicksAndDraw(e,i,n,a,o,r){var s,c;const u=i.pixelsPerTick;if(u===null)throw new w("BadArguments","A valid Formatter must be provide to draw offsets by ticks.");const d=u*((s=r.leftShiftTicks)!==null&&s!==void 0?s:0),h=u*((c=r.rightShiftTicks)!==null&&c!==void 0?c:0),l={height:r.height,yShift:r.yShift,leftShiftPx:d,rightShiftPx:h,rightShiftTicks:0,leftShiftTicks:0};new Gt({firstNote:n.firstNote,lastNote:n.lastNote},a).setContext(e).setRenderOptions(l).setPosition(o).drawWithStyle()}constructor(e,i){super(),this.setNotes(e),this.hairpin=i,this.position=v.Position.BELOW,this.renderOptions={height:10,yShift:0,leftShiftPx:0,rightShiftPx:0,rightShiftTicks:0,leftShiftTicks:0}}setPosition(e){return(e===v.Position.ABOVE||e===v.Position.BELOW)&&(this.position=e),this}setRenderOptions(e){return this.renderOptions=e,this}setNotes(e){if(!e.firstNote&&!e.lastNote)throw new w("BadArguments","Hairpin needs to have either firstNote or lastNote set.");return this.notes=e,this.firstNote=e.firstNote,this.lastNote=e.lastNote,this}renderHairpin(e){const i=this.checkContext();let n=this.renderOptions.yShift+20,a=e.firstY;this.position===v.Position.ABOVE&&(n=-n+30,a=e.firstY-e.staffHeight);const o=this.renderOptions.leftShiftPx,r=this.renderOptions.rightShiftPx;switch(i.beginPath(),this.hairpin){case Gt.type.CRESC:i.moveTo(e.lastX+r,a+n),i.lineTo(e.firstX+o,a+this.renderOptions.height/2+n),i.lineTo(e.lastX+r,a+this.renderOptions.height+n);break;case Gt.type.DECRESC:i.moveTo(e.firstX+o,a+n),i.lineTo(e.lastX+r,a+this.renderOptions.height/2+n),i.lineTo(e.firstX+o,a+this.renderOptions.height+n);break}i.stroke(),i.closePath()}draw(){this.checkContext(),this.setRendered();const e=this.firstNote,i=this.lastNote;if(!e||!i)throw new w("NoNote","Notes required to draw");const n=e.getModifierStartXY(this.position,0),a=i.getModifierStartXY(this.position,0);this.renderHairpin({firstX:n.x,lastX:a.x,firstY:e.checkStave().getY()+e.checkStave().getHeight(),lastY:i.checkStave().getY()+i.checkStave().getHeight(),staffHeight:e.checkStave().getHeight()})}}Gt.type={CRESC:1,DECRESC:2};class Ct extends te{static get CATEGORY(){return"TabSlide"}static get SLIDE_UP(){return 1}static get SLIDE_DOWN(){return-1}static createSlideUp(e){return new Ct(e,Ct.SLIDE_UP)}static createSlideDown(e){return new Ct(e,Ct.SLIDE_DOWN)}constructor(e,i){if(super(e,"sl."),!i){let n=e.firstNote.getPositions()[0].fret;typeof n=="string"&&(n=parseInt(n,10));let a=e.lastNote.getPositions()[0].fret;typeof a=="string"&&(a=parseInt(a,10)),isNaN(n)||isNaN(a)?i=Ct.SLIDE_UP:i=n>a?Ct.SLIDE_DOWN:Ct.SLIDE_UP}this.direction=i,this.renderOptions.cp1=11,this.renderOptions.cp2=14,this.renderOptions.yShift=.5}renderTie(e){if(e.firstYs.length===0||e.lastYs.length===0)throw new w("BadArguments","No Y-values to render");const i=this.checkContext(),n=e.firstX,a=e.firstYs,o=e.lastX,r=e.direction;if(r!==Ct.SLIDE_UP&&r!==Ct.SLIDE_DOWN)throw new w("BadSlide","Invalid slide direction");const s=this.notes.firstIndexes;for(let c=0;c<s.length;++c){const u=a[s[c]]+this.renderOptions.yShift;if(isNaN(u))throw new w("BadArguments","Bad indexes for slide rendering.");i.beginPath(),i.moveTo(n,u+3*r),i.lineTo(o,u-3*r),i.closePath(),i.stroke()}this.setRendered()}}class qn extends v{static get CATEGORY(){return"Tremolo"}constructor(e){super(),this.num=e,this.position=v.Position.CENTER,this.text=E.tremolo1}draw(){const e=this.checkContext(),i=this.checkAttachedNote();this.setRendered();const n=i.getStemDirection(),a=i.getFontScale(),o=F.get("Tremolo.spacing")*n*a,r=i.getAbsoluteX()+(n===k.UP?i.getGlyphWidth()-k.WIDTH/2:k.WIDTH/2);let s=i.getStemExtents().topY+(this.num<=3?o:0);this.fontInfo.size=F.get("Tremolo.fontSize")*a;for(let c=0;c<this.num;++c)this.renderText(e,r,s),s+=o}}class Le{static get names(){return{standard:"E/5,B/4,G/4,D/4,A/3,E/3",dagdad:"D/5,A/4,G/4,D/4,A/3,D/3",dropd:"E/5,B/4,G/4,D/4,A/3,D/3",eb:"Eb/5,Bb/4,Gb/4,Db/4,Ab/3,Db/3",standardBanjo:"D/5,B/4,G/4,D/4,G/5"}}constructor(e="E/5,B/4,G/4,D/4,A/3,E/3,B/2,E/2"){this.tuningValues=[],this.setTuning(e)}noteToInteger(e){var i;return(i=D.keyProperties(e).intValue)!==null&&i!==void 0?i:-1}setTuning(e){Le.names[e]&&(e=Le.names[e]),this.tuningValues=[];const i=e.split(/\s*,\s*/);if(i.length===0)throw new w("BadArguments",`Invalid tuning string: ${e}`);for(let n=0;n<i.length;++n)this.tuningValues[n]=this.noteToInteger(i[n])}getValueForString(e){const i=Number(e);if(i<1||i>this.tuningValues.length)throw new w("BadArguments",`String number must be between 1 and ${this.tuningValues.length}:${e}`);return this.tuningValues[i-1]}getValueForFret(e,i){const n=this.getValueForString(i),a=Number(e);if(a<0)throw new w("BadArguments",`Fret number must be 0 or higher: ${e}`);return n+a}getNoteForFret(e,i){const n=this.getValueForFret(e,i),a=Math.floor(n/12),o=n%12;return`${D.integerToNote(o)}/${a}`}}const $n="5.0.0",Kn="0ca6f889545c33cce851b420c24945f6eb685aeb",Qn="2025-03-05T17:05:43.991Z";var Jn=function(t,e,i,n){function a(o){return o instanceof i?o:new i(function(r){r(o)})}return new(i||(i=Promise))(function(o,r){function s(d){try{u(n.next(d))}catch(h){r(h)}}function c(d){try{u(n.throw(d))}catch(h){r(h)}}function u(d){d.done?o(d.value):a(d.value).then(s,c)}u((n=n.apply(t,e||[])).next())})};class b{static loadFonts(...e){return Jn(this,void 0,void 0,function*(){e||(e=Object.keys(W.FILES));const i=[];for(const n of e)i.push(W.load(n));yield Promise.all(i)})}static setFonts(...e){ue.fontFamily=e.join(","),F.clear()}static getFonts(){return F.get("fontFamily").split(",")}static get RENDER_PRECISION_PLACES(){return D.RENDER_PRECISION_PLACES}static set RENDER_PRECISION_PLACES(e){D.RENDER_PRECISION_PLACES=e}static get SOFTMAX_FACTOR(){return D.SOFTMAX_FACTOR}static set SOFTMAX_FACTOR(e){D.SOFTMAX_FACTOR=e}static get UNISON(){return D.UNISON}static set UNISON(e){D.UNISON=e}static get NOTATION_FONT_SCALE(){return D.NOTATION_FONT_SCALE}static set NOTATION_FONT_SCALE(e){D.NOTATION_FONT_SCALE=e}static get TABLATURE_FONT_SCALE(){return D.TABLATURE_FONT_SCALE}static set TABLATURE_FONT_SCALE(e){D.TABLATURE_FONT_SCALE=e}static get RESOLUTION(){return D.RESOLUTION}static set RESOLUTION(e){D.RESOLUTION=e}static get SLASH_NOTEHEAD_WIDTH(){return D.SLASH_NOTEHEAD_WIDTH}static set SLASH_NOTEHEAD_WIDTH(e){D.SLASH_NOTEHEAD_WIDTH=e}static get STAVE_LINE_DISTANCE(){return D.STAVE_LINE_DISTANCE}static set STAVE_LINE_DISTANCE(e){D.STAVE_LINE_DISTANCE=e}static get STAVE_LINE_THICKNESS(){return ue.Stave.lineWidth}static set STAVE_LINE_THICKNESS(e){ue.Stave.lineWidth=e,ue.TabStave.lineWidth=e,F.clear("Stave"),F.clear("TabStave")}static get STEM_HEIGHT(){return D.STEM_HEIGHT}static set STEM_HEIGHT(e){D.STEM_HEIGHT=e}static get STEM_WIDTH(){return D.STEM_WIDTH}static set STEM_WIDTH(e){D.STEM_WIDTH=e}static get TIME4_4(){return D.TIME4_4}static get unicode(){return D.unicode}static keySignature(e){return D.keySignature(e)}static hasKeySignature(e){return D.hasKeySignature(e)}static getKeySignatures(){return D.getKeySignatures()}static clefProperties(e){return D.clefProperties(e)}static keyProperties(e,i,n){return D.keyProperties(e,i,n)}static durationToTicks(e){return D.durationToTicks(e)}}b.BUILD={VERSION:$n,ID:Kn,DATE:Qn,INFO:""};b.Accidental=Kt;b.Annotation=dt;b.Articulation=Rt;b.Barline=At;b.BarNote=ve;b.Beam=Yt;b.Bend=gt;b.BoundingBox=Nt;b.CanvasContext=yt;b.ChordSymbol=Y;b.Clef=ut;b.ClefNote=Fi;b.Crescendo=Ze;b.Curve=pe;b.Dot=Xt;b.EasyScore=Re;b.Element=p;b.Factory=Se;b.Font=W;b.Formatter=rt;b.Fraction=P;b.FretHandFinger=Ne;b.GhostNote=Oi;b.GlyphNote=ni;b.GraceNote=We;b.GraceNoteGroup=fe;b.GraceTabNote=zn;b.KeyManager=jn;b.KeySignature=ie;b.KeySigNote=Ri;b.Modifier=v;b.ModifierContext=ee;b.MultiMeasureRest=Pi;b.Music=H;b.Note=$;b.NoteHead=Pe;b.NoteSubGroup=ti;b.Ornament=st;b.Parenthesis=Ee;b.Parser=Oe;b.PedalMarking=X;b.Registry=Zt;b.RenderContext=Qe;b.Renderer=V;b.RepeatNote=Mi;b.Repetition=z;b.Stave=Vt;b.StaveConnector=R;b.StaveHairpin=Gt;b.StaveLine=ft;b.StaveModifier=Pt;b.StaveNote=Tt;b.StaveTempo=vi;b.StaveText=pi;b.StaveTie=Me;b.Stem=k;b.StringNumber=ei;b.Stroke=Q;b.SVGContext=$t;b.System=Wi;b.TabNote=me;b.TabSlide=Ct;b.TabStave=Ii;b.TabTie=te;b.TextBracket=ae;b.TextDynamics=oe;b.TextNote=ne;b.TickContext=le;b.TimeSignature=pt;b.TimeSigNote=Hi;b.Tremolo=qn;b.Tuning=Le;b.Tuplet=lt;b.Vibrato=ii;b.VibratoBracket=Ie;b.Voice=bt;b.Volta=Ni;b.RuntimeError=w;b.Test=void 0;b.AnnotationHorizontalJustify=at;b.AnnotationVerticalJustify=ot;b.ChordSymbolHorizontalJustify=ct;b.ChordSymbolVerticalJustify=kt;b.SymbolModifiers=It;b.CurvePosition=wt;b.FontWeight=qt;b.FontStyle=Ut;b.Glyphs=E;b.ModifierPosition=U;b.RendererBackends=Ae;b.RendererLineEndType=ke;b.BarlineType=I;b.StaveModifierPosition=O;b.VoltaType=Wt;b.TextBracketPosition=Bt;b.TextJustification=mt;b.VoiceMode=Dt;b.BUILD.INFO="vexflow-core";export{Kt as A,At as B,rt as F,V as R,Vt as S,b as V,Tt as a,bt as b};
